(function (root, factory) {(typeof module === 'object' && module.exports) ? module.exports = factory() : root.ChainsafeLibp2PGossipsub = factory()}(typeof self !== 'undefined' ? self : this, function () {
"use strict";var ChainsafeLibp2PGossipsub=(()=>{var J0=Object.create;var fs=Object.defineProperty;var eh=Object.getOwnPropertyDescriptor;var th=Object.getOwnPropertyNames;var rh=Object.getPrototypeOf,nh=Object.prototype.hasOwnProperty;var Ya=(t=>typeof require<"u"?require:typeof Proxy<"u"?new Proxy(t,{get:(e,r)=>(typeof require<"u"?require:e)[r]}):t)(function(t){if(typeof require<"u")return require.apply(this,arguments);throw Error('Dynamic require of "'+t+'" is not supported')});var G=(t,e)=>()=>(e||t((e={exports:{}}).exports,e),e.exports),De=(t,e)=>{for(var r in e)fs(t,r,{get:e[r],enumerable:!0})},Za=(t,e,r,n)=>{if(e&&typeof e=="object"||typeof e=="function")for(let s of th(e))!nh.call(t,s)&&s!==r&&fs(t,s,{get:()=>e[s],enumerable:!(n=eh(e,s))||n.enumerable});return t};var Se=(t,e,r)=>(r=t!=null?J0(rh(t)):{},Za(e||!t||!t.__esModule?fs(r,"default",{value:t,enumerable:!0}):r,t)),sh=t=>Za(fs({},"__esModule",{value:!0}),t);var Bc=G((px,Cc)=>{"use strict";Cc.exports=mp;function mp(t,e){for(var r=new Array(arguments.length-1),n=0,s=2,i=!0;s<arguments.length;)r[n++]=arguments[s++];return new Promise(function(a,f){r[n]=function(c){if(i)if(i=!1,c)f(c);else{for(var l=new Array(arguments.length-1),h=0;h<l.length;)l[h++]=arguments[h];a.apply(null,l)}};try{t.apply(e||null,r)}catch(u){i&&(i=!1,f(u))}})}});var Rc=G(Pc=>{"use strict";var ys=Pc;ys.length=function(e){var r=e.length;if(!r)return 0;for(var n=0;--r%4>1&&e.charAt(r)==="=";)++n;return Math.ceil(e.length*3)/4-n};var tn=new Array(64),Tc=new Array(123);for(gt=0;gt<64;)Tc[tn[gt]=gt<26?gt+65:gt<52?gt+71:gt<62?gt-4:gt-59|43]=gt++;var gt;ys.encode=function(e,r,n){for(var s=null,i=[],o=0,a=0,f;r<n;){var u=e[r++];switch(a){case 0:i[o++]=tn[u>>2],f=(u&3)<<4,a=1;break;case 1:i[o++]=tn[f|u>>4],f=(u&15)<<2,a=2;break;case 2:i[o++]=tn[f|u>>6],i[o++]=tn[u&63],a=0;break}o>8191&&((s||(s=[])).push(String.fromCharCode.apply(String,i)),o=0)}return a&&(i[o++]=tn[f],i[o++]=61,a===1&&(i[o++]=61)),s?(o&&s.push(String.fromCharCode.apply(String,i.slice(0,o))),s.join("")):String.fromCharCode.apply(String,i.slice(0,o))};var Ac="invalid encoding";ys.decode=function(e,r,n){for(var s=n,i=0,o,a=0;a<e.length;){var f=e.charCodeAt(a++);if(f===61&&i>1)break;if((f=Tc[f])===void 0)throw Error(Ac);switch(i){case 0:o=f,i=1;break;case 1:r[n++]=o<<2|(f&48)>>4,o=f,i=2;break;case 2:r[n++]=(o&15)<<4|(f&60)>>2,o=f,i=3;break;case 3:r[n++]=(o&3)<<6|f,i=0;break}}if(i===1)throw Error(Ac);return n-s};ys.test=function(e){return/^(?:[A-Za-z0-9+/]{4})*(?:[A-Za-z0-9+/]{2}==|[A-Za-z0-9+/]{3}=)?$/.test(e)}});var kc=G((gx,Dc)=>{"use strict";Dc.exports=ms;function ms(){this._listeners={}}ms.prototype.on=function(e,r,n){return(this._listeners[e]||(this._listeners[e]=[])).push({fn:r,ctx:n||this}),this};ms.prototype.off=function(e,r){if(e===void 0)this._listeners={};else if(r===void 0)this._listeners[e]=[];else for(var n=this._listeners[e],s=0;s<n.length;)n[s].fn===r?n.splice(s,1):++s;return this};ms.prototype.emit=function(e){var r=this._listeners[e];if(r){for(var n=[],s=1;s<arguments.length;)n.push(arguments[s++]);for(s=0;s<r.length;)r[s].fn.apply(r[s++].ctx,n)}return this}});var Kc=G((yx,Uc)=>{"use strict";Uc.exports=Mc(Mc);function Mc(t){return typeof Float32Array<"u"?function(){var e=new Float32Array([-0]),r=new Uint8Array(e.buffer),n=r[3]===128;function s(f,u,c){e[0]=f,u[c]=r[0],u[c+1]=r[1],u[c+2]=r[2],u[c+3]=r[3]}function i(f,u,c){e[0]=f,u[c]=r[3],u[c+1]=r[2],u[c+2]=r[1],u[c+3]=r[0]}t.writeFloatLE=n?s:i,t.writeFloatBE=n?i:s;function o(f,u){return r[0]=f[u],r[1]=f[u+1],r[2]=f[u+2],r[3]=f[u+3],e[0]}function a(f,u){return r[3]=f[u],r[2]=f[u+1],r[1]=f[u+2],r[0]=f[u+3],e[0]}t.readFloatLE=n?o:a,t.readFloatBE=n?a:o}():function(){function e(n,s,i,o){var a=s<0?1:0;if(a&&(s=-s),s===0)n(1/s>0?0:2147483648,i,o);else if(isNaN(s))n(2143289344,i,o);else if(s>34028234663852886e22)n((a<<31|2139095040)>>>0,i,o);else if(s<11754943508222875e-54)n((a<<31|Math.round(s/1401298464324817e-60))>>>0,i,o);else{var f=Math.floor(Math.log(s)/Math.LN2),u=Math.round(s*Math.pow(2,-f)*8388608)&8388607;n((a<<31|f+127<<23|u)>>>0,i,o)}}t.writeFloatLE=e.bind(null,Lc),t.writeFloatBE=e.bind(null,Nc);function r(n,s,i){var o=n(s,i),a=(o>>31)*2+1,f=o>>>23&255,u=o&8388607;return f===255?u?NaN:a*(1/0):f===0?a*1401298464324817e-60*u:a*Math.pow(2,f-150)*(u+8388608)}t.readFloatLE=r.bind(null,Oc),t.readFloatBE=r.bind(null,Fc)}(),typeof Float64Array<"u"?function(){var e=new Float64Array([-0]),r=new Uint8Array(e.buffer),n=r[7]===128;function s(f,u,c){e[0]=f,u[c]=r[0],u[c+1]=r[1],u[c+2]=r[2],u[c+3]=r[3],u[c+4]=r[4],u[c+5]=r[5],u[c+6]=r[6],u[c+7]=r[7]}function i(f,u,c){e[0]=f,u[c]=r[7],u[c+1]=r[6],u[c+2]=r[5],u[c+3]=r[4],u[c+4]=r[3],u[c+5]=r[2],u[c+6]=r[1],u[c+7]=r[0]}t.writeDoubleLE=n?s:i,t.writeDoubleBE=n?i:s;function o(f,u){return r[0]=f[u],r[1]=f[u+1],r[2]=f[u+2],r[3]=f[u+3],r[4]=f[u+4],r[5]=f[u+5],r[6]=f[u+6],r[7]=f[u+7],e[0]}function a(f,u){return r[7]=f[u],r[6]=f[u+1],r[5]=f[u+2],r[4]=f[u+3],r[3]=f[u+4],r[2]=f[u+5],r[1]=f[u+6],r[0]=f[u+7],e[0]}t.readDoubleLE=n?o:a,t.readDoubleBE=n?a:o}():function(){function e(n,s,i,o,a,f){var u=o<0?1:0;if(u&&(o=-o),o===0)n(0,a,f+s),n(1/o>0?0:2147483648,a,f+i);else if(isNaN(o))n(0,a,f+s),n(2146959360,a,f+i);else if(o>17976931348623157e292)n(0,a,f+s),n((u<<31|2146435072)>>>0,a,f+i);else{var c;if(o<22250738585072014e-324)c=o/5e-324,n(c>>>0,a,f+s),n((u<<31|c/4294967296)>>>0,a,f+i);else{var l=Math.floor(Math.log(o)/Math.LN2);l===1024&&(l=1023),c=o*Math.pow(2,-l),n(c*4503599627370496>>>0,a,f+s),n((u<<31|l+1023<<20|c*1048576&1048575)>>>0,a,f+i)}}}t.writeDoubleLE=e.bind(null,Lc,0,4),t.writeDoubleBE=e.bind(null,Nc,4,0);function r(n,s,i,o,a){var f=n(o,a+s),u=n(o,a+i),c=(u>>31)*2+1,l=u>>>20&2047,h=4294967296*(u&1048575)+f;return l===2047?h?NaN:c*(1/0):l===0?c*5e-324*h:c*Math.pow(2,l-1075)*(h+4503599627370496)}t.readDoubleLE=r.bind(null,Oc,0,4),t.readDoubleBE=r.bind(null,Fc,4,0)}(),t}function Lc(t,e,r){e[r]=t&255,e[r+1]=t>>>8&255,e[r+2]=t>>>16&255,e[r+3]=t>>>24}function Nc(t,e,r){e[r]=t>>>24,e[r+1]=t>>>16&255,e[r+2]=t>>>8&255,e[r+3]=t&255}function Oc(t,e){return(t[e]|t[e+1]<<8|t[e+2]<<16|t[e+3]<<24)>>>0}function Fc(t,e){return(t[e]<<24|t[e+1]<<16|t[e+2]<<8|t[e+3])>>>0}});var qc=G((exports,module)=>{"use strict";module.exports=inquire;function inquire(moduleName){try{var mod=eval("quire".replace(/^/,"re"))(moduleName);if(mod&&(mod.length||Object.keys(mod).length))return mod}catch(t){}return null}});var zc=G(Vc=>{"use strict";var Xi=Vc;Xi.length=function(e){for(var r=0,n=0,s=0;s<e.length;++s)n=e.charCodeAt(s),n<128?r+=1:n<2048?r+=2:(n&64512)===55296&&(e.charCodeAt(s+1)&64512)===56320?(++s,r+=4):r+=3;return r};Xi.read=function(e,r,n){var s=n-r;if(s<1)return"";for(var i=null,o=[],a=0,f;r<n;)f=e[r++],f<128?o[a++]=f:f>191&&f<224?o[a++]=(f&31)<<6|e[r++]&63:f>239&&f<365?(f=((f&7)<<18|(e[r++]&63)<<12|(e[r++]&63)<<6|e[r++]&63)-65536,o[a++]=55296+(f>>10),o[a++]=56320+(f&1023)):o[a++]=(f&15)<<12|(e[r++]&63)<<6|e[r++]&63,a>8191&&((i||(i=[])).push(String.fromCharCode.apply(String,o)),a=0);return i?(a&&i.push(String.fromCharCode.apply(String,o.slice(0,a))),i.join("")):String.fromCharCode.apply(String,o.slice(0,a))};Xi.write=function(e,r,n){for(var s=n,i,o,a=0;a<e.length;++a)i=e.charCodeAt(a),i<128?r[n++]=i:i<2048?(r[n++]=i>>6|192,r[n++]=i&63|128):(i&64512)===55296&&((o=e.charCodeAt(a+1))&64512)===56320?(i=65536+((i&1023)<<10)+(o&1023),++a,r[n++]=i>>18|240,r[n++]=i>>12&63|128,r[n++]=i>>6&63|128,r[n++]=i&63|128):(r[n++]=i>>12|224,r[n++]=i>>6&63|128,r[n++]=i&63|128);return n-s}});var Gc=G((bx,Hc)=>{"use strict";Hc.exports=bp;function bp(t,e,r){var n=r||8192,s=n>>>1,i=null,o=n;return function(f){if(f<1||f>s)return t(f);o+f>n&&(i=t(n),o=0);var u=e.call(i,o,o+=f);return o&7&&(o=(o|7)+1),u}}});var jc=G((xx,Wc)=>{"use strict";Wc.exports=Me;var On=sr();function Me(t,e){this.lo=t>>>0,this.hi=e>>>0}var Ir=Me.zero=new Me(0,0);Ir.toNumber=function(){return 0};Ir.zzEncode=Ir.zzDecode=function(){return this};Ir.length=function(){return 1};var xp=Me.zeroHash="\0\0\0\0\0\0\0\0";Me.fromNumber=function(e){if(e===0)return Ir;var r=e<0;r&&(e=-e);var n=e>>>0,s=(e-n)/4294967296>>>0;return r&&(s=~s>>>0,n=~n>>>0,++n>4294967295&&(n=0,++s>4294967295&&(s=0))),new Me(n,s)};Me.from=function(e){if(typeof e=="number")return Me.fromNumber(e);if(On.isString(e))if(On.Long)e=On.Long.fromString(e);else return Me.fromNumber(parseInt(e,10));return e.low||e.high?new Me(e.low>>>0,e.high>>>0):Ir};Me.prototype.toNumber=function(e){if(!e&&this.hi>>>31){var r=~this.lo+1>>>0,n=~this.hi>>>0;return r||(n=n+1>>>0),-(r+n*4294967296)}return this.lo+this.hi*4294967296};Me.prototype.toLong=function(e){return On.Long?new On.Long(this.lo|0,this.hi|0,!!e):{low:this.lo|0,high:this.hi|0,unsigned:!!e}};var nr=String.prototype.charCodeAt;Me.fromHash=function(e){return e===xp?Ir:new Me((nr.call(e,0)|nr.call(e,1)<<8|nr.call(e,2)<<16|nr.call(e,3)<<24)>>>0,(nr.call(e,4)|nr.call(e,5)<<8|nr.call(e,6)<<16|nr.call(e,7)<<24)>>>0)};Me.prototype.toHash=function(){return String.fromCharCode(this.lo&255,this.lo>>>8&255,this.lo>>>16&255,this.lo>>>24,this.hi&255,this.hi>>>8&255,this.hi>>>16&255,this.hi>>>24)};Me.prototype.zzEncode=function(){var e=this.hi>>31;return this.hi=((this.hi<<1|this.lo>>>31)^e)>>>0,this.lo=(this.lo<<1^e)>>>0,this};Me.prototype.zzDecode=function(){var e=-(this.lo&1);return this.lo=((this.lo>>>1|this.hi<<31)^e)>>>0,this.hi=(this.hi>>>1^e)>>>0,this};Me.prototype.length=function(){var e=this.lo,r=(this.lo>>>28|this.hi<<4)>>>0,n=this.hi>>>24;return n===0?r===0?e<16384?e<128?1:2:e<2097152?3:4:r<16384?r<128?5:6:r<2097152?7:8:n<128?9:10}});var sr=G(Ji=>{"use strict";var z=Ji;z.asPromise=Bc();z.base64=Rc();z.EventEmitter=kc();z.float=Kc();z.inquire=qc();z.utf8=zc();z.pool=Gc();z.LongBits=jc();z.isNode=!!(typeof globalThis<"u"&&globalThis&&globalThis.process&&globalThis.process.versions&&globalThis.process.versions.node);z.global=z.isNode&&globalThis||typeof window<"u"&&window||typeof self<"u"&&self||Ji;z.emptyArray=Object.freeze?Object.freeze([]):[];z.emptyObject=Object.freeze?Object.freeze({}):{};z.isInteger=Number.isInteger||function(e){return typeof e=="number"&&isFinite(e)&&Math.floor(e)===e};z.isString=function(e){return typeof e=="string"||e instanceof String};z.isObject=function(e){return e&&typeof e=="object"};z.isset=z.isSet=function(e,r){var n=e[r];return n!=null&&e.hasOwnProperty(r)?typeof n!="object"||(Array.isArray(n)?n.length:Object.keys(n).length)>0:!1};z.Buffer=function(){try{var t=z.inquire("buffer").Buffer;return t.prototype.utf8Write?t:null}catch{return null}}();z._Buffer_from=null;z._Buffer_allocUnsafe=null;z.newBuffer=function(e){return typeof e=="number"?z.Buffer?z._Buffer_allocUnsafe(e):new z.Array(e):z.Buffer?z._Buffer_from(e):typeof Uint8Array>"u"?e:new Uint8Array(e)};z.Array=typeof Uint8Array<"u"?Uint8Array:Array;z.Long=z.global.dcodeIO&&z.global.dcodeIO.Long||z.global.Long||z.inquire("long");z.key2Re=/^true|false|0|1$/;z.key32Re=/^-?(?:0|[1-9][0-9]*)$/;z.key64Re=/^(?:[\\x00-\\xff]{8}|-?(?:0|[1-9][0-9]*))$/;z.longToHash=function(e){return e?z.LongBits.from(e).toHash():z.LongBits.zeroHash};z.longFromHash=function(e,r){var n=z.LongBits.fromHash(e);return z.Long?z.Long.fromBits(n.lo,n.hi,r):n.toNumber(!!r)};function $c(t,e,r){for(var n=Object.keys(e),s=0;s<n.length;++s)(t[n[s]]===void 0||!r)&&(t[n[s]]=e[n[s]]);return t}z.merge=$c;z.lcFirst=function(e){return e.charAt(0).toLowerCase()+e.substring(1)};function Yc(t){function e(r,n){if(!(this instanceof e))return new e(r,n);Object.defineProperty(this,"message",{get:function(){return r}}),Error.captureStackTrace?Error.captureStackTrace(this,e):Object.defineProperty(this,"stack",{value:new Error().stack||""}),n&&$c(this,n)}return e.prototype=Object.create(Error.prototype,{constructor:{value:e,writable:!0,enumerable:!1,configurable:!0},name:{get:function(){return t},set:void 0,enumerable:!1,configurable:!0},toString:{value:function(){return this.name+": "+this.message},writable:!0,enumerable:!1,configurable:!0}}),e}z.newError=Yc;z.ProtocolError=Yc("ProtocolError");z.oneOfGetter=function(e){for(var r={},n=0;n<e.length;++n)r[e[n]]=1;return function(){for(var s=Object.keys(this),i=s.length-1;i>-1;--i)if(r[s[i]]===1&&this[s[i]]!==void 0&&this[s[i]]!==null)return s[i]}};z.oneOfSetter=function(e){return function(r){for(var n=0;n<e.length;++n)e[n]!==r&&delete this[e[n]]}};z.toJSONOptions={longs:String,enums:String,bytes:String,json:!0};z._configure=function(){var t=z.Buffer;if(!t){z._Buffer_from=z._Buffer_allocUnsafe=null;return}z._Buffer_from=t.from!==Uint8Array.from&&t.from||function(r,n){return new t(r,n)},z._Buffer_allocUnsafe=t.allocUnsafe||function(r){return new t(r)}}});var oo=G((wx,Jc)=>{"use strict";Jc.exports=re;var ft=sr(),eo,bs=ft.LongBits,Zc=ft.base64,Qc=ft.utf8;function Fn(t,e,r){this.fn=t,this.len=e,this.next=void 0,this.val=r}function ro(){}function vp(t){this.head=t.head,this.tail=t.tail,this.len=t.len,this.next=t.states}function re(){this.len=0,this.head=new Fn(ro,0,0),this.tail=this.head,this.states=null}var Xc=function(){return ft.Buffer?function(){return(re.create=function(){return new eo})()}:function(){return new re}};re.create=Xc();re.alloc=function(e){return new ft.Array(e)};ft.Array!==Array&&(re.alloc=ft.pool(re.alloc,ft.Array.prototype.subarray));re.prototype._push=function(e,r,n){return this.tail=this.tail.next=new Fn(e,r,n),this.len+=r,this};function no(t,e,r){e[r]=t&255}function wp(t,e,r){for(;t>127;)e[r++]=t&127|128,t>>>=7;e[r]=t}function so(t,e){this.len=t,this.next=void 0,this.val=e}so.prototype=Object.create(Fn.prototype);so.prototype.fn=wp;re.prototype.uint32=function(e){return this.len+=(this.tail=this.tail.next=new so((e=e>>>0)<128?1:e<16384?2:e<2097152?3:e<268435456?4:5,e)).len,this};re.prototype.int32=function(e){return e<0?this._push(io,10,bs.fromNumber(e)):this.uint32(e)};re.prototype.sint32=function(e){return this.uint32((e<<1^e>>31)>>>0)};function io(t,e,r){for(;t.hi;)e[r++]=t.lo&127|128,t.lo=(t.lo>>>7|t.hi<<25)>>>0,t.hi>>>=7;for(;t.lo>127;)e[r++]=t.lo&127|128,t.lo=t.lo>>>7;e[r++]=t.lo}re.prototype.uint64=function(e){var r=bs.from(e);return this._push(io,r.length(),r)};re.prototype.int64=re.prototype.uint64;re.prototype.sint64=function(e){var r=bs.from(e).zzEncode();return this._push(io,r.length(),r)};re.prototype.bool=function(e){return this._push(no,1,e?1:0)};function to(t,e,r){e[r]=t&255,e[r+1]=t>>>8&255,e[r+2]=t>>>16&255,e[r+3]=t>>>24}re.prototype.fixed32=function(e){return this._push(to,4,e>>>0)};re.prototype.sfixed32=re.prototype.fixed32;re.prototype.fixed64=function(e){var r=bs.from(e);return this._push(to,4,r.lo)._push(to,4,r.hi)};re.prototype.sfixed64=re.prototype.fixed64;re.prototype.float=function(e){return this._push(ft.float.writeFloatLE,4,e)};re.prototype.double=function(e){return this._push(ft.float.writeDoubleLE,8,e)};var Sp=ft.Array.prototype.set?function(e,r,n){r.set(e,n)}:function(e,r,n){for(var s=0;s<e.length;++s)r[n+s]=e[s]};re.prototype.bytes=function(e){var r=e.length>>>0;if(!r)return this._push(no,1,0);if(ft.isString(e)){var n=re.alloc(r=Zc.length(e));Zc.decode(e,n,0),e=n}return this.uint32(r)._push(Sp,r,e)};re.prototype.string=function(e){var r=Qc.length(e);return r?this.uint32(r)._push(Qc.write,r,e):this._push(no,1,0)};re.prototype.fork=function(){return this.states=new vp(this),this.head=this.tail=new Fn(ro,0,0),this.len=0,this};re.prototype.reset=function(){return this.states?(this.head=this.states.head,this.tail=this.states.tail,this.len=this.states.len,this.states=this.states.next):(this.head=this.tail=new Fn(ro,0,0),this.len=0),this};re.prototype.ldelim=function(){var e=this.head,r=this.tail,n=this.len;return this.reset().uint32(n),n&&(this.tail.next=e.next,this.tail=r,this.len+=n),this};re.prototype.finish=function(){for(var e=this.head.next,r=this.constructor.alloc(this.len),n=0;e;)e.fn(e.val,r,n),n+=e.len,e=e.next;return r};re._configure=function(t){eo=t,re.create=Xc(),eo._configure()}});var ru=G((Sx,tu)=>{"use strict";tu.exports=Bt;var eu=oo();(Bt.prototype=Object.create(eu.prototype)).constructor=Bt;var ir=sr();function Bt(){eu.call(this)}Bt._configure=function(){Bt.alloc=ir._Buffer_allocUnsafe,Bt.writeBytesBuffer=ir.Buffer&&ir.Buffer.prototype instanceof Uint8Array&&ir.Buffer.prototype.set.name==="set"?function(e,r,n){r.set(e,n)}:function(e,r,n){if(e.copy)e.copy(r,n,0,e.length);else for(var s=0;s<e.length;)r[n++]=e[s++]}};Bt.prototype.bytes=function(e){ir.isString(e)&&(e=ir._Buffer_from(e,"base64"));var r=e.length>>>0;return this.uint32(r),r&&this._push(Bt.writeBytesBuffer,r,e),this};function Ep(t,e,r){t.length<40?ir.utf8.write(t,e,r):e.utf8Write?e.utf8Write(t,r):e.write(t,r)}Bt.prototype.string=function(e){var r=ir.Buffer.byteLength(e);return this.uint32(r),r&&this._push(Ep,r,e),this};Bt._configure()});var uo=G((Ex,au)=>{"use strict";au.exports=Ie;var yt=sr(),co,iu=yt.LongBits,_p=yt.utf8;function mt(t,e){return RangeError("index out of range: "+t.pos+" + "+(e||1)+" > "+t.len)}function Ie(t){this.buf=t,this.pos=0,this.len=t.length}var nu=typeof Uint8Array<"u"?function(e){if(e instanceof Uint8Array||Array.isArray(e))return new Ie(e);throw Error("illegal buffer")}:function(e){if(Array.isArray(e))return new Ie(e);throw Error("illegal buffer")},ou=function(){return yt.Buffer?function(r){return(Ie.create=function(s){return yt.Buffer.isBuffer(s)?new co(s):nu(s)})(r)}:nu};Ie.create=ou();Ie.prototype._slice=yt.Array.prototype.subarray||yt.Array.prototype.slice;Ie.prototype.uint32=function(){var e=4294967295;return function(){if(e=(this.buf[this.pos]&127)>>>0,this.buf[this.pos++]<128||(e=(e|(this.buf[this.pos]&127)<<7)>>>0,this.buf[this.pos++]<128)||(e=(e|(this.buf[this.pos]&127)<<14)>>>0,this.buf[this.pos++]<128)||(e=(e|(this.buf[this.pos]&127)<<21)>>>0,this.buf[this.pos++]<128)||(e=(e|(this.buf[this.pos]&15)<<28)>>>0,this.buf[this.pos++]<128))return e;if((this.pos+=5)>this.len)throw this.pos=this.len,mt(this,10);return e}}();Ie.prototype.int32=function(){return this.uint32()|0};Ie.prototype.sint32=function(){var e=this.uint32();return e>>>1^-(e&1)|0};function ao(){var t=new iu(0,0),e=0;if(this.len-this.pos>4){for(;e<4;++e)if(t.lo=(t.lo|(this.buf[this.pos]&127)<<e*7)>>>0,this.buf[this.pos++]<128)return t;if(t.lo=(t.lo|(this.buf[this.pos]&127)<<28)>>>0,t.hi=(t.hi|(this.buf[this.pos]&127)>>4)>>>0,this.buf[this.pos++]<128)return t;e=0}else{for(;e<3;++e){if(this.pos>=this.len)throw mt(this);if(t.lo=(t.lo|(this.buf[this.pos]&127)<<e*7)>>>0,this.buf[this.pos++]<128)return t}return t.lo=(t.lo|(this.buf[this.pos++]&127)<<e*7)>>>0,t}if(this.len-this.pos>4){for(;e<5;++e)if(t.hi=(t.hi|(this.buf[this.pos]&127)<<e*7+3)>>>0,this.buf[this.pos++]<128)return t}else for(;e<5;++e){if(this.pos>=this.len)throw mt(this);if(t.hi=(t.hi|(this.buf[this.pos]&127)<<e*7+3)>>>0,this.buf[this.pos++]<128)return t}throw Error("invalid varint encoding")}Ie.prototype.bool=function(){return this.uint32()!==0};function xs(t,e){return(t[e-4]|t[e-3]<<8|t[e-2]<<16|t[e-1]<<24)>>>0}Ie.prototype.fixed32=function(){if(this.pos+4>this.len)throw mt(this,4);return xs(this.buf,this.pos+=4)};Ie.prototype.sfixed32=function(){if(this.pos+4>this.len)throw mt(this,4);return xs(this.buf,this.pos+=4)|0};function su(){if(this.pos+8>this.len)throw mt(this,8);return new iu(xs(this.buf,this.pos+=4),xs(this.buf,this.pos+=4))}Ie.prototype.float=function(){if(this.pos+4>this.len)throw mt(this,4);var e=yt.float.readFloatLE(this.buf,this.pos);return this.pos+=4,e};Ie.prototype.double=function(){if(this.pos+8>this.len)throw mt(this,4);var e=yt.float.readDoubleLE(this.buf,this.pos);return this.pos+=8,e};Ie.prototype.bytes=function(){var e=this.uint32(),r=this.pos,n=this.pos+e;if(n>this.len)throw mt(this,e);if(this.pos+=e,Array.isArray(this.buf))return this.buf.slice(r,n);if(r===n){var s=yt.Buffer;return s?s.alloc(0):new this.buf.constructor(0)}return this._slice.call(this.buf,r,n)};Ie.prototype.string=function(){var e=this.bytes();return _p.read(e,0,e.length)};Ie.prototype.skip=function(e){if(typeof e=="number"){if(this.pos+e>this.len)throw mt(this,e);this.pos+=e}else do if(this.pos>=this.len)throw mt(this);while(this.buf[this.pos++]&128);return this};Ie.prototype.skipType=function(t){switch(t){case 0:this.skip();break;case 1:this.skip(8);break;case 2:this.skip(this.uint32());break;case 3:for(;(t=this.uint32()&7)!==4;)this.skipType(t);break;case 5:this.skip(4);break;default:throw Error("invalid wire type "+t+" at offset "+this.pos)}return this};Ie._configure=function(t){co=t,Ie.create=ou(),co._configure();var e=yt.Long?"toLong":"toNumber";yt.merge(Ie.prototype,{int64:function(){return ao.call(this)[e](!1)},uint64:function(){return ao.call(this)[e](!0)},sint64:function(){return ao.call(this).zzDecode()[e](!1)},fixed64:function(){return su.call(this)[e](!0)},sfixed64:function(){return su.call(this)[e](!1)}})}});var lu=G((_x,fu)=>{"use strict";fu.exports=Cr;var uu=uo();(Cr.prototype=Object.create(uu.prototype)).constructor=Cr;var cu=sr();function Cr(t){uu.call(this,t)}Cr._configure=function(){cu.Buffer&&(Cr.prototype._slice=cu.Buffer.prototype.slice)};Cr.prototype.string=function(){var e=this.uint32();return this.buf.utf8Slice?this.buf.utf8Slice(this.pos,this.pos=Math.min(this.pos+e,this.len)):this.buf.toString("utf-8",this.pos,this.pos=Math.min(this.pos+e,this.len))};Cr._configure()});var pu=G((Ix,hu)=>{"use strict";hu.exports=Un;var fo=sr();(Un.prototype=Object.create(fo.EventEmitter.prototype)).constructor=Un;function Un(t,e,r){if(typeof t!="function")throw TypeError("rpcImpl must be a function");fo.EventEmitter.call(this),this.rpcImpl=t,this.requestDelimited=!!e,this.responseDelimited=!!r}Un.prototype.rpcCall=function t(e,r,n,s,i){if(!s)throw TypeError("request must be specified");var o=this;if(!i)return fo.asPromise(t,o,e,r,n,s);if(!o.rpcImpl){setTimeout(function(){i(Error("already ended"))},0);return}try{return o.rpcImpl(e,r[o.requestDelimited?"encodeDelimited":"encode"](s).finish(),function(f,u){if(f)return o.emit("error",f,e),i(f);if(u===null){o.end(!0);return}if(!(u instanceof n))try{u=n[o.responseDelimited?"decodeDelimited":"decode"](u)}catch(c){return o.emit("error",c,e),i(c)}return o.emit("data",u,e),i(null,u)})}catch(a){o.emit("error",a,e),setTimeout(function(){i(a)},0);return}};Un.prototype.end=function(e){return this.rpcImpl&&(e||this.rpcImpl(null,null,null),this.rpcImpl=null,this.emit("end").off()),this}});var gu=G(du=>{"use strict";var Ip=du;Ip.Service=pu()});var mu=G((Bx,yu)=>{"use strict";yu.exports={}});var vu=G(xu=>{"use strict";var et=xu;et.build="minimal";et.Writer=oo();et.BufferWriter=ru();et.Reader=uo();et.BufferReader=lu();et.util=sr();et.rpc=gu();et.roots=mu();et.configure=bu;function bu(){et.util._configure(),et.Writer._configure(et.BufferWriter),et.Reader._configure(et.BufferReader)}bu()});var lo=G((Tx,wu)=>{"use strict";wu.exports=vu()});var Cu=G((Iu,Kn)=>{"use strict";(function(t,e){typeof define=="function"&&define.amd?define(["protobufjs/minimal"],e):typeof Ya=="function"&&typeof Kn=="object"&&Kn&&Kn.exports&&(Kn.exports=e(lo()))})(Iu,function(t){"use strict";var e=t.Reader,r=t.Writer,n=t.util,s=t.roots.default||(t.roots.default={});return s.RPC=function(){function i(a){if(this.subscriptions=[],this.messages=[],a)for(var f=Object.keys(a),u=0;u<f.length;++u)a[f[u]]!=null&&(this[f[u]]=a[f[u]])}i.prototype.subscriptions=n.emptyArray,i.prototype.messages=n.emptyArray,i.prototype.control=null;var o;return Object.defineProperty(i.prototype,"_control",{get:n.oneOfGetter(o=["control"]),set:n.oneOfSetter(o)}),i.encode=function(f,u){if(u||(u=r.create()),f.subscriptions!=null&&f.subscriptions.length)for(var c=0;c<f.subscriptions.length;++c)s.RPC.SubOpts.encode(f.subscriptions[c],u.uint32(10).fork()).ldelim();if(f.messages!=null&&f.messages.length)for(var c=0;c<f.messages.length;++c)s.RPC.Message.encode(f.messages[c],u.uint32(18).fork()).ldelim();return f.control!=null&&Object.hasOwnProperty.call(f,"control")&&s.RPC.ControlMessage.encode(f.control,u.uint32(26).fork()).ldelim(),u},i.decode=function(f,u){f instanceof e||(f=e.create(f));for(var c=u===void 0?f.len:f.pos+u,l=new s.RPC;f.pos<c;){var h=f.uint32();switch(h>>>3){case 1:l.subscriptions&&l.subscriptions.length||(l.subscriptions=[]),l.subscriptions.push(s.RPC.SubOpts.decode(f,f.uint32()));break;case 2:l.messages&&l.messages.length||(l.messages=[]),l.messages.push(s.RPC.Message.decode(f,f.uint32()));break;case 3:l.control=s.RPC.ControlMessage.decode(f,f.uint32());break;default:f.skipType(h&7);break}}return l},i.fromObject=function(f){if(f instanceof s.RPC)return f;var u=new s.RPC;if(f.subscriptions){if(!Array.isArray(f.subscriptions))throw TypeError(".RPC.subscriptions: array expected");u.subscriptions=[];for(var c=0;c<f.subscriptions.length;++c){if(typeof f.subscriptions[c]!="object")throw TypeError(".RPC.subscriptions: object expected");u.subscriptions[c]=s.RPC.SubOpts.fromObject(f.subscriptions[c])}}if(f.messages){if(!Array.isArray(f.messages))throw TypeError(".RPC.messages: array expected");u.messages=[];for(var c=0;c<f.messages.length;++c){if(typeof f.messages[c]!="object")throw TypeError(".RPC.messages: object expected");u.messages[c]=s.RPC.Message.fromObject(f.messages[c])}}if(f.control!=null){if(typeof f.control!="object")throw TypeError(".RPC.control: object expected");u.control=s.RPC.ControlMessage.fromObject(f.control)}return u},i.toObject=function(f,u){u||(u={});var c={};if((u.arrays||u.defaults)&&(c.subscriptions=[],c.messages=[]),f.subscriptions&&f.subscriptions.length){c.subscriptions=[];for(var l=0;l<f.subscriptions.length;++l)c.subscriptions[l]=s.RPC.SubOpts.toObject(f.subscriptions[l],u)}if(f.messages&&f.messages.length){c.messages=[];for(var l=0;l<f.messages.length;++l)c.messages[l]=s.RPC.Message.toObject(f.messages[l],u)}return f.control!=null&&f.hasOwnProperty("control")&&(c.control=s.RPC.ControlMessage.toObject(f.control,u),u.oneofs&&(c._control="control")),c},i.prototype.toJSON=function(){return this.constructor.toObject(this,t.util.toJSONOptions)},i.SubOpts=function(){function a(u){if(u)for(var c=Object.keys(u),l=0;l<c.length;++l)u[c[l]]!=null&&(this[c[l]]=u[c[l]])}a.prototype.subscribe=null,a.prototype.topic=null;var f;return Object.defineProperty(a.prototype,"_subscribe",{get:n.oneOfGetter(f=["subscribe"]),set:n.oneOfSetter(f)}),Object.defineProperty(a.prototype,"_topic",{get:n.oneOfGetter(f=["topic"]),set:n.oneOfSetter(f)}),a.encode=function(c,l){return l||(l=r.create()),c.subscribe!=null&&Object.hasOwnProperty.call(c,"subscribe")&&l.uint32(8).bool(c.subscribe),c.topic!=null&&Object.hasOwnProperty.call(c,"topic")&&l.uint32(18).string(c.topic),l},a.decode=function(c,l){c instanceof e||(c=e.create(c));for(var h=l===void 0?c.len:c.pos+l,g=new s.RPC.SubOpts;c.pos<h;){var p=c.uint32();switch(p>>>3){case 1:g.subscribe=c.bool();break;case 2:g.topic=c.string();break;default:c.skipType(p&7);break}}return g},a.fromObject=function(c){if(c instanceof s.RPC.SubOpts)return c;var l=new s.RPC.SubOpts;return c.subscribe!=null&&(l.subscribe=!!c.subscribe),c.topic!=null&&(l.topic=String(c.topic)),l},a.toObject=function(c,l){l||(l={});var h={};return c.subscribe!=null&&c.hasOwnProperty("subscribe")&&(h.subscribe=c.subscribe,l.oneofs&&(h._subscribe="subscribe")),c.topic!=null&&c.hasOwnProperty("topic")&&(h.topic=c.topic,l.oneofs&&(h._topic="topic")),h},a.prototype.toJSON=function(){return this.constructor.toObject(this,t.util.toJSONOptions)},a}(),i.Message=function(){function a(u){if(u)for(var c=Object.keys(u),l=0;l<c.length;++l)u[c[l]]!=null&&(this[c[l]]=u[c[l]])}a.prototype.from=null,a.prototype.data=null,a.prototype.seqno=null,a.prototype.topic="",a.prototype.signature=null,a.prototype.key=null;var f;return Object.defineProperty(a.prototype,"_from",{get:n.oneOfGetter(f=["from"]),set:n.oneOfSetter(f)}),Object.defineProperty(a.prototype,"_data",{get:n.oneOfGetter(f=["data"]),set:n.oneOfSetter(f)}),Object.defineProperty(a.prototype,"_seqno",{get:n.oneOfGetter(f=["seqno"]),set:n.oneOfSetter(f)}),Object.defineProperty(a.prototype,"_signature",{get:n.oneOfGetter(f=["signature"]),set:n.oneOfSetter(f)}),Object.defineProperty(a.prototype,"_key",{get:n.oneOfGetter(f=["key"]),set:n.oneOfSetter(f)}),a.encode=function(c,l){return l||(l=r.create()),c.from!=null&&Object.hasOwnProperty.call(c,"from")&&l.uint32(10).bytes(c.from),c.data!=null&&Object.hasOwnProperty.call(c,"data")&&l.uint32(18).bytes(c.data),c.seqno!=null&&Object.hasOwnProperty.call(c,"seqno")&&l.uint32(26).bytes(c.seqno),l.uint32(34).string(c.topic),c.signature!=null&&Object.hasOwnProperty.call(c,"signature")&&l.uint32(42).bytes(c.signature),c.key!=null&&Object.hasOwnProperty.call(c,"key")&&l.uint32(50).bytes(c.key),l},a.decode=function(c,l){c instanceof e||(c=e.create(c));for(var h=l===void 0?c.len:c.pos+l,g=new s.RPC.Message;c.pos<h;){var p=c.uint32();switch(p>>>3){case 1:g.from=c.bytes();break;case 2:g.data=c.bytes();break;case 3:g.seqno=c.bytes();break;case 4:g.topic=c.string();break;case 5:g.signature=c.bytes();break;case 6:g.key=c.bytes();break;default:c.skipType(p&7);break}}if(!g.hasOwnProperty("topic"))throw n.ProtocolError("missing required 'topic'",{instance:g});return g},a.fromObject=function(c){if(c instanceof s.RPC.Message)return c;var l=new s.RPC.Message;return c.from!=null&&(typeof c.from=="string"?n.base64.decode(c.from,l.from=n.newBuffer(n.base64.length(c.from)),0):c.from.length&&(l.from=c.from)),c.data!=null&&(typeof c.data=="string"?n.base64.decode(c.data,l.data=n.newBuffer(n.base64.length(c.data)),0):c.data.length&&(l.data=c.data)),c.seqno!=null&&(typeof c.seqno=="string"?n.base64.decode(c.seqno,l.seqno=n.newBuffer(n.base64.length(c.seqno)),0):c.seqno.length&&(l.seqno=c.seqno)),c.topic!=null&&(l.topic=String(c.topic)),c.signature!=null&&(typeof c.signature=="string"?n.base64.decode(c.signature,l.signature=n.newBuffer(n.base64.length(c.signature)),0):c.signature.length&&(l.signature=c.signature)),c.key!=null&&(typeof c.key=="string"?n.base64.decode(c.key,l.key=n.newBuffer(n.base64.length(c.key)),0):c.key.length&&(l.key=c.key)),l},a.toObject=function(c,l){l||(l={});var h={};return l.defaults&&(h.topic=""),c.from!=null&&c.hasOwnProperty("from")&&(h.from=l.bytes===String?n.base64.encode(c.from,0,c.from.length):l.bytes===Array?Array.prototype.slice.call(c.from):c.from,l.oneofs&&(h._from="from")),c.data!=null&&c.hasOwnProperty("data")&&(h.data=l.bytes===String?n.base64.encode(c.data,0,c.data.length):l.bytes===Array?Array.prototype.slice.call(c.data):c.data,l.oneofs&&(h._data="data")),c.seqno!=null&&c.hasOwnProperty("seqno")&&(h.seqno=l.bytes===String?n.base64.encode(c.seqno,0,c.seqno.length):l.bytes===Array?Array.prototype.slice.call(c.seqno):c.seqno,l.oneofs&&(h._seqno="seqno")),c.topic!=null&&c.hasOwnProperty("topic")&&(h.topic=c.topic),c.signature!=null&&c.hasOwnProperty("signature")&&(h.signature=l.bytes===String?n.base64.encode(c.signature,0,c.signature.length):l.bytes===Array?Array.prototype.slice.call(c.signature):c.signature,l.oneofs&&(h._signature="signature")),c.key!=null&&c.hasOwnProperty("key")&&(h.key=l.bytes===String?n.base64.encode(c.key,0,c.key.length):l.bytes===Array?Array.prototype.slice.call(c.key):c.key,l.oneofs&&(h._key="key")),h},a.prototype.toJSON=function(){return this.constructor.toObject(this,t.util.toJSONOptions)},a}(),i.ControlMessage=function(){function a(f){if(this.ihave=[],this.iwant=[],this.graft=[],this.prune=[],f)for(var u=Object.keys(f),c=0;c<u.length;++c)f[u[c]]!=null&&(this[u[c]]=f[u[c]])}return a.prototype.ihave=n.emptyArray,a.prototype.iwant=n.emptyArray,a.prototype.graft=n.emptyArray,a.prototype.prune=n.emptyArray,a.encode=function(u,c){if(c||(c=r.create()),u.ihave!=null&&u.ihave.length)for(var l=0;l<u.ihave.length;++l)s.RPC.ControlIHave.encode(u.ihave[l],c.uint32(10).fork()).ldelim();if(u.iwant!=null&&u.iwant.length)for(var l=0;l<u.iwant.length;++l)s.RPC.ControlIWant.encode(u.iwant[l],c.uint32(18).fork()).ldelim();if(u.graft!=null&&u.graft.length)for(var l=0;l<u.graft.length;++l)s.RPC.ControlGraft.encode(u.graft[l],c.uint32(26).fork()).ldelim();if(u.prune!=null&&u.prune.length)for(var l=0;l<u.prune.length;++l)s.RPC.ControlPrune.encode(u.prune[l],c.uint32(34).fork()).ldelim();return c},a.decode=function(u,c){u instanceof e||(u=e.create(u));for(var l=c===void 0?u.len:u.pos+c,h=new s.RPC.ControlMessage;u.pos<l;){var g=u.uint32();switch(g>>>3){case 1:h.ihave&&h.ihave.length||(h.ihave=[]),h.ihave.push(s.RPC.ControlIHave.decode(u,u.uint32()));break;case 2:h.iwant&&h.iwant.length||(h.iwant=[]),h.iwant.push(s.RPC.ControlIWant.decode(u,u.uint32()));break;case 3:h.graft&&h.graft.length||(h.graft=[]),h.graft.push(s.RPC.ControlGraft.decode(u,u.uint32()));break;case 4:h.prune&&h.prune.length||(h.prune=[]),h.prune.push(s.RPC.ControlPrune.decode(u,u.uint32()));break;default:u.skipType(g&7);break}}return h},a.fromObject=function(u){if(u instanceof s.RPC.ControlMessage)return u;var c=new s.RPC.ControlMessage;if(u.ihave){if(!Array.isArray(u.ihave))throw TypeError(".RPC.ControlMessage.ihave: array expected");c.ihave=[];for(var l=0;l<u.ihave.length;++l){if(typeof u.ihave[l]!="object")throw TypeError(".RPC.ControlMessage.ihave: object expected");c.ihave[l]=s.RPC.ControlIHave.fromObject(u.ihave[l])}}if(u.iwant){if(!Array.isArray(u.iwant))throw TypeError(".RPC.ControlMessage.iwant: array expected");c.iwant=[];for(var l=0;l<u.iwant.length;++l){if(typeof u.iwant[l]!="object")throw TypeError(".RPC.ControlMessage.iwant: object expected");c.iwant[l]=s.RPC.ControlIWant.fromObject(u.iwant[l])}}if(u.graft){if(!Array.isArray(u.graft))throw TypeError(".RPC.ControlMessage.graft: array expected");c.graft=[];for(var l=0;l<u.graft.length;++l){if(typeof u.graft[l]!="object")throw TypeError(".RPC.ControlMessage.graft: object expected");c.graft[l]=s.RPC.ControlGraft.fromObject(u.graft[l])}}if(u.prune){if(!Array.isArray(u.prune))throw TypeError(".RPC.ControlMessage.prune: array expected");c.prune=[];for(var l=0;l<u.prune.length;++l){if(typeof u.prune[l]!="object")throw TypeError(".RPC.ControlMessage.prune: object expected");c.prune[l]=s.RPC.ControlPrune.fromObject(u.prune[l])}}return c},a.toObject=function(u,c){c||(c={});var l={};if((c.arrays||c.defaults)&&(l.ihave=[],l.iwant=[],l.graft=[],l.prune=[]),u.ihave&&u.ihave.length){l.ihave=[];for(var h=0;h<u.ihave.length;++h)l.ihave[h]=s.RPC.ControlIHave.toObject(u.ihave[h],c)}if(u.iwant&&u.iwant.length){l.iwant=[];for(var h=0;h<u.iwant.length;++h)l.iwant[h]=s.RPC.ControlIWant.toObject(u.iwant[h],c)}if(u.graft&&u.graft.length){l.graft=[];for(var h=0;h<u.graft.length;++h)l.graft[h]=s.RPC.ControlGraft.toObject(u.graft[h],c)}if(u.prune&&u.prune.length){l.prune=[];for(var h=0;h<u.prune.length;++h)l.prune[h]=s.RPC.ControlPrune.toObject(u.prune[h],c)}return l},a.prototype.toJSON=function(){return this.constructor.toObject(this,t.util.toJSONOptions)},a}(),i.ControlIHave=function(){function a(u){if(this.messageIDs=[],u)for(var c=Object.keys(u),l=0;l<c.length;++l)u[c[l]]!=null&&(this[c[l]]=u[c[l]])}a.prototype.topicID=null,a.prototype.messageIDs=n.emptyArray;var f;return Object.defineProperty(a.prototype,"_topicID",{get:n.oneOfGetter(f=["topicID"]),set:n.oneOfSetter(f)}),a.encode=function(c,l){if(l||(l=r.create()),c.topicID!=null&&Object.hasOwnProperty.call(c,"topicID")&&l.uint32(10).string(c.topicID),c.messageIDs!=null&&c.messageIDs.length)for(var h=0;h<c.messageIDs.length;++h)l.uint32(18).bytes(c.messageIDs[h]);return l},a.decode=function(c,l){c instanceof e||(c=e.create(c));for(var h=l===void 0?c.len:c.pos+l,g=new s.RPC.ControlIHave;c.pos<h;){var p=c.uint32();switch(p>>>3){case 1:g.topicID=c.string();break;case 2:g.messageIDs&&g.messageIDs.length||(g.messageIDs=[]),g.messageIDs.push(c.bytes());break;default:c.skipType(p&7);break}}return g},a.fromObject=function(c){if(c instanceof s.RPC.ControlIHave)return c;var l=new s.RPC.ControlIHave;if(c.topicID!=null&&(l.topicID=String(c.topicID)),c.messageIDs){if(!Array.isArray(c.messageIDs))throw TypeError(".RPC.ControlIHave.messageIDs: array expected");l.messageIDs=[];for(var h=0;h<c.messageIDs.length;++h)typeof c.messageIDs[h]=="string"?n.base64.decode(c.messageIDs[h],l.messageIDs[h]=n.newBuffer(n.base64.length(c.messageIDs[h])),0):c.messageIDs[h].length&&(l.messageIDs[h]=c.messageIDs[h])}return l},a.toObject=function(c,l){l||(l={});var h={};if((l.arrays||l.defaults)&&(h.messageIDs=[]),c.topicID!=null&&c.hasOwnProperty("topicID")&&(h.topicID=c.topicID,l.oneofs&&(h._topicID="topicID")),c.messageIDs&&c.messageIDs.length){h.messageIDs=[];for(var g=0;g<c.messageIDs.length;++g)h.messageIDs[g]=l.bytes===String?n.base64.encode(c.messageIDs[g],0,c.messageIDs[g].length):l.bytes===Array?Array.prototype.slice.call(c.messageIDs[g]):c.messageIDs[g]}return h},a.prototype.toJSON=function(){return this.constructor.toObject(this,t.util.toJSONOptions)},a}(),i.ControlIWant=function(){function a(f){if(this.messageIDs=[],f)for(var u=Object.keys(f),c=0;c<u.length;++c)f[u[c]]!=null&&(this[u[c]]=f[u[c]])}return a.prototype.messageIDs=n.emptyArray,a.encode=function(u,c){if(c||(c=r.create()),u.messageIDs!=null&&u.messageIDs.length)for(var l=0;l<u.messageIDs.length;++l)c.uint32(10).bytes(u.messageIDs[l]);return c},a.decode=function(u,c){u instanceof e||(u=e.create(u));for(var l=c===void 0?u.len:u.pos+c,h=new s.RPC.ControlIWant;u.pos<l;){var g=u.uint32();switch(g>>>3){case 1:h.messageIDs&&h.messageIDs.length||(h.messageIDs=[]),h.messageIDs.push(u.bytes());break;default:u.skipType(g&7);break}}return h},a.fromObject=function(u){if(u instanceof s.RPC.ControlIWant)return u;var c=new s.RPC.ControlIWant;if(u.messageIDs){if(!Array.isArray(u.messageIDs))throw TypeError(".RPC.ControlIWant.messageIDs: array expected");c.messageIDs=[];for(var l=0;l<u.messageIDs.length;++l)typeof u.messageIDs[l]=="string"?n.base64.decode(u.messageIDs[l],c.messageIDs[l]=n.newBuffer(n.base64.length(u.messageIDs[l])),0):u.messageIDs[l].length&&(c.messageIDs[l]=u.messageIDs[l])}return c},a.toObject=function(u,c){c||(c={});var l={};if((c.arrays||c.defaults)&&(l.messageIDs=[]),u.messageIDs&&u.messageIDs.length){l.messageIDs=[];for(var h=0;h<u.messageIDs.length;++h)l.messageIDs[h]=c.bytes===String?n.base64.encode(u.messageIDs[h],0,u.messageIDs[h].length):c.bytes===Array?Array.prototype.slice.call(u.messageIDs[h]):u.messageIDs[h]}return l},a.prototype.toJSON=function(){return this.constructor.toObject(this,t.util.toJSONOptions)},a}(),i.ControlGraft=function(){function a(u){if(u)for(var c=Object.keys(u),l=0;l<c.length;++l)u[c[l]]!=null&&(this[c[l]]=u[c[l]])}a.prototype.topicID=null;var f;return Object.defineProperty(a.prototype,"_topicID",{get:n.oneOfGetter(f=["topicID"]),set:n.oneOfSetter(f)}),a.encode=function(c,l){return l||(l=r.create()),c.topicID!=null&&Object.hasOwnProperty.call(c,"topicID")&&l.uint32(10).string(c.topicID),l},a.decode=function(c,l){c instanceof e||(c=e.create(c));for(var h=l===void 0?c.len:c.pos+l,g=new s.RPC.ControlGraft;c.pos<h;){var p=c.uint32();switch(p>>>3){case 1:g.topicID=c.string();break;default:c.skipType(p&7);break}}return g},a.fromObject=function(c){if(c instanceof s.RPC.ControlGraft)return c;var l=new s.RPC.ControlGraft;return c.topicID!=null&&(l.topicID=String(c.topicID)),l},a.toObject=function(c,l){l||(l={});var h={};return c.topicID!=null&&c.hasOwnProperty("topicID")&&(h.topicID=c.topicID,l.oneofs&&(h._topicID="topicID")),h},a.prototype.toJSON=function(){return this.constructor.toObject(this,t.util.toJSONOptions)},a}(),i.ControlPrune=function(){function a(u){if(this.peers=[],u)for(var c=Object.keys(u),l=0;l<c.length;++l)u[c[l]]!=null&&(this[c[l]]=u[c[l]])}a.prototype.topicID=null,a.prototype.peers=n.emptyArray,a.prototype.backoff=null;var f;return Object.defineProperty(a.prototype,"_topicID",{get:n.oneOfGetter(f=["topicID"]),set:n.oneOfSetter(f)}),Object.defineProperty(a.prototype,"_backoff",{get:n.oneOfGetter(f=["backoff"]),set:n.oneOfSetter(f)}),a.encode=function(c,l){if(l||(l=r.create()),c.topicID!=null&&Object.hasOwnProperty.call(c,"topicID")&&l.uint32(10).string(c.topicID),c.peers!=null&&c.peers.length)for(var h=0;h<c.peers.length;++h)s.RPC.PeerInfo.encode(c.peers[h],l.uint32(18).fork()).ldelim();return c.backoff!=null&&Object.hasOwnProperty.call(c,"backoff")&&l.uint32(24).uint64(c.backoff),l},a.decode=function(c,l){c instanceof e||(c=e.create(c));for(var h=l===void 0?c.len:c.pos+l,g=new s.RPC.ControlPrune;c.pos<h;){var p=c.uint32();switch(p>>>3){case 1:g.topicID=c.string();break;case 2:g.peers&&g.peers.length||(g.peers=[]),g.peers.push(s.RPC.PeerInfo.decode(c,c.uint32()));break;case 3:g.backoff=c.uint64();break;default:c.skipType(p&7);break}}return g},a.fromObject=function(c){if(c instanceof s.RPC.ControlPrune)return c;var l=new s.RPC.ControlPrune;if(c.topicID!=null&&(l.topicID=String(c.topicID)),c.peers){if(!Array.isArray(c.peers))throw TypeError(".RPC.ControlPrune.peers: array expected");l.peers=[];for(var h=0;h<c.peers.length;++h){if(typeof c.peers[h]!="object")throw TypeError(".RPC.ControlPrune.peers: object expected");l.peers[h]=s.RPC.PeerInfo.fromObject(c.peers[h])}}return c.backoff!=null&&(n.Long?(l.backoff=n.Long.fromValue(c.backoff)).unsigned=!0:typeof c.backoff=="string"?l.backoff=parseInt(c.backoff,10):typeof c.backoff=="number"?l.backoff=c.backoff:typeof c.backoff=="object"&&(l.backoff=new n.LongBits(c.backoff.low>>>0,c.backoff.high>>>0).toNumber(!0))),l},a.toObject=function(c,l){l||(l={});var h={};if((l.arrays||l.defaults)&&(h.peers=[]),c.topicID!=null&&c.hasOwnProperty("topicID")&&(h.topicID=c.topicID,l.oneofs&&(h._topicID="topicID")),c.peers&&c.peers.length){h.peers=[];for(var g=0;g<c.peers.length;++g)h.peers[g]=s.RPC.PeerInfo.toObject(c.peers[g],l)}return c.backoff!=null&&c.hasOwnProperty("backoff")&&(typeof c.backoff=="number"?h.backoff=l.longs===String?String(c.backoff):c.backoff:h.backoff=l.longs===String?n.Long.prototype.toString.call(c.backoff):l.longs===Number?new n.LongBits(c.backoff.low>>>0,c.backoff.high>>>0).toNumber(!0):c.backoff,l.oneofs&&(h._backoff="backoff")),h},a.prototype.toJSON=function(){return this.constructor.toObject(this,t.util.toJSONOptions)},a}(),i.PeerInfo=function(){function a(u){if(u)for(var c=Object.keys(u),l=0;l<c.length;++l)u[c[l]]!=null&&(this[c[l]]=u[c[l]])}a.prototype.peerID=null,a.prototype.signedPeerRecord=null;var f;return Object.defineProperty(a.prototype,"_peerID",{get:n.oneOfGetter(f=["peerID"]),set:n.oneOfSetter(f)}),Object.defineProperty(a.prototype,"_signedPeerRecord",{get:n.oneOfGetter(f=["signedPeerRecord"]),set:n.oneOfSetter(f)}),a.encode=function(c,l){return l||(l=r.create()),c.peerID!=null&&Object.hasOwnProperty.call(c,"peerID")&&l.uint32(10).bytes(c.peerID),c.signedPeerRecord!=null&&Object.hasOwnProperty.call(c,"signedPeerRecord")&&l.uint32(18).bytes(c.signedPeerRecord),l},a.decode=function(c,l){c instanceof e||(c=e.create(c));for(var h=l===void 0?c.len:c.pos+l,g=new s.RPC.PeerInfo;c.pos<h;){var p=c.uint32();switch(p>>>3){case 1:g.peerID=c.bytes();break;case 2:g.signedPeerRecord=c.bytes();break;default:c.skipType(p&7);break}}return g},a.fromObject=function(c){if(c instanceof s.RPC.PeerInfo)return c;var l=new s.RPC.PeerInfo;return c.peerID!=null&&(typeof c.peerID=="string"?n.base64.decode(c.peerID,l.peerID=n.newBuffer(n.base64.length(c.peerID)),0):c.peerID.length&&(l.peerID=c.peerID)),c.signedPeerRecord!=null&&(typeof c.signedPeerRecord=="string"?n.base64.decode(c.signedPeerRecord,l.signedPeerRecord=n.newBuffer(n.base64.length(c.signedPeerRecord)),0):c.signedPeerRecord.length&&(l.signedPeerRecord=c.signedPeerRecord)),l},a.toObject=function(c,l){l||(l={});var h={};return c.peerID!=null&&c.hasOwnProperty("peerID")&&(h.peerID=l.bytes===String?n.base64.encode(c.peerID,0,c.peerID.length):l.bytes===Array?Array.prototype.slice.call(c.peerID):c.peerID,l.oneofs&&(h._peerID="peerID")),c.signedPeerRecord!=null&&c.hasOwnProperty("signedPeerRecord")&&(h.signedPeerRecord=l.bytes===String?n.base64.encode(c.signedPeerRecord,0,c.signedPeerRecord.length):l.bytes===Array?Array.prototype.slice.call(c.signedPeerRecord):c.signedPeerRecord,l.oneofs&&(h._signedPeerRecord="signedPeerRecord")),h},a.prototype.toJSON=function(){return this.constructor.toObject(this,t.util.toJSONOptions)},a}(),i}(),s})});var Lu=G((jx,Mu)=>{var on=1e3,an=on*60,cn=an*60,Br=cn*24,Up=Br*7,Kp=Br*365.25;Mu.exports=function(t,e){e=e||{};var r=typeof t;if(r==="string"&&t.length>0)return qp(t);if(r==="number"&&isFinite(t))return e.long?zp(t):Vp(t);throw new Error("val is not a non-empty string or a valid number. val="+JSON.stringify(t))};function qp(t){if(t=String(t),!(t.length>100)){var e=/^(-?(?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|weeks?|w|years?|yrs?|y)?$/i.exec(t);if(e){var r=parseFloat(e[1]),n=(e[2]||"ms").toLowerCase();switch(n){case"years":case"year":case"yrs":case"yr":case"y":return r*Kp;case"weeks":case"week":case"w":return r*Up;case"days":case"day":case"d":return r*Br;case"hours":case"hour":case"hrs":case"hr":case"h":return r*cn;case"minutes":case"minute":case"mins":case"min":case"m":return r*an;case"seconds":case"second":case"secs":case"sec":case"s":return r*on;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return r;default:return}}}}function Vp(t){var e=Math.abs(t);return e>=Br?Math.round(t/Br)+"d":e>=cn?Math.round(t/cn)+"h":e>=an?Math.round(t/an)+"m":e>=on?Math.round(t/on)+"s":t+"ms"}function zp(t){var e=Math.abs(t);return e>=Br?ws(t,e,Br,"day"):e>=cn?ws(t,e,cn,"hour"):e>=an?ws(t,e,an,"minute"):e>=on?ws(t,e,on,"second"):t+" ms"}function ws(t,e,r,n){var s=e>=r*1.5;return Math.round(t/r)+" "+n+(s?"s":"")}});var Ou=G(($x,Nu)=>{function Hp(t){r.debug=r,r.default=r,r.coerce=f,r.disable=i,r.enable=s,r.enabled=o,r.humanize=Lu(),r.destroy=u,Object.keys(t).forEach(c=>{r[c]=t[c]}),r.names=[],r.skips=[],r.formatters={};function e(c){let l=0;for(let h=0;h<c.length;h++)l=(l<<5)-l+c.charCodeAt(h),l|=0;return r.colors[Math.abs(l)%r.colors.length]}r.selectColor=e;function r(c){let l,h=null,g,p;function d(...y){if(!d.enabled)return;let m=d,E=Number(new Date),v=E-(l||E);m.diff=v,m.prev=l,m.curr=E,l=E,y[0]=r.coerce(y[0]),typeof y[0]!="string"&&y.unshift("%O");let C=0;y[0]=y[0].replace(/%([a-zA-Z%])/g,(w,I)=>{if(w==="%%")return"%";C++;let T=r.formatters[I];if(typeof T=="function"){let F=y[C];w=T.call(m,F),y.splice(C,1),C--}return w}),r.formatArgs.call(m,y),(m.log||r.log).apply(m,y)}return d.namespace=c,d.useColors=r.useColors(),d.color=r.selectColor(c),d.extend=n,d.destroy=r.destroy,Object.defineProperty(d,"enabled",{enumerable:!0,configurable:!1,get:()=>h!==null?h:(g!==r.namespaces&&(g=r.namespaces,p=r.enabled(c)),p),set:y=>{h=y}}),typeof r.init=="function"&&r.init(d),d}function n(c,l){let h=r(this.namespace+(typeof l>"u"?":":l)+c);return h.log=this.log,h}function s(c){r.save(c),r.namespaces=c,r.names=[],r.skips=[];let l,h=(typeof c=="string"?c:"").split(/[\s,]+/),g=h.length;for(l=0;l<g;l++)h[l]&&(c=h[l].replace(/\*/g,".*?"),c[0]==="-"?r.skips.push(new RegExp("^"+c.slice(1)+"$")):r.names.push(new RegExp("^"+c+"$")))}function i(){let c=[...r.names.map(a),...r.skips.map(a).map(l=>"-"+l)].join(",");return r.enable(""),c}function o(c){if(c[c.length-1]==="*")return!0;let l,h;for(l=0,h=r.skips.length;l<h;l++)if(r.skips[l].test(c))return!1;for(l=0,h=r.names.length;l<h;l++)if(r.names[l].test(c))return!0;return!1}function a(c){return c.toString().substring(2,c.toString().length-2).replace(/\.\*\?$/,"*")}function f(c){return c instanceof Error?c.stack||c.message:c}function u(){console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`.")}return r.enable(r.load()),r}Nu.exports=Hp});var Fu=G((it,Ss)=>{it.formatArgs=Wp;it.save=jp;it.load=$p;it.useColors=Gp;it.storage=Yp();it.destroy=(()=>{let t=!1;return()=>{t||(t=!0,console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`."))}})();it.colors=["#0000CC","#0000FF","#0033CC","#0033FF","#0066CC","#0066FF","#0099CC","#0099FF","#00CC00","#00CC33","#00CC66","#00CC99","#00CCCC","#00CCFF","#3300CC","#3300FF","#3333CC","#3333FF","#3366CC","#3366FF","#3399CC","#3399FF","#33CC00","#33CC33","#33CC66","#33CC99","#33CCCC","#33CCFF","#6600CC","#6600FF","#6633CC","#6633FF","#66CC00","#66CC33","#9900CC","#9900FF","#9933CC","#9933FF","#99CC00","#99CC33","#CC0000","#CC0033","#CC0066","#CC0099","#CC00CC","#CC00FF","#CC3300","#CC3333","#CC3366","#CC3399","#CC33CC","#CC33FF","#CC6600","#CC6633","#CC9900","#CC9933","#CCCC00","#CCCC33","#FF0000","#FF0033","#FF0066","#FF0099","#FF00CC","#FF00FF","#FF3300","#FF3333","#FF3366","#FF3399","#FF33CC","#FF33FF","#FF6600","#FF6633","#FF9900","#FF9933","#FFCC00","#FFCC33"];function Gp(){return typeof window<"u"&&window.process&&(window.process.type==="renderer"||window.process.__nwjs)?!0:typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/(edge|trident)\/(\d+)/)?!1:typeof document<"u"&&document.documentElement&&document.documentElement.style&&document.documentElement.style.WebkitAppearance||typeof window<"u"&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/)&&parseInt(RegExp.$1,10)>=31||typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\/(\d+)/)}function Wp(t){if(t[0]=(this.useColors?"%c":"")+this.namespace+(this.useColors?" %c":" ")+t[0]+(this.useColors?"%c ":" ")+"+"+Ss.exports.humanize(this.diff),!this.useColors)return;let e="color: "+this.color;t.splice(1,0,e,"color: inherit");let r=0,n=0;t[0].replace(/%[a-zA-Z%]/g,s=>{s!=="%%"&&(r++,s==="%c"&&(n=r))}),t.splice(n,0,e)}it.log=console.debug||console.log||(()=>{});function jp(t){try{t?it.storage.setItem("debug",t):it.storage.removeItem("debug")}catch{}}function $p(){let t;try{t=it.storage.getItem("debug")}catch{}return!t&&typeof process<"u"&&"env"in process&&(t=process.env.DEBUG),t}function Yp(){try{return localStorage}catch{}}Ss.exports=Ou()(it);var{formatters:Zp}=Ss.exports;Zp.j=function(t){try{return JSON.stringify(t)}catch(e){return"[UnexpectedJSONParseError]: "+e.message}}});var zu=G((sv,Vu)=>{"use strict";function ve(t,r){var r=r||{};this._capacity=r.capacity,this._head=0,this._tail=0,Array.isArray(t)?this._fromArray(t):(this._capacityMask=3,this._list=new Array(4))}ve.prototype.peekAt=function(e){var r=e;if(r===(r|0)){var n=this.size();if(!(r>=n||r<-n))return r<0&&(r+=n),r=this._head+r&this._capacityMask,this._list[r]}};ve.prototype.get=function(e){return this.peekAt(e)};ve.prototype.peek=function(){if(this._head!==this._tail)return this._list[this._head]};ve.prototype.peekFront=function(){return this.peek()};ve.prototype.peekBack=function(){return this.peekAt(-1)};Object.defineProperty(ve.prototype,"length",{get:function(){return this.size()}});ve.prototype.size=function(){return this._head===this._tail?0:this._head<this._tail?this._tail-this._head:this._capacityMask+1-(this._head-this._tail)};ve.prototype.unshift=function(e){if(arguments.length===0)return this.size();var r=this._list.length;return this._head=this._head-1+r&this._capacityMask,this._list[this._head]=e,this._tail===this._head&&this._growArray(),this._capacity&&this.size()>this._capacity&&this.pop(),this._head<this._tail?this._tail-this._head:this._capacityMask+1-(this._head-this._tail)};ve.prototype.shift=function(){var e=this._head;if(e!==this._tail){var r=this._list[e];return this._list[e]=void 0,this._head=e+1&this._capacityMask,e<2&&this._tail>1e4&&this._tail<=this._list.length>>>2&&this._shrinkArray(),r}};ve.prototype.push=function(e){if(arguments.length===0)return this.size();var r=this._tail;return this._list[r]=e,this._tail=r+1&this._capacityMask,this._tail===this._head&&this._growArray(),this._capacity&&this.size()>this._capacity&&this.shift(),this._head<this._tail?this._tail-this._head:this._capacityMask+1-(this._head-this._tail)};ve.prototype.pop=function(){var e=this._tail;if(e!==this._head){var r=this._list.length;this._tail=e-1+r&this._capacityMask;var n=this._list[this._tail];return this._list[this._tail]=void 0,this._head<2&&e>1e4&&e<=r>>>2&&this._shrinkArray(),n}};ve.prototype.removeOne=function(e){var r=e;if(r===(r|0)&&this._head!==this._tail){var n=this.size(),s=this._list.length;if(!(r>=n||r<-n)){r<0&&(r+=n),r=this._head+r&this._capacityMask;var i=this._list[r],o;if(e<n/2){for(o=e;o>0;o--)this._list[r]=this._list[r=r-1+s&this._capacityMask];this._list[r]=void 0,this._head=this._head+1+s&this._capacityMask}else{for(o=n-1-e;o>0;o--)this._list[r]=this._list[r=r+1+s&this._capacityMask];this._list[r]=void 0,this._tail=this._tail-1+s&this._capacityMask}return i}}};ve.prototype.remove=function(e,r){var n=e,s,i=r;if(n===(n|0)&&this._head!==this._tail){var o=this.size(),a=this._list.length;if(!(n>=o||n<-o||r<1)){if(n<0&&(n+=o),r===1||!r)return s=new Array(1),s[0]=this.removeOne(n),s;if(n===0&&n+r>=o)return s=this.toArray(),this.clear(),s;n+r>o&&(r=o-n);var f;for(s=new Array(r),f=0;f<r;f++)s[f]=this._list[this._head+n+f&this._capacityMask];if(n=this._head+n&this._capacityMask,e+r===o){for(this._tail=this._tail-r+a&this._capacityMask,f=r;f>0;f--)this._list[n=n+1+a&this._capacityMask]=void 0;return s}if(e===0){for(this._head=this._head+r+a&this._capacityMask,f=r-1;f>0;f--)this._list[n=n+1+a&this._capacityMask]=void 0;return s}if(n<o/2){for(this._head=this._head+e+r+a&this._capacityMask,f=e;f>0;f--)this.unshift(this._list[n=n-1+a&this._capacityMask]);for(n=this._head-1+a&this._capacityMask;i>0;)this._list[n=n-1+a&this._capacityMask]=void 0,i--;e<0&&(this._tail=n)}else{for(this._tail=n,n=n+r+a&this._capacityMask,f=o-(r+e);f>0;f--)this.push(this._list[n++]);for(n=this._tail;i>0;)this._list[n=n+1+a&this._capacityMask]=void 0,i--}return this._head<2&&this._tail>1e4&&this._tail<=a>>>2&&this._shrinkArray(),s}}};ve.prototype.splice=function(e,r){var n=e;if(n===(n|0)){var s=this.size();if(n<0&&(n+=s),!(n>s))if(arguments.length>2){var i,o,a,f=arguments.length,u=this._list.length,c=2;if(!s||n<s/2){for(o=new Array(n),i=0;i<n;i++)o[i]=this._list[this._head+i&this._capacityMask];for(r===0?(a=[],n>0&&(this._head=this._head+n+u&this._capacityMask)):(a=this.remove(n,r),this._head=this._head+n+u&this._capacityMask);f>c;)this.unshift(arguments[--f]);for(i=n;i>0;i--)this.unshift(o[i-1])}else{o=new Array(s-(n+r));var l=o.length;for(i=0;i<l;i++)o[i]=this._list[this._head+n+r+i&this._capacityMask];for(r===0?(a=[],n!=s&&(this._tail=this._head+n+u&this._capacityMask)):(a=this.remove(n,r),this._tail=this._tail-l+u&this._capacityMask);c<f;)this.push(arguments[c++]);for(i=0;i<l;i++)this.push(o[i])}return a}else return this.remove(n,r)}};ve.prototype.clear=function(){this._list=new Array(this._list.length),this._head=0,this._tail=0};ve.prototype.isEmpty=function(){return this._head===this._tail};ve.prototype.toArray=function(){return this._copyArray(!1)};ve.prototype._fromArray=function(e){var r=e.length,n=this._nextPowerOf2(r);this._list=new Array(n),this._capacityMask=n-1,this._tail=r;for(var s=0;s<r;s++)this._list[s]=e[s]};ve.prototype._copyArray=function(e,r){var n=this._list,s=n.length,i=this.length;if(r=r|i,r==i&&this._head<this._tail)return this._list.slice(this._head,this._tail);var o=new Array(r),a=0,f;if(e||this._head>this._tail){for(f=this._head;f<s;f++)o[a++]=n[f];for(f=0;f<this._tail;f++)o[a++]=n[f]}else for(f=this._head;f<this._tail;f++)o[a++]=n[f];return o};ve.prototype._growArray=function(){if(this._head!=0){var e=this._copyArray(!0,this._list.length<<1);this._tail=this._list.length,this._head=0,this._list=e}else this._tail=this._list.length,this._list.length<<=1;this._capacityMask=this._capacityMask<<1|1};ve.prototype._shrinkArray=function(){this._list.length>>>=1,this._capacityMask>>>=1};ve.prototype._nextPowerOf2=function(e){var r=Math.log(e)/Math.log(2),n=1<<r+1;return Math.max(n,4)};Vu.exports=ve});var Qu=G((Kv,Zu)=>{"use strict";function Yu(t,e){for(let r in e)Object.defineProperty(t,r,{value:e[r],enumerable:!0,configurable:!0});return t}function ad(t,e,r){if(!t||typeof t=="string")throw new TypeError("Please pass an Error to err-code");r||(r={}),typeof e=="object"&&(r=e,e=""),e&&(r.code=e);try{return Yu(t,r)}catch{r.message=t.message,r.stack=t.stack;let s=function(){};return s.prototype=Object.create(Object.getPrototypeOf(t)),Yu(new s,r)}}Zu.exports=ad});var ce=G((rw,Xu)=>{Xu.exports={options:{usePureJavaScript:!1}}});var tf=G((nw,ef)=>{var So={};ef.exports=So;var Ju={};So.encode=function(t,e,r){if(typeof e!="string")throw new TypeError('"alphabet" must be a string.');if(r!==void 0&&typeof r!="number")throw new TypeError('"maxline" must be a number.');var n="";if(!(t instanceof Uint8Array))n=fd(t,e);else{var s=0,i=e.length,o=e.charAt(0),a=[0];for(s=0;s<t.length;++s){for(var f=0,u=t[s];f<a.length;++f)u+=a[f]<<8,a[f]=u%i,u=u/i|0;for(;u>0;)a.push(u%i),u=u/i|0}for(s=0;t[s]===0&&s<t.length-1;++s)n+=o;for(s=a.length-1;s>=0;--s)n+=e[a[s]]}if(r){var c=new RegExp(".{1,"+r+"}","g");n=n.match(c).join(`\r
`)}return n};So.decode=function(t,e){if(typeof t!="string")throw new TypeError('"input" must be a string.');if(typeof e!="string")throw new TypeError('"alphabet" must be a string.');var r=Ju[e];if(!r){r=Ju[e]=[];for(var n=0;n<e.length;++n)r[e.charCodeAt(n)]=n}t=t.replace(/\s/g,"");for(var s=e.length,i=e.charAt(0),o=[0],n=0;n<t.length;n++){var a=r[t.charCodeAt(n)];if(a===void 0)return;for(var f=0,u=a;f<o.length;++f)u+=o[f]*s,o[f]=u&255,u>>=8;for(;u>0;)o.push(u&255),u>>=8}for(var c=0;t[c]===i&&c<t.length-1;++c)o.push(0);return typeof Buffer<"u"?Buffer.from(o.reverse()):new Uint8Array(o.reverse())};function fd(t,e){var r=0,n=e.length,s=e.charAt(0),i=[0];for(r=0;r<t.length();++r){for(var o=0,a=t.at(r);o<i.length;++o)a+=i[o]<<8,i[o]=a%n,a=a/n|0;for(;a>0;)i.push(a%n),a=a/n|0}var f="";for(r=0;t.at(r)===0&&r<t.length()-1;++r)f+=s;for(r=i.length-1;r>=0;--r)f+=e[i[r]];return f}});var Ce=G((sw,of)=>{var rf=ce(),nf=tf(),x=of.exports=rf.util=rf.util||{};(function(){if(typeof process<"u"&&process.nextTick&&!process.browser){x.nextTick=process.nextTick,typeof setImmediate=="function"?x.setImmediate=setImmediate:x.setImmediate=x.nextTick;return}if(typeof setImmediate=="function"){x.setImmediate=function(){return setImmediate.apply(void 0,arguments)},x.nextTick=function(a){return setImmediate(a)};return}if(x.setImmediate=function(a){setTimeout(a,0)},typeof window<"u"&&typeof window.postMessage=="function"){let a=function(f){if(f.source===window&&f.data===t){f.stopPropagation();var u=e.slice();e.length=0,u.forEach(function(c){c()})}};var o=a,t="forge.setImmediate",e=[];x.setImmediate=function(f){e.push(f),e.length===1&&window.postMessage(t,"*")},window.addEventListener("message",a,!0)}if(typeof MutationObserver<"u"){var r=Date.now(),n=!0,s=document.createElement("div"),e=[];new MutationObserver(function(){var f=e.slice();e.length=0,f.forEach(function(u){u()})}).observe(s,{attributes:!0});var i=x.setImmediate;x.setImmediate=function(f){Date.now()-r>15?(r=Date.now(),i(f)):(e.push(f),e.length===1&&s.setAttribute("a",n=!n))}}x.nextTick=x.setImmediate})();x.isNodejs=typeof process<"u"&&process.versions&&process.versions.node;x.globalScope=function(){return x.isNodejs?globalThis:typeof self>"u"?window:self}();x.isArray=Array.isArray||function(t){return Object.prototype.toString.call(t)==="[object Array]"};x.isArrayBuffer=function(t){return typeof ArrayBuffer<"u"&&t instanceof ArrayBuffer};x.isArrayBufferView=function(t){return t&&x.isArrayBuffer(t.buffer)&&t.byteLength!==void 0};function Hn(t){if(!(t===8||t===16||t===24||t===32))throw new Error("Only 8, 16, 24, or 32 bits supported: "+t)}x.ByteBuffer=Eo;function Eo(t){if(this.data="",this.read=0,typeof t=="string")this.data=t;else if(x.isArrayBuffer(t)||x.isArrayBufferView(t))if(typeof Buffer<"u"&&t instanceof Buffer)this.data=t.toString("binary");else{var e=new Uint8Array(t);try{this.data=String.fromCharCode.apply(null,e)}catch{for(var r=0;r<e.length;++r)this.putByte(e[r])}}else(t instanceof Eo||typeof t=="object"&&typeof t.data=="string"&&typeof t.read=="number")&&(this.data=t.data,this.read=t.read);this._constructedStringLength=0}x.ByteStringBuffer=Eo;var ld=4096;x.ByteStringBuffer.prototype._optimizeConstructedString=function(t){this._constructedStringLength+=t,this._constructedStringLength>ld&&(this.data.substr(0,1),this._constructedStringLength=0)};x.ByteStringBuffer.prototype.length=function(){return this.data.length-this.read};x.ByteStringBuffer.prototype.isEmpty=function(){return this.length()<=0};x.ByteStringBuffer.prototype.putByte=function(t){return this.putBytes(String.fromCharCode(t))};x.ByteStringBuffer.prototype.fillWithByte=function(t,e){t=String.fromCharCode(t);for(var r=this.data;e>0;)e&1&&(r+=t),e>>>=1,e>0&&(t+=t);return this.data=r,this._optimizeConstructedString(e),this};x.ByteStringBuffer.prototype.putBytes=function(t){return this.data+=t,this._optimizeConstructedString(t.length),this};x.ByteStringBuffer.prototype.putString=function(t){return this.putBytes(x.encodeUtf8(t))};x.ByteStringBuffer.prototype.putInt16=function(t){return this.putBytes(String.fromCharCode(t>>8&255)+String.fromCharCode(t&255))};x.ByteStringBuffer.prototype.putInt24=function(t){return this.putBytes(String.fromCharCode(t>>16&255)+String.fromCharCode(t>>8&255)+String.fromCharCode(t&255))};x.ByteStringBuffer.prototype.putInt32=function(t){return this.putBytes(String.fromCharCode(t>>24&255)+String.fromCharCode(t>>16&255)+String.fromCharCode(t>>8&255)+String.fromCharCode(t&255))};x.ByteStringBuffer.prototype.putInt16Le=function(t){return this.putBytes(String.fromCharCode(t&255)+String.fromCharCode(t>>8&255))};x.ByteStringBuffer.prototype.putInt24Le=function(t){return this.putBytes(String.fromCharCode(t&255)+String.fromCharCode(t>>8&255)+String.fromCharCode(t>>16&255))};x.ByteStringBuffer.prototype.putInt32Le=function(t){return this.putBytes(String.fromCharCode(t&255)+String.fromCharCode(t>>8&255)+String.fromCharCode(t>>16&255)+String.fromCharCode(t>>24&255))};x.ByteStringBuffer.prototype.putInt=function(t,e){Hn(e);var r="";do e-=8,r+=String.fromCharCode(t>>e&255);while(e>0);return this.putBytes(r)};x.ByteStringBuffer.prototype.putSignedInt=function(t,e){return t<0&&(t+=2<<e-1),this.putInt(t,e)};x.ByteStringBuffer.prototype.putBuffer=function(t){return this.putBytes(t.getBytes())};x.ByteStringBuffer.prototype.getByte=function(){return this.data.charCodeAt(this.read++)};x.ByteStringBuffer.prototype.getInt16=function(){var t=this.data.charCodeAt(this.read)<<8^this.data.charCodeAt(this.read+1);return this.read+=2,t};x.ByteStringBuffer.prototype.getInt24=function(){var t=this.data.charCodeAt(this.read)<<16^this.data.charCodeAt(this.read+1)<<8^this.data.charCodeAt(this.read+2);return this.read+=3,t};x.ByteStringBuffer.prototype.getInt32=function(){var t=this.data.charCodeAt(this.read)<<24^this.data.charCodeAt(this.read+1)<<16^this.data.charCodeAt(this.read+2)<<8^this.data.charCodeAt(this.read+3);return this.read+=4,t};x.ByteStringBuffer.prototype.getInt16Le=function(){var t=this.data.charCodeAt(this.read)^this.data.charCodeAt(this.read+1)<<8;return this.read+=2,t};x.ByteStringBuffer.prototype.getInt24Le=function(){var t=this.data.charCodeAt(this.read)^this.data.charCodeAt(this.read+1)<<8^this.data.charCodeAt(this.read+2)<<16;return this.read+=3,t};x.ByteStringBuffer.prototype.getInt32Le=function(){var t=this.data.charCodeAt(this.read)^this.data.charCodeAt(this.read+1)<<8^this.data.charCodeAt(this.read+2)<<16^this.data.charCodeAt(this.read+3)<<24;return this.read+=4,t};x.ByteStringBuffer.prototype.getInt=function(t){Hn(t);var e=0;do e=(e<<8)+this.data.charCodeAt(this.read++),t-=8;while(t>0);return e};x.ByteStringBuffer.prototype.getSignedInt=function(t){var e=this.getInt(t),r=2<<t-2;return e>=r&&(e-=r<<1),e};x.ByteStringBuffer.prototype.getBytes=function(t){var e;return t?(t=Math.min(this.length(),t),e=this.data.slice(this.read,this.read+t),this.read+=t):t===0?e="":(e=this.read===0?this.data:this.data.slice(this.read),this.clear()),e};x.ByteStringBuffer.prototype.bytes=function(t){return typeof t>"u"?this.data.slice(this.read):this.data.slice(this.read,this.read+t)};x.ByteStringBuffer.prototype.at=function(t){return this.data.charCodeAt(this.read+t)};x.ByteStringBuffer.prototype.setAt=function(t,e){return this.data=this.data.substr(0,this.read+t)+String.fromCharCode(e)+this.data.substr(this.read+t+1),this};x.ByteStringBuffer.prototype.last=function(){return this.data.charCodeAt(this.data.length-1)};x.ByteStringBuffer.prototype.copy=function(){var t=x.createBuffer(this.data);return t.read=this.read,t};x.ByteStringBuffer.prototype.compact=function(){return this.read>0&&(this.data=this.data.slice(this.read),this.read=0),this};x.ByteStringBuffer.prototype.clear=function(){return this.data="",this.read=0,this};x.ByteStringBuffer.prototype.truncate=function(t){var e=Math.max(0,this.length()-t);return this.data=this.data.substr(this.read,e),this.read=0,this};x.ByteStringBuffer.prototype.toHex=function(){for(var t="",e=this.read;e<this.data.length;++e){var r=this.data.charCodeAt(e);r<16&&(t+="0"),t+=r.toString(16)}return t};x.ByteStringBuffer.prototype.toString=function(){return x.decodeUtf8(this.bytes())};function hd(t,e){e=e||{},this.read=e.readOffset||0,this.growSize=e.growSize||1024;var r=x.isArrayBuffer(t),n=x.isArrayBufferView(t);if(r||n){r?this.data=new DataView(t):this.data=new DataView(t.buffer,t.byteOffset,t.byteLength),this.write="writeOffset"in e?e.writeOffset:this.data.byteLength;return}this.data=new DataView(new ArrayBuffer(0)),this.write=0,t!=null&&this.putBytes(t),"writeOffset"in e&&(this.write=e.writeOffset)}x.DataBuffer=hd;x.DataBuffer.prototype.length=function(){return this.write-this.read};x.DataBuffer.prototype.isEmpty=function(){return this.length()<=0};x.DataBuffer.prototype.accommodate=function(t,e){if(this.length()>=t)return this;e=Math.max(e||this.growSize,t);var r=new Uint8Array(this.data.buffer,this.data.byteOffset,this.data.byteLength),n=new Uint8Array(this.length()+e);return n.set(r),this.data=new DataView(n.buffer),this};x.DataBuffer.prototype.putByte=function(t){return this.accommodate(1),this.data.setUint8(this.write++,t),this};x.DataBuffer.prototype.fillWithByte=function(t,e){this.accommodate(e);for(var r=0;r<e;++r)this.data.setUint8(t);return this};x.DataBuffer.prototype.putBytes=function(t,e){if(x.isArrayBufferView(t)){var r=new Uint8Array(t.buffer,t.byteOffset,t.byteLength),n=r.byteLength-r.byteOffset;this.accommodate(n);var s=new Uint8Array(this.data.buffer,this.write);return s.set(r),this.write+=n,this}if(x.isArrayBuffer(t)){var r=new Uint8Array(t);this.accommodate(r.byteLength);var s=new Uint8Array(this.data.buffer);return s.set(r,this.write),this.write+=r.byteLength,this}if(t instanceof x.DataBuffer||typeof t=="object"&&typeof t.read=="number"&&typeof t.write=="number"&&x.isArrayBufferView(t.data)){var r=new Uint8Array(t.data.byteLength,t.read,t.length());this.accommodate(r.byteLength);var s=new Uint8Array(t.data.byteLength,this.write);return s.set(r),this.write+=r.byteLength,this}if(t instanceof x.ByteStringBuffer&&(t=t.data,e="binary"),e=e||"binary",typeof t=="string"){var i;if(e==="hex")return this.accommodate(Math.ceil(t.length/2)),i=new Uint8Array(this.data.buffer,this.write),this.write+=x.binary.hex.decode(t,i,this.write),this;if(e==="base64")return this.accommodate(Math.ceil(t.length/4)*3),i=new Uint8Array(this.data.buffer,this.write),this.write+=x.binary.base64.decode(t,i,this.write),this;if(e==="utf8"&&(t=x.encodeUtf8(t),e="binary"),e==="binary"||e==="raw")return this.accommodate(t.length),i=new Uint8Array(this.data.buffer,this.write),this.write+=x.binary.raw.decode(i),this;if(e==="utf16")return this.accommodate(t.length*2),i=new Uint16Array(this.data.buffer,this.write),this.write+=x.text.utf16.encode(i),this;throw new Error("Invalid encoding: "+e)}throw Error("Invalid parameter: "+t)};x.DataBuffer.prototype.putBuffer=function(t){return this.putBytes(t),t.clear(),this};x.DataBuffer.prototype.putString=function(t){return this.putBytes(t,"utf16")};x.DataBuffer.prototype.putInt16=function(t){return this.accommodate(2),this.data.setInt16(this.write,t),this.write+=2,this};x.DataBuffer.prototype.putInt24=function(t){return this.accommodate(3),this.data.setInt16(this.write,t>>8&65535),this.data.setInt8(this.write,t>>16&255),this.write+=3,this};x.DataBuffer.prototype.putInt32=function(t){return this.accommodate(4),this.data.setInt32(this.write,t),this.write+=4,this};x.DataBuffer.prototype.putInt16Le=function(t){return this.accommodate(2),this.data.setInt16(this.write,t,!0),this.write+=2,this};x.DataBuffer.prototype.putInt24Le=function(t){return this.accommodate(3),this.data.setInt8(this.write,t>>16&255),this.data.setInt16(this.write,t>>8&65535,!0),this.write+=3,this};x.DataBuffer.prototype.putInt32Le=function(t){return this.accommodate(4),this.data.setInt32(this.write,t,!0),this.write+=4,this};x.DataBuffer.prototype.putInt=function(t,e){Hn(e),this.accommodate(e/8);do e-=8,this.data.setInt8(this.write++,t>>e&255);while(e>0);return this};x.DataBuffer.prototype.putSignedInt=function(t,e){return Hn(e),this.accommodate(e/8),t<0&&(t+=2<<e-1),this.putInt(t,e)};x.DataBuffer.prototype.getByte=function(){return this.data.getInt8(this.read++)};x.DataBuffer.prototype.getInt16=function(){var t=this.data.getInt16(this.read);return this.read+=2,t};x.DataBuffer.prototype.getInt24=function(){var t=this.data.getInt16(this.read)<<8^this.data.getInt8(this.read+2);return this.read+=3,t};x.DataBuffer.prototype.getInt32=function(){var t=this.data.getInt32(this.read);return this.read+=4,t};x.DataBuffer.prototype.getInt16Le=function(){var t=this.data.getInt16(this.read,!0);return this.read+=2,t};x.DataBuffer.prototype.getInt24Le=function(){var t=this.data.getInt8(this.read)^this.data.getInt16(this.read+1,!0)<<8;return this.read+=3,t};x.DataBuffer.prototype.getInt32Le=function(){var t=this.data.getInt32(this.read,!0);return this.read+=4,t};x.DataBuffer.prototype.getInt=function(t){Hn(t);var e=0;do e=(e<<8)+this.data.getInt8(this.read++),t-=8;while(t>0);return e};x.DataBuffer.prototype.getSignedInt=function(t){var e=this.getInt(t),r=2<<t-2;return e>=r&&(e-=r<<1),e};x.DataBuffer.prototype.getBytes=function(t){var e;return t?(t=Math.min(this.length(),t),e=this.data.slice(this.read,this.read+t),this.read+=t):t===0?e="":(e=this.read===0?this.data:this.data.slice(this.read),this.clear()),e};x.DataBuffer.prototype.bytes=function(t){return typeof t>"u"?this.data.slice(this.read):this.data.slice(this.read,this.read+t)};x.DataBuffer.prototype.at=function(t){return this.data.getUint8(this.read+t)};x.DataBuffer.prototype.setAt=function(t,e){return this.data.setUint8(t,e),this};x.DataBuffer.prototype.last=function(){return this.data.getUint8(this.write-1)};x.DataBuffer.prototype.copy=function(){return new x.DataBuffer(this)};x.DataBuffer.prototype.compact=function(){if(this.read>0){var t=new Uint8Array(this.data.buffer,this.read),e=new Uint8Array(t.byteLength);e.set(t),this.data=new DataView(e),this.write-=this.read,this.read=0}return this};x.DataBuffer.prototype.clear=function(){return this.data=new DataView(new ArrayBuffer(0)),this.read=this.write=0,this};x.DataBuffer.prototype.truncate=function(t){return this.write=Math.max(0,this.length()-t),this.read=Math.min(this.read,this.write),this};x.DataBuffer.prototype.toHex=function(){for(var t="",e=this.read;e<this.data.byteLength;++e){var r=this.data.getUint8(e);r<16&&(t+="0"),t+=r.toString(16)}return t};x.DataBuffer.prototype.toString=function(t){var e=new Uint8Array(this.data,this.read,this.length());if(t=t||"utf8",t==="binary"||t==="raw")return x.binary.raw.encode(e);if(t==="hex")return x.binary.hex.encode(e);if(t==="base64")return x.binary.base64.encode(e);if(t==="utf8")return x.text.utf8.decode(e);if(t==="utf16")return x.text.utf16.decode(e);throw new Error("Invalid encoding: "+t)};x.createBuffer=function(t,e){return e=e||"raw",t!==void 0&&e==="utf8"&&(t=x.encodeUtf8(t)),new x.ByteBuffer(t)};x.fillString=function(t,e){for(var r="";e>0;)e&1&&(r+=t),e>>>=1,e>0&&(t+=t);return r};x.xorBytes=function(t,e,r){for(var n="",s="",i="",o=0,a=0;r>0;--r,++o)s=t.charCodeAt(o)^e.charCodeAt(o),a>=10&&(n+=i,i="",a=0),i+=String.fromCharCode(s),++a;return n+=i,n};x.hexToBytes=function(t){var e="",r=0;for(t.length&!0&&(r=1,e+=String.fromCharCode(parseInt(t[0],16)));r<t.length;r+=2)e+=String.fromCharCode(parseInt(t.substr(r,2),16));return e};x.bytesToHex=function(t){return x.createBuffer(t).toHex()};x.int32ToBytes=function(t){return String.fromCharCode(t>>24&255)+String.fromCharCode(t>>16&255)+String.fromCharCode(t>>8&255)+String.fromCharCode(t&255)};var ar="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",cr=[62,-1,-1,-1,63,52,53,54,55,56,57,58,59,60,61,-1,-1,-1,64,-1,-1,-1,0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,-1,-1,-1,-1,-1,-1,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51],sf="123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz";x.encode64=function(t,e){for(var r="",n="",s,i,o,a=0;a<t.length;)s=t.charCodeAt(a++),i=t.charCodeAt(a++),o=t.charCodeAt(a++),r+=ar.charAt(s>>2),r+=ar.charAt((s&3)<<4|i>>4),isNaN(i)?r+="==":(r+=ar.charAt((i&15)<<2|o>>6),r+=isNaN(o)?"=":ar.charAt(o&63)),e&&r.length>e&&(n+=r.substr(0,e)+`\r
`,r=r.substr(e));return n+=r,n};x.decode64=function(t){t=t.replace(/[^A-Za-z0-9\+\/\=]/g,"");for(var e="",r,n,s,i,o=0;o<t.length;)r=cr[t.charCodeAt(o++)-43],n=cr[t.charCodeAt(o++)-43],s=cr[t.charCodeAt(o++)-43],i=cr[t.charCodeAt(o++)-43],e+=String.fromCharCode(r<<2|n>>4),s!==64&&(e+=String.fromCharCode((n&15)<<4|s>>2),i!==64&&(e+=String.fromCharCode((s&3)<<6|i)));return e};x.encodeUtf8=function(t){return unescape(encodeURIComponent(t))};x.decodeUtf8=function(t){return decodeURIComponent(escape(t))};x.binary={raw:{},hex:{},base64:{},base58:{},baseN:{encode:nf.encode,decode:nf.decode}};x.binary.raw.encode=function(t){return String.fromCharCode.apply(null,t)};x.binary.raw.decode=function(t,e,r){var n=e;n||(n=new Uint8Array(t.length)),r=r||0;for(var s=r,i=0;i<t.length;++i)n[s++]=t.charCodeAt(i);return e?s-r:n};x.binary.hex.encode=x.bytesToHex;x.binary.hex.decode=function(t,e,r){var n=e;n||(n=new Uint8Array(Math.ceil(t.length/2))),r=r||0;var s=0,i=r;for(t.length&1&&(s=1,n[i++]=parseInt(t[0],16));s<t.length;s+=2)n[i++]=parseInt(t.substr(s,2),16);return e?i-r:n};x.binary.base64.encode=function(t,e){for(var r="",n="",s,i,o,a=0;a<t.byteLength;)s=t[a++],i=t[a++],o=t[a++],r+=ar.charAt(s>>2),r+=ar.charAt((s&3)<<4|i>>4),isNaN(i)?r+="==":(r+=ar.charAt((i&15)<<2|o>>6),r+=isNaN(o)?"=":ar.charAt(o&63)),e&&r.length>e&&(n+=r.substr(0,e)+`\r
`,r=r.substr(e));return n+=r,n};x.binary.base64.decode=function(t,e,r){var n=e;n||(n=new Uint8Array(Math.ceil(t.length/4)*3)),t=t.replace(/[^A-Za-z0-9\+\/\=]/g,""),r=r||0;for(var s,i,o,a,f=0,u=r;f<t.length;)s=cr[t.charCodeAt(f++)-43],i=cr[t.charCodeAt(f++)-43],o=cr[t.charCodeAt(f++)-43],a=cr[t.charCodeAt(f++)-43],n[u++]=s<<2|i>>4,o!==64&&(n[u++]=(i&15)<<4|o>>2,a!==64&&(n[u++]=(o&3)<<6|a));return e?u-r:n.subarray(0,u)};x.binary.base58.encode=function(t,e){return x.binary.baseN.encode(t,sf,e)};x.binary.base58.decode=function(t,e){return x.binary.baseN.decode(t,sf,e)};x.text={utf8:{},utf16:{}};x.text.utf8.encode=function(t,e,r){t=x.encodeUtf8(t);var n=e;n||(n=new Uint8Array(t.length)),r=r||0;for(var s=r,i=0;i<t.length;++i)n[s++]=t.charCodeAt(i);return e?s-r:n};x.text.utf8.decode=function(t){return x.decodeUtf8(String.fromCharCode.apply(null,t))};x.text.utf16.encode=function(t,e,r){var n=e;n||(n=new Uint8Array(t.length*2));var s=new Uint16Array(n.buffer);r=r||0;for(var i=r,o=r,a=0;a<t.length;++a)s[o++]=t.charCodeAt(a),i+=2;return e?i-r:n};x.text.utf16.decode=function(t){return String.fromCharCode.apply(null,new Uint16Array(t.buffer))};x.deflate=function(t,e,r){if(e=x.decode64(t.deflate(x.encode64(e)).rval),r){var n=2,s=e.charCodeAt(1);s&32&&(n=6),e=e.substring(n,e.length-4)}return e};x.inflate=function(t,e,r){var n=t.inflate(x.encode64(e)).rval;return n===null?null:x.decode64(n)};var _o=function(t,e,r){if(!t)throw new Error("WebStorage not available.");var n;if(r===null?n=t.removeItem(e):(r=x.encode64(JSON.stringify(r)),n=t.setItem(e,r)),typeof n<"u"&&n.rval!==!0){var s=new Error(n.error.message);throw s.id=n.error.id,s.name=n.error.name,s}},Io=function(t,e){if(!t)throw new Error("WebStorage not available.");var r=t.getItem(e);if(t.init)if(r.rval===null){if(r.error){var n=new Error(r.error.message);throw n.id=r.error.id,n.name=r.error.name,n}r=null}else r=r.rval;return r!==null&&(r=JSON.parse(x.decode64(r))),r},pd=function(t,e,r,n){var s=Io(t,e);s===null&&(s={}),s[r]=n,_o(t,e,s)},dd=function(t,e,r){var n=Io(t,e);return n!==null&&(n=r in n?n[r]:null),n},gd=function(t,e,r){var n=Io(t,e);if(n!==null&&r in n){delete n[r];var s=!0;for(var i in n){s=!1;break}s&&(n=null),_o(t,e,n)}},yd=function(t,e){_o(t,e,null)},Ms=function(t,e,r){var n=null;typeof r>"u"&&(r=["web","flash"]);var s,i=!1,o=null;for(var a in r){s=r[a];try{if(s==="flash"||s==="both"){if(e[0]===null)throw new Error("Flash local storage not available.");n=t.apply(this,e),i=s==="flash"}(s==="web"||s==="both")&&(e[0]=localStorage,n=t.apply(this,e),i=!0)}catch(f){o=f}if(i)break}if(!i)throw o;return n};x.setItem=function(t,e,r,n,s){Ms(pd,arguments,s)};x.getItem=function(t,e,r,n){return Ms(dd,arguments,n)};x.removeItem=function(t,e,r,n){Ms(gd,arguments,n)};x.clearItems=function(t,e,r){Ms(yd,arguments,r)};x.isEmpty=function(t){for(var e in t)if(t.hasOwnProperty(e))return!1;return!0};x.format=function(t){for(var e=/%./g,r,n,s=0,i=[],o=0;r=e.exec(t);){n=t.substring(o,e.lastIndex-2),n.length>0&&i.push(n),o=e.lastIndex;var a=r[0][1];switch(a){case"s":case"o":s<arguments.length?i.push(arguments[s+++1]):i.push("<?>");break;case"%":i.push("%");break;default:i.push("<%"+a+"?>")}}return i.push(t.substring(o)),i.join("")};x.formatNumber=function(t,e,r,n){var s=t,i=isNaN(e=Math.abs(e))?2:e,o=r===void 0?",":r,a=n===void 0?".":n,f=s<0?"-":"",u=parseInt(s=Math.abs(+s||0).toFixed(i),10)+"",c=u.length>3?u.length%3:0;return f+(c?u.substr(0,c)+a:"")+u.substr(c).replace(/(\d{3})(?=\d)/g,"$1"+a)+(i?o+Math.abs(s-u).toFixed(i).slice(2):"")};x.formatSize=function(t){return t>=1073741824?t=x.formatNumber(t/1073741824,2,".","")+" GiB":t>=1048576?t=x.formatNumber(t/1048576,2,".","")+" MiB":t>=1024?t=x.formatNumber(t/1024,0)+" KiB":t=x.formatNumber(t,0)+" bytes",t};x.bytesFromIP=function(t){return t.indexOf(".")!==-1?x.bytesFromIPv4(t):t.indexOf(":")!==-1?x.bytesFromIPv6(t):null};x.bytesFromIPv4=function(t){if(t=t.split("."),t.length!==4)return null;for(var e=x.createBuffer(),r=0;r<t.length;++r){var n=parseInt(t[r],10);if(isNaN(n))return null;e.putByte(n)}return e.getBytes()};x.bytesFromIPv6=function(t){var e=0;t=t.split(":").filter(function(o){return o.length===0&&++e,!0});for(var r=(8-t.length+e)*2,n=x.createBuffer(),s=0;s<8;++s){if(!t[s]||t[s].length===0){n.fillWithByte(0,r),r=0;continue}var i=x.hexToBytes(t[s]);i.length<2&&n.putByte(0),n.putBytes(i)}return n.getBytes()};x.bytesToIP=function(t){return t.length===4?x.bytesToIPv4(t):t.length===16?x.bytesToIPv6(t):null};x.bytesToIPv4=function(t){if(t.length!==4)return null;for(var e=[],r=0;r<t.length;++r)e.push(t.charCodeAt(r));return e.join(".")};x.bytesToIPv6=function(t){if(t.length!==16)return null;for(var e=[],r=[],n=0,s=0;s<t.length;s+=2){for(var i=x.bytesToHex(t[s]+t[s+1]);i[0]==="0"&&i!=="0";)i=i.substr(1);if(i==="0"){var o=r[r.length-1],a=e.length;!o||a!==o.end+1?r.push({start:a,end:a}):(o.end=a,o.end-o.start>r[n].end-r[n].start&&(n=r.length-1))}e.push(i)}if(r.length>0){var f=r[n];f.end-f.start>0&&(e.splice(f.start,f.end-f.start+1,""),f.start===0&&e.unshift(""),f.end===7&&e.push(""))}return e.join(":")};x.estimateCores=function(t,e){if(typeof t=="function"&&(e=t,t={}),t=t||{},"cores"in x&&!t.update)return e(null,x.cores);if(typeof navigator<"u"&&"hardwareConcurrency"in navigator&&navigator.hardwareConcurrency>0)return x.cores=navigator.hardwareConcurrency,e(null,x.cores);if(typeof Worker>"u")return x.cores=1,e(null,x.cores);if(typeof Blob>"u")return x.cores=2,e(null,x.cores);var r=URL.createObjectURL(new Blob(["(",function(){self.addEventListener("message",function(o){for(var a=Date.now(),f=a+4;Date.now()<f;);self.postMessage({st:a,et:f})})}.toString(),")()"],{type:"application/javascript"}));n([],5,16);function n(o,a,f){if(a===0){var u=Math.floor(o.reduce(function(c,l){return c+l},0)/o.length);return x.cores=Math.max(1,u),URL.revokeObjectURL(r),e(null,x.cores)}s(f,function(c,l){o.push(i(f,l)),n(o,a-1,f)})}function s(o,a){for(var f=[],u=[],c=0;c<o;++c){var l=new Worker(r);l.addEventListener("message",function(h){if(u.push(h.data),u.length===o){for(var g=0;g<o;++g)f[g].terminate();a(null,u)}}),f.push(l)}for(var c=0;c<o;++c)f[c].postMessage(c)}function i(o,a){for(var f=[],u=0;u<o;++u)for(var c=a[u],l=f[u]=[],h=0;h<o;++h)if(u!==h){var g=a[h];(c.st>g.st&&c.st<g.et||g.st>c.st&&g.st<c.et)&&l.push(h)}return f.reduce(function(p,d){return Math.max(p,d.length)},0)}}});var Bo=G((iw,af)=>{var Le=ce();Ce();af.exports=Le.cipher=Le.cipher||{};Le.cipher.algorithms=Le.cipher.algorithms||{};Le.cipher.createCipher=function(t,e){var r=t;if(typeof r=="string"&&(r=Le.cipher.getAlgorithm(r),r&&(r=r())),!r)throw new Error("Unsupported algorithm: "+t);return new Le.cipher.BlockCipher({algorithm:r,key:e,decrypt:!1})};Le.cipher.createDecipher=function(t,e){var r=t;if(typeof r=="string"&&(r=Le.cipher.getAlgorithm(r),r&&(r=r())),!r)throw new Error("Unsupported algorithm: "+t);return new Le.cipher.BlockCipher({algorithm:r,key:e,decrypt:!0})};Le.cipher.registerAlgorithm=function(t,e){t=t.toUpperCase(),Le.cipher.algorithms[t]=e};Le.cipher.getAlgorithm=function(t){return t=t.toUpperCase(),t in Le.cipher.algorithms?Le.cipher.algorithms[t]:null};var Co=Le.cipher.BlockCipher=function(t){this.algorithm=t.algorithm,this.mode=this.algorithm.mode,this.blockSize=this.mode.blockSize,this._finish=!1,this._input=null,this.output=null,this._op=t.decrypt?this.mode.decrypt:this.mode.encrypt,this._decrypt=t.decrypt,this.algorithm.initialize(t)};Co.prototype.start=function(t){t=t||{};var e={};for(var r in t)e[r]=t[r];e.decrypt=this._decrypt,this._finish=!1,this._input=Le.util.createBuffer(),this.output=t.output||Le.util.createBuffer(),this.mode.start(e)};Co.prototype.update=function(t){for(t&&this._input.putBuffer(t);!this._op.call(this.mode,this._input,this.output,this._finish)&&!this._finish;);this._input.compact()};Co.prototype.finish=function(t){t&&(this.mode.name==="ECB"||this.mode.name==="CBC")&&(this.mode.pad=function(r){return t(this.blockSize,r,!1)},this.mode.unpad=function(r){return t(this.blockSize,r,!0)});var e={};return e.decrypt=this._decrypt,e.overflow=this._input.length()%this.blockSize,!(!this._decrypt&&this.mode.pad&&!this.mode.pad(this._input,e)||(this._finish=!0,this.update(),this._decrypt&&this.mode.unpad&&!this.mode.unpad(this.output,e))||this.mode.afterFinish&&!this.mode.afterFinish(this.output,e))}});var To=G((ow,cf)=>{var Ne=ce();Ce();Ne.cipher=Ne.cipher||{};var Q=cf.exports=Ne.cipher.modes=Ne.cipher.modes||{};Q.ecb=function(t){t=t||{},this.name="ECB",this.cipher=t.cipher,this.blockSize=t.blockSize||16,this._ints=this.blockSize/4,this._inBlock=new Array(this._ints),this._outBlock=new Array(this._ints)};Q.ecb.prototype.start=function(t){};Q.ecb.prototype.encrypt=function(t,e,r){if(t.length()<this.blockSize&&!(r&&t.length()>0))return!0;for(var n=0;n<this._ints;++n)this._inBlock[n]=t.getInt32();this.cipher.encrypt(this._inBlock,this._outBlock);for(var n=0;n<this._ints;++n)e.putInt32(this._outBlock[n])};Q.ecb.prototype.decrypt=function(t,e,r){if(t.length()<this.blockSize&&!(r&&t.length()>0))return!0;for(var n=0;n<this._ints;++n)this._inBlock[n]=t.getInt32();this.cipher.decrypt(this._inBlock,this._outBlock);for(var n=0;n<this._ints;++n)e.putInt32(this._outBlock[n])};Q.ecb.prototype.pad=function(t,e){var r=t.length()===this.blockSize?this.blockSize:this.blockSize-t.length();return t.fillWithByte(r,r),!0};Q.ecb.prototype.unpad=function(t,e){if(e.overflow>0)return!1;var r=t.length(),n=t.at(r-1);return n>this.blockSize<<2?!1:(t.truncate(n),!0)};Q.cbc=function(t){t=t||{},this.name="CBC",this.cipher=t.cipher,this.blockSize=t.blockSize||16,this._ints=this.blockSize/4,this._inBlock=new Array(this._ints),this._outBlock=new Array(this._ints)};Q.cbc.prototype.start=function(t){if(t.iv===null){if(!this._prev)throw new Error("Invalid IV parameter.");this._iv=this._prev.slice(0)}else if("iv"in t)this._iv=Ls(t.iv,this.blockSize),this._prev=this._iv.slice(0);else throw new Error("Invalid IV parameter.")};Q.cbc.prototype.encrypt=function(t,e,r){if(t.length()<this.blockSize&&!(r&&t.length()>0))return!0;for(var n=0;n<this._ints;++n)this._inBlock[n]=this._prev[n]^t.getInt32();this.cipher.encrypt(this._inBlock,this._outBlock);for(var n=0;n<this._ints;++n)e.putInt32(this._outBlock[n]);this._prev=this._outBlock};Q.cbc.prototype.decrypt=function(t,e,r){if(t.length()<this.blockSize&&!(r&&t.length()>0))return!0;for(var n=0;n<this._ints;++n)this._inBlock[n]=t.getInt32();this.cipher.decrypt(this._inBlock,this._outBlock);for(var n=0;n<this._ints;++n)e.putInt32(this._prev[n]^this._outBlock[n]);this._prev=this._inBlock.slice(0)};Q.cbc.prototype.pad=function(t,e){var r=t.length()===this.blockSize?this.blockSize:this.blockSize-t.length();return t.fillWithByte(r,r),!0};Q.cbc.prototype.unpad=function(t,e){if(e.overflow>0)return!1;var r=t.length(),n=t.at(r-1);return n>this.blockSize<<2?!1:(t.truncate(n),!0)};Q.cfb=function(t){t=t||{},this.name="CFB",this.cipher=t.cipher,this.blockSize=t.blockSize||16,this._ints=this.blockSize/4,this._inBlock=null,this._outBlock=new Array(this._ints),this._partialBlock=new Array(this._ints),this._partialOutput=Ne.util.createBuffer(),this._partialBytes=0};Q.cfb.prototype.start=function(t){if(!("iv"in t))throw new Error("Invalid IV parameter.");this._iv=Ls(t.iv,this.blockSize),this._inBlock=this._iv.slice(0),this._partialBytes=0};Q.cfb.prototype.encrypt=function(t,e,r){var n=t.length();if(n===0)return!0;if(this.cipher.encrypt(this._inBlock,this._outBlock),this._partialBytes===0&&n>=this.blockSize){for(var s=0;s<this._ints;++s)this._inBlock[s]=t.getInt32()^this._outBlock[s],e.putInt32(this._inBlock[s]);return}var i=(this.blockSize-n)%this.blockSize;i>0&&(i=this.blockSize-i),this._partialOutput.clear();for(var s=0;s<this._ints;++s)this._partialBlock[s]=t.getInt32()^this._outBlock[s],this._partialOutput.putInt32(this._partialBlock[s]);if(i>0)t.read-=this.blockSize;else for(var s=0;s<this._ints;++s)this._inBlock[s]=this._partialBlock[s];if(this._partialBytes>0&&this._partialOutput.getBytes(this._partialBytes),i>0&&!r)return e.putBytes(this._partialOutput.getBytes(i-this._partialBytes)),this._partialBytes=i,!0;e.putBytes(this._partialOutput.getBytes(n-this._partialBytes)),this._partialBytes=0};Q.cfb.prototype.decrypt=function(t,e,r){var n=t.length();if(n===0)return!0;if(this.cipher.encrypt(this._inBlock,this._outBlock),this._partialBytes===0&&n>=this.blockSize){for(var s=0;s<this._ints;++s)this._inBlock[s]=t.getInt32(),e.putInt32(this._inBlock[s]^this._outBlock[s]);return}var i=(this.blockSize-n)%this.blockSize;i>0&&(i=this.blockSize-i),this._partialOutput.clear();for(var s=0;s<this._ints;++s)this._partialBlock[s]=t.getInt32(),this._partialOutput.putInt32(this._partialBlock[s]^this._outBlock[s]);if(i>0)t.read-=this.blockSize;else for(var s=0;s<this._ints;++s)this._inBlock[s]=this._partialBlock[s];if(this._partialBytes>0&&this._partialOutput.getBytes(this._partialBytes),i>0&&!r)return e.putBytes(this._partialOutput.getBytes(i-this._partialBytes)),this._partialBytes=i,!0;e.putBytes(this._partialOutput.getBytes(n-this._partialBytes)),this._partialBytes=0};Q.ofb=function(t){t=t||{},this.name="OFB",this.cipher=t.cipher,this.blockSize=t.blockSize||16,this._ints=this.blockSize/4,this._inBlock=null,this._outBlock=new Array(this._ints),this._partialOutput=Ne.util.createBuffer(),this._partialBytes=0};Q.ofb.prototype.start=function(t){if(!("iv"in t))throw new Error("Invalid IV parameter.");this._iv=Ls(t.iv,this.blockSize),this._inBlock=this._iv.slice(0),this._partialBytes=0};Q.ofb.prototype.encrypt=function(t,e,r){var n=t.length();if(t.length()===0)return!0;if(this.cipher.encrypt(this._inBlock,this._outBlock),this._partialBytes===0&&n>=this.blockSize){for(var s=0;s<this._ints;++s)e.putInt32(t.getInt32()^this._outBlock[s]),this._inBlock[s]=this._outBlock[s];return}var i=(this.blockSize-n)%this.blockSize;i>0&&(i=this.blockSize-i),this._partialOutput.clear();for(var s=0;s<this._ints;++s)this._partialOutput.putInt32(t.getInt32()^this._outBlock[s]);if(i>0)t.read-=this.blockSize;else for(var s=0;s<this._ints;++s)this._inBlock[s]=this._outBlock[s];if(this._partialBytes>0&&this._partialOutput.getBytes(this._partialBytes),i>0&&!r)return e.putBytes(this._partialOutput.getBytes(i-this._partialBytes)),this._partialBytes=i,!0;e.putBytes(this._partialOutput.getBytes(n-this._partialBytes)),this._partialBytes=0};Q.ofb.prototype.decrypt=Q.ofb.prototype.encrypt;Q.ctr=function(t){t=t||{},this.name="CTR",this.cipher=t.cipher,this.blockSize=t.blockSize||16,this._ints=this.blockSize/4,this._inBlock=null,this._outBlock=new Array(this._ints),this._partialOutput=Ne.util.createBuffer(),this._partialBytes=0};Q.ctr.prototype.start=function(t){if(!("iv"in t))throw new Error("Invalid IV parameter.");this._iv=Ls(t.iv,this.blockSize),this._inBlock=this._iv.slice(0),this._partialBytes=0};Q.ctr.prototype.encrypt=function(t,e,r){var n=t.length();if(n===0)return!0;if(this.cipher.encrypt(this._inBlock,this._outBlock),this._partialBytes===0&&n>=this.blockSize)for(var s=0;s<this._ints;++s)e.putInt32(t.getInt32()^this._outBlock[s]);else{var i=(this.blockSize-n)%this.blockSize;i>0&&(i=this.blockSize-i),this._partialOutput.clear();for(var s=0;s<this._ints;++s)this._partialOutput.putInt32(t.getInt32()^this._outBlock[s]);if(i>0&&(t.read-=this.blockSize),this._partialBytes>0&&this._partialOutput.getBytes(this._partialBytes),i>0&&!r)return e.putBytes(this._partialOutput.getBytes(i-this._partialBytes)),this._partialBytes=i,!0;e.putBytes(this._partialOutput.getBytes(n-this._partialBytes)),this._partialBytes=0}Ns(this._inBlock)};Q.ctr.prototype.decrypt=Q.ctr.prototype.encrypt;Q.gcm=function(t){t=t||{},this.name="GCM",this.cipher=t.cipher,this.blockSize=t.blockSize||16,this._ints=this.blockSize/4,this._inBlock=new Array(this._ints),this._outBlock=new Array(this._ints),this._partialOutput=Ne.util.createBuffer(),this._partialBytes=0,this._R=3774873600};Q.gcm.prototype.start=function(t){if(!("iv"in t))throw new Error("Invalid IV parameter.");var e=Ne.util.createBuffer(t.iv);this._cipherLength=0;var r;if("additionalData"in t?r=Ne.util.createBuffer(t.additionalData):r=Ne.util.createBuffer(),"tagLength"in t?this._tagLength=t.tagLength:this._tagLength=128,this._tag=null,t.decrypt&&(this._tag=Ne.util.createBuffer(t.tag).getBytes(),this._tag.length!==this._tagLength/8))throw new Error("Authentication tag does not match tag length.");this._hashBlock=new Array(this._ints),this.tag=null,this._hashSubkey=new Array(this._ints),this.cipher.encrypt([0,0,0,0],this._hashSubkey),this.componentBits=4,this._m=this.generateHashTable(this._hashSubkey,this.componentBits);var n=e.length();if(n===12)this._j0=[e.getInt32(),e.getInt32(),e.getInt32(),1];else{for(this._j0=[0,0,0,0];e.length()>0;)this._j0=this.ghash(this._hashSubkey,this._j0,[e.getInt32(),e.getInt32(),e.getInt32(),e.getInt32()]);this._j0=this.ghash(this._hashSubkey,this._j0,[0,0].concat(Ao(n*8)))}this._inBlock=this._j0.slice(0),Ns(this._inBlock),this._partialBytes=0,r=Ne.util.createBuffer(r),this._aDataLength=Ao(r.length()*8);var s=r.length()%this.blockSize;for(s&&r.fillWithByte(0,this.blockSize-s),this._s=[0,0,0,0];r.length()>0;)this._s=this.ghash(this._hashSubkey,this._s,[r.getInt32(),r.getInt32(),r.getInt32(),r.getInt32()])};Q.gcm.prototype.encrypt=function(t,e,r){var n=t.length();if(n===0)return!0;if(this.cipher.encrypt(this._inBlock,this._outBlock),this._partialBytes===0&&n>=this.blockSize){for(var s=0;s<this._ints;++s)e.putInt32(this._outBlock[s]^=t.getInt32());this._cipherLength+=this.blockSize}else{var i=(this.blockSize-n)%this.blockSize;i>0&&(i=this.blockSize-i),this._partialOutput.clear();for(var s=0;s<this._ints;++s)this._partialOutput.putInt32(t.getInt32()^this._outBlock[s]);if(i<=0||r){if(r){var o=n%this.blockSize;this._cipherLength+=o,this._partialOutput.truncate(this.blockSize-o)}else this._cipherLength+=this.blockSize;for(var s=0;s<this._ints;++s)this._outBlock[s]=this._partialOutput.getInt32();this._partialOutput.read-=this.blockSize}if(this._partialBytes>0&&this._partialOutput.getBytes(this._partialBytes),i>0&&!r)return t.read-=this.blockSize,e.putBytes(this._partialOutput.getBytes(i-this._partialBytes)),this._partialBytes=i,!0;e.putBytes(this._partialOutput.getBytes(n-this._partialBytes)),this._partialBytes=0}this._s=this.ghash(this._hashSubkey,this._s,this._outBlock),Ns(this._inBlock)};Q.gcm.prototype.decrypt=function(t,e,r){var n=t.length();if(n<this.blockSize&&!(r&&n>0))return!0;this.cipher.encrypt(this._inBlock,this._outBlock),Ns(this._inBlock),this._hashBlock[0]=t.getInt32(),this._hashBlock[1]=t.getInt32(),this._hashBlock[2]=t.getInt32(),this._hashBlock[3]=t.getInt32(),this._s=this.ghash(this._hashSubkey,this._s,this._hashBlock);for(var s=0;s<this._ints;++s)e.putInt32(this._outBlock[s]^this._hashBlock[s]);n<this.blockSize?this._cipherLength+=n%this.blockSize:this._cipherLength+=this.blockSize};Q.gcm.prototype.afterFinish=function(t,e){var r=!0;e.decrypt&&e.overflow&&t.truncate(this.blockSize-e.overflow),this.tag=Ne.util.createBuffer();var n=this._aDataLength.concat(Ao(this._cipherLength*8));this._s=this.ghash(this._hashSubkey,this._s,n);var s=[];this.cipher.encrypt(this._j0,s);for(var i=0;i<this._ints;++i)this.tag.putInt32(this._s[i]^s[i]);return this.tag.truncate(this.tag.length()%(this._tagLength/8)),e.decrypt&&this.tag.bytes()!==this._tag&&(r=!1),r};Q.gcm.prototype.multiply=function(t,e){for(var r=[0,0,0,0],n=e.slice(0),s=0;s<128;++s){var i=t[s/32|0]&1<<31-s%32;i&&(r[0]^=n[0],r[1]^=n[1],r[2]^=n[2],r[3]^=n[3]),this.pow(n,n)}return r};Q.gcm.prototype.pow=function(t,e){for(var r=t[3]&1,n=3;n>0;--n)e[n]=t[n]>>>1|(t[n-1]&1)<<31;e[0]=t[0]>>>1,r&&(e[0]^=this._R)};Q.gcm.prototype.tableMultiply=function(t){for(var e=[0,0,0,0],r=0;r<32;++r){var n=r/8|0,s=t[n]>>>(7-r%8)*4&15,i=this._m[r][s];e[0]^=i[0],e[1]^=i[1],e[2]^=i[2],e[3]^=i[3]}return e};Q.gcm.prototype.ghash=function(t,e,r){return e[0]^=r[0],e[1]^=r[1],e[2]^=r[2],e[3]^=r[3],this.tableMultiply(e)};Q.gcm.prototype.generateHashTable=function(t,e){for(var r=8/e,n=4*r,s=16*r,i=new Array(s),o=0;o<s;++o){var a=[0,0,0,0],f=o/n|0,u=(n-1-o%n)*e;a[f]=1<<e-1<<u,i[o]=this.generateSubHashTable(this.multiply(a,t),e)}return i};Q.gcm.prototype.generateSubHashTable=function(t,e){var r=1<<e,n=r>>>1,s=new Array(r);s[n]=t.slice(0);for(var i=n>>>1;i>0;)this.pow(s[2*i],s[i]=[]),i>>=1;for(i=2;i<n;){for(var o=1;o<i;++o){var a=s[i],f=s[o];s[i+o]=[a[0]^f[0],a[1]^f[1],a[2]^f[2],a[3]^f[3]]}i*=2}for(s[0]=[0,0,0,0],i=n+1;i<r;++i){var u=s[i^n];s[i]=[t[0]^u[0],t[1]^u[1],t[2]^u[2],t[3]^u[3]]}return s};function Ls(t,e){if(typeof t=="string"&&(t=Ne.util.createBuffer(t)),Ne.util.isArray(t)&&t.length>4){var r=t;t=Ne.util.createBuffer();for(var n=0;n<r.length;++n)t.putByte(r[n])}if(t.length()<e)throw new Error("Invalid IV length; got "+t.length()+" bytes and expected "+e+" bytes.");if(!Ne.util.isArray(t)){for(var s=[],i=e/4,n=0;n<i;++n)s.push(t.getInt32());t=s}return t}function Ns(t){t[t.length-1]=t[t.length-1]+1&4294967295}function Ao(t){return[t/4294967296|0,t&4294967295]}});var Fs=G((aw,hf)=>{var pe=ce();Bo();To();Ce();hf.exports=pe.aes=pe.aes||{};pe.aes.startEncrypting=function(t,e,r,n){var s=Os({key:t,output:r,decrypt:!1,mode:n});return s.start(e),s};pe.aes.createEncryptionCipher=function(t,e){return Os({key:t,output:null,decrypt:!1,mode:e})};pe.aes.startDecrypting=function(t,e,r,n){var s=Os({key:t,output:r,decrypt:!0,mode:n});return s.start(e),s};pe.aes.createDecryptionCipher=function(t,e){return Os({key:t,output:null,decrypt:!0,mode:e})};pe.aes.Algorithm=function(t,e){Do||ff();var r=this;r.name=t,r.mode=new e({blockSize:16,cipher:{encrypt:function(n,s){return Ro(r._w,n,s,!1)},decrypt:function(n,s){return Ro(r._w,n,s,!0)}}}),r._init=!1};pe.aes.Algorithm.prototype.initialize=function(t){if(!this._init){var e=t.key,r;if(typeof e=="string"&&(e.length===16||e.length===24||e.length===32))e=pe.util.createBuffer(e);else if(pe.util.isArray(e)&&(e.length===16||e.length===24||e.length===32)){r=e,e=pe.util.createBuffer();for(var n=0;n<r.length;++n)e.putByte(r[n])}if(!pe.util.isArray(e)){r=e,e=[];var s=r.length();if(s===16||s===24||s===32){s=s>>>2;for(var n=0;n<s;++n)e.push(r.getInt32())}}if(!pe.util.isArray(e)||!(e.length===4||e.length===6||e.length===8))throw new Error("Invalid key parameter.");var i=this.mode.name,o=["CFB","OFB","CTR","GCM"].indexOf(i)!==-1;this._w=lf(e,t.decrypt&&!o),this._init=!0}};pe.aes._expandKey=function(t,e){return Do||ff(),lf(t,e)};pe.aes._updateBlock=Ro;dn("AES-ECB",pe.cipher.modes.ecb);dn("AES-CBC",pe.cipher.modes.cbc);dn("AES-CFB",pe.cipher.modes.cfb);dn("AES-OFB",pe.cipher.modes.ofb);dn("AES-CTR",pe.cipher.modes.ctr);dn("AES-GCM",pe.cipher.modes.gcm);function dn(t,e){var r=function(){return new pe.aes.Algorithm(t,e)};pe.cipher.registerAlgorithm(t,r)}var Do=!1,pn=4,Xe,Po,uf,Pr,vt;function ff(){Do=!0,uf=[0,1,2,4,8,16,32,64,128,27,54];for(var t=new Array(256),e=0;e<128;++e)t[e]=e<<1,t[e+128]=e+128<<1^283;Xe=new Array(256),Po=new Array(256),Pr=new Array(4),vt=new Array(4);for(var e=0;e<4;++e)Pr[e]=new Array(256),vt[e]=new Array(256);for(var r=0,n=0,s,i,o,a,f,u,c,e=0;e<256;++e){a=n^n<<1^n<<2^n<<3^n<<4,a=a>>8^a&255^99,Xe[r]=a,Po[a]=r,f=t[a],s=t[r],i=t[s],o=t[i],u=f<<24^a<<16^a<<8^(a^f),c=(s^i^o)<<24^(r^o)<<16^(r^i^o)<<8^(r^s^o);for(var l=0;l<4;++l)Pr[l][r]=u,vt[l][a]=c,u=u<<24|u>>>8,c=c<<24|c>>>8;r===0?r=n=1:(r=s^t[t[t[s^o]]],n^=t[t[n]])}}function lf(t,e){for(var r=t.slice(0),n,s=1,i=r.length,o=i+6+1,a=pn*o,f=i;f<a;++f)n=r[f-1],f%i===0?(n=Xe[n>>>16&255]<<24^Xe[n>>>8&255]<<16^Xe[n&255]<<8^Xe[n>>>24]^uf[s]<<24,s++):i>6&&f%i===4&&(n=Xe[n>>>24]<<24^Xe[n>>>16&255]<<16^Xe[n>>>8&255]<<8^Xe[n&255]),r[f]=r[f-i]^n;if(e){var u,c=vt[0],l=vt[1],h=vt[2],g=vt[3],p=r.slice(0);a=r.length;for(var f=0,d=a-pn;f<a;f+=pn,d-=pn)if(f===0||f===a-pn)p[f]=r[d],p[f+1]=r[d+3],p[f+2]=r[d+2],p[f+3]=r[d+1];else for(var y=0;y<pn;++y)u=r[d+y],p[f+(3&-y)]=c[Xe[u>>>24]]^l[Xe[u>>>16&255]]^h[Xe[u>>>8&255]]^g[Xe[u&255]];r=p}return r}function Ro(t,e,r,n){var s=t.length/4-1,i,o,a,f,u;n?(i=vt[0],o=vt[1],a=vt[2],f=vt[3],u=Po):(i=Pr[0],o=Pr[1],a=Pr[2],f=Pr[3],u=Xe);var c,l,h,g,p,d,y;c=e[0]^t[0],l=e[n?3:1]^t[1],h=e[2]^t[2],g=e[n?1:3]^t[3];for(var m=3,E=1;E<s;++E)p=i[c>>>24]^o[l>>>16&255]^a[h>>>8&255]^f[g&255]^t[++m],d=i[l>>>24]^o[h>>>16&255]^a[g>>>8&255]^f[c&255]^t[++m],y=i[h>>>24]^o[g>>>16&255]^a[c>>>8&255]^f[l&255]^t[++m],g=i[g>>>24]^o[c>>>16&255]^a[l>>>8&255]^f[h&255]^t[++m],c=p,l=d,h=y;r[0]=u[c>>>24]<<24^u[l>>>16&255]<<16^u[h>>>8&255]<<8^u[g&255]^t[++m],r[n?3:1]=u[l>>>24]<<24^u[h>>>16&255]<<16^u[g>>>8&255]<<8^u[c&255]^t[++m],r[2]=u[h>>>24]<<24^u[g>>>16&255]<<16^u[c>>>8&255]<<8^u[l&255]^t[++m],r[n?1:3]=u[g>>>24]<<24^u[c>>>16&255]<<16^u[l>>>8&255]<<8^u[h&255]^t[++m]}function Os(t){t=t||{};var e=(t.mode||"CBC").toUpperCase(),r="AES-"+e,n;t.decrypt?n=pe.cipher.createDecipher(r,t.key):n=pe.cipher.createCipher(r,t.key);var s=n.start;return n.start=function(i,o){var a=null;o instanceof pe.util.ByteBuffer&&(a=o,o={}),o=o||{},o.output=a,o.iv=i,s.call(n,o)},n}});var Ks=G((Aw,yf)=>{var Gn=ce();Gn.pki=Gn.pki||{};var Mo=yf.exports=Gn.pki.oids=Gn.oids=Gn.oids||{};function R(t,e){Mo[t]=e,Mo[e]=t}function oe(t,e){Mo[t]=e}R("1.2.840.113549.1.1.1","rsaEncryption");R("1.2.840.113549.1.1.4","md5WithRSAEncryption");R("1.2.840.113549.1.1.5","sha1WithRSAEncryption");R("1.2.840.113549.1.1.7","RSAES-OAEP");R("1.2.840.113549.1.1.8","mgf1");R("1.2.840.113549.1.1.9","pSpecified");R("1.2.840.113549.1.1.10","RSASSA-PSS");R("1.2.840.113549.1.1.11","sha256WithRSAEncryption");R("1.2.840.113549.1.1.12","sha384WithRSAEncryption");R("1.2.840.113549.1.1.13","sha512WithRSAEncryption");R("1.3.101.112","EdDSA25519");R("1.2.840.10040.4.3","dsa-with-sha1");R("1.3.14.3.2.7","desCBC");R("1.3.14.3.2.26","sha1");R("1.3.14.3.2.29","sha1WithRSASignature");R("2.16.840.1.101.3.4.2.1","sha256");R("2.16.840.1.101.3.4.2.2","sha384");R("2.16.840.1.101.3.4.2.3","sha512");R("2.16.840.1.101.3.4.2.4","sha224");R("2.16.840.1.101.3.4.2.5","sha512-224");R("2.16.840.1.101.3.4.2.6","sha512-256");R("1.2.840.113549.2.2","md2");R("1.2.840.113549.2.5","md5");R("1.2.840.113549.1.7.1","data");R("1.2.840.113549.1.7.2","signedData");R("1.2.840.113549.1.7.3","envelopedData");R("1.2.840.113549.1.7.4","signedAndEnvelopedData");R("1.2.840.113549.1.7.5","digestedData");R("1.2.840.113549.1.7.6","encryptedData");R("1.2.840.113549.1.9.1","emailAddress");R("1.2.840.113549.1.9.2","unstructuredName");R("1.2.840.113549.1.9.3","contentType");R("1.2.840.113549.1.9.4","messageDigest");R("1.2.840.113549.1.9.5","signingTime");R("1.2.840.113549.1.9.6","counterSignature");R("1.2.840.113549.1.9.7","challengePassword");R("1.2.840.113549.1.9.8","unstructuredAddress");R("1.2.840.113549.1.9.14","extensionRequest");R("1.2.840.113549.1.9.20","friendlyName");R("1.2.840.113549.1.9.21","localKeyId");R("1.2.840.113549.1.9.22.1","x509Certificate");R("1.2.840.113549.1.12.10.1.1","keyBag");R("1.2.840.113549.1.12.10.1.2","pkcs8ShroudedKeyBag");R("1.2.840.113549.1.12.10.1.3","certBag");R("1.2.840.113549.1.12.10.1.4","crlBag");R("1.2.840.113549.1.12.10.1.5","secretBag");R("1.2.840.113549.1.12.10.1.6","safeContentsBag");R("1.2.840.113549.1.5.13","pkcs5PBES2");R("1.2.840.113549.1.5.12","pkcs5PBKDF2");R("1.2.840.113549.1.12.1.1","pbeWithSHAAnd128BitRC4");R("1.2.840.113549.1.12.1.2","pbeWithSHAAnd40BitRC4");R("1.2.840.113549.1.12.1.3","pbeWithSHAAnd3-KeyTripleDES-CBC");R("1.2.840.113549.1.12.1.4","pbeWithSHAAnd2-KeyTripleDES-CBC");R("1.2.840.113549.1.12.1.5","pbeWithSHAAnd128BitRC2-CBC");R("1.2.840.113549.1.12.1.6","pbewithSHAAnd40BitRC2-CBC");R("1.2.840.113549.2.7","hmacWithSHA1");R("1.2.840.113549.2.8","hmacWithSHA224");R("1.2.840.113549.2.9","hmacWithSHA256");R("1.2.840.113549.2.10","hmacWithSHA384");R("1.2.840.113549.2.11","hmacWithSHA512");R("1.2.840.113549.3.7","des-EDE3-CBC");R("2.16.840.1.101.3.4.1.2","aes128-CBC");R("2.16.840.1.101.3.4.1.22","aes192-CBC");R("2.16.840.1.101.3.4.1.42","aes256-CBC");R("2.5.4.3","commonName");R("2.5.4.4","surname");R("2.5.4.5","serialNumber");R("2.5.4.6","countryName");R("2.5.4.7","localityName");R("2.5.4.8","stateOrProvinceName");R("2.5.4.9","streetAddress");R("2.5.4.10","organizationName");R("2.5.4.11","organizationalUnitName");R("2.5.4.12","title");R("2.5.4.13","description");R("2.5.4.15","businessCategory");R("2.5.4.17","postalCode");R("2.5.4.42","givenName");R("1.3.6.1.4.1.311.60.2.1.2","jurisdictionOfIncorporationStateOrProvinceName");R("1.3.6.1.4.1.311.60.2.1.3","jurisdictionOfIncorporationCountryName");R("2.16.840.1.113730.1.1","nsCertType");R("2.16.840.1.113730.1.13","nsComment");oe("2.5.29.1","authorityKeyIdentifier");oe("2.5.29.2","keyAttributes");oe("2.5.29.3","certificatePolicies");oe("2.5.29.4","keyUsageRestriction");oe("2.5.29.5","policyMapping");oe("2.5.29.6","subtreesConstraint");oe("2.5.29.7","subjectAltName");oe("2.5.29.8","issuerAltName");oe("2.5.29.9","subjectDirectoryAttributes");oe("2.5.29.10","basicConstraints");oe("2.5.29.11","nameConstraints");oe("2.5.29.12","policyConstraints");oe("2.5.29.13","basicConstraints");R("2.5.29.14","subjectKeyIdentifier");R("2.5.29.15","keyUsage");oe("2.5.29.16","privateKeyUsagePeriod");R("2.5.29.17","subjectAltName");R("2.5.29.18","issuerAltName");R("2.5.29.19","basicConstraints");oe("2.5.29.20","cRLNumber");oe("2.5.29.21","cRLReason");oe("2.5.29.22","expirationDate");oe("2.5.29.23","instructionCode");oe("2.5.29.24","invalidityDate");oe("2.5.29.25","cRLDistributionPoints");oe("2.5.29.26","issuingDistributionPoint");oe("2.5.29.27","deltaCRLIndicator");oe("2.5.29.28","issuingDistributionPoint");oe("2.5.29.29","certificateIssuer");oe("2.5.29.30","nameConstraints");R("2.5.29.31","cRLDistributionPoints");R("2.5.29.32","certificatePolicies");oe("2.5.29.33","policyMappings");oe("2.5.29.34","policyConstraints");R("2.5.29.35","authorityKeyIdentifier");oe("2.5.29.36","policyConstraints");R("2.5.29.37","extKeyUsage");oe("2.5.29.46","freshestCRL");oe("2.5.29.54","inhibitAnyPolicy");R("1.3.6.1.4.1.11129.2.4.2","timestampList");R("1.3.6.1.5.5.7.1.1","authorityInfoAccess");R("1.3.6.1.5.5.7.3.1","serverAuth");R("1.3.6.1.5.5.7.3.2","clientAuth");R("1.3.6.1.5.5.7.3.3","codeSigning");R("1.3.6.1.5.5.7.3.4","emailProtection");R("1.3.6.1.5.5.7.3.8","timeStamping")});var jn=G((Tw,bf)=>{var de=ce();Ce();Ks();var L=bf.exports=de.asn1=de.asn1||{};L.Class={UNIVERSAL:0,APPLICATION:64,CONTEXT_SPECIFIC:128,PRIVATE:192};L.Type={NONE:0,BOOLEAN:1,INTEGER:2,BITSTRING:3,OCTETSTRING:4,NULL:5,OID:6,ODESC:7,EXTERNAL:8,REAL:9,ENUMERATED:10,EMBEDDED:11,UTF8:12,ROID:13,SEQUENCE:16,SET:17,PRINTABLESTRING:19,IA5STRING:22,UTCTIME:23,GENERALIZEDTIME:24,BMPSTRING:30};L.create=function(t,e,r,n,s){if(de.util.isArray(n)){for(var i=[],o=0;o<n.length;++o)n[o]!==void 0&&i.push(n[o]);n=i}var a={tagClass:t,type:e,constructed:r,composed:r||de.util.isArray(n),value:n};return s&&"bitStringContents"in s&&(a.bitStringContents=s.bitStringContents,a.original=L.copy(a)),a};L.copy=function(t,e){var r;if(de.util.isArray(t)){r=[];for(var n=0;n<t.length;++n)r.push(L.copy(t[n],e));return r}return typeof t=="string"?t:(r={tagClass:t.tagClass,type:t.type,constructed:t.constructed,composed:t.composed,value:L.copy(t.value,e)},e&&!e.excludeBitStringContents&&(r.bitStringContents=t.bitStringContents),r)};L.equals=function(t,e,r){if(de.util.isArray(t)){if(!de.util.isArray(e)||t.length!==e.length)return!1;for(var n=0;n<t.length;++n)if(!L.equals(t[n],e[n]))return!1;return!0}if(typeof t!=typeof e)return!1;if(typeof t=="string")return t===e;var s=t.tagClass===e.tagClass&&t.type===e.type&&t.constructed===e.constructed&&t.composed===e.composed&&L.equals(t.value,e.value);return r&&r.includeBitStringContents&&(s=s&&t.bitStringContents===e.bitStringContents),s};L.getBerValueLength=function(t){var e=t.getByte();if(e!==128){var r,n=e&128;return n?r=t.getInt((e&127)<<3):r=e,r}};function Wn(t,e,r){if(r>e){var n=new Error("Too few bytes to parse DER.");throw n.available=t.length(),n.remaining=e,n.requested=r,n}}var wd=function(t,e){var r=t.getByte();if(e--,r!==128){var n,s=r&128;if(!s)n=r;else{var i=r&127;Wn(t,e,i),n=t.getInt(i<<3)}if(n<0)throw new Error("Negative length: "+n);return n}};L.fromDer=function(t,e){e===void 0&&(e={strict:!0,parseAllBytes:!0,decodeBitStrings:!0}),typeof e=="boolean"&&(e={strict:e,parseAllBytes:!0,decodeBitStrings:!0}),"strict"in e||(e.strict=!0),"parseAllBytes"in e||(e.parseAllBytes=!0),"decodeBitStrings"in e||(e.decodeBitStrings=!0),typeof t=="string"&&(t=de.util.createBuffer(t));var r=t.length(),n=qs(t,t.length(),0,e);if(e.parseAllBytes&&t.length()!==0){var s=new Error("Unparsed DER bytes remain after ASN.1 parsing.");throw s.byteCount=r,s.remaining=t.length(),s}return n};function qs(t,e,r,n){var s;Wn(t,e,2);var i=t.getByte();e--;var o=i&192,a=i&31;s=t.length();var f=wd(t,e);if(e-=s-t.length(),f!==void 0&&f>e){if(n.strict){var u=new Error("Too few bytes to read ASN.1 value.");throw u.available=t.length(),u.remaining=e,u.requested=f,u}f=e}var c,l,h=(i&32)===32;if(h)if(c=[],f===void 0)for(;;){if(Wn(t,e,2),t.bytes(2)===String.fromCharCode(0,0)){t.getBytes(2),e-=2;break}s=t.length(),c.push(qs(t,e,r+1,n)),e-=s-t.length()}else for(;f>0;)s=t.length(),c.push(qs(t,f,r+1,n)),e-=s-t.length(),f-=s-t.length();if(c===void 0&&o===L.Class.UNIVERSAL&&a===L.Type.BITSTRING&&(l=t.bytes(f)),c===void 0&&n.decodeBitStrings&&o===L.Class.UNIVERSAL&&a===L.Type.BITSTRING&&f>1){var g=t.read,p=e,d=0;if(a===L.Type.BITSTRING&&(Wn(t,e,1),d=t.getByte(),e--),d===0)try{s=t.length();var y={strict:!0,decodeBitStrings:!0},m=qs(t,e,r+1,y),E=s-t.length();e-=E,a==L.Type.BITSTRING&&E++;var v=m.tagClass;E===f&&(v===L.Class.UNIVERSAL||v===L.Class.CONTEXT_SPECIFIC)&&(c=[m])}catch{}c===void 0&&(t.read=g,e=p)}if(c===void 0){if(f===void 0){if(n.strict)throw new Error("Non-constructed ASN.1 object of indefinite length.");f=e}if(a===L.Type.BMPSTRING)for(c="";f>0;f-=2)Wn(t,e,2),c+=String.fromCharCode(t.getInt16()),e-=2;else c=t.getBytes(f),e-=f}var C=l===void 0?null:{bitStringContents:l};return L.create(o,a,h,c,C)}L.toDer=function(t){var e=de.util.createBuffer(),r=t.tagClass|t.type,n=de.util.createBuffer(),s=!1;if("bitStringContents"in t&&(s=!0,t.original&&(s=L.equals(t,t.original))),s)n.putBytes(t.bitStringContents);else if(t.composed){t.constructed?r|=32:n.putByte(0);for(var i=0;i<t.value.length;++i)t.value[i]!==void 0&&n.putBuffer(L.toDer(t.value[i]))}else if(t.type===L.Type.BMPSTRING)for(var i=0;i<t.value.length;++i)n.putInt16(t.value.charCodeAt(i));else t.type===L.Type.INTEGER&&t.value.length>1&&(t.value.charCodeAt(0)===0&&!(t.value.charCodeAt(1)&128)||t.value.charCodeAt(0)===255&&(t.value.charCodeAt(1)&128)===128)?n.putBytes(t.value.substr(1)):n.putBytes(t.value);if(e.putByte(r),n.length()<=127)e.putByte(n.length()&127);else{var o=n.length(),a="";do a+=String.fromCharCode(o&255),o=o>>>8;while(o>0);e.putByte(a.length|128);for(var i=a.length-1;i>=0;--i)e.putByte(a.charCodeAt(i))}return e.putBuffer(n),e};L.oidToDer=function(t){var e=t.split("."),r=de.util.createBuffer();r.putByte(40*parseInt(e[0],10)+parseInt(e[1],10));for(var n,s,i,o,a=2;a<e.length;++a){n=!0,s=[],i=parseInt(e[a],10);do o=i&127,i=i>>>7,n||(o|=128),s.push(o),n=!1;while(i>0);for(var f=s.length-1;f>=0;--f)r.putByte(s[f])}return r};L.derToOid=function(t){var e;typeof t=="string"&&(t=de.util.createBuffer(t));var r=t.getByte();e=Math.floor(r/40)+"."+r%40;for(var n=0;t.length()>0;)r=t.getByte(),n=n<<7,r&128?n+=r&127:(e+="."+(n+r),n=0);return e};L.utcTimeToDate=function(t){var e=new Date,r=parseInt(t.substr(0,2),10);r=r>=50?1900+r:2e3+r;var n=parseInt(t.substr(2,2),10)-1,s=parseInt(t.substr(4,2),10),i=parseInt(t.substr(6,2),10),o=parseInt(t.substr(8,2),10),a=0;if(t.length>11){var f=t.charAt(10),u=10;f!=="+"&&f!=="-"&&(a=parseInt(t.substr(10,2),10),u+=2)}if(e.setUTCFullYear(r,n,s),e.setUTCHours(i,o,a,0),u&&(f=t.charAt(u),f==="+"||f==="-")){var c=parseInt(t.substr(u+1,2),10),l=parseInt(t.substr(u+4,2),10),h=c*60+l;h*=6e4,f==="+"?e.setTime(+e-h):e.setTime(+e+h)}return e};L.generalizedTimeToDate=function(t){var e=new Date,r=parseInt(t.substr(0,4),10),n=parseInt(t.substr(4,2),10)-1,s=parseInt(t.substr(6,2),10),i=parseInt(t.substr(8,2),10),o=parseInt(t.substr(10,2),10),a=parseInt(t.substr(12,2),10),f=0,u=0,c=!1;t.charAt(t.length-1)==="Z"&&(c=!0);var l=t.length-5,h=t.charAt(l);if(h==="+"||h==="-"){var g=parseInt(t.substr(l+1,2),10),p=parseInt(t.substr(l+4,2),10);u=g*60+p,u*=6e4,h==="+"&&(u*=-1),c=!0}return t.charAt(14)==="."&&(f=parseFloat(t.substr(14),10)*1e3),c?(e.setUTCFullYear(r,n,s),e.setUTCHours(i,o,a,f),e.setTime(+e+u)):(e.setFullYear(r,n,s),e.setHours(i,o,a,f)),e};L.dateToUtcTime=function(t){if(typeof t=="string")return t;var e="",r=[];r.push((""+t.getUTCFullYear()).substr(2)),r.push(""+(t.getUTCMonth()+1)),r.push(""+t.getUTCDate()),r.push(""+t.getUTCHours()),r.push(""+t.getUTCMinutes()),r.push(""+t.getUTCSeconds());for(var n=0;n<r.length;++n)r[n].length<2&&(e+="0"),e+=r[n];return e+="Z",e};L.dateToGeneralizedTime=function(t){if(typeof t=="string")return t;var e="",r=[];r.push(""+t.getUTCFullYear()),r.push(""+(t.getUTCMonth()+1)),r.push(""+t.getUTCDate()),r.push(""+t.getUTCHours()),r.push(""+t.getUTCMinutes()),r.push(""+t.getUTCSeconds());for(var n=0;n<r.length;++n)r[n].length<2&&(e+="0"),e+=r[n];return e+="Z",e};L.integerToDer=function(t){var e=de.util.createBuffer();if(t>=-128&&t<128)return e.putSignedInt(t,8);if(t>=-32768&&t<32768)return e.putSignedInt(t,16);if(t>=-8388608&&t<8388608)return e.putSignedInt(t,24);if(t>=-2147483648&&t<2147483648)return e.putSignedInt(t,32);var r=new Error("Integer too large; max is 32-bits.");throw r.integer=t,r};L.derToInteger=function(t){typeof t=="string"&&(t=de.util.createBuffer(t));var e=t.length()*8;if(e>32)throw new Error("Integer too large; max is 32-bits.");return t.getSignedInt(e)};L.validate=function(t,e,r,n){var s=!1;if((t.tagClass===e.tagClass||typeof e.tagClass>"u")&&(t.type===e.type||typeof e.type>"u"))if(t.constructed===e.constructed||typeof e.constructed>"u"){if(s=!0,e.value&&de.util.isArray(e.value))for(var i=0,o=0;s&&o<e.value.length;++o)s=e.value[o].optional||!1,t.value[i]&&(s=L.validate(t.value[i],e.value[o],r,n),s?++i:e.value[o].optional&&(s=!0)),!s&&n&&n.push("["+e.name+'] Tag class "'+e.tagClass+'", type "'+e.type+'" expected value length "'+e.value.length+'", got "'+t.value.length+'"');if(s&&r&&(e.capture&&(r[e.capture]=t.value),e.captureAsn1&&(r[e.captureAsn1]=t),e.captureBitStringContents&&"bitStringContents"in t&&(r[e.captureBitStringContents]=t.bitStringContents),e.captureBitStringValue&&"bitStringContents"in t)){var a;if(t.bitStringContents.length<2)r[e.captureBitStringValue]="";else{var f=t.bitStringContents.charCodeAt(0);if(f!==0)throw new Error("captureBitStringValue only supported for zero unused bits");r[e.captureBitStringValue]=t.bitStringContents.slice(1)}}}else n&&n.push("["+e.name+'] Expected constructed "'+e.constructed+'", got "'+t.constructed+'"');else n&&(t.tagClass!==e.tagClass&&n.push("["+e.name+'] Expected tag class "'+e.tagClass+'", got "'+t.tagClass+'"'),t.type!==e.type&&n.push("["+e.name+'] Expected type "'+e.type+'", got "'+t.type+'"'));return s};var mf=/[^\\u0000-\\u00ff]/;L.prettyPrint=function(t,e,r){var n="";e=e||0,r=r||2,e>0&&(n+=`
`);for(var s="",i=0;i<e*r;++i)s+=" ";switch(n+=s+"Tag: ",t.tagClass){case L.Class.UNIVERSAL:n+="Universal:";break;case L.Class.APPLICATION:n+="Application:";break;case L.Class.CONTEXT_SPECIFIC:n+="Context-Specific:";break;case L.Class.PRIVATE:n+="Private:";break}if(t.tagClass===L.Class.UNIVERSAL)switch(n+=t.type,t.type){case L.Type.NONE:n+=" (None)";break;case L.Type.BOOLEAN:n+=" (Boolean)";break;case L.Type.INTEGER:n+=" (Integer)";break;case L.Type.BITSTRING:n+=" (Bit string)";break;case L.Type.OCTETSTRING:n+=" (Octet string)";break;case L.Type.NULL:n+=" (Null)";break;case L.Type.OID:n+=" (Object Identifier)";break;case L.Type.ODESC:n+=" (Object Descriptor)";break;case L.Type.EXTERNAL:n+=" (External or Instance of)";break;case L.Type.REAL:n+=" (Real)";break;case L.Type.ENUMERATED:n+=" (Enumerated)";break;case L.Type.EMBEDDED:n+=" (Embedded PDV)";break;case L.Type.UTF8:n+=" (UTF8)";break;case L.Type.ROID:n+=" (Relative Object Identifier)";break;case L.Type.SEQUENCE:n+=" (Sequence)";break;case L.Type.SET:n+=" (Set)";break;case L.Type.PRINTABLESTRING:n+=" (Printable String)";break;case L.Type.IA5String:n+=" (IA5String (ASCII))";break;case L.Type.UTCTIME:n+=" (UTC time)";break;case L.Type.GENERALIZEDTIME:n+=" (Generalized time)";break;case L.Type.BMPSTRING:n+=" (BMP String)";break}else n+=t.type;if(n+=`
`,n+=s+"Constructed: "+t.constructed+`
`,t.composed){for(var o=0,a="",i=0;i<t.value.length;++i)t.value[i]!==void 0&&(o+=1,a+=L.prettyPrint(t.value[i],e+1,r),i+1<t.value.length&&(a+=","));n+=s+"Sub values: "+o+a}else{if(n+=s+"Value: ",t.type===L.Type.OID){var f=L.derToOid(t.value);n+=f,de.pki&&de.pki.oids&&f in de.pki.oids&&(n+=" ("+de.pki.oids[f]+") ")}if(t.type===L.Type.INTEGER)try{n+=L.derToInteger(t.value)}catch{n+="0x"+de.util.bytesToHex(t.value)}else if(t.type===L.Type.BITSTRING){if(t.value.length>1?n+="0x"+de.util.bytesToHex(t.value.slice(1)):n+="(none)",t.value.length>0){var u=t.value.charCodeAt(0);u==1?n+=" (1 unused bit shown)":u>1&&(n+=" ("+u+" unused bits shown)")}}else if(t.type===L.Type.OCTETSTRING)mf.test(t.value)||(n+="("+t.value+") "),n+="0x"+de.util.bytesToHex(t.value);else if(t.type===L.Type.UTF8)try{n+=de.util.decodeUtf8(t.value)}catch(c){if(c.message==="URI malformed")n+="0x"+de.util.bytesToHex(t.value)+" (malformed UTF8)";else throw c}else t.type===L.Type.PRINTABLESTRING||t.type===L.Type.IA5String?n+=t.value:mf.test(t.value)?n+="0x"+de.util.bytesToHex(t.value):t.value.length===0?n+="[null]":n+=t.value}return n}});var wf=G((Pw,vf)=>{var ye=ce();Bo();To();Ce();vf.exports=ye.des=ye.des||{};ye.des.startEncrypting=function(t,e,r,n){var s=Vs({key:t,output:r,decrypt:!1,mode:n||(e===null?"ECB":"CBC")});return s.start(e),s};ye.des.createEncryptionCipher=function(t,e){return Vs({key:t,output:null,decrypt:!1,mode:e})};ye.des.startDecrypting=function(t,e,r,n){var s=Vs({key:t,output:r,decrypt:!0,mode:n||(e===null?"ECB":"CBC")});return s.start(e),s};ye.des.createDecryptionCipher=function(t,e){return Vs({key:t,output:null,decrypt:!0,mode:e})};ye.des.Algorithm=function(t,e){var r=this;r.name=t,r.mode=new e({blockSize:8,cipher:{encrypt:function(n,s){return xf(r._keys,n,s,!1)},decrypt:function(n,s){return xf(r._keys,n,s,!0)}}}),r._init=!1};ye.des.Algorithm.prototype.initialize=function(t){if(!this._init){var e=ye.util.createBuffer(t.key);if(this.name.indexOf("3DES")===0&&e.length()!==24)throw new Error("Invalid Triple-DES key size: "+e.length()*8);this._keys=Pd(e),this._init=!0}};At("DES-ECB",ye.cipher.modes.ecb);At("DES-CBC",ye.cipher.modes.cbc);At("DES-CFB",ye.cipher.modes.cfb);At("DES-OFB",ye.cipher.modes.ofb);At("DES-CTR",ye.cipher.modes.ctr);At("3DES-ECB",ye.cipher.modes.ecb);At("3DES-CBC",ye.cipher.modes.cbc);At("3DES-CFB",ye.cipher.modes.cfb);At("3DES-OFB",ye.cipher.modes.ofb);At("3DES-CTR",ye.cipher.modes.ctr);function At(t,e){var r=function(){return new ye.des.Algorithm(t,e)};ye.cipher.registerAlgorithm(t,r)}var Sd=[16843776,0,65536,16843780,16842756,66564,4,65536,1024,16843776,16843780,1024,16778244,16842756,16777216,4,1028,16778240,16778240,66560,66560,16842752,16842752,16778244,65540,16777220,16777220,65540,0,1028,66564,16777216,65536,16843780,4,16842752,16843776,16777216,16777216,1024,16842756,65536,66560,16777220,1024,4,16778244,66564,16843780,65540,16842752,16778244,16777220,1028,66564,16843776,1028,16778240,16778240,0,65540,66560,0,16842756],Ed=[-2146402272,-2147450880,32768,1081376,1048576,32,-2146435040,-2147450848,-2147483616,-2146402272,-2146402304,-2147483648,-2147450880,1048576,32,-2146435040,1081344,1048608,-2147450848,0,-2147483648,32768,1081376,-2146435072,1048608,-2147483616,0,1081344,32800,-2146402304,-2146435072,32800,0,1081376,-2146435040,1048576,-2147450848,-2146435072,-2146402304,32768,-2146435072,-2147450880,32,-2146402272,1081376,32,32768,-2147483648,32800,-2146402304,1048576,-2147483616,1048608,-2147450848,-2147483616,1048608,1081344,0,-2147450880,32800,-2147483648,-2146435040,-2146402272,1081344],_d=[520,134349312,0,134348808,134218240,0,131592,134218240,131080,134217736,134217736,131072,134349320,131080,134348800,520,134217728,8,134349312,512,131584,134348800,134348808,131592,134218248,131584,131072,134218248,8,134349320,512,134217728,134349312,134217728,131080,520,131072,134349312,134218240,0,512,131080,134349320,134218240,134217736,512,0,134348808,134218248,131072,134217728,134349320,8,131592,131584,134217736,134348800,134218248,520,134348800,131592,8,134348808,131584],Id=[8396801,8321,8321,128,8396928,8388737,8388609,8193,0,8396800,8396800,8396929,129,0,8388736,8388609,1,8192,8388608,8396801,128,8388608,8193,8320,8388737,1,8320,8388736,8192,8396928,8396929,129,8388736,8388609,8396800,8396929,129,0,0,8396800,8320,8388736,8388737,1,8396801,8321,8321,128,8396929,129,1,8192,8388609,8193,8396928,8388737,8193,8320,8388608,8396801,128,8388608,8192,8396928],Cd=[256,34078976,34078720,1107296512,524288,256,1073741824,34078720,1074266368,524288,33554688,1074266368,1107296512,1107820544,524544,1073741824,33554432,1074266112,1074266112,0,1073742080,1107820800,1107820800,33554688,1107820544,1073742080,0,1107296256,34078976,33554432,1107296256,524544,524288,1107296512,256,33554432,1073741824,34078720,1107296512,1074266368,33554688,1073741824,1107820544,34078976,1074266368,256,33554432,1107820544,1107820800,524544,1107296256,1107820800,34078720,0,1074266112,1107296256,524544,33554688,1073742080,524288,0,1074266112,34078976,1073742080],Bd=[536870928,541065216,16384,541081616,541065216,16,541081616,4194304,536887296,4210704,4194304,536870928,4194320,536887296,536870912,16400,0,4194320,536887312,16384,4210688,536887312,16,541065232,541065232,0,4210704,541081600,16400,4210688,541081600,536870912,536887296,16,541065232,4210688,541081616,4194304,16400,536870928,4194304,536887296,536870912,16400,536870928,541081616,4210688,541065216,4210704,541081600,0,541065232,16,16384,541065216,4210704,16384,4194320,536887312,0,541081600,536870912,4194320,536887312],Ad=[2097152,69206018,67110914,0,2048,67110914,2099202,69208064,69208066,2097152,0,67108866,2,67108864,69206018,2050,67110912,2099202,2097154,67110912,67108866,69206016,69208064,2097154,69206016,2048,2050,69208066,2099200,2,67108864,2099200,67108864,2099200,2097152,67110914,67110914,69206018,69206018,2,2097154,67108864,67110912,2097152,69208064,2050,2099202,69208064,2050,67108866,69208066,69206016,2099200,0,2,69208066,0,2099202,69206016,2048,67108866,67110912,2048,2097154],Td=[268439616,4096,262144,268701760,268435456,268439616,64,268435456,262208,268697600,268701760,266240,268701696,266304,4096,64,268697600,268435520,268439552,4160,266240,262208,268697664,268701696,4160,0,0,268697664,268435520,268439552,266304,262144,266304,262144,268701696,4096,64,268697664,4096,266304,268439552,64,268435520,268697600,268697664,268435456,262144,268439616,0,268701760,262208,268435520,268697600,268439552,268439616,0,268701760,266240,266240,4160,4160,262208,268435456,268701696];function Pd(t){for(var e=[0,4,536870912,536870916,65536,65540,536936448,536936452,512,516,536871424,536871428,66048,66052,536936960,536936964],r=[0,1,1048576,1048577,67108864,67108865,68157440,68157441,256,257,1048832,1048833,67109120,67109121,68157696,68157697],n=[0,8,2048,2056,16777216,16777224,16779264,16779272,0,8,2048,2056,16777216,16777224,16779264,16779272],s=[0,2097152,134217728,136314880,8192,2105344,134225920,136323072,131072,2228224,134348800,136445952,139264,2236416,134356992,136454144],i=[0,262144,16,262160,0,262144,16,262160,4096,266240,4112,266256,4096,266240,4112,266256],o=[0,1024,32,1056,0,1024,32,1056,33554432,33555456,33554464,33555488,33554432,33555456,33554464,33555488],a=[0,268435456,524288,268959744,2,268435458,524290,268959746,0,268435456,524288,268959744,2,268435458,524290,268959746],f=[0,65536,2048,67584,536870912,536936448,536872960,536938496,131072,196608,133120,198656,537001984,537067520,537004032,537069568],u=[0,262144,0,262144,2,262146,2,262146,33554432,33816576,33554432,33816576,33554434,33816578,33554434,33816578],c=[0,268435456,8,268435464,0,268435456,8,268435464,1024,268436480,1032,268436488,1024,268436480,1032,268436488],l=[0,32,0,32,1048576,1048608,1048576,1048608,8192,8224,8192,8224,1056768,1056800,1056768,1056800],h=[0,16777216,512,16777728,2097152,18874368,2097664,18874880,67108864,83886080,67109376,83886592,69206016,85983232,69206528,85983744],g=[0,4096,134217728,134221824,524288,528384,134742016,134746112,16,4112,134217744,134221840,524304,528400,134742032,134746128],p=[0,4,256,260,0,4,256,260,1,5,257,261,1,5,257,261],d=t.length()>8?3:1,y=[],m=[0,0,1,1,1,1,1,1,0,1,1,1,1,1,1,0],E=0,v,C=0;C<d;C++){var b=t.getInt32(),w=t.getInt32();v=(b>>>4^w)&252645135,w^=v,b^=v<<4,v=(w>>>-16^b)&65535,b^=v,w^=v<<-16,v=(b>>>2^w)&858993459,w^=v,b^=v<<2,v=(w>>>-16^b)&65535,b^=v,w^=v<<-16,v=(b>>>1^w)&1431655765,w^=v,b^=v<<1,v=(w>>>8^b)&16711935,b^=v,w^=v<<8,v=(b>>>1^w)&1431655765,w^=v,b^=v<<1,v=b<<8|w>>>20&240,b=w<<24|w<<8&16711680|w>>>8&65280|w>>>24&240,w=v;for(var I=0;I<m.length;++I){m[I]?(b=b<<2|b>>>26,w=w<<2|w>>>26):(b=b<<1|b>>>27,w=w<<1|w>>>27),b&=-15,w&=-15;var T=e[b>>>28]|r[b>>>24&15]|n[b>>>20&15]|s[b>>>16&15]|i[b>>>12&15]|o[b>>>8&15]|a[b>>>4&15],F=f[w>>>28]|u[w>>>24&15]|c[w>>>20&15]|l[w>>>16&15]|h[w>>>12&15]|g[w>>>8&15]|p[w>>>4&15];v=(F>>>16^T)&65535,y[E++]=T^v,y[E++]=F^v<<16}}return y}function xf(t,e,r,n){var s=t.length===32?3:9,i;s===3?i=n?[30,-2,-2]:[0,32,2]:i=n?[94,62,-2,32,64,2,30,-2,-2]:[0,32,2,62,30,-2,64,96,2];var o,a=e[0],f=e[1];o=(a>>>4^f)&252645135,f^=o,a^=o<<4,o=(a>>>16^f)&65535,f^=o,a^=o<<16,o=(f>>>2^a)&858993459,a^=o,f^=o<<2,o=(f>>>8^a)&16711935,a^=o,f^=o<<8,o=(a>>>1^f)&1431655765,f^=o,a^=o<<1,a=a<<1|a>>>31,f=f<<1|f>>>31;for(var u=0;u<s;u+=3){for(var c=i[u+1],l=i[u+2],h=i[u];h!=c;h+=l){var g=f^t[h],p=(f>>>4|f<<28)^t[h+1];o=a,a=f,f=o^(Ed[g>>>24&63]|Id[g>>>16&63]|Bd[g>>>8&63]|Td[g&63]|Sd[p>>>24&63]|_d[p>>>16&63]|Cd[p>>>8&63]|Ad[p&63])}o=a,a=f,f=o}a=a>>>1|a<<31,f=f>>>1|f<<31,o=(a>>>1^f)&1431655765,f^=o,a^=o<<1,o=(f>>>8^a)&16711935,a^=o,f^=o<<8,o=(f>>>2^a)&858993459,a^=o,f^=o<<2,o=(a>>>16^f)&65535,f^=o,a^=o<<16,o=(a>>>4^f)&252645135,f^=o,a^=o<<4,r[0]=a,r[1]=f}function Vs(t){t=t||{};var e=(t.mode||"CBC").toUpperCase(),r="DES-"+e,n;t.decrypt?n=ye.cipher.createDecipher(r,t.key):n=ye.cipher.createCipher(r,t.key);var s=n.start;return n.start=function(i,o){var a=null;o instanceof ye.util.ByteBuffer&&(a=o,o={}),o=o||{},o.output=a,o.iv=i,s.call(n,o)},n}});var Rr=G((Rw,Sf)=>{var zs=ce();Sf.exports=zs.md=zs.md||{};zs.md.algorithms=zs.md.algorithms||{}});var _f=G((Dw,Ef)=>{var zt=ce();Rr();Ce();var Rd=Ef.exports=zt.hmac=zt.hmac||{};Rd.create=function(){var t=null,e=null,r=null,n=null,s={};return s.start=function(i,o){if(i!==null)if(typeof i=="string")if(i=i.toLowerCase(),i in zt.md.algorithms)e=zt.md.algorithms[i].create();else throw new Error('Unknown hash algorithm "'+i+'"');else e=i;if(o===null)o=t;else{if(typeof o=="string")o=zt.util.createBuffer(o);else if(zt.util.isArray(o)){var a=o;o=zt.util.createBuffer();for(var f=0;f<a.length;++f)o.putByte(a[f])}var u=o.length();u>e.blockLength&&(e.start(),e.update(o.bytes()),o=e.digest()),r=zt.util.createBuffer(),n=zt.util.createBuffer(),u=o.length();for(var f=0;f<u;++f){var a=o.at(f);r.putByte(54^a),n.putByte(92^a)}if(u<e.blockLength)for(var a=e.blockLength-u,f=0;f<a;++f)r.putByte(54),n.putByte(92);t=o,r=r.bytes(),n=n.bytes()}e.start(),e.update(r)},s.update=function(i){e.update(i)},s.getMac=function(){var i=e.digest().bytes();return e.start(),e.update(n),e.update(i),e.digest()},s.digest=s.getMac,s}});var Hs=G(()=>{});var Lo=G((Lw,If)=>{var Je=ce();_f();Rr();Ce();var Dd=Je.pkcs5=Je.pkcs5||{},Ht;Je.util.isNodejs&&!Je.options.usePureJavaScript&&(Ht=Hs());If.exports=Je.pbkdf2=Dd.pbkdf2=function(t,e,r,n,s,i){if(typeof s=="function"&&(i=s,s=null),Je.util.isNodejs&&!Je.options.usePureJavaScript&&Ht.pbkdf2&&(s===null||typeof s!="object")&&(Ht.pbkdf2Sync.length>4||!s||s==="sha1"))return typeof s!="string"&&(s="sha1"),t=Buffer.from(t,"binary"),e=Buffer.from(e,"binary"),i?Ht.pbkdf2Sync.length===4?Ht.pbkdf2(t,e,r,n,function(v,C){if(v)return i(v);i(null,C.toString("binary"))}):Ht.pbkdf2(t,e,r,n,s,function(v,C){if(v)return i(v);i(null,C.toString("binary"))}):Ht.pbkdf2Sync.length===4?Ht.pbkdf2Sync(t,e,r,n).toString("binary"):Ht.pbkdf2Sync(t,e,r,n,s).toString("binary");if((typeof s>"u"||s===null)&&(s="sha1"),typeof s=="string"){if(!(s in Je.md.algorithms))throw new Error("Unknown hash algorithm: "+s);s=Je.md[s].create()}var o=s.digestLength;if(n>4294967295*o){var a=new Error("Derived key is too long.");if(i)return i(a);throw a}var f=Math.ceil(n/o),u=n-(f-1)*o,c=Je.hmac.create();c.start(s,t);var l="",h,g,p;if(!i){for(var d=1;d<=f;++d){c.start(null,null),c.update(e),c.update(Je.util.int32ToBytes(d)),h=p=c.digest().getBytes();for(var y=2;y<=r;++y)c.start(null,null),c.update(p),g=c.digest().getBytes(),h=Je.util.xorBytes(h,g,o),p=g;l+=d<f?h:h.substr(0,u)}return l}var d=1,y;function m(){if(d>f)return i(null,l);c.start(null,null),c.update(e),c.update(Je.util.int32ToBytes(d)),h=p=c.digest().getBytes(),y=2,E()}function E(){if(y<=r)return c.start(null,null),c.update(p),g=c.digest().getBytes(),h=Je.util.xorBytes(h,g,o),p=g,++y,Je.util.setImmediate(E);l+=d<f?h:h.substr(0,u),++d,m()}m()}});var Af=G((Nw,Bf)=>{var Ws=ce();Ce();var Cf=Bf.exports=Ws.pem=Ws.pem||{};Cf.encode=function(t,e){e=e||{};var r="-----BEGIN "+t.type+`-----\r
`,n;if(t.procType&&(n={name:"Proc-Type",values:[String(t.procType.version),t.procType.type]},r+=Gs(n)),t.contentDomain&&(n={name:"Content-Domain",values:[t.contentDomain]},r+=Gs(n)),t.dekInfo&&(n={name:"DEK-Info",values:[t.dekInfo.algorithm]},t.dekInfo.parameters&&n.values.push(t.dekInfo.parameters),r+=Gs(n)),t.headers)for(var s=0;s<t.headers.length;++s)r+=Gs(t.headers[s]);return t.procType&&(r+=`\r
`),r+=Ws.util.encode64(t.body,e.maxline||64)+`\r
`,r+="-----END "+t.type+`-----\r
`,r};Cf.decode=function(t){for(var e=[],r=/\s*-----BEGIN ([A-Z0-9- ]+)-----\r?\n?([\x21-\x7e\s]+?(?:\r?\n\r?\n))?([:A-Za-z0-9+\/=\s]+?)-----END \1-----/g,n=/([\x21-\x7e]+):\s*([\x21-\x7e\s^:]+)/,s=/\r?\n/,i;i=r.exec(t),!!i;){var o=i[1];o==="NEW CERTIFICATE REQUEST"&&(o="CERTIFICATE REQUEST");var a={type:o,procType:null,contentDomain:null,dekInfo:null,headers:[],body:Ws.util.decode64(i[3])};if(e.push(a),!!i[2]){for(var f=i[2].split(s),u=0;i&&u<f.length;){for(var c=f[u].replace(/\s+$/,""),l=u+1;l<f.length;++l){var h=f[l];if(!/\s/.test(h[0]))break;c+=h,u=l}if(i=c.match(n),i){for(var g={name:i[1],values:[]},p=i[2].split(","),d=0;d<p.length;++d)g.values.push(kd(p[d]));if(a.procType)if(!a.contentDomain&&g.name==="Content-Domain")a.contentDomain=p[0]||"";else if(!a.dekInfo&&g.name==="DEK-Info"){if(g.values.length===0)throw new Error('Invalid PEM formatted message. The "DEK-Info" header must have at least one subfield.');a.dekInfo={algorithm:p[0],parameters:p[1]||null}}else a.headers.push(g);else{if(g.name!=="Proc-Type")throw new Error('Invalid PEM formatted message. The first encapsulated header must be "Proc-Type".');if(g.values.length!==2)throw new Error('Invalid PEM formatted message. The "Proc-Type" header must have two subfields.');a.procType={version:p[0],type:p[1]}}}++u}if(a.procType==="ENCRYPTED"&&!a.dekInfo)throw new Error('Invalid PEM formatted message. The "DEK-Info" header must be present if "Proc-Type" is "ENCRYPTED".')}}if(e.length===0)throw new Error("Invalid PEM formatted message.");return e};function Gs(t){for(var e=t.name+": ",r=[],n=function(f,u){return" "+u},s=0;s<t.values.length;++s)r.push(t.values[s].replace(/^(\S+\r\n)/,n));e+=r.join(",")+`\r
`;for(var i=0,o=-1,s=0;s<e.length;++s,++i)if(i>65&&o!==-1){var a=e[o];a===","?(++o,e=e.substr(0,o)+`\r
 `+e.substr(o)):e=e.substr(0,o)+`\r
`+a+e.substr(o+1),i=s-o-1,o=-1,++s}else(e[s]===" "||e[s]==="	"||e[s]===",")&&(o=s);return e}function kd(t){return t.replace(/^\s+/,"")}});var Mf=G((Ow,kf)=>{var Tt=ce();Rr();Ce();var Pf=kf.exports=Tt.sha256=Tt.sha256||{};Tt.md.sha256=Tt.md.algorithms.sha256=Pf;Pf.create=function(){Rf||Md();var t=null,e=Tt.util.createBuffer(),r=new Array(64),n={algorithm:"sha256",blockLength:64,digestLength:32,messageLength:0,fullMessageLength:null,messageLengthSize:8};return n.start=function(){n.messageLength=0,n.fullMessageLength=n.messageLength64=[];for(var s=n.messageLengthSize/4,i=0;i<s;++i)n.fullMessageLength.push(0);return e=Tt.util.createBuffer(),t={h0:1779033703,h1:3144134277,h2:1013904242,h3:2773480762,h4:1359893119,h5:2600822924,h6:528734635,h7:1541459225},n},n.start(),n.update=function(s,i){i==="utf8"&&(s=Tt.util.encodeUtf8(s));var o=s.length;n.messageLength+=o,o=[o/4294967296>>>0,o>>>0];for(var a=n.fullMessageLength.length-1;a>=0;--a)n.fullMessageLength[a]+=o[1],o[1]=o[0]+(n.fullMessageLength[a]/4294967296>>>0),n.fullMessageLength[a]=n.fullMessageLength[a]>>>0,o[0]=o[1]/4294967296>>>0;return e.putBytes(s),Tf(t,r,e),(e.read>2048||e.length()===0)&&e.compact(),n},n.digest=function(){var s=Tt.util.createBuffer();s.putBytes(e.bytes());var i=n.fullMessageLength[n.fullMessageLength.length-1]+n.messageLengthSize,o=i&n.blockLength-1;s.putBytes(No.substr(0,n.blockLength-o));for(var a,f,u=n.fullMessageLength[0]*8,c=0;c<n.fullMessageLength.length-1;++c)a=n.fullMessageLength[c+1]*8,f=a/4294967296>>>0,u+=f,s.putInt32(u>>>0),u=a>>>0;s.putInt32(u);var l={h0:t.h0,h1:t.h1,h2:t.h2,h3:t.h3,h4:t.h4,h5:t.h5,h6:t.h6,h7:t.h7};Tf(l,r,s);var h=Tt.util.createBuffer();return h.putInt32(l.h0),h.putInt32(l.h1),h.putInt32(l.h2),h.putInt32(l.h3),h.putInt32(l.h4),h.putInt32(l.h5),h.putInt32(l.h6),h.putInt32(l.h7),h},n};var No=null,Rf=!1,Df=null;function Md(){No=String.fromCharCode(128),No+=Tt.util.fillString(String.fromCharCode(0),64),Df=[1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298],Rf=!0}function Tf(t,e,r){for(var n,s,i,o,a,f,u,c,l,h,g,p,d,y,m,E=r.length();E>=64;){for(u=0;u<16;++u)e[u]=r.getInt32();for(;u<64;++u)n=e[u-2],n=(n>>>17|n<<15)^(n>>>19|n<<13)^n>>>10,s=e[u-15],s=(s>>>7|s<<25)^(s>>>18|s<<14)^s>>>3,e[u]=n+e[u-7]+s+e[u-16]|0;for(c=t.h0,l=t.h1,h=t.h2,g=t.h3,p=t.h4,d=t.h5,y=t.h6,m=t.h7,u=0;u<64;++u)o=(p>>>6|p<<26)^(p>>>11|p<<21)^(p>>>25|p<<7),a=y^p&(d^y),i=(c>>>2|c<<30)^(c>>>13|c<<19)^(c>>>22|c<<10),f=c&l|h&(c^l),n=m+o+a+Df[u]+e[u],s=i+f,m=y,y=d,d=p,p=g+n>>>0,g=h,h=l,l=c,c=n+s>>>0;t.h0=t.h0+c|0,t.h1=t.h1+l|0,t.h2=t.h2+h|0,t.h3=t.h3+g|0,t.h4=t.h4+p|0,t.h5=t.h5+d|0,t.h6=t.h6+y|0,t.h7=t.h7+m|0,E-=64}}});var Nf=G((Fw,Lf)=>{var Pt=ce();Ce();var js=null;Pt.util.isNodejs&&!Pt.options.usePureJavaScript&&!process.versions["node-webkit"]&&(js=Hs());var Ld=Lf.exports=Pt.prng=Pt.prng||{};Ld.create=function(t){for(var e={plugin:t,key:null,seed:null,time:null,reseeds:0,generated:0,keyBytes:""},r=t.md,n=new Array(32),s=0;s<32;++s)n[s]=r.create();e.pools=n,e.pool=0,e.generate=function(u,c){if(!c)return e.generateSync(u);var l=e.plugin.cipher,h=e.plugin.increment,g=e.plugin.formatKey,p=e.plugin.formatSeed,d=Pt.util.createBuffer();e.key=null,y();function y(m){if(m)return c(m);if(d.length()>=u)return c(null,d.getBytes(u));if(e.generated>1048575&&(e.key=null),e.key===null)return Pt.util.nextTick(function(){i(y)});var E=l(e.key,e.seed);e.generated+=E.length,d.putBytes(E),e.key=g(l(e.key,h(e.seed))),e.seed=p(l(e.key,e.seed)),Pt.util.setImmediate(y)}},e.generateSync=function(u){var c=e.plugin.cipher,l=e.plugin.increment,h=e.plugin.formatKey,g=e.plugin.formatSeed;e.key=null;for(var p=Pt.util.createBuffer();p.length()<u;){e.generated>1048575&&(e.key=null),e.key===null&&o();var d=c(e.key,e.seed);e.generated+=d.length,p.putBytes(d),e.key=h(c(e.key,l(e.seed))),e.seed=g(c(e.key,e.seed))}return p.getBytes(u)};function i(u){if(e.pools[0].messageLength>=32)return a(),u();var c=32-e.pools[0].messageLength<<5;e.seedFile(c,function(l,h){if(l)return u(l);e.collect(h),a(),u()})}function o(){if(e.pools[0].messageLength>=32)return a();var u=32-e.pools[0].messageLength<<5;e.collect(e.seedFileSync(u)),a()}function a(){e.reseeds=e.reseeds===4294967295?0:e.reseeds+1;var u=e.plugin.md.create();u.update(e.keyBytes);for(var c=1,l=0;l<32;++l)e.reseeds%c===0&&(u.update(e.pools[l].digest().getBytes()),e.pools[l].start()),c=c<<1;e.keyBytes=u.digest().getBytes(),u.start(),u.update(e.keyBytes);var h=u.digest().getBytes();e.key=e.plugin.formatKey(e.keyBytes),e.seed=e.plugin.formatSeed(h),e.generated=0}function f(u){var c=null,l=Pt.util.globalScope,h=l.crypto||l.msCrypto;h&&h.getRandomValues&&(c=function(b){return h.getRandomValues(b)});var g=Pt.util.createBuffer();if(c)for(;g.length()<u;){var p=Math.max(1,Math.min(u-g.length(),65536)/4),d=new Uint32Array(Math.floor(p));try{c(d);for(var y=0;y<d.length;++y)g.putInt32(d[y])}catch(b){if(!(typeof QuotaExceededError<"u"&&b instanceof QuotaExceededError))throw b}}if(g.length()<u)for(var m,E,v,C=Math.floor(Math.random()*65536);g.length()<u;){E=16807*(C&65535),m=16807*(C>>16),E+=(m&32767)<<16,E+=m>>15,E=(E&2147483647)+(E>>31),C=E&4294967295;for(var y=0;y<3;++y)v=C>>>(y<<3),v^=Math.floor(Math.random()*256),g.putByte(v&255)}return g.getBytes(u)}return js?(e.seedFile=function(u,c){js.randomBytes(u,function(l,h){if(l)return c(l);c(null,h.toString())})},e.seedFileSync=function(u){return js.randomBytes(u).toString()}):(e.seedFile=function(u,c){try{c(null,f(u))}catch(l){c(l)}},e.seedFileSync=f),e.collect=function(u){for(var c=u.length,l=0;l<c;++l)e.pools[e.pool].update(u.substr(l,1)),e.pool=e.pool===31?0:e.pool+1},e.collectInt=function(u,c){for(var l="",h=0;h<c;h+=8)l+=String.fromCharCode(u>>h&255);e.collect(l)},e.registerWorker=function(u){if(u===self)e.seedFile=function(l,h){function g(p){var d=p.data;d.forge&&d.forge.prng&&(self.removeEventListener("message",g),h(d.forge.prng.err,d.forge.prng.bytes))}self.addEventListener("message",g),self.postMessage({forge:{prng:{needed:l}}})};else{var c=function(l){var h=l.data;h.forge&&h.forge.prng&&e.seedFile(h.forge.prng.needed,function(g,p){u.postMessage({forge:{prng:{err:g,bytes:p}}})})};u.addEventListener("message",c)}},e}});var $n=G((Uw,Oo)=>{var Oe=ce();Fs();Mf();Nf();Ce();(function(){if(Oe.random&&Oe.random.getBytes){Oo.exports=Oe.random;return}(function(t){var e={},r=new Array(4),n=Oe.util.createBuffer();e.formatKey=function(l){var h=Oe.util.createBuffer(l);return l=new Array(4),l[0]=h.getInt32(),l[1]=h.getInt32(),l[2]=h.getInt32(),l[3]=h.getInt32(),Oe.aes._expandKey(l,!1)},e.formatSeed=function(l){var h=Oe.util.createBuffer(l);return l=new Array(4),l[0]=h.getInt32(),l[1]=h.getInt32(),l[2]=h.getInt32(),l[3]=h.getInt32(),l},e.cipher=function(l,h){return Oe.aes._updateBlock(l,h,r,!1),n.putInt32(r[0]),n.putInt32(r[1]),n.putInt32(r[2]),n.putInt32(r[3]),n.getBytes()},e.increment=function(l){return++l[3],l},e.md=Oe.md.sha256;function s(){var l=Oe.prng.create(e);return l.getBytes=function(h,g){return l.generate(h,g)},l.getBytesSync=function(h){return l.generate(h)},l}var i=s(),o=null,a=Oe.util.globalScope,f=a.crypto||a.msCrypto;if(f&&f.getRandomValues&&(o=function(l){return f.getRandomValues(l)}),Oe.options.usePureJavaScript||!Oe.util.isNodejs&&!o){if(typeof window>"u"||window.document,i.collectInt(+new Date,32),typeof navigator<"u"){var u="";for(var c in navigator)try{typeof navigator[c]=="string"&&(u+=navigator[c])}catch{}i.collect(u),u=null}t&&(t().mousemove(function(l){i.collectInt(l.clientX,16),i.collectInt(l.clientY,16)}),t().keypress(function(l){i.collectInt(l.charCode,8)}))}if(!Oe.random)Oe.random=i;else for(var c in i)Oe.random[c]=i[c];Oe.random.createInstance=s,Oo.exports=Oe.random})(typeof jQuery<"u"?jQuery:null)})()});var Kf=G((Kw,Uf)=>{var nt=ce();Ce();var Fo=[217,120,249,196,25,221,181,237,40,233,253,121,74,160,216,157,198,126,55,131,43,118,83,142,98,76,100,136,68,139,251,162,23,154,89,245,135,179,79,19,97,69,109,141,9,129,125,50,189,143,64,235,134,183,123,11,240,149,33,34,92,107,78,130,84,214,101,147,206,96,178,28,115,86,192,20,167,140,241,220,18,117,202,31,59,190,228,209,66,61,212,48,163,60,182,38,111,191,14,218,70,105,7,87,39,242,29,155,188,148,67,3,248,17,199,246,144,239,62,231,6,195,213,47,200,102,30,215,8,232,234,222,128,82,238,247,132,170,114,172,53,77,106,42,150,26,210,113,90,21,73,116,75,159,208,94,4,24,164,236,194,224,65,110,15,81,203,204,36,145,175,80,161,244,112,57,153,124,58,133,35,184,180,122,252,2,54,91,37,85,151,49,45,93,250,152,227,138,146,174,5,223,41,16,103,108,186,201,211,0,230,207,225,158,168,44,99,22,1,63,88,226,137,169,13,56,52,27,171,51,255,176,187,72,12,95,185,177,205,46,197,243,219,71,229,165,156,119,10,166,32,104,254,127,193,173],Of=[1,2,3,5],Nd=function(t,e){return t<<e&65535|(t&65535)>>16-e},Od=function(t,e){return(t&65535)>>e|t<<16-e&65535};Uf.exports=nt.rc2=nt.rc2||{};nt.rc2.expandKey=function(t,e){typeof t=="string"&&(t=nt.util.createBuffer(t)),e=e||128;var r=t,n=t.length(),s=e,i=Math.ceil(s/8),o=255>>(s&7),a;for(a=n;a<128;a++)r.putByte(Fo[r.at(a-1)+r.at(a-n)&255]);for(r.setAt(128-i,Fo[r.at(128-i)&o]),a=127-i;a>=0;a--)r.setAt(a,Fo[r.at(a+1)^r.at(a+i)]);return r};var Ff=function(t,e,r){var n=!1,s=null,i=null,o=null,a,f,u,c,l=[];for(t=nt.rc2.expandKey(t,e),u=0;u<64;u++)l.push(t.getInt16Le());r?(a=function(p){for(u=0;u<4;u++)p[u]+=l[c]+(p[(u+3)%4]&p[(u+2)%4])+(~p[(u+3)%4]&p[(u+1)%4]),p[u]=Nd(p[u],Of[u]),c++},f=function(p){for(u=0;u<4;u++)p[u]+=l[p[(u+3)%4]&63]}):(a=function(p){for(u=3;u>=0;u--)p[u]=Od(p[u],Of[u]),p[u]-=l[c]+(p[(u+3)%4]&p[(u+2)%4])+(~p[(u+3)%4]&p[(u+1)%4]),c--},f=function(p){for(u=3;u>=0;u--)p[u]-=l[p[(u+3)%4]&63]});var h=function(p){var d=[];for(u=0;u<4;u++){var y=s.getInt16Le();o!==null&&(r?y^=o.getInt16Le():o.putInt16Le(y)),d.push(y&65535)}c=r?0:63;for(var m=0;m<p.length;m++)for(var E=0;E<p[m][0];E++)p[m][1](d);for(u=0;u<4;u++)o!==null&&(r?o.putInt16Le(d[u]):d[u]^=o.getInt16Le()),i.putInt16Le(d[u])},g=null;return g={start:function(p,d){p&&typeof p=="string"&&(p=nt.util.createBuffer(p)),n=!1,s=nt.util.createBuffer(),i=d||new nt.util.createBuffer,o=p,g.output=i},update:function(p){for(n||s.putBuffer(p);s.length()>=8;)h([[5,a],[1,f],[6,a],[1,f],[5,a]])},finish:function(p){var d=!0;if(r)if(p)d=p(8,s,!r);else{var y=s.length()===8?8:8-s.length();s.fillWithByte(y,y)}if(d&&(n=!0,g.update()),!r&&(d=s.length()===0,d))if(p)d=p(8,i,!r);else{var m=i.length(),E=i.at(m-1);E>m?d=!1:i.truncate(E)}return d}},g};nt.rc2.startEncrypting=function(t,e,r){var n=nt.rc2.createEncryptionCipher(t,128);return n.start(e,r),n};nt.rc2.createEncryptionCipher=function(t,e){return Ff(t,e,!0)};nt.rc2.startDecrypting=function(t,e,r){var n=nt.rc2.createDecryptionCipher(t,128);return n.start(e,r),n};nt.rc2.createDecryptionCipher=function(t,e){return Ff(t,e,!1)}});var Zs=G((qw,$f)=>{var Uo=ce();$f.exports=Uo.jsbn=Uo.jsbn||{};var Gt,Fd=0xdeadbeefcafe,qf=(Fd&16777215)==15715070;function A(t,e,r){this.data=[],t!=null&&(typeof t=="number"?this.fromNumber(t,e,r):e==null&&typeof t!="string"?this.fromString(t,256):this.fromString(t,e))}Uo.jsbn.BigInteger=A;function ne(){return new A(null)}function Ud(t,e,r,n,s,i){for(;--i>=0;){var o=e*this.data[t++]+r.data[n]+s;s=Math.floor(o/67108864),r.data[n++]=o&67108863}return s}function Kd(t,e,r,n,s,i){for(var o=e&32767,a=e>>15;--i>=0;){var f=this.data[t]&32767,u=this.data[t++]>>15,c=a*f+u*o;f=o*f+((c&32767)<<15)+r.data[n]+(s&1073741823),s=(f>>>30)+(c>>>15)+a*u+(s>>>30),r.data[n++]=f&1073741823}return s}function Vf(t,e,r,n,s,i){for(var o=e&16383,a=e>>14;--i>=0;){var f=this.data[t]&16383,u=this.data[t++]>>14,c=a*f+u*o;f=o*f+((c&16383)<<14)+r.data[n]+s,s=(f>>28)+(c>>14)+a*u,r.data[n++]=f&268435455}return s}typeof navigator>"u"?(A.prototype.am=Vf,Gt=28):qf&&navigator.appName=="Microsoft Internet Explorer"?(A.prototype.am=Kd,Gt=30):qf&&navigator.appName!="Netscape"?(A.prototype.am=Ud,Gt=26):(A.prototype.am=Vf,Gt=28);A.prototype.DB=Gt;A.prototype.DM=(1<<Gt)-1;A.prototype.DV=1<<Gt;var Ko=52;A.prototype.FV=Math.pow(2,Ko);A.prototype.F1=Ko-Gt;A.prototype.F2=2*Gt-Ko;var qd="0123456789abcdefghijklmnopqrstuvwxyz",$s=new Array,gn,lt;gn="0".charCodeAt(0);for(lt=0;lt<=9;++lt)$s[gn++]=lt;gn="a".charCodeAt(0);for(lt=10;lt<36;++lt)$s[gn++]=lt;gn="A".charCodeAt(0);for(lt=10;lt<36;++lt)$s[gn++]=lt;function zf(t){return qd.charAt(t)}function Hf(t,e){var r=$s[t.charCodeAt(e)];return r??-1}function Vd(t){for(var e=this.t-1;e>=0;--e)t.data[e]=this.data[e];t.t=this.t,t.s=this.s}function zd(t){this.t=1,this.s=t<0?-1:0,t>0?this.data[0]=t:t<-1?this.data[0]=t+this.DV:this.t=0}function ur(t){var e=ne();return e.fromInt(t),e}function Hd(t,e){var r;if(e==16)r=4;else if(e==8)r=3;else if(e==256)r=8;else if(e==2)r=1;else if(e==32)r=5;else if(e==4)r=2;else{this.fromRadix(t,e);return}this.t=0,this.s=0;for(var n=t.length,s=!1,i=0;--n>=0;){var o=r==8?t[n]&255:Hf(t,n);if(o<0){t.charAt(n)=="-"&&(s=!0);continue}s=!1,i==0?this.data[this.t++]=o:i+r>this.DB?(this.data[this.t-1]|=(o&(1<<this.DB-i)-1)<<i,this.data[this.t++]=o>>this.DB-i):this.data[this.t-1]|=o<<i,i+=r,i>=this.DB&&(i-=this.DB)}r==8&&t[0]&128&&(this.s=-1,i>0&&(this.data[this.t-1]|=(1<<this.DB-i)-1<<i)),this.clamp(),s&&A.ZERO.subTo(this,this)}function Gd(){for(var t=this.s&this.DM;this.t>0&&this.data[this.t-1]==t;)--this.t}function Wd(t){if(this.s<0)return"-"+this.negate().toString(t);var e;if(t==16)e=4;else if(t==8)e=3;else if(t==2)e=1;else if(t==32)e=5;else if(t==4)e=2;else return this.toRadix(t);var r=(1<<e)-1,n,s=!1,i="",o=this.t,a=this.DB-o*this.DB%e;if(o-- >0)for(a<this.DB&&(n=this.data[o]>>a)>0&&(s=!0,i=zf(n));o>=0;)a<e?(n=(this.data[o]&(1<<a)-1)<<e-a,n|=this.data[--o]>>(a+=this.DB-e)):(n=this.data[o]>>(a-=e)&r,a<=0&&(a+=this.DB,--o)),n>0&&(s=!0),s&&(i+=zf(n));return s?i:"0"}function jd(){var t=ne();return A.ZERO.subTo(this,t),t}function $d(){return this.s<0?this.negate():this}function Yd(t){var e=this.s-t.s;if(e!=0)return e;var r=this.t;if(e=r-t.t,e!=0)return this.s<0?-e:e;for(;--r>=0;)if((e=this.data[r]-t.data[r])!=0)return e;return 0}function Ys(t){var e=1,r;return(r=t>>>16)!=0&&(t=r,e+=16),(r=t>>8)!=0&&(t=r,e+=8),(r=t>>4)!=0&&(t=r,e+=4),(r=t>>2)!=0&&(t=r,e+=2),(r=t>>1)!=0&&(t=r,e+=1),e}function Zd(){return this.t<=0?0:this.DB*(this.t-1)+Ys(this.data[this.t-1]^this.s&this.DM)}function Qd(t,e){var r;for(r=this.t-1;r>=0;--r)e.data[r+t]=this.data[r];for(r=t-1;r>=0;--r)e.data[r]=0;e.t=this.t+t,e.s=this.s}function Xd(t,e){for(var r=t;r<this.t;++r)e.data[r-t]=this.data[r];e.t=Math.max(this.t-t,0),e.s=this.s}function Jd(t,e){var r=t%this.DB,n=this.DB-r,s=(1<<n)-1,i=Math.floor(t/this.DB),o=this.s<<r&this.DM,a;for(a=this.t-1;a>=0;--a)e.data[a+i+1]=this.data[a]>>n|o,o=(this.data[a]&s)<<r;for(a=i-1;a>=0;--a)e.data[a]=0;e.data[i]=o,e.t=this.t+i+1,e.s=this.s,e.clamp()}function eg(t,e){e.s=this.s;var r=Math.floor(t/this.DB);if(r>=this.t){e.t=0;return}var n=t%this.DB,s=this.DB-n,i=(1<<n)-1;e.data[0]=this.data[r]>>n;for(var o=r+1;o<this.t;++o)e.data[o-r-1]|=(this.data[o]&i)<<s,e.data[o-r]=this.data[o]>>n;n>0&&(e.data[this.t-r-1]|=(this.s&i)<<s),e.t=this.t-r,e.clamp()}function tg(t,e){for(var r=0,n=0,s=Math.min(t.t,this.t);r<s;)n+=this.data[r]-t.data[r],e.data[r++]=n&this.DM,n>>=this.DB;if(t.t<this.t){for(n-=t.s;r<this.t;)n+=this.data[r],e.data[r++]=n&this.DM,n>>=this.DB;n+=this.s}else{for(n+=this.s;r<t.t;)n-=t.data[r],e.data[r++]=n&this.DM,n>>=this.DB;n-=t.s}e.s=n<0?-1:0,n<-1?e.data[r++]=this.DV+n:n>0&&(e.data[r++]=n),e.t=r,e.clamp()}function rg(t,e){var r=this.abs(),n=t.abs(),s=r.t;for(e.t=s+n.t;--s>=0;)e.data[s]=0;for(s=0;s<n.t;++s)e.data[s+r.t]=r.am(0,n.data[s],e,s,0,r.t);e.s=0,e.clamp(),this.s!=t.s&&A.ZERO.subTo(e,e)}function ng(t){for(var e=this.abs(),r=t.t=2*e.t;--r>=0;)t.data[r]=0;for(r=0;r<e.t-1;++r){var n=e.am(r,e.data[r],t,2*r,0,1);(t.data[r+e.t]+=e.am(r+1,2*e.data[r],t,2*r+1,n,e.t-r-1))>=e.DV&&(t.data[r+e.t]-=e.DV,t.data[r+e.t+1]=1)}t.t>0&&(t.data[t.t-1]+=e.am(r,e.data[r],t,2*r,0,1)),t.s=0,t.clamp()}function sg(t,e,r){var n=t.abs();if(!(n.t<=0)){var s=this.abs();if(s.t<n.t){e?.fromInt(0),r!=null&&this.copyTo(r);return}r==null&&(r=ne());var i=ne(),o=this.s,a=t.s,f=this.DB-Ys(n.data[n.t-1]);f>0?(n.lShiftTo(f,i),s.lShiftTo(f,r)):(n.copyTo(i),s.copyTo(r));var u=i.t,c=i.data[u-1];if(c!=0){var l=c*(1<<this.F1)+(u>1?i.data[u-2]>>this.F2:0),h=this.FV/l,g=(1<<this.F1)/l,p=1<<this.F2,d=r.t,y=d-u,m=e??ne();for(i.dlShiftTo(y,m),r.compareTo(m)>=0&&(r.data[r.t++]=1,r.subTo(m,r)),A.ONE.dlShiftTo(u,m),m.subTo(i,i);i.t<u;)i.data[i.t++]=0;for(;--y>=0;){var E=r.data[--d]==c?this.DM:Math.floor(r.data[d]*h+(r.data[d-1]+p)*g);if((r.data[d]+=i.am(0,E,r,y,0,u))<E)for(i.dlShiftTo(y,m),r.subTo(m,r);r.data[d]<--E;)r.subTo(m,r)}e!=null&&(r.drShiftTo(u,e),o!=a&&A.ZERO.subTo(e,e)),r.t=u,r.clamp(),f>0&&r.rShiftTo(f,r),o<0&&A.ZERO.subTo(r,r)}}}function ig(t){var e=ne();return this.abs().divRemTo(t,null,e),this.s<0&&e.compareTo(A.ZERO)>0&&t.subTo(e,e),e}function Dr(t){this.m=t}function og(t){return t.s<0||t.compareTo(this.m)>=0?t.mod(this.m):t}function ag(t){return t}function cg(t){t.divRemTo(this.m,null,t)}function ug(t,e,r){t.multiplyTo(e,r),this.reduce(r)}function fg(t,e){t.squareTo(e),this.reduce(e)}Dr.prototype.convert=og;Dr.prototype.revert=ag;Dr.prototype.reduce=cg;Dr.prototype.mulTo=ug;Dr.prototype.sqrTo=fg;function lg(){if(this.t<1)return 0;var t=this.data[0];if(!(t&1))return 0;var e=t&3;return e=e*(2-(t&15)*e)&15,e=e*(2-(t&255)*e)&255,e=e*(2-((t&65535)*e&65535))&65535,e=e*(2-t*e%this.DV)%this.DV,e>0?this.DV-e:-e}function kr(t){this.m=t,this.mp=t.invDigit(),this.mpl=this.mp&32767,this.mph=this.mp>>15,this.um=(1<<t.DB-15)-1,this.mt2=2*t.t}function hg(t){var e=ne();return t.abs().dlShiftTo(this.m.t,e),e.divRemTo(this.m,null,e),t.s<0&&e.compareTo(A.ZERO)>0&&this.m.subTo(e,e),e}function pg(t){var e=ne();return t.copyTo(e),this.reduce(e),e}function dg(t){for(;t.t<=this.mt2;)t.data[t.t++]=0;for(var e=0;e<this.m.t;++e){var r=t.data[e]&32767,n=r*this.mpl+((r*this.mph+(t.data[e]>>15)*this.mpl&this.um)<<15)&t.DM;for(r=e+this.m.t,t.data[r]+=this.m.am(0,n,t,e,0,this.m.t);t.data[r]>=t.DV;)t.data[r]-=t.DV,t.data[++r]++}t.clamp(),t.drShiftTo(this.m.t,t),t.compareTo(this.m)>=0&&t.subTo(this.m,t)}function gg(t,e){t.squareTo(e),this.reduce(e)}function yg(t,e,r){t.multiplyTo(e,r),this.reduce(r)}kr.prototype.convert=hg;kr.prototype.revert=pg;kr.prototype.reduce=dg;kr.prototype.mulTo=yg;kr.prototype.sqrTo=gg;function mg(){return(this.t>0?this.data[0]&1:this.s)==0}function bg(t,e){if(t>4294967295||t<1)return A.ONE;var r=ne(),n=ne(),s=e.convert(this),i=Ys(t)-1;for(s.copyTo(r);--i>=0;)if(e.sqrTo(r,n),(t&1<<i)>0)e.mulTo(n,s,r);else{var o=r;r=n,n=o}return e.revert(r)}function xg(t,e){var r;return t<256||e.isEven()?r=new Dr(e):r=new kr(e),this.exp(t,r)}A.prototype.copyTo=Vd;A.prototype.fromInt=zd;A.prototype.fromString=Hd;A.prototype.clamp=Gd;A.prototype.dlShiftTo=Qd;A.prototype.drShiftTo=Xd;A.prototype.lShiftTo=Jd;A.prototype.rShiftTo=eg;A.prototype.subTo=tg;A.prototype.multiplyTo=rg;A.prototype.squareTo=ng;A.prototype.divRemTo=sg;A.prototype.invDigit=lg;A.prototype.isEven=mg;A.prototype.exp=bg;A.prototype.toString=Wd;A.prototype.negate=jd;A.prototype.abs=$d;A.prototype.compareTo=Yd;A.prototype.bitLength=Zd;A.prototype.mod=ig;A.prototype.modPowInt=xg;A.ZERO=ur(0);A.ONE=ur(1);function vg(){var t=ne();return this.copyTo(t),t}function wg(){if(this.s<0){if(this.t==1)return this.data[0]-this.DV;if(this.t==0)return-1}else{if(this.t==1)return this.data[0];if(this.t==0)return 0}return(this.data[1]&(1<<32-this.DB)-1)<<this.DB|this.data[0]}function Sg(){return this.t==0?this.s:this.data[0]<<24>>24}function Eg(){return this.t==0?this.s:this.data[0]<<16>>16}function _g(t){return Math.floor(Math.LN2*this.DB/Math.log(t))}function Ig(){return this.s<0?-1:this.t<=0||this.t==1&&this.data[0]<=0?0:1}function Cg(t){if(t==null&&(t=10),this.signum()==0||t<2||t>36)return"0";var e=this.chunkSize(t),r=Math.pow(t,e),n=ur(r),s=ne(),i=ne(),o="";for(this.divRemTo(n,s,i);s.signum()>0;)o=(r+i.intValue()).toString(t).substr(1)+o,s.divRemTo(n,s,i);return i.intValue().toString(t)+o}function Bg(t,e){this.fromInt(0),e==null&&(e=10);for(var r=this.chunkSize(e),n=Math.pow(e,r),s=!1,i=0,o=0,a=0;a<t.length;++a){var f=Hf(t,a);if(f<0){t.charAt(a)=="-"&&this.signum()==0&&(s=!0);continue}o=e*o+f,++i>=r&&(this.dMultiply(n),this.dAddOffset(o,0),i=0,o=0)}i>0&&(this.dMultiply(Math.pow(e,i)),this.dAddOffset(o,0)),s&&A.ZERO.subTo(this,this)}function Ag(t,e,r){if(typeof e=="number")if(t<2)this.fromInt(1);else for(this.fromNumber(t,r),this.testBit(t-1)||this.bitwiseTo(A.ONE.shiftLeft(t-1),qo,this),this.isEven()&&this.dAddOffset(1,0);!this.isProbablePrime(e);)this.dAddOffset(2,0),this.bitLength()>t&&this.subTo(A.ONE.shiftLeft(t-1),this);else{var n=new Array,s=t&7;n.length=(t>>3)+1,e.nextBytes(n),s>0?n[0]&=(1<<s)-1:n[0]=0,this.fromString(n,256)}}function Tg(){var t=this.t,e=new Array;e[0]=this.s;var r=this.DB-t*this.DB%8,n,s=0;if(t-- >0)for(r<this.DB&&(n=this.data[t]>>r)!=(this.s&this.DM)>>r&&(e[s++]=n|this.s<<this.DB-r);t>=0;)r<8?(n=(this.data[t]&(1<<r)-1)<<8-r,n|=this.data[--t]>>(r+=this.DB-8)):(n=this.data[t]>>(r-=8)&255,r<=0&&(r+=this.DB,--t)),n&128&&(n|=-256),s==0&&(this.s&128)!=(n&128)&&++s,(s>0||n!=this.s)&&(e[s++]=n);return e}function Pg(t){return this.compareTo(t)==0}function Rg(t){return this.compareTo(t)<0?this:t}function Dg(t){return this.compareTo(t)>0?this:t}function kg(t,e,r){var n,s,i=Math.min(t.t,this.t);for(n=0;n<i;++n)r.data[n]=e(this.data[n],t.data[n]);if(t.t<this.t){for(s=t.s&this.DM,n=i;n<this.t;++n)r.data[n]=e(this.data[n],s);r.t=this.t}else{for(s=this.s&this.DM,n=i;n<t.t;++n)r.data[n]=e(s,t.data[n]);r.t=t.t}r.s=e(this.s,t.s),r.clamp()}function Mg(t,e){return t&e}function Lg(t){var e=ne();return this.bitwiseTo(t,Mg,e),e}function qo(t,e){return t|e}function Ng(t){var e=ne();return this.bitwiseTo(t,qo,e),e}function Gf(t,e){return t^e}function Og(t){var e=ne();return this.bitwiseTo(t,Gf,e),e}function Wf(t,e){return t&~e}function Fg(t){var e=ne();return this.bitwiseTo(t,Wf,e),e}function Ug(){for(var t=ne(),e=0;e<this.t;++e)t.data[e]=this.DM&~this.data[e];return t.t=this.t,t.s=~this.s,t}function Kg(t){var e=ne();return t<0?this.rShiftTo(-t,e):this.lShiftTo(t,e),e}function qg(t){var e=ne();return t<0?this.lShiftTo(-t,e):this.rShiftTo(t,e),e}function Vg(t){if(t==0)return-1;var e=0;return t&65535||(t>>=16,e+=16),t&255||(t>>=8,e+=8),t&15||(t>>=4,e+=4),t&3||(t>>=2,e+=2),t&1||++e,e}function zg(){for(var t=0;t<this.t;++t)if(this.data[t]!=0)return t*this.DB+Vg(this.data[t]);return this.s<0?this.t*this.DB:-1}function Hg(t){for(var e=0;t!=0;)t&=t-1,++e;return e}function Gg(){for(var t=0,e=this.s&this.DM,r=0;r<this.t;++r)t+=Hg(this.data[r]^e);return t}function Wg(t){var e=Math.floor(t/this.DB);return e>=this.t?this.s!=0:(this.data[e]&1<<t%this.DB)!=0}function jg(t,e){var r=A.ONE.shiftLeft(t);return this.bitwiseTo(r,e,r),r}function $g(t){return this.changeBit(t,qo)}function Yg(t){return this.changeBit(t,Wf)}function Zg(t){return this.changeBit(t,Gf)}function Qg(t,e){for(var r=0,n=0,s=Math.min(t.t,this.t);r<s;)n+=this.data[r]+t.data[r],e.data[r++]=n&this.DM,n>>=this.DB;if(t.t<this.t){for(n+=t.s;r<this.t;)n+=this.data[r],e.data[r++]=n&this.DM,n>>=this.DB;n+=this.s}else{for(n+=this.s;r<t.t;)n+=t.data[r],e.data[r++]=n&this.DM,n>>=this.DB;n+=t.s}e.s=n<0?-1:0,n>0?e.data[r++]=n:n<-1&&(e.data[r++]=this.DV+n),e.t=r,e.clamp()}function Xg(t){var e=ne();return this.addTo(t,e),e}function Jg(t){var e=ne();return this.subTo(t,e),e}function ey(t){var e=ne();return this.multiplyTo(t,e),e}function ty(t){var e=ne();return this.divRemTo(t,e,null),e}function ry(t){var e=ne();return this.divRemTo(t,null,e),e}function ny(t){var e=ne(),r=ne();return this.divRemTo(t,e,r),new Array(e,r)}function sy(t){this.data[this.t]=this.am(0,t-1,this,0,0,this.t),++this.t,this.clamp()}function iy(t,e){if(t!=0){for(;this.t<=e;)this.data[this.t++]=0;for(this.data[e]+=t;this.data[e]>=this.DV;)this.data[e]-=this.DV,++e>=this.t&&(this.data[this.t++]=0),++this.data[e]}}function Yn(){}function jf(t){return t}function oy(t,e,r){t.multiplyTo(e,r)}function ay(t,e){t.squareTo(e)}Yn.prototype.convert=jf;Yn.prototype.revert=jf;Yn.prototype.mulTo=oy;Yn.prototype.sqrTo=ay;function cy(t){return this.exp(t,new Yn)}function uy(t,e,r){var n=Math.min(this.t+t.t,e);for(r.s=0,r.t=n;n>0;)r.data[--n]=0;var s;for(s=r.t-this.t;n<s;++n)r.data[n+this.t]=this.am(0,t.data[n],r,n,0,this.t);for(s=Math.min(t.t,e);n<s;++n)this.am(0,t.data[n],r,n,0,e-n);r.clamp()}function fy(t,e,r){--e;var n=r.t=this.t+t.t-e;for(r.s=0;--n>=0;)r.data[n]=0;for(n=Math.max(e-this.t,0);n<t.t;++n)r.data[this.t+n-e]=this.am(e-n,t.data[n],r,0,0,this.t+n-e);r.clamp(),r.drShiftTo(1,r)}function yn(t){this.r2=ne(),this.q3=ne(),A.ONE.dlShiftTo(2*t.t,this.r2),this.mu=this.r2.divide(t),this.m=t}function ly(t){if(t.s<0||t.t>2*this.m.t)return t.mod(this.m);if(t.compareTo(this.m)<0)return t;var e=ne();return t.copyTo(e),this.reduce(e),e}function hy(t){return t}function py(t){for(t.drShiftTo(this.m.t-1,this.r2),t.t>this.m.t+1&&(t.t=this.m.t+1,t.clamp()),this.mu.multiplyUpperTo(this.r2,this.m.t+1,this.q3),this.m.multiplyLowerTo(this.q3,this.m.t+1,this.r2);t.compareTo(this.r2)<0;)t.dAddOffset(1,this.m.t+1);for(t.subTo(this.r2,t);t.compareTo(this.m)>=0;)t.subTo(this.m,t)}function dy(t,e){t.squareTo(e),this.reduce(e)}function gy(t,e,r){t.multiplyTo(e,r),this.reduce(r)}yn.prototype.convert=ly;yn.prototype.revert=hy;yn.prototype.reduce=py;yn.prototype.mulTo=gy;yn.prototype.sqrTo=dy;function yy(t,e){var r=t.bitLength(),n,s=ur(1),i;if(r<=0)return s;r<18?n=1:r<48?n=3:r<144?n=4:r<768?n=5:n=6,r<8?i=new Dr(e):e.isEven()?i=new yn(e):i=new kr(e);var o=new Array,a=3,f=n-1,u=(1<<n)-1;if(o[1]=i.convert(this),n>1){var c=ne();for(i.sqrTo(o[1],c);a<=u;)o[a]=ne(),i.mulTo(c,o[a-2],o[a]),a+=2}var l=t.t-1,h,g=!0,p=ne(),d;for(r=Ys(t.data[l])-1;l>=0;){for(r>=f?h=t.data[l]>>r-f&u:(h=(t.data[l]&(1<<r+1)-1)<<f-r,l>0&&(h|=t.data[l-1]>>this.DB+r-f)),a=n;!(h&1);)h>>=1,--a;if((r-=a)<0&&(r+=this.DB,--l),g)o[h].copyTo(s),g=!1;else{for(;a>1;)i.sqrTo(s,p),i.sqrTo(p,s),a-=2;a>0?i.sqrTo(s,p):(d=s,s=p,p=d),i.mulTo(p,o[h],s)}for(;l>=0&&!(t.data[l]&1<<r);)i.sqrTo(s,p),d=s,s=p,p=d,--r<0&&(r=this.DB-1,--l)}return i.revert(s)}function my(t){var e=this.s<0?this.negate():this.clone(),r=t.s<0?t.negate():t.clone();if(e.compareTo(r)<0){var n=e;e=r,r=n}var s=e.getLowestSetBit(),i=r.getLowestSetBit();if(i<0)return e;for(s<i&&(i=s),i>0&&(e.rShiftTo(i,e),r.rShiftTo(i,r));e.signum()>0;)(s=e.getLowestSetBit())>0&&e.rShiftTo(s,e),(s=r.getLowestSetBit())>0&&r.rShiftTo(s,r),e.compareTo(r)>=0?(e.subTo(r,e),e.rShiftTo(1,e)):(r.subTo(e,r),r.rShiftTo(1,r));return i>0&&r.lShiftTo(i,r),r}function by(t){if(t<=0)return 0;var e=this.DV%t,r=this.s<0?t-1:0;if(this.t>0)if(e==0)r=this.data[0]%t;else for(var n=this.t-1;n>=0;--n)r=(e*r+this.data[n])%t;return r}function xy(t){var e=t.isEven();if(this.isEven()&&e||t.signum()==0)return A.ZERO;for(var r=t.clone(),n=this.clone(),s=ur(1),i=ur(0),o=ur(0),a=ur(1);r.signum()!=0;){for(;r.isEven();)r.rShiftTo(1,r),e?((!s.isEven()||!i.isEven())&&(s.addTo(this,s),i.subTo(t,i)),s.rShiftTo(1,s)):i.isEven()||i.subTo(t,i),i.rShiftTo(1,i);for(;n.isEven();)n.rShiftTo(1,n),e?((!o.isEven()||!a.isEven())&&(o.addTo(this,o),a.subTo(t,a)),o.rShiftTo(1,o)):a.isEven()||a.subTo(t,a),a.rShiftTo(1,a);r.compareTo(n)>=0?(r.subTo(n,r),e&&s.subTo(o,s),i.subTo(a,i)):(n.subTo(r,n),e&&o.subTo(s,o),a.subTo(i,a))}if(n.compareTo(A.ONE)!=0)return A.ZERO;if(a.compareTo(t)>=0)return a.subtract(t);if(a.signum()<0)a.addTo(t,a);else return a;return a.signum()<0?a.add(t):a}var wt=[2,3,5,7,11,13,17,19,23,29,31,37,41,43,47,53,59,61,67,71,73,79,83,89,97,101,103,107,109,113,127,131,137,139,149,151,157,163,167,173,179,181,191,193,197,199,211,223,227,229,233,239,241,251,257,263,269,271,277,281,283,293,307,311,313,317,331,337,347,349,353,359,367,373,379,383,389,397,401,409,419,421,431,433,439,443,449,457,461,463,467,479,487,491,499,503,509],vy=(1<<26)/wt[wt.length-1];function wy(t){var e,r=this.abs();if(r.t==1&&r.data[0]<=wt[wt.length-1]){for(e=0;e<wt.length;++e)if(r.data[0]==wt[e])return!0;return!1}if(r.isEven())return!1;for(e=1;e<wt.length;){for(var n=wt[e],s=e+1;s<wt.length&&n<vy;)n*=wt[s++];for(n=r.modInt(n);e<s;)if(n%wt[e++]==0)return!1}return r.millerRabin(t)}function Sy(t){var e=this.subtract(A.ONE),r=e.getLowestSetBit();if(r<=0)return!1;for(var n=e.shiftRight(r),s=Ey(),i,o=0;o<t;++o){do i=new A(this.bitLength(),s);while(i.compareTo(A.ONE)<=0||i.compareTo(e)>=0);var a=i.modPow(n,this);if(a.compareTo(A.ONE)!=0&&a.compareTo(e)!=0){for(var f=1;f++<r&&a.compareTo(e)!=0;)if(a=a.modPowInt(2,this),a.compareTo(A.ONE)==0)return!1;if(a.compareTo(e)!=0)return!1}}return!0}function Ey(){return{nextBytes:function(t){for(var e=0;e<t.length;++e)t[e]=Math.floor(Math.random()*256)}}}A.prototype.chunkSize=_g;A.prototype.toRadix=Cg;A.prototype.fromRadix=Bg;A.prototype.fromNumber=Ag;A.prototype.bitwiseTo=kg;A.prototype.changeBit=jg;A.prototype.addTo=Qg;A.prototype.dMultiply=sy;A.prototype.dAddOffset=iy;A.prototype.multiplyLowerTo=uy;A.prototype.multiplyUpperTo=fy;A.prototype.modInt=by;A.prototype.millerRabin=Sy;A.prototype.clone=vg;A.prototype.intValue=wg;A.prototype.byteValue=Sg;A.prototype.shortValue=Eg;A.prototype.signum=Ig;A.prototype.toByteArray=Tg;A.prototype.equals=Pg;A.prototype.min=Rg;A.prototype.max=Dg;A.prototype.and=Lg;A.prototype.or=Ng;A.prototype.xor=Og;A.prototype.andNot=Fg;A.prototype.not=Ug;A.prototype.shiftLeft=Kg;A.prototype.shiftRight=qg;A.prototype.getLowestSetBit=zg;A.prototype.bitCount=Gg;A.prototype.testBit=Wg;A.prototype.setBit=$g;A.prototype.clearBit=Yg;A.prototype.flipBit=Zg;A.prototype.add=Xg;A.prototype.subtract=Jg;A.prototype.multiply=ey;A.prototype.divide=ty;A.prototype.remainder=ry;A.prototype.divideAndRemainder=ny;A.prototype.modPow=yy;A.prototype.modInverse=xy;A.prototype.pow=cy;A.prototype.gcd=my;A.prototype.isProbablePrime=wy});var Jf=G((Vw,Xf)=>{var Rt=ce();Rr();Ce();var Zf=Xf.exports=Rt.sha1=Rt.sha1||{};Rt.md.sha1=Rt.md.algorithms.sha1=Zf;Zf.create=function(){Qf||_y();var t=null,e=Rt.util.createBuffer(),r=new Array(80),n={algorithm:"sha1",blockLength:64,digestLength:20,messageLength:0,fullMessageLength:null,messageLengthSize:8};return n.start=function(){n.messageLength=0,n.fullMessageLength=n.messageLength64=[];for(var s=n.messageLengthSize/4,i=0;i<s;++i)n.fullMessageLength.push(0);return e=Rt.util.createBuffer(),t={h0:1732584193,h1:4023233417,h2:2562383102,h3:271733878,h4:3285377520},n},n.start(),n.update=function(s,i){i==="utf8"&&(s=Rt.util.encodeUtf8(s));var o=s.length;n.messageLength+=o,o=[o/4294967296>>>0,o>>>0];for(var a=n.fullMessageLength.length-1;a>=0;--a)n.fullMessageLength[a]+=o[1],o[1]=o[0]+(n.fullMessageLength[a]/4294967296>>>0),n.fullMessageLength[a]=n.fullMessageLength[a]>>>0,o[0]=o[1]/4294967296>>>0;return e.putBytes(s),Yf(t,r,e),(e.read>2048||e.length()===0)&&e.compact(),n},n.digest=function(){var s=Rt.util.createBuffer();s.putBytes(e.bytes());var i=n.fullMessageLength[n.fullMessageLength.length-1]+n.messageLengthSize,o=i&n.blockLength-1;s.putBytes(Vo.substr(0,n.blockLength-o));for(var a,f,u=n.fullMessageLength[0]*8,c=0;c<n.fullMessageLength.length-1;++c)a=n.fullMessageLength[c+1]*8,f=a/4294967296>>>0,u+=f,s.putInt32(u>>>0),u=a>>>0;s.putInt32(u);var l={h0:t.h0,h1:t.h1,h2:t.h2,h3:t.h3,h4:t.h4};Yf(l,r,s);var h=Rt.util.createBuffer();return h.putInt32(l.h0),h.putInt32(l.h1),h.putInt32(l.h2),h.putInt32(l.h3),h.putInt32(l.h4),h},n};var Vo=null,Qf=!1;function _y(){Vo=String.fromCharCode(128),Vo+=Rt.util.fillString(String.fromCharCode(0),64),Qf=!0}function Yf(t,e,r){for(var n,s,i,o,a,f,u,c,l=r.length();l>=64;){for(s=t.h0,i=t.h1,o=t.h2,a=t.h3,f=t.h4,c=0;c<16;++c)n=r.getInt32(),e[c]=n,u=a^i&(o^a),n=(s<<5|s>>>27)+u+f+1518500249+n,f=a,a=o,o=(i<<30|i>>>2)>>>0,i=s,s=n;for(;c<20;++c)n=e[c-3]^e[c-8]^e[c-14]^e[c-16],n=n<<1|n>>>31,e[c]=n,u=a^i&(o^a),n=(s<<5|s>>>27)+u+f+1518500249+n,f=a,a=o,o=(i<<30|i>>>2)>>>0,i=s,s=n;for(;c<32;++c)n=e[c-3]^e[c-8]^e[c-14]^e[c-16],n=n<<1|n>>>31,e[c]=n,u=i^o^a,n=(s<<5|s>>>27)+u+f+1859775393+n,f=a,a=o,o=(i<<30|i>>>2)>>>0,i=s,s=n;for(;c<40;++c)n=e[c-6]^e[c-16]^e[c-28]^e[c-32],n=n<<2|n>>>30,e[c]=n,u=i^o^a,n=(s<<5|s>>>27)+u+f+1859775393+n,f=a,a=o,o=(i<<30|i>>>2)>>>0,i=s,s=n;for(;c<60;++c)n=e[c-6]^e[c-16]^e[c-28]^e[c-32],n=n<<2|n>>>30,e[c]=n,u=i&o|a&(i^o),n=(s<<5|s>>>27)+u+f+2400959708+n,f=a,a=o,o=(i<<30|i>>>2)>>>0,i=s,s=n;for(;c<80;++c)n=e[c-6]^e[c-16]^e[c-28]^e[c-32],n=n<<2|n>>>30,e[c]=n,u=i^o^a,n=(s<<5|s>>>27)+u+f+3395469782+n,f=a,a=o,o=(i<<30|i>>>2)>>>0,i=s,s=n;t.h0=t.h0+s|0,t.h1=t.h1+i|0,t.h2=t.h2+o|0,t.h3=t.h3+a|0,t.h4=t.h4+f|0,l-=64}}});var rl=G((zw,tl)=>{var Dt=ce();Ce();$n();Jf();var el=tl.exports=Dt.pkcs1=Dt.pkcs1||{};el.encode_rsa_oaep=function(t,e,r){var n,s,i,o;typeof r=="string"?(n=r,s=arguments[3]||void 0,i=arguments[4]||void 0):r&&(n=r.label||void 0,s=r.seed||void 0,i=r.md||void 0,r.mgf1&&r.mgf1.md&&(o=r.mgf1.md)),i?i.start():i=Dt.md.sha1.create(),o||(o=i);var a=Math.ceil(t.n.bitLength()/8),f=a-2*i.digestLength-2;if(e.length>f){var u=new Error("RSAES-OAEP input message length is too long.");throw u.length=e.length,u.maxLength=f,u}n||(n=""),i.update(n,"raw");for(var c=i.digest(),l="",h=f-e.length,g=0;g<h;g++)l+="\0";var p=c.getBytes()+l+""+e;if(!s)s=Dt.random.getBytes(i.digestLength);else if(s.length!==i.digestLength){var u=new Error("Invalid RSAES-OAEP seed. The seed length must match the digest length.");throw u.seedLength=s.length,u.digestLength=i.digestLength,u}var d=Qs(s,a-i.digestLength-1,o),y=Dt.util.xorBytes(p,d,p.length),m=Qs(y,i.digestLength,o),E=Dt.util.xorBytes(s,m,s.length);return"\0"+E+y};el.decode_rsa_oaep=function(t,e,r){var n,s,i;typeof r=="string"?(n=r,s=arguments[3]||void 0):r&&(n=r.label||void 0,s=r.md||void 0,r.mgf1&&r.mgf1.md&&(i=r.mgf1.md));var o=Math.ceil(t.n.bitLength()/8);if(e.length!==o){var y=new Error("RSAES-OAEP encoded message length is invalid.");throw y.length=e.length,y.expectedLength=o,y}if(s===void 0?s=Dt.md.sha1.create():s.start(),i||(i=s),o<2*s.digestLength+2)throw new Error("RSAES-OAEP key is too short for the hash function.");n||(n=""),s.update(n,"raw");for(var a=s.digest().getBytes(),f=e.charAt(0),u=e.substring(1,s.digestLength+1),c=e.substring(1+s.digestLength),l=Qs(c,s.digestLength,i),h=Dt.util.xorBytes(u,l,u.length),g=Qs(h,o-s.digestLength-1,i),p=Dt.util.xorBytes(c,g,c.length),d=p.substring(0,s.digestLength),y=f!=="\0",m=0;m<s.digestLength;++m)y|=a.charAt(m)!==d.charAt(m);for(var E=1,v=s.digestLength,C=s.digestLength;C<p.length;C++){var b=p.charCodeAt(C),w=b&1^1,I=E?65534:0;y|=b&I,E=E&w,v+=E}if(y||p.charCodeAt(v)!==1)throw new Error("Invalid RSAES-OAEP padding.");return p.substring(v+1)};function Qs(t,e,r){r||(r=Dt.md.sha1.create());for(var n="",s=Math.ceil(e/r.digestLength),i=0;i<s;++i){var o=String.fromCharCode(i>>24&255,i>>16&255,i>>8&255,i&255);r.start(),r.update(t+o),n+=r.digest().getBytes()}return n.substring(0,e)}});var nl=G((Hw,zo)=>{var fr=ce();Ce();Zs();$n();(function(){if(fr.prime){zo.exports=fr.prime;return}var t=zo.exports=fr.prime=fr.prime||{},e=fr.jsbn.BigInteger,r=[6,4,2,4,2,4,6,2],n=new e(null);n.fromInt(30);var s=function(l,h){return l|h};t.generateProbablePrime=function(l,h,g){typeof h=="function"&&(g=h,h={}),h=h||{};var p=h.algorithm||"PRIMEINC";typeof p=="string"&&(p={name:p}),p.options=p.options||{};var d=h.prng||fr.random,y={nextBytes:function(m){for(var E=d.getBytesSync(m.length),v=0;v<m.length;++v)m[v]=E.charCodeAt(v)}};if(p.name==="PRIMEINC")return i(l,y,p.options,g);throw new Error("Invalid prime generation algorithm: "+p.name)};function i(l,h,g,p){return"workers"in g?f(l,h,g,p):o(l,h,g,p)}function o(l,h,g,p){var d=u(l,h),y=0,m=c(d.bitLength());"millerRabinTests"in g&&(m=g.millerRabinTests);var E=10;"maxBlockTime"in g&&(E=g.maxBlockTime),a(d,l,h,y,m,E,p)}function a(l,h,g,p,d,y,m){var E=+new Date;do{if(l.bitLength()>h&&(l=u(h,g)),l.isProbablePrime(d))return m(null,l);l.dAddOffset(r[p++%8],0)}while(y<0||+new Date-E<y);fr.util.setImmediate(function(){a(l,h,g,p,d,y,m)})}function f(l,h,g,p){if(typeof Worker>"u")return o(l,h,g,p);var d=u(l,h),y=g.workers,m=g.workLoad||100,E=m*30/8,v=g.workerScript||"forge/prime.worker.js";if(y===-1)return fr.util.estimateCores(function(b,w){b&&(w=2),y=w-1,C()});C();function C(){y=Math.max(1,y);for(var b=[],w=0;w<y;++w)b[w]=new Worker(v);for(var I=y,w=0;w<y;++w)b[w].addEventListener("message",F);var T=!1;function F(K){if(!T){--I;var q=K.data;if(q.found){for(var X=0;X<b.length;++X)b[X].terminate();return T=!0,p(null,new e(q.prime,16))}d.bitLength()>l&&(d=u(l,h));var ue=d.toString(16);K.target.postMessage({hex:ue,workLoad:m}),d.dAddOffset(E,0)}}}}function u(l,h){var g=new e(l,h),p=l-1;return g.testBit(p)||g.bitwiseTo(e.ONE.shiftLeft(p),s,g),g.dAddOffset(31-g.mod(n).byteValue(),0),g}function c(l){return l<=100?27:l<=150?18:l<=200?15:l<=250?12:l<=300?9:l<=350?8:l<=400?7:l<=500?6:l<=600?5:l<=800?4:l<=1250?3:2}})()});var Js=G((Gw,fl)=>{var H=ce();jn();Zs();Ks();rl();nl();$n();Ce();typeof te>"u"&&(te=H.jsbn.BigInteger);var te,Ho=H.util.isNodejs?Hs():null,S=H.asn1,ht=H.util;H.pki=H.pki||{};fl.exports=H.pki.rsa=H.rsa=H.rsa||{};var j=H.pki,Iy=[6,4,2,4,2,4,6,2],Cy={name:"PrivateKeyInfo",tagClass:S.Class.UNIVERSAL,type:S.Type.SEQUENCE,constructed:!0,value:[{name:"PrivateKeyInfo.version",tagClass:S.Class.UNIVERSAL,type:S.Type.INTEGER,constructed:!1,capture:"privateKeyVersion"},{name:"PrivateKeyInfo.privateKeyAlgorithm",tagClass:S.Class.UNIVERSAL,type:S.Type.SEQUENCE,constructed:!0,value:[{name:"AlgorithmIdentifier.algorithm",tagClass:S.Class.UNIVERSAL,type:S.Type.OID,constructed:!1,capture:"privateKeyOid"}]},{name:"PrivateKeyInfo",tagClass:S.Class.UNIVERSAL,type:S.Type.OCTETSTRING,constructed:!1,capture:"privateKey"}]},By={name:"RSAPrivateKey",tagClass:S.Class.UNIVERSAL,type:S.Type.SEQUENCE,constructed:!0,value:[{name:"RSAPrivateKey.version",tagClass:S.Class.UNIVERSAL,type:S.Type.INTEGER,constructed:!1,capture:"privateKeyVersion"},{name:"RSAPrivateKey.modulus",tagClass:S.Class.UNIVERSAL,type:S.Type.INTEGER,constructed:!1,capture:"privateKeyModulus"},{name:"RSAPrivateKey.publicExponent",tagClass:S.Class.UNIVERSAL,type:S.Type.INTEGER,constructed:!1,capture:"privateKeyPublicExponent"},{name:"RSAPrivateKey.privateExponent",tagClass:S.Class.UNIVERSAL,type:S.Type.INTEGER,constructed:!1,capture:"privateKeyPrivateExponent"},{name:"RSAPrivateKey.prime1",tagClass:S.Class.UNIVERSAL,type:S.Type.INTEGER,constructed:!1,capture:"privateKeyPrime1"},{name:"RSAPrivateKey.prime2",tagClass:S.Class.UNIVERSAL,type:S.Type.INTEGER,constructed:!1,capture:"privateKeyPrime2"},{name:"RSAPrivateKey.exponent1",tagClass:S.Class.UNIVERSAL,type:S.Type.INTEGER,constructed:!1,capture:"privateKeyExponent1"},{name:"RSAPrivateKey.exponent2",tagClass:S.Class.UNIVERSAL,type:S.Type.INTEGER,constructed:!1,capture:"privateKeyExponent2"},{name:"RSAPrivateKey.coefficient",tagClass:S.Class.UNIVERSAL,type:S.Type.INTEGER,constructed:!1,capture:"privateKeyCoefficient"}]},Ay={name:"RSAPublicKey",tagClass:S.Class.UNIVERSAL,type:S.Type.SEQUENCE,constructed:!0,value:[{name:"RSAPublicKey.modulus",tagClass:S.Class.UNIVERSAL,type:S.Type.INTEGER,constructed:!1,capture:"publicKeyModulus"},{name:"RSAPublicKey.exponent",tagClass:S.Class.UNIVERSAL,type:S.Type.INTEGER,constructed:!1,capture:"publicKeyExponent"}]},Ty=H.pki.rsa.publicKeyValidator={name:"SubjectPublicKeyInfo",tagClass:S.Class.UNIVERSAL,type:S.Type.SEQUENCE,constructed:!0,captureAsn1:"subjectPublicKeyInfo",value:[{name:"SubjectPublicKeyInfo.AlgorithmIdentifier",tagClass:S.Class.UNIVERSAL,type:S.Type.SEQUENCE,constructed:!0,value:[{name:"AlgorithmIdentifier.algorithm",tagClass:S.Class.UNIVERSAL,type:S.Type.OID,constructed:!1,capture:"publicKeyOid"}]},{name:"SubjectPublicKeyInfo.subjectPublicKey",tagClass:S.Class.UNIVERSAL,type:S.Type.BITSTRING,constructed:!1,value:[{name:"SubjectPublicKeyInfo.subjectPublicKey.RSAPublicKey",tagClass:S.Class.UNIVERSAL,type:S.Type.SEQUENCE,constructed:!0,optional:!0,captureAsn1:"rsaPublicKey"}]}]},Py={name:"DigestInfo",tagClass:S.Class.UNIVERSAL,type:S.Type.SEQUENCE,constructed:!0,value:[{name:"DigestInfo.DigestAlgorithm",tagClass:S.Class.UNIVERSAL,type:S.Type.SEQUENCE,constructed:!0,value:[{name:"DigestInfo.DigestAlgorithm.algorithmIdentifier",tagClass:S.Class.UNIVERSAL,type:S.Type.OID,constructed:!1,capture:"algorithmIdentifier"},{name:"DigestInfo.DigestAlgorithm.parameters",tagClass:S.Class.UNIVERSAL,type:S.Type.NULL,capture:"parameters",optional:!0,constructed:!1}]},{name:"DigestInfo.digest",tagClass:S.Class.UNIVERSAL,type:S.Type.OCTETSTRING,constructed:!1,capture:"digest"}]},Ry=function(t){var e;if(t.algorithm in j.oids)e=j.oids[t.algorithm];else{var r=new Error("Unknown message digest algorithm.");throw r.algorithm=t.algorithm,r}var n=S.oidToDer(e).getBytes(),s=S.create(S.Class.UNIVERSAL,S.Type.SEQUENCE,!0,[]),i=S.create(S.Class.UNIVERSAL,S.Type.SEQUENCE,!0,[]);i.value.push(S.create(S.Class.UNIVERSAL,S.Type.OID,!1,n)),i.value.push(S.create(S.Class.UNIVERSAL,S.Type.NULL,!1,""));var o=S.create(S.Class.UNIVERSAL,S.Type.OCTETSTRING,!1,t.digest().getBytes());return s.value.push(i),s.value.push(o),S.toDer(s).getBytes()},cl=function(t,e,r){if(r)return t.modPow(e.e,e.n);if(!e.p||!e.q)return t.modPow(e.d,e.n);e.dP||(e.dP=e.d.mod(e.p.subtract(te.ONE))),e.dQ||(e.dQ=e.d.mod(e.q.subtract(te.ONE))),e.qInv||(e.qInv=e.q.modInverse(e.p));var n;do n=new te(H.util.bytesToHex(H.random.getBytes(e.n.bitLength()/8)),16);while(n.compareTo(e.n)>=0||!n.gcd(e.n).equals(te.ONE));t=t.multiply(n.modPow(e.e,e.n)).mod(e.n);for(var s=t.mod(e.p).modPow(e.dP,e.p),i=t.mod(e.q).modPow(e.dQ,e.q);s.compareTo(i)<0;)s=s.add(e.p);var o=s.subtract(i).multiply(e.qInv).mod(e.p).multiply(e.q).add(i);return o=o.multiply(n.modInverse(e.n)).mod(e.n),o};j.rsa.encrypt=function(t,e,r){var n=r,s,i=Math.ceil(e.n.bitLength()/8);r!==!1&&r!==!0?(n=r===2,s=ul(t,e,r)):(s=H.util.createBuffer(),s.putBytes(t));for(var o=new te(s.toHex(),16),a=cl(o,e,n),f=a.toString(16),u=H.util.createBuffer(),c=i-Math.ceil(f.length/2);c>0;)u.putByte(0),--c;return u.putBytes(H.util.hexToBytes(f)),u.getBytes()};j.rsa.decrypt=function(t,e,r,n){var s=Math.ceil(e.n.bitLength()/8);if(t.length!==s){var i=new Error("Encrypted message length is invalid.");throw i.length=t.length,i.expected=s,i}var o=new te(H.util.createBuffer(t).toHex(),16);if(o.compareTo(e.n)>=0)throw new Error("Encrypted message is invalid.");for(var a=cl(o,e,r),f=a.toString(16),u=H.util.createBuffer(),c=s-Math.ceil(f.length/2);c>0;)u.putByte(0),--c;return u.putBytes(H.util.hexToBytes(f)),n!==!1?Xs(u.getBytes(),e,r):u.getBytes()};j.rsa.createKeyPairGenerationState=function(t,e,r){typeof t=="string"&&(t=parseInt(t,10)),t=t||2048,r=r||{};var n=r.prng||H.random,s={nextBytes:function(a){for(var f=n.getBytesSync(a.length),u=0;u<a.length;++u)a[u]=f.charCodeAt(u)}},i=r.algorithm||"PRIMEINC",o;if(i==="PRIMEINC")o={algorithm:i,state:0,bits:t,rng:s,eInt:e||65537,e:new te(null),p:null,q:null,qBits:t>>1,pBits:t-(t>>1),pqState:0,num:null,keys:null},o.e.fromInt(o.eInt);else throw new Error("Invalid key generation algorithm: "+i);return o};j.rsa.stepKeyPairGenerationState=function(t,e){"algorithm"in t||(t.algorithm="PRIMEINC");var r=new te(null);r.fromInt(30);for(var n=0,s=function(l,h){return l|h},i=+new Date,o,a=0;t.keys===null&&(e<=0||a<e);){if(t.state===0){var f=t.p===null?t.pBits:t.qBits,u=f-1;t.pqState===0?(t.num=new te(f,t.rng),t.num.testBit(u)||t.num.bitwiseTo(te.ONE.shiftLeft(u),s,t.num),t.num.dAddOffset(31-t.num.mod(r).byteValue(),0),n=0,++t.pqState):t.pqState===1?t.num.bitLength()>f?t.pqState=0:t.num.isProbablePrime(ky(t.num.bitLength()))?++t.pqState:t.num.dAddOffset(Iy[n++%8],0):t.pqState===2?t.pqState=t.num.subtract(te.ONE).gcd(t.e).compareTo(te.ONE)===0?3:0:t.pqState===3&&(t.pqState=0,t.p===null?t.p=t.num:t.q=t.num,t.p!==null&&t.q!==null&&++t.state,t.num=null)}else if(t.state===1)t.p.compareTo(t.q)<0&&(t.num=t.p,t.p=t.q,t.q=t.num),++t.state;else if(t.state===2)t.p1=t.p.subtract(te.ONE),t.q1=t.q.subtract(te.ONE),t.phi=t.p1.multiply(t.q1),++t.state;else if(t.state===3)t.phi.gcd(t.e).compareTo(te.ONE)===0?++t.state:(t.p=null,t.q=null,t.state=0);else if(t.state===4)t.n=t.p.multiply(t.q),t.n.bitLength()===t.bits?++t.state:(t.q=null,t.state=0);else if(t.state===5){var c=t.e.modInverse(t.phi);t.keys={privateKey:j.rsa.setPrivateKey(t.n,t.e,c,t.p,t.q,c.mod(t.p1),c.mod(t.q1),t.q.modInverse(t.p)),publicKey:j.rsa.setPublicKey(t.n,t.e)}}o=+new Date,a+=o-i,i=o}return t.keys!==null};j.rsa.generateKeyPair=function(t,e,r,n){if(arguments.length===1?typeof t=="object"?(r=t,t=void 0):typeof t=="function"&&(n=t,t=void 0):arguments.length===2?typeof t=="number"?typeof e=="function"?(n=e,e=void 0):typeof e!="number"&&(r=e,e=void 0):(r=t,n=e,t=void 0,e=void 0):arguments.length===3&&(typeof e=="number"?typeof r=="function"&&(n=r,r=void 0):(n=r,r=e,e=void 0)),r=r||{},t===void 0&&(t=r.bits||2048),e===void 0&&(e=r.e||65537),!H.options.usePureJavaScript&&!r.prng&&t>=256&&t<=16384&&(e===65537||e===3)){if(n){if(sl("generateKeyPair"))return Ho.generateKeyPair("rsa",{modulusLength:t,publicExponent:e,publicKeyEncoding:{type:"spki",format:"pem"},privateKeyEncoding:{type:"pkcs8",format:"pem"}},function(a,f,u){if(a)return n(a);n(null,{privateKey:j.privateKeyFromPem(u),publicKey:j.publicKeyFromPem(f)})});if(il("generateKey")&&il("exportKey"))return ht.globalScope.crypto.subtle.generateKey({name:"RSASSA-PKCS1-v1_5",modulusLength:t,publicExponent:al(e),hash:{name:"SHA-256"}},!0,["sign","verify"]).then(function(a){return ht.globalScope.crypto.subtle.exportKey("pkcs8",a.privateKey)}).then(void 0,function(a){n(a)}).then(function(a){if(a){var f=j.privateKeyFromAsn1(S.fromDer(H.util.createBuffer(a)));n(null,{privateKey:f,publicKey:j.setRsaPublicKey(f.n,f.e)})}});if(ol("generateKey")&&ol("exportKey")){var s=ht.globalScope.msCrypto.subtle.generateKey({name:"RSASSA-PKCS1-v1_5",modulusLength:t,publicExponent:al(e),hash:{name:"SHA-256"}},!0,["sign","verify"]);s.oncomplete=function(a){var f=a.target.result,u=ht.globalScope.msCrypto.subtle.exportKey("pkcs8",f.privateKey);u.oncomplete=function(c){var l=c.target.result,h=j.privateKeyFromAsn1(S.fromDer(H.util.createBuffer(l)));n(null,{privateKey:h,publicKey:j.setRsaPublicKey(h.n,h.e)})},u.onerror=function(c){n(c)}},s.onerror=function(a){n(a)};return}}else if(sl("generateKeyPairSync")){var i=Ho.generateKeyPairSync("rsa",{modulusLength:t,publicExponent:e,publicKeyEncoding:{type:"spki",format:"pem"},privateKeyEncoding:{type:"pkcs8",format:"pem"}});return{privateKey:j.privateKeyFromPem(i.privateKey),publicKey:j.publicKeyFromPem(i.publicKey)}}}var o=j.rsa.createKeyPairGenerationState(t,e,r);if(!n)return j.rsa.stepKeyPairGenerationState(o,0),o.keys;Dy(o,r,n)};j.setRsaPublicKey=j.rsa.setPublicKey=function(t,e){var r={n:t,e};return r.encrypt=function(n,s,i){if(typeof s=="string"?s=s.toUpperCase():s===void 0&&(s="RSAES-PKCS1-V1_5"),s==="RSAES-PKCS1-V1_5")s={encode:function(a,f,u){return ul(a,f,2).getBytes()}};else if(s==="RSA-OAEP"||s==="RSAES-OAEP")s={encode:function(a,f){return H.pkcs1.encode_rsa_oaep(f,a,i)}};else if(["RAW","NONE","NULL",null].indexOf(s)!==-1)s={encode:function(a){return a}};else if(typeof s=="string")throw new Error('Unsupported encryption scheme: "'+s+'".');var o=s.encode(n,r,!0);return j.rsa.encrypt(o,r,!0)},r.verify=function(n,s,i,o){typeof i=="string"?i=i.toUpperCase():i===void 0&&(i="RSASSA-PKCS1-V1_5"),o===void 0&&(o={_parseAllDigestBytes:!0}),"_parseAllDigestBytes"in o||(o._parseAllDigestBytes=!0),i==="RSASSA-PKCS1-V1_5"?i={verify:function(f,u){u=Xs(u,r,!0);var c=S.fromDer(u,{parseAllBytes:o._parseAllDigestBytes}),l={},h=[];if(!S.validate(c,Py,l,h)){var g=new Error("ASN.1 object does not contain a valid RSASSA-PKCS1-v1_5 DigestInfo value.");throw g.errors=h,g}var p=S.derToOid(l.algorithmIdentifier);if(!(p===H.oids.md2||p===H.oids.md5||p===H.oids.sha1||p===H.oids.sha224||p===H.oids.sha256||p===H.oids.sha384||p===H.oids.sha512||p===H.oids["sha512-224"]||p===H.oids["sha512-256"])){var g=new Error("Unknown RSASSA-PKCS1-v1_5 DigestAlgorithm identifier.");throw g.oid=p,g}if((p===H.oids.md2||p===H.oids.md5)&&!("parameters"in l))throw new Error("ASN.1 object does not contain a valid RSASSA-PKCS1-v1_5 DigestInfo value. Missing algorithm identifer NULL parameters.");return f===l.digest}}:(i==="NONE"||i==="NULL"||i===null)&&(i={verify:function(f,u){return u=Xs(u,r,!0),f===u}});var a=j.rsa.decrypt(s,r,!0,!1);return i.verify(n,a,r.n.bitLength())},r};j.setRsaPrivateKey=j.rsa.setPrivateKey=function(t,e,r,n,s,i,o,a){var f={n:t,e,d:r,p:n,q:s,dP:i,dQ:o,qInv:a};return f.decrypt=function(u,c,l){typeof c=="string"?c=c.toUpperCase():c===void 0&&(c="RSAES-PKCS1-V1_5");var h=j.rsa.decrypt(u,f,!1,!1);if(c==="RSAES-PKCS1-V1_5")c={decode:Xs};else if(c==="RSA-OAEP"||c==="RSAES-OAEP")c={decode:function(g,p){return H.pkcs1.decode_rsa_oaep(p,g,l)}};else if(["RAW","NONE","NULL",null].indexOf(c)!==-1)c={decode:function(g){return g}};else throw new Error('Unsupported encryption scheme: "'+c+'".');return c.decode(h,f,!1)},f.sign=function(u,c){var l=!1;typeof c=="string"&&(c=c.toUpperCase()),c===void 0||c==="RSASSA-PKCS1-V1_5"?(c={encode:Ry},l=1):(c==="NONE"||c==="NULL"||c===null)&&(c={encode:function(){return u}},l=1);var h=c.encode(u,f.n.bitLength());return j.rsa.encrypt(h,f,l)},f};j.wrapRsaPrivateKey=function(t){return S.create(S.Class.UNIVERSAL,S.Type.SEQUENCE,!0,[S.create(S.Class.UNIVERSAL,S.Type.INTEGER,!1,S.integerToDer(0).getBytes()),S.create(S.Class.UNIVERSAL,S.Type.SEQUENCE,!0,[S.create(S.Class.UNIVERSAL,S.Type.OID,!1,S.oidToDer(j.oids.rsaEncryption).getBytes()),S.create(S.Class.UNIVERSAL,S.Type.NULL,!1,"")]),S.create(S.Class.UNIVERSAL,S.Type.OCTETSTRING,!1,S.toDer(t).getBytes())])};j.privateKeyFromAsn1=function(t){var e={},r=[];if(S.validate(t,Cy,e,r)&&(t=S.fromDer(H.util.createBuffer(e.privateKey))),e={},r=[],!S.validate(t,By,e,r)){var n=new Error("Cannot read private key. ASN.1 object does not contain an RSAPrivateKey.");throw n.errors=r,n}var s,i,o,a,f,u,c,l;return s=H.util.createBuffer(e.privateKeyModulus).toHex(),i=H.util.createBuffer(e.privateKeyPublicExponent).toHex(),o=H.util.createBuffer(e.privateKeyPrivateExponent).toHex(),a=H.util.createBuffer(e.privateKeyPrime1).toHex(),f=H.util.createBuffer(e.privateKeyPrime2).toHex(),u=H.util.createBuffer(e.privateKeyExponent1).toHex(),c=H.util.createBuffer(e.privateKeyExponent2).toHex(),l=H.util.createBuffer(e.privateKeyCoefficient).toHex(),j.setRsaPrivateKey(new te(s,16),new te(i,16),new te(o,16),new te(a,16),new te(f,16),new te(u,16),new te(c,16),new te(l,16))};j.privateKeyToAsn1=j.privateKeyToRSAPrivateKey=function(t){return S.create(S.Class.UNIVERSAL,S.Type.SEQUENCE,!0,[S.create(S.Class.UNIVERSAL,S.Type.INTEGER,!1,S.integerToDer(0).getBytes()),S.create(S.Class.UNIVERSAL,S.Type.INTEGER,!1,kt(t.n)),S.create(S.Class.UNIVERSAL,S.Type.INTEGER,!1,kt(t.e)),S.create(S.Class.UNIVERSAL,S.Type.INTEGER,!1,kt(t.d)),S.create(S.Class.UNIVERSAL,S.Type.INTEGER,!1,kt(t.p)),S.create(S.Class.UNIVERSAL,S.Type.INTEGER,!1,kt(t.q)),S.create(S.Class.UNIVERSAL,S.Type.INTEGER,!1,kt(t.dP)),S.create(S.Class.UNIVERSAL,S.Type.INTEGER,!1,kt(t.dQ)),S.create(S.Class.UNIVERSAL,S.Type.INTEGER,!1,kt(t.qInv))])};j.publicKeyFromAsn1=function(t){var e={},r=[];if(S.validate(t,Ty,e,r)){var n=S.derToOid(e.publicKeyOid);if(n!==j.oids.rsaEncryption){var s=new Error("Cannot read public key. Unknown OID.");throw s.oid=n,s}t=e.rsaPublicKey}if(r=[],!S.validate(t,Ay,e,r)){var s=new Error("Cannot read public key. ASN.1 object does not contain an RSAPublicKey.");throw s.errors=r,s}var i=H.util.createBuffer(e.publicKeyModulus).toHex(),o=H.util.createBuffer(e.publicKeyExponent).toHex();return j.setRsaPublicKey(new te(i,16),new te(o,16))};j.publicKeyToAsn1=j.publicKeyToSubjectPublicKeyInfo=function(t){return S.create(S.Class.UNIVERSAL,S.Type.SEQUENCE,!0,[S.create(S.Class.UNIVERSAL,S.Type.SEQUENCE,!0,[S.create(S.Class.UNIVERSAL,S.Type.OID,!1,S.oidToDer(j.oids.rsaEncryption).getBytes()),S.create(S.Class.UNIVERSAL,S.Type.NULL,!1,"")]),S.create(S.Class.UNIVERSAL,S.Type.BITSTRING,!1,[j.publicKeyToRSAPublicKey(t)])])};j.publicKeyToRSAPublicKey=function(t){return S.create(S.Class.UNIVERSAL,S.Type.SEQUENCE,!0,[S.create(S.Class.UNIVERSAL,S.Type.INTEGER,!1,kt(t.n)),S.create(S.Class.UNIVERSAL,S.Type.INTEGER,!1,kt(t.e))])};function ul(t,e,r){var n=H.util.createBuffer(),s=Math.ceil(e.n.bitLength()/8);if(t.length>s-11){var i=new Error("Message is too long for PKCS#1 v1.5 padding.");throw i.length=t.length,i.max=s-11,i}n.putByte(0),n.putByte(r);var o=s-3-t.length,a;if(r===0||r===1){a=r===0?0:255;for(var f=0;f<o;++f)n.putByte(a)}else for(;o>0;){for(var u=0,c=H.random.getBytes(o),f=0;f<o;++f)a=c.charCodeAt(f),a===0?++u:n.putByte(a);o=u}return n.putByte(0),n.putBytes(t),n}function Xs(t,e,r,n){var s=Math.ceil(e.n.bitLength()/8),i=H.util.createBuffer(t),o=i.getByte(),a=i.getByte();if(o!==0||r&&a!==0&&a!==1||!r&&a!=2||r&&a===0&&typeof n>"u")throw new Error("Encryption block is invalid.");var f=0;if(a===0){f=s-3-n;for(var u=0;u<f;++u)if(i.getByte()!==0)throw new Error("Encryption block is invalid.")}else if(a===1)for(f=0;i.length()>1;){if(i.getByte()!==255){--i.read;break}++f}else if(a===2)for(f=0;i.length()>1;){if(i.getByte()===0){--i.read;break}++f}var c=i.getByte();if(c!==0||f!==s-3-i.length())throw new Error("Encryption block is invalid.");return i.getBytes()}function Dy(t,e,r){typeof e=="function"&&(r=e,e={}),e=e||{};var n={algorithm:{name:e.algorithm||"PRIMEINC",options:{workers:e.workers||2,workLoad:e.workLoad||100,workerScript:e.workerScript}}};"prng"in e&&(n.prng=e.prng),s();function s(){i(t.pBits,function(a,f){if(a)return r(a);if(t.p=f,t.q!==null)return o(a,t.q);i(t.qBits,o)})}function i(a,f){H.prime.generateProbablePrime(a,n,f)}function o(a,f){if(a)return r(a);if(t.q=f,t.p.compareTo(t.q)<0){var u=t.p;t.p=t.q,t.q=u}if(t.p.subtract(te.ONE).gcd(t.e).compareTo(te.ONE)!==0){t.p=null,s();return}if(t.q.subtract(te.ONE).gcd(t.e).compareTo(te.ONE)!==0){t.q=null,i(t.qBits,o);return}if(t.p1=t.p.subtract(te.ONE),t.q1=t.q.subtract(te.ONE),t.phi=t.p1.multiply(t.q1),t.phi.gcd(t.e).compareTo(te.ONE)!==0){t.p=t.q=null,s();return}if(t.n=t.p.multiply(t.q),t.n.bitLength()!==t.bits){t.q=null,i(t.qBits,o);return}var c=t.e.modInverse(t.phi);t.keys={privateKey:j.rsa.setPrivateKey(t.n,t.e,c,t.p,t.q,c.mod(t.p1),c.mod(t.q1),t.q.modInverse(t.p)),publicKey:j.rsa.setPublicKey(t.n,t.e)},r(null,t.keys)}}function kt(t){var e=t.toString(16);e[0]>="8"&&(e="00"+e);var r=H.util.hexToBytes(e);return r.length>1&&(r.charCodeAt(0)===0&&!(r.charCodeAt(1)&128)||r.charCodeAt(0)===255&&(r.charCodeAt(1)&128)===128)?r.substr(1):r}function ky(t){return t<=100?27:t<=150?18:t<=200?15:t<=250?12:t<=300?9:t<=350?8:t<=400?7:t<=500?6:t<=600?5:t<=800?4:t<=1250?3:2}function sl(t){return H.util.isNodejs&&typeof Ho[t]=="function"}function il(t){return typeof ht.globalScope<"u"&&typeof ht.globalScope.crypto=="object"&&typeof ht.globalScope.crypto.subtle=="object"&&typeof ht.globalScope.crypto.subtle[t]=="function"}function ol(t){return typeof ht.globalScope<"u"&&typeof ht.globalScope.msCrypto=="object"&&typeof ht.globalScope.msCrypto.subtle=="object"&&typeof ht.globalScope.msCrypto.subtle[t]=="function"}function al(t){for(var e=H.util.hexToBytes(t.toString(16)),r=new Uint8Array(e.length),n=0;n<e.length;++n)r[n]=e.charCodeAt(n);return r}});var yl=G((Ww,gl)=>{var N=ce();Fs();jn();wf();Rr();Ks();Lo();Af();$n();Kf();Js();Ce();typeof ll>"u"&&(ll=N.jsbn.BigInteger);var ll,_=N.asn1,$=N.pki=N.pki||{};gl.exports=$.pbe=N.pbe=N.pbe||{};var Mr=$.oids,My={name:"EncryptedPrivateKeyInfo",tagClass:_.Class.UNIVERSAL,type:_.Type.SEQUENCE,constructed:!0,value:[{name:"EncryptedPrivateKeyInfo.encryptionAlgorithm",tagClass:_.Class.UNIVERSAL,type:_.Type.SEQUENCE,constructed:!0,value:[{name:"AlgorithmIdentifier.algorithm",tagClass:_.Class.UNIVERSAL,type:_.Type.OID,constructed:!1,capture:"encryptionOid"},{name:"AlgorithmIdentifier.parameters",tagClass:_.Class.UNIVERSAL,type:_.Type.SEQUENCE,constructed:!0,captureAsn1:"encryptionParams"}]},{name:"EncryptedPrivateKeyInfo.encryptedData",tagClass:_.Class.UNIVERSAL,type:_.Type.OCTETSTRING,constructed:!1,capture:"encryptedData"}]},Ly={name:"PBES2Algorithms",tagClass:_.Class.UNIVERSAL,type:_.Type.SEQUENCE,constructed:!0,value:[{name:"PBES2Algorithms.keyDerivationFunc",tagClass:_.Class.UNIVERSAL,type:_.Type.SEQUENCE,constructed:!0,value:[{name:"PBES2Algorithms.keyDerivationFunc.oid",tagClass:_.Class.UNIVERSAL,type:_.Type.OID,constructed:!1,capture:"kdfOid"},{name:"PBES2Algorithms.params",tagClass:_.Class.UNIVERSAL,type:_.Type.SEQUENCE,constructed:!0,value:[{name:"PBES2Algorithms.params.salt",tagClass:_.Class.UNIVERSAL,type:_.Type.OCTETSTRING,constructed:!1,capture:"kdfSalt"},{name:"PBES2Algorithms.params.iterationCount",tagClass:_.Class.UNIVERSAL,type:_.Type.INTEGER,constructed:!1,capture:"kdfIterationCount"},{name:"PBES2Algorithms.params.keyLength",tagClass:_.Class.UNIVERSAL,type:_.Type.INTEGER,constructed:!1,optional:!0,capture:"keyLength"},{name:"PBES2Algorithms.params.prf",tagClass:_.Class.UNIVERSAL,type:_.Type.SEQUENCE,constructed:!0,optional:!0,value:[{name:"PBES2Algorithms.params.prf.algorithm",tagClass:_.Class.UNIVERSAL,type:_.Type.OID,constructed:!1,capture:"prfOid"}]}]}]},{name:"PBES2Algorithms.encryptionScheme",tagClass:_.Class.UNIVERSAL,type:_.Type.SEQUENCE,constructed:!0,value:[{name:"PBES2Algorithms.encryptionScheme.oid",tagClass:_.Class.UNIVERSAL,type:_.Type.OID,constructed:!1,capture:"encOid"},{name:"PBES2Algorithms.encryptionScheme.iv",tagClass:_.Class.UNIVERSAL,type:_.Type.OCTETSTRING,constructed:!1,capture:"encIv"}]}]},Ny={name:"pkcs-12PbeParams",tagClass:_.Class.UNIVERSAL,type:_.Type.SEQUENCE,constructed:!0,value:[{name:"pkcs-12PbeParams.salt",tagClass:_.Class.UNIVERSAL,type:_.Type.OCTETSTRING,constructed:!1,capture:"salt"},{name:"pkcs-12PbeParams.iterations",tagClass:_.Class.UNIVERSAL,type:_.Type.INTEGER,constructed:!1,capture:"iterations"}]};$.encryptPrivateKeyInfo=function(t,e,r){r=r||{},r.saltSize=r.saltSize||8,r.count=r.count||2048,r.algorithm=r.algorithm||"aes128",r.prfAlgorithm=r.prfAlgorithm||"sha1";var n=N.random.getBytesSync(r.saltSize),s=r.count,i=_.integerToDer(s),o,a,f;if(r.algorithm.indexOf("aes")===0||r.algorithm==="des"){var u,c,l;switch(r.algorithm){case"aes128":o=16,u=16,c=Mr["aes128-CBC"],l=N.aes.createEncryptionCipher;break;case"aes192":o=24,u=16,c=Mr["aes192-CBC"],l=N.aes.createEncryptionCipher;break;case"aes256":o=32,u=16,c=Mr["aes256-CBC"],l=N.aes.createEncryptionCipher;break;case"des":o=8,u=8,c=Mr.desCBC,l=N.des.createEncryptionCipher;break;default:var h=new Error("Cannot encrypt private key. Unknown encryption algorithm.");throw h.algorithm=r.algorithm,h}var g="hmacWith"+r.prfAlgorithm.toUpperCase(),p=dl(g),d=N.pkcs5.pbkdf2(e,n,s,o,p),y=N.random.getBytesSync(u),m=l(d);m.start(y),m.update(_.toDer(t)),m.finish(),f=m.output.getBytes();var E=Oy(n,i,o,g);a=_.create(_.Class.UNIVERSAL,_.Type.SEQUENCE,!0,[_.create(_.Class.UNIVERSAL,_.Type.OID,!1,_.oidToDer(Mr.pkcs5PBES2).getBytes()),_.create(_.Class.UNIVERSAL,_.Type.SEQUENCE,!0,[_.create(_.Class.UNIVERSAL,_.Type.SEQUENCE,!0,[_.create(_.Class.UNIVERSAL,_.Type.OID,!1,_.oidToDer(Mr.pkcs5PBKDF2).getBytes()),E]),_.create(_.Class.UNIVERSAL,_.Type.SEQUENCE,!0,[_.create(_.Class.UNIVERSAL,_.Type.OID,!1,_.oidToDer(c).getBytes()),_.create(_.Class.UNIVERSAL,_.Type.OCTETSTRING,!1,y)])])])}else if(r.algorithm==="3des"){o=24;var v=new N.util.ByteBuffer(n),d=$.pbe.generatePkcs12Key(e,v,1,s,o),y=$.pbe.generatePkcs12Key(e,v,2,s,o),m=N.des.createEncryptionCipher(d);m.start(y),m.update(_.toDer(t)),m.finish(),f=m.output.getBytes(),a=_.create(_.Class.UNIVERSAL,_.Type.SEQUENCE,!0,[_.create(_.Class.UNIVERSAL,_.Type.OID,!1,_.oidToDer(Mr["pbeWithSHAAnd3-KeyTripleDES-CBC"]).getBytes()),_.create(_.Class.UNIVERSAL,_.Type.SEQUENCE,!0,[_.create(_.Class.UNIVERSAL,_.Type.OCTETSTRING,!1,n),_.create(_.Class.UNIVERSAL,_.Type.INTEGER,!1,i.getBytes())])])}else{var h=new Error("Cannot encrypt private key. Unknown encryption algorithm.");throw h.algorithm=r.algorithm,h}var C=_.create(_.Class.UNIVERSAL,_.Type.SEQUENCE,!0,[a,_.create(_.Class.UNIVERSAL,_.Type.OCTETSTRING,!1,f)]);return C};$.decryptPrivateKeyInfo=function(t,e){var r=null,n={},s=[];if(!_.validate(t,My,n,s)){var i=new Error("Cannot read encrypted private key. ASN.1 object is not a supported EncryptedPrivateKeyInfo.");throw i.errors=s,i}var o=_.derToOid(n.encryptionOid),a=$.pbe.getCipher(o,n.encryptionParams,e),f=N.util.createBuffer(n.encryptedData);return a.update(f),a.finish()&&(r=_.fromDer(a.output)),r};$.encryptedPrivateKeyToPem=function(t,e){var r={type:"ENCRYPTED PRIVATE KEY",body:_.toDer(t).getBytes()};return N.pem.encode(r,{maxline:e})};$.encryptedPrivateKeyFromPem=function(t){var e=N.pem.decode(t)[0];if(e.type!=="ENCRYPTED PRIVATE KEY"){var r=new Error('Could not convert encrypted private key from PEM; PEM header type is "ENCRYPTED PRIVATE KEY".');throw r.headerType=e.type,r}if(e.procType&&e.procType.type==="ENCRYPTED")throw new Error("Could not convert encrypted private key from PEM; PEM is encrypted.");return _.fromDer(e.body)};$.encryptRsaPrivateKey=function(t,e,r){if(r=r||{},!r.legacy){var n=$.wrapRsaPrivateKey($.privateKeyToAsn1(t));return n=$.encryptPrivateKeyInfo(n,e,r),$.encryptedPrivateKeyToPem(n)}var s,i,o,a;switch(r.algorithm){case"aes128":s="AES-128-CBC",o=16,i=N.random.getBytesSync(16),a=N.aes.createEncryptionCipher;break;case"aes192":s="AES-192-CBC",o=24,i=N.random.getBytesSync(16),a=N.aes.createEncryptionCipher;break;case"aes256":s="AES-256-CBC",o=32,i=N.random.getBytesSync(16),a=N.aes.createEncryptionCipher;break;case"3des":s="DES-EDE3-CBC",o=24,i=N.random.getBytesSync(8),a=N.des.createEncryptionCipher;break;case"des":s="DES-CBC",o=8,i=N.random.getBytesSync(8),a=N.des.createEncryptionCipher;break;default:var f=new Error('Could not encrypt RSA private key; unsupported encryption algorithm "'+r.algorithm+'".');throw f.algorithm=r.algorithm,f}var u=N.pbe.opensslDeriveBytes(e,i.substr(0,8),o),c=a(u);c.start(i),c.update(_.toDer($.privateKeyToAsn1(t))),c.finish();var l={type:"RSA PRIVATE KEY",procType:{version:"4",type:"ENCRYPTED"},dekInfo:{algorithm:s,parameters:N.util.bytesToHex(i).toUpperCase()},body:c.output.getBytes()};return N.pem.encode(l)};$.decryptRsaPrivateKey=function(t,e){var r=null,n=N.pem.decode(t)[0];if(n.type!=="ENCRYPTED PRIVATE KEY"&&n.type!=="PRIVATE KEY"&&n.type!=="RSA PRIVATE KEY"){var s=new Error('Could not convert private key from PEM; PEM header type is not "ENCRYPTED PRIVATE KEY", "PRIVATE KEY", or "RSA PRIVATE KEY".');throw s.headerType=s,s}if(n.procType&&n.procType.type==="ENCRYPTED"){var i,o;switch(n.dekInfo.algorithm){case"DES-CBC":i=8,o=N.des.createDecryptionCipher;break;case"DES-EDE3-CBC":i=24,o=N.des.createDecryptionCipher;break;case"AES-128-CBC":i=16,o=N.aes.createDecryptionCipher;break;case"AES-192-CBC":i=24,o=N.aes.createDecryptionCipher;break;case"AES-256-CBC":i=32,o=N.aes.createDecryptionCipher;break;case"RC2-40-CBC":i=5,o=function(l){return N.rc2.createDecryptionCipher(l,40)};break;case"RC2-64-CBC":i=8,o=function(l){return N.rc2.createDecryptionCipher(l,64)};break;case"RC2-128-CBC":i=16,o=function(l){return N.rc2.createDecryptionCipher(l,128)};break;default:var s=new Error('Could not decrypt private key; unsupported encryption algorithm "'+n.dekInfo.algorithm+'".');throw s.algorithm=n.dekInfo.algorithm,s}var a=N.util.hexToBytes(n.dekInfo.parameters),f=N.pbe.opensslDeriveBytes(e,a.substr(0,8),i),u=o(f);if(u.start(a),u.update(N.util.createBuffer(n.body)),u.finish())r=u.output.getBytes();else return r}else r=n.body;return n.type==="ENCRYPTED PRIVATE KEY"?r=$.decryptPrivateKeyInfo(_.fromDer(r),e):r=_.fromDer(r),r!==null&&(r=$.privateKeyFromAsn1(r)),r};$.pbe.generatePkcs12Key=function(t,e,r,n,s,i){var o,a;if(typeof i>"u"||i===null){if(!("sha1"in N.md))throw new Error('"sha1" hash algorithm unavailable.');i=N.md.sha1.create()}var f=i.digestLength,u=i.blockLength,c=new N.util.ByteBuffer,l=new N.util.ByteBuffer;if(t!=null){for(a=0;a<t.length;a++)l.putInt16(t.charCodeAt(a));l.putInt16(0)}var h=l.length(),g=e.length(),p=new N.util.ByteBuffer;p.fillWithByte(r,u);var d=u*Math.ceil(g/u),y=new N.util.ByteBuffer;for(a=0;a<d;a++)y.putByte(e.at(a%g));var m=u*Math.ceil(h/u),E=new N.util.ByteBuffer;for(a=0;a<m;a++)E.putByte(l.at(a%h));var v=y;v.putBuffer(E);for(var C=Math.ceil(s/f),b=1;b<=C;b++){var w=new N.util.ByteBuffer;w.putBytes(p.bytes()),w.putBytes(v.bytes());for(var I=0;I<n;I++)i.start(),i.update(w.getBytes()),w=i.digest();var T=new N.util.ByteBuffer;for(a=0;a<u;a++)T.putByte(w.at(a%f));var F=Math.ceil(g/u)+Math.ceil(h/u),K=new N.util.ByteBuffer;for(o=0;o<F;o++){var q=new N.util.ByteBuffer(v.getBytes(u)),X=511;for(a=T.length()-1;a>=0;a--)X=X>>8,X+=T.at(a)+q.at(a),q.setAt(a,X&255);K.putBuffer(q)}v=K,c.putBuffer(w)}return c.truncate(c.length()-s),c};$.pbe.getCipher=function(t,e,r){switch(t){case $.oids.pkcs5PBES2:return $.pbe.getCipherForPBES2(t,e,r);case $.oids["pbeWithSHAAnd3-KeyTripleDES-CBC"]:case $.oids["pbewithSHAAnd40BitRC2-CBC"]:return $.pbe.getCipherForPKCS12PBE(t,e,r);default:var n=new Error("Cannot read encrypted PBE data block. Unsupported OID.");throw n.oid=t,n.supportedOids=["pkcs5PBES2","pbeWithSHAAnd3-KeyTripleDES-CBC","pbewithSHAAnd40BitRC2-CBC"],n}};$.pbe.getCipherForPBES2=function(t,e,r){var n={},s=[];if(!_.validate(e,Ly,n,s)){var i=new Error("Cannot read password-based-encryption algorithm parameters. ASN.1 object is not a supported EncryptedPrivateKeyInfo.");throw i.errors=s,i}if(t=_.derToOid(n.kdfOid),t!==$.oids.pkcs5PBKDF2){var i=new Error("Cannot read encrypted private key. Unsupported key derivation function OID.");throw i.oid=t,i.supportedOids=["pkcs5PBKDF2"],i}if(t=_.derToOid(n.encOid),t!==$.oids["aes128-CBC"]&&t!==$.oids["aes192-CBC"]&&t!==$.oids["aes256-CBC"]&&t!==$.oids["des-EDE3-CBC"]&&t!==$.oids.desCBC){var i=new Error("Cannot read encrypted private key. Unsupported encryption scheme OID.");throw i.oid=t,i.supportedOids=["aes128-CBC","aes192-CBC","aes256-CBC","des-EDE3-CBC","desCBC"],i}var o=n.kdfSalt,a=N.util.createBuffer(n.kdfIterationCount);a=a.getInt(a.length()<<3);var f,u;switch($.oids[t]){case"aes128-CBC":f=16,u=N.aes.createDecryptionCipher;break;case"aes192-CBC":f=24,u=N.aes.createDecryptionCipher;break;case"aes256-CBC":f=32,u=N.aes.createDecryptionCipher;break;case"des-EDE3-CBC":f=24,u=N.des.createDecryptionCipher;break;case"desCBC":f=8,u=N.des.createDecryptionCipher;break}var c=pl(n.prfOid),l=N.pkcs5.pbkdf2(r,o,a,f,c),h=n.encIv,g=u(l);return g.start(h),g};$.pbe.getCipherForPKCS12PBE=function(t,e,r){var n={},s=[];if(!_.validate(e,Ny,n,s)){var i=new Error("Cannot read password-based-encryption algorithm parameters. ASN.1 object is not a supported EncryptedPrivateKeyInfo.");throw i.errors=s,i}var o=N.util.createBuffer(n.salt),a=N.util.createBuffer(n.iterations);a=a.getInt(a.length()<<3);var f,u,c;switch(t){case $.oids["pbeWithSHAAnd3-KeyTripleDES-CBC"]:f=24,u=8,c=N.des.startDecrypting;break;case $.oids["pbewithSHAAnd40BitRC2-CBC"]:f=5,u=8,c=function(d,y){var m=N.rc2.createDecryptionCipher(d,40);return m.start(y,null),m};break;default:var i=new Error("Cannot read PKCS #12 PBE data block. Unsupported OID.");throw i.oid=t,i}var l=pl(n.prfOid),h=$.pbe.generatePkcs12Key(r,o,1,a,f,l);l.start();var g=$.pbe.generatePkcs12Key(r,o,2,a,u,l);return c(h,g)};$.pbe.opensslDeriveBytes=function(t,e,r,n){if(typeof n>"u"||n===null){if(!("md5"in N.md))throw new Error('"md5" hash algorithm unavailable.');n=N.md.md5.create()}e===null&&(e="");for(var s=[hl(n,t+e)],i=16,o=1;i<r;++o,i+=16)s.push(hl(n,s[o-1]+t+e));return s.join("").substr(0,r)};function hl(t,e){return t.start().update(e).digest().getBytes()}function pl(t){var e;if(!t)e="hmacWithSHA1";else if(e=$.oids[_.derToOid(t)],!e){var r=new Error("Unsupported PRF OID.");throw r.oid=t,r.supported=["hmacWithSHA1","hmacWithSHA224","hmacWithSHA256","hmacWithSHA384","hmacWithSHA512"],r}return dl(e)}function dl(t){var e=N.md;switch(t){case"hmacWithSHA224":e=N.md.sha512;case"hmacWithSHA1":case"hmacWithSHA256":case"hmacWithSHA384":case"hmacWithSHA512":t=t.substr(8).toLowerCase();break;default:var r=new Error("Unsupported PRF algorithm.");throw r.algorithm=t,r.supported=["hmacWithSHA1","hmacWithSHA224","hmacWithSHA256","hmacWithSHA384","hmacWithSHA512"],r}if(!e||!(t in e))throw new Error("Unknown hash algorithm: "+t);return e[t].create()}function Oy(t,e,r,n){var s=_.create(_.Class.UNIVERSAL,_.Type.SEQUENCE,!0,[_.create(_.Class.UNIVERSAL,_.Type.OCTETSTRING,!1,t),_.create(_.Class.UNIVERSAL,_.Type.INTEGER,!1,e.getBytes())]);return n!=="hmacWithSHA1"&&s.value.push(_.create(_.Class.UNIVERSAL,_.Type.INTEGER,!1,N.util.hexToBytes(r.toString(16))),_.create(_.Class.UNIVERSAL,_.Type.SEQUENCE,!0,[_.create(_.Class.UNIVERSAL,_.Type.OID,!1,_.oidToDer($.oids[n]).getBytes()),_.create(_.Class.UNIVERSAL,_.Type.NULL,!1,"")])),s}});var r0=G((GE,t0)=>{var ge=ce();Rr();Ce();var ns=t0.exports=ge.sha512=ge.sha512||{};ge.md.sha512=ge.md.algorithms.sha512=ns;var Jl=ge.sha384=ge.sha512.sha384=ge.sha512.sha384||{};Jl.create=function(){return ns.create("SHA-384")};ge.md.sha384=ge.md.algorithms.sha384=Jl;ge.sha512.sha256=ge.sha512.sha256||{create:function(){return ns.create("SHA-512/256")}};ge.md["sha512/256"]=ge.md.algorithms["sha512/256"]=ge.sha512.sha256;ge.sha512.sha224=ge.sha512.sha224||{create:function(){return ns.create("SHA-512/224")}};ge.md["sha512/224"]=ge.md.algorithms["sha512/224"]=ge.sha512.sha224;ns.create=function(t){if(e0||t1(),typeof t>"u"&&(t="SHA-512"),!(t in qr))throw new Error("Invalid SHA-512 algorithm: "+t);for(var e=qr[t],r=null,n=ge.util.createBuffer(),s=new Array(80),i=0;i<80;++i)s[i]=new Array(2);var o=64;switch(t){case"SHA-384":o=48;break;case"SHA-512/256":o=32;break;case"SHA-512/224":o=28;break}var a={algorithm:t.replace("-","").toLowerCase(),blockLength:128,digestLength:o,messageLength:0,fullMessageLength:null,messageLengthSize:16};return a.start=function(){a.messageLength=0,a.fullMessageLength=a.messageLength128=[];for(var f=a.messageLengthSize/4,u=0;u<f;++u)a.fullMessageLength.push(0);n=ge.util.createBuffer(),r=new Array(e.length);for(var u=0;u<e.length;++u)r[u]=e[u].slice(0);return a},a.start(),a.update=function(f,u){u==="utf8"&&(f=ge.util.encodeUtf8(f));var c=f.length;a.messageLength+=c,c=[c/4294967296>>>0,c>>>0];for(var l=a.fullMessageLength.length-1;l>=0;--l)a.fullMessageLength[l]+=c[1],c[1]=c[0]+(a.fullMessageLength[l]/4294967296>>>0),a.fullMessageLength[l]=a.fullMessageLength[l]>>>0,c[0]=c[1]/4294967296>>>0;return n.putBytes(f),Xl(r,s,n),(n.read>2048||n.length()===0)&&n.compact(),a},a.digest=function(){var f=ge.util.createBuffer();f.putBytes(n.bytes());var u=a.fullMessageLength[a.fullMessageLength.length-1]+a.messageLengthSize,c=u&a.blockLength-1;f.putBytes(Ea.substr(0,a.blockLength-c));for(var l,h,g=a.fullMessageLength[0]*8,p=0;p<a.fullMessageLength.length-1;++p)l=a.fullMessageLength[p+1]*8,h=l/4294967296>>>0,g+=h,f.putInt32(g>>>0),g=l>>>0;f.putInt32(g);for(var d=new Array(r.length),p=0;p<r.length;++p)d[p]=r[p].slice(0);Xl(d,s,f);var y=ge.util.createBuffer(),m;t==="SHA-512"?m=d.length:t==="SHA-384"?m=d.length-2:m=d.length-4;for(var p=0;p<m;++p)y.putInt32(d[p][0]),(p!==m-1||t!=="SHA-512/224")&&y.putInt32(d[p][1]);return y},a};var Ea=null,e0=!1,_a=null,qr=null;function t1(){Ea=String.fromCharCode(128),Ea+=ge.util.fillString(String.fromCharCode(0),128),_a=[[1116352408,3609767458],[1899447441,602891725],[3049323471,3964484399],[3921009573,2173295548],[961987163,4081628472],[1508970993,3053834265],[2453635748,2937671579],[2870763221,3664609560],[3624381080,2734883394],[310598401,1164996542],[607225278,1323610764],[1426881987,3590304994],[1925078388,4068182383],[2162078206,991336113],[2614888103,633803317],[3248222580,3479774868],[3835390401,2666613458],[4022224774,944711139],[264347078,2341262773],[604807628,2007800933],[770255983,1495990901],[1249150122,1856431235],[1555081692,3175218132],[1996064986,2198950837],[2554220882,3999719339],[2821834349,766784016],[2952996808,2566594879],[3210313671,3203337956],[3336571891,1034457026],[3584528711,2466948901],[113926993,3758326383],[338241895,168717936],[666307205,1188179964],[773529912,1546045734],[1294757372,1522805485],[1396182291,2643833823],[1695183700,2343527390],[1986661051,1014477480],[2177026350,1206759142],[2456956037,344077627],[2730485921,1290863460],[2820302411,3158454273],[3259730800,3505952657],[3345764771,106217008],[3516065817,3606008344],[3600352804,1432725776],[4094571909,1467031594],[275423344,851169720],[430227734,3100823752],[506948616,1363258195],[659060556,3750685593],[883997877,3785050280],[958139571,3318307427],[1322822218,3812723403],[1537002063,2003034995],[1747873779,3602036899],[1955562222,1575990012],[2024104815,1125592928],[2227730452,2716904306],[2361852424,442776044],[2428436474,593698344],[2756734187,3733110249],[3204031479,2999351573],[3329325298,3815920427],[3391569614,3928383900],[3515267271,566280711],[3940187606,3454069534],[4118630271,4000239992],[116418474,1914138554],[174292421,2731055270],[289380356,3203993006],[460393269,320620315],[685471733,587496836],[852142971,1086792851],[1017036298,365543100],[1126000580,2618297676],[1288033470,3409855158],[1501505948,4234509866],[1607167915,987167468],[1816402316,1246189591]],qr={},qr["SHA-512"]=[[1779033703,4089235720],[3144134277,2227873595],[1013904242,4271175723],[2773480762,1595750129],[1359893119,2917565137],[2600822924,725511199],[528734635,4215389547],[1541459225,327033209]],qr["SHA-384"]=[[3418070365,3238371032],[1654270250,914150663],[2438529370,812702999],[355462360,4144912697],[1731405415,4290775857],[2394180231,1750603025],[3675008525,1694076839],[1203062813,3204075428]],qr["SHA-512/256"]=[[573645204,4230739756],[2673172387,3360449730],[596883563,1867755857],[2520282905,1497426621],[2519219938,2827943907],[3193839141,1401305490],[721525244,746961066],[246885852,2177182882]],qr["SHA-512/224"]=[[2352822216,424955298],[1944164710,2312950998],[502970286,855612546],[1738396948,1479516111],[258812777,2077511080],[2011393907,79989058],[1067287976,1780299464],[286451373,2446758561]],e0=!0}function Xl(t,e,r){for(var n,s,i,o,a,f,u,c,l,h,g,p,d,y,m,E,v,C,b,w,I,T,F,K,q,X,ue,Fe,P,M,D,k,B,O,V,W=r.length();W>=128;){for(P=0;P<16;++P)e[P][0]=r.getInt32()>>>0,e[P][1]=r.getInt32()>>>0;for(;P<80;++P)k=e[P-2],M=k[0],D=k[1],n=((M>>>19|D<<13)^(D>>>29|M<<3)^M>>>6)>>>0,s=((M<<13|D>>>19)^(D<<3|M>>>29)^(M<<26|D>>>6))>>>0,O=e[P-15],M=O[0],D=O[1],i=((M>>>1|D<<31)^(M>>>8|D<<24)^M>>>7)>>>0,o=((M<<31|D>>>1)^(M<<24|D>>>8)^(M<<25|D>>>7))>>>0,B=e[P-7],V=e[P-16],D=s+B[1]+o+V[1],e[P][0]=n+B[0]+i+V[0]+(D/4294967296>>>0)>>>0,e[P][1]=D>>>0;for(d=t[0][0],y=t[0][1],m=t[1][0],E=t[1][1],v=t[2][0],C=t[2][1],b=t[3][0],w=t[3][1],I=t[4][0],T=t[4][1],F=t[5][0],K=t[5][1],q=t[6][0],X=t[6][1],ue=t[7][0],Fe=t[7][1],P=0;P<80;++P)u=((I>>>14|T<<18)^(I>>>18|T<<14)^(T>>>9|I<<23))>>>0,c=((I<<18|T>>>14)^(I<<14|T>>>18)^(T<<23|I>>>9))>>>0,l=(q^I&(F^q))>>>0,h=(X^T&(K^X))>>>0,a=((d>>>28|y<<4)^(y>>>2|d<<30)^(y>>>7|d<<25))>>>0,f=((d<<4|y>>>28)^(y<<30|d>>>2)^(y<<25|d>>>7))>>>0,g=(d&m|v&(d^m))>>>0,p=(y&E|C&(y^E))>>>0,D=Fe+c+h+_a[P][1]+e[P][1],n=ue+u+l+_a[P][0]+e[P][0]+(D/4294967296>>>0)>>>0,s=D>>>0,D=f+p,i=a+g+(D/4294967296>>>0)>>>0,o=D>>>0,ue=q,Fe=X,q=F,X=K,F=I,K=T,D=w+s,I=b+n+(D/4294967296>>>0)>>>0,T=D>>>0,b=v,w=C,v=m,C=E,m=d,E=y,D=s+o,d=n+i+(D/4294967296>>>0)>>>0,y=D>>>0;D=t[0][1]+y,t[0][0]=t[0][0]+d+(D/4294967296>>>0)>>>0,t[0][1]=D>>>0,D=t[1][1]+E,t[1][0]=t[1][0]+m+(D/4294967296>>>0)>>>0,t[1][1]=D>>>0,D=t[2][1]+C,t[2][0]=t[2][0]+v+(D/4294967296>>>0)>>>0,t[2][1]=D>>>0,D=t[3][1]+w,t[3][0]=t[3][0]+b+(D/4294967296>>>0)>>>0,t[3][1]=D>>>0,D=t[4][1]+T,t[4][0]=t[4][0]+I+(D/4294967296>>>0)>>>0,t[4][1]=D>>>0,D=t[5][1]+K,t[5][0]=t[5][0]+F+(D/4294967296>>>0)>>>0,t[5][1]=D>>>0,D=t[6][1]+X,t[6][0]=t[6][0]+q+(D/4294967296>>>0)>>>0,t[6][1]=D>>>0,D=t[7][1]+Fe,t[7][0]=t[7][0]+ue+(D/4294967296>>>0)>>>0,t[7][1]=D>>>0,W-=128}}});var Sb={};De(Sb,{GossipSub:()=>Ii,gossipsub:()=>wb,multicodec:()=>vb});var _b=Symbol.for("@libp2p/connection");var Cb=Symbol.for("@libp2p/content-routing");var Tb=Symbol.for("@libp2p/peer-discovery");var Qa=Symbol.for("@libp2p/peer-id");var Db=Symbol.for("@libp2p/peer-routing");var wr="StrictSign",Hr="StrictNoSign",$e;(function(t){t.Accept="accept",t.Ignore="ignore",t.Reject="reject"})($e||($e={}));var Nb=Symbol.for("@libp2p/transport");var Xa;(function(t){t[t.FATAL_ALL=0]="FATAL_ALL",t[t.NO_FATAL=1]="NO_FATAL"})(Xa||(Xa={}));var U=class extends Error{code;props;constructor(e,r,n){super(e),this.code=r,this.name=n?.name??"CodeError",this.props=n??{}}};var ls=class extends EventTarget{#e=new Map;listenerCount(e){let r=this.#e.get(e);return r==null?0:r.length}addEventListener(e,r,n){super.addEventListener(e,r,n);let s=this.#e.get(e);s==null&&(s=[],this.#e.set(e,s)),s.push({callback:r,once:(n!==!0&&n!==!1&&n?.once)??!1})}removeEventListener(e,r,n){super.removeEventListener(e.toString(),r??null,n);let s=this.#e.get(e);s!=null&&(s=s.filter(({callback:i})=>i!==r),this.#e.set(e,s))}dispatchEvent(e){let r=super.dispatchEvent(e),n=this.#e.get(e.type);return n==null||(n=n.filter(({once:s})=>!s),this.#e.set(e.type,n)),r}safeDispatchEvent(e,r){return this.dispatchEvent(new Sr(e,r))}},Bi=class extends Event{detail;constructor(e,r){super(e,r),this.detail=r?.detail}},Sr=globalThis.CustomEvent??Bi;var Di={};De(Di,{base58btc:()=>ke,base58flickr:()=>fh});function ih(t,e){if(t.length>=255)throw new TypeError("Alphabet too long");for(var r=new Uint8Array(256),n=0;n<r.length;n++)r[n]=255;for(var s=0;s<t.length;s++){var i=t.charAt(s),o=i.charCodeAt(0);if(r[o]!==255)throw new TypeError(i+" is ambiguous");r[o]=s}var a=t.length,f=t.charAt(0),u=Math.log(a)/Math.log(256),c=Math.log(256)/Math.log(a);function l(p){if(p instanceof Uint8Array||(ArrayBuffer.isView(p)?p=new Uint8Array(p.buffer,p.byteOffset,p.byteLength):Array.isArray(p)&&(p=Uint8Array.from(p))),!(p instanceof Uint8Array))throw new TypeError("Expected Uint8Array");if(p.length===0)return"";for(var d=0,y=0,m=0,E=p.length;m!==E&&p[m]===0;)m++,d++;for(var v=(E-m)*c+1>>>0,C=new Uint8Array(v);m!==E;){for(var b=p[m],w=0,I=v-1;(b!==0||w<y)&&I!==-1;I--,w++)b+=256*C[I]>>>0,C[I]=b%a>>>0,b=b/a>>>0;if(b!==0)throw new Error("Non-zero carry");y=w,m++}for(var T=v-y;T!==v&&C[T]===0;)T++;for(var F=f.repeat(d);T<v;++T)F+=t.charAt(C[T]);return F}function h(p){if(typeof p!="string")throw new TypeError("Expected String");if(p.length===0)return new Uint8Array;var d=0;if(p[d]!==" "){for(var y=0,m=0;p[d]===f;)y++,d++;for(var E=(p.length-d)*u+1>>>0,v=new Uint8Array(E);p[d];){var C=r[p.charCodeAt(d)];if(C===255)return;for(var b=0,w=E-1;(C!==0||b<m)&&w!==-1;w--,b++)C+=a*v[w]>>>0,v[w]=C%256>>>0,C=C/256>>>0;if(C!==0)throw new Error("Non-zero carry");m=b,d++}if(p[d]!==" "){for(var I=E-m;I!==E&&v[I]===0;)I++;for(var T=new Uint8Array(y+(E-I)),F=y;I!==E;)T[F++]=v[I++];return T}}}function g(p){var d=h(p);if(d)return d;throw new Error(`Non-${e} character`)}return{encode:l,decodeUnsafe:h,decode:g}}var oh=ih,ah=oh,Ja=ah;var p2=new Uint8Array(0);var ec=(t,e)=>{if(t===e)return!0;if(t.byteLength!==e.byteLength)return!1;for(let r=0;r<t.byteLength;r++)if(t[r]!==e[r])return!1;return!0},Ut=t=>{if(t instanceof Uint8Array&&t.constructor.name==="Uint8Array")return t;if(t instanceof ArrayBuffer)return new Uint8Array(t);if(ArrayBuffer.isView(t))return new Uint8Array(t.buffer,t.byteOffset,t.byteLength);throw new Error("Unknown type, must be binary type")};var tc=t=>new TextEncoder().encode(t),rc=t=>new TextDecoder().decode(t);var Ai=class{constructor(e,r,n){this.name=e,this.prefix=r,this.baseEncode=n}encode(e){if(e instanceof Uint8Array)return`${this.prefix}${this.baseEncode(e)}`;throw Error("Unknown type, must be binary type")}},Ti=class{constructor(e,r,n){if(this.name=e,this.prefix=r,r.codePointAt(0)===void 0)throw new Error("Invalid prefix character");this.prefixCodePoint=r.codePointAt(0),this.baseDecode=n}decode(e){if(typeof e=="string"){if(e.codePointAt(0)!==this.prefixCodePoint)throw Error(`Unable to decode multibase string ${JSON.stringify(e)}, ${this.name} decoder only supports inputs prefixed with ${this.prefix}`);return this.baseDecode(e.slice(this.prefix.length))}else throw Error("Can only multibase decode strings")}or(e){return sc(this,e)}},Pi=class{constructor(e){this.decoders=e}or(e){return sc(this,e)}decode(e){let r=e[0],n=this.decoders[r];if(n)return n.decode(e);throw RangeError(`Unable to decode multibase string ${JSON.stringify(e)}, only inputs prefixed with ${Object.keys(this.decoders)} are supported`)}},sc=(t,e)=>new Pi({...t.decoders||{[t.prefix]:t},...e.decoders||{[e.prefix]:e}}),Ri=class{constructor(e,r,n,s){this.name=e,this.prefix=r,this.baseEncode=n,this.baseDecode=s,this.encoder=new Ai(e,r,n),this.decoder=new Ti(e,r,s)}encode(e){return this.encoder.encode(e)}decode(e){return this.decoder.decode(e)}},Gr=({name:t,prefix:e,encode:r,decode:n})=>new Ri(t,e,r,n),Jt=({prefix:t,name:e,alphabet:r})=>{let{encode:n,decode:s}=Ja(r,e);return Gr({prefix:t,name:e,encode:n,decode:i=>Ut(s(i))})},ch=(t,e,r,n)=>{let s={};for(let c=0;c<e.length;++c)s[e[c]]=c;let i=t.length;for(;t[i-1]==="=";)--i;let o=new Uint8Array(i*r/8|0),a=0,f=0,u=0;for(let c=0;c<i;++c){let l=s[t[c]];if(l===void 0)throw new SyntaxError(`Non-${n} character`);f=f<<r|l,a+=r,a>=8&&(a-=8,o[u++]=255&f>>a)}if(a>=r||255&f<<8-a)throw new SyntaxError("Unexpected end of data");return o},uh=(t,e,r)=>{let n=e[e.length-1]==="=",s=(1<<r)-1,i="",o=0,a=0;for(let f=0;f<t.length;++f)for(a=a<<8|t[f],o+=8;o>r;)o-=r,i+=e[s&a>>o];if(o&&(i+=e[s&a<<r-o]),n)for(;i.length*r&7;)i+="=";return i},Ee=({name:t,prefix:e,bitsPerChar:r,alphabet:n})=>Gr({prefix:e,name:t,encode(s){return uh(s,n,r)},decode(s){return ch(s,n,r,t)}});var ke=Jt({name:"base58btc",prefix:"z",alphabet:"123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"}),fh=Jt({name:"base58flickr",prefix:"Z",alphabet:"123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ"});var ki={};De(ki,{base10:()=>lh});var lh=Jt({prefix:"9",name:"base10",alphabet:"0123456789"});var Mi={};De(Mi,{base16:()=>hh,base16upper:()=>ph});var hh=Ee({prefix:"f",name:"base16",alphabet:"0123456789abcdef",bitsPerChar:4}),ph=Ee({prefix:"F",name:"base16upper",alphabet:"0123456789ABCDEF",bitsPerChar:4});var Li={};De(Li,{base2:()=>dh});var dh=Ee({prefix:"0",name:"base2",alphabet:"01",bitsPerChar:1});var Ni={};De(Ni,{base256emoji:()=>xh});var ic=Array.from("\u{1F680}\u{1FA90}\u2604\u{1F6F0}\u{1F30C}\u{1F311}\u{1F312}\u{1F313}\u{1F314}\u{1F315}\u{1F316}\u{1F317}\u{1F318}\u{1F30D}\u{1F30F}\u{1F30E}\u{1F409}\u2600\u{1F4BB}\u{1F5A5}\u{1F4BE}\u{1F4BF}\u{1F602}\u2764\u{1F60D}\u{1F923}\u{1F60A}\u{1F64F}\u{1F495}\u{1F62D}\u{1F618}\u{1F44D}\u{1F605}\u{1F44F}\u{1F601}\u{1F525}\u{1F970}\u{1F494}\u{1F496}\u{1F499}\u{1F622}\u{1F914}\u{1F606}\u{1F644}\u{1F4AA}\u{1F609}\u263A\u{1F44C}\u{1F917}\u{1F49C}\u{1F614}\u{1F60E}\u{1F607}\u{1F339}\u{1F926}\u{1F389}\u{1F49E}\u270C\u2728\u{1F937}\u{1F631}\u{1F60C}\u{1F338}\u{1F64C}\u{1F60B}\u{1F497}\u{1F49A}\u{1F60F}\u{1F49B}\u{1F642}\u{1F493}\u{1F929}\u{1F604}\u{1F600}\u{1F5A4}\u{1F603}\u{1F4AF}\u{1F648}\u{1F447}\u{1F3B6}\u{1F612}\u{1F92D}\u2763\u{1F61C}\u{1F48B}\u{1F440}\u{1F62A}\u{1F611}\u{1F4A5}\u{1F64B}\u{1F61E}\u{1F629}\u{1F621}\u{1F92A}\u{1F44A}\u{1F973}\u{1F625}\u{1F924}\u{1F449}\u{1F483}\u{1F633}\u270B\u{1F61A}\u{1F61D}\u{1F634}\u{1F31F}\u{1F62C}\u{1F643}\u{1F340}\u{1F337}\u{1F63B}\u{1F613}\u2B50\u2705\u{1F97A}\u{1F308}\u{1F608}\u{1F918}\u{1F4A6}\u2714\u{1F623}\u{1F3C3}\u{1F490}\u2639\u{1F38A}\u{1F498}\u{1F620}\u261D\u{1F615}\u{1F33A}\u{1F382}\u{1F33B}\u{1F610}\u{1F595}\u{1F49D}\u{1F64A}\u{1F639}\u{1F5E3}\u{1F4AB}\u{1F480}\u{1F451}\u{1F3B5}\u{1F91E}\u{1F61B}\u{1F534}\u{1F624}\u{1F33C}\u{1F62B}\u26BD\u{1F919}\u2615\u{1F3C6}\u{1F92B}\u{1F448}\u{1F62E}\u{1F646}\u{1F37B}\u{1F343}\u{1F436}\u{1F481}\u{1F632}\u{1F33F}\u{1F9E1}\u{1F381}\u26A1\u{1F31E}\u{1F388}\u274C\u270A\u{1F44B}\u{1F630}\u{1F928}\u{1F636}\u{1F91D}\u{1F6B6}\u{1F4B0}\u{1F353}\u{1F4A2}\u{1F91F}\u{1F641}\u{1F6A8}\u{1F4A8}\u{1F92C}\u2708\u{1F380}\u{1F37A}\u{1F913}\u{1F619}\u{1F49F}\u{1F331}\u{1F616}\u{1F476}\u{1F974}\u25B6\u27A1\u2753\u{1F48E}\u{1F4B8}\u2B07\u{1F628}\u{1F31A}\u{1F98B}\u{1F637}\u{1F57A}\u26A0\u{1F645}\u{1F61F}\u{1F635}\u{1F44E}\u{1F932}\u{1F920}\u{1F927}\u{1F4CC}\u{1F535}\u{1F485}\u{1F9D0}\u{1F43E}\u{1F352}\u{1F617}\u{1F911}\u{1F30A}\u{1F92F}\u{1F437}\u260E\u{1F4A7}\u{1F62F}\u{1F486}\u{1F446}\u{1F3A4}\u{1F647}\u{1F351}\u2744\u{1F334}\u{1F4A3}\u{1F438}\u{1F48C}\u{1F4CD}\u{1F940}\u{1F922}\u{1F445}\u{1F4A1}\u{1F4A9}\u{1F450}\u{1F4F8}\u{1F47B}\u{1F910}\u{1F92E}\u{1F3BC}\u{1F975}\u{1F6A9}\u{1F34E}\u{1F34A}\u{1F47C}\u{1F48D}\u{1F4E3}\u{1F942}"),gh=ic.reduce((t,e,r)=>(t[r]=e,t),[]),yh=ic.reduce((t,e,r)=>(t[e.codePointAt(0)]=r,t),[]);function mh(t){return t.reduce((e,r)=>(e+=gh[r],e),"")}function bh(t){let e=[];for(let r of t){let n=yh[r.codePointAt(0)];if(n===void 0)throw new Error(`Non-base256emoji character: ${r}`);e.push(n)}return new Uint8Array(e)}var xh=Gr({prefix:"\u{1F680}",name:"base256emoji",encode:mh,decode:bh});var Oi={};De(Oi,{base32:()=>Kt,base32hex:()=>Eh,base32hexpad:()=>Ih,base32hexpadupper:()=>Ch,base32hexupper:()=>_h,base32pad:()=>wh,base32padupper:()=>Sh,base32upper:()=>vh,base32z:()=>Bh});var Kt=Ee({prefix:"b",name:"base32",alphabet:"abcdefghijklmnopqrstuvwxyz234567",bitsPerChar:5}),vh=Ee({prefix:"B",name:"base32upper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567",bitsPerChar:5}),wh=Ee({prefix:"c",name:"base32pad",alphabet:"abcdefghijklmnopqrstuvwxyz234567=",bitsPerChar:5}),Sh=Ee({prefix:"C",name:"base32padupper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567=",bitsPerChar:5}),Eh=Ee({prefix:"v",name:"base32hex",alphabet:"0123456789abcdefghijklmnopqrstuv",bitsPerChar:5}),_h=Ee({prefix:"V",name:"base32hexupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV",bitsPerChar:5}),Ih=Ee({prefix:"t",name:"base32hexpad",alphabet:"0123456789abcdefghijklmnopqrstuv=",bitsPerChar:5}),Ch=Ee({prefix:"T",name:"base32hexpadupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV=",bitsPerChar:5}),Bh=Ee({prefix:"h",name:"base32z",alphabet:"ybndrfg8ejkmcpqxot1uwisza345h769",bitsPerChar:5});var Fi={};De(Fi,{base36:()=>Ah,base36upper:()=>Th});var Ah=Jt({prefix:"k",name:"base36",alphabet:"0123456789abcdefghijklmnopqrstuvwxyz"}),Th=Jt({prefix:"K",name:"base36upper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ"});var Ui={};De(Ui,{base64:()=>Wr,base64pad:()=>Ph,base64url:()=>Rh,base64urlpad:()=>Dh});var Wr=Ee({prefix:"m",name:"base64",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",bitsPerChar:6}),Ph=Ee({prefix:"M",name:"base64pad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",bitsPerChar:6}),Rh=Ee({prefix:"u",name:"base64url",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_",bitsPerChar:6}),Dh=Ee({prefix:"U",name:"base64urlpad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_=",bitsPerChar:6});var Ki={};De(Ki,{base8:()=>kh});var kh=Ee({prefix:"7",name:"base8",alphabet:"01234567",bitsPerChar:3});var qi={};De(qi,{identity:()=>Mh});var Mh=Gr({prefix:"\0",name:"identity",encode:t=>rc(t),decode:t=>tc(t)});var A2=new TextEncoder,T2=new TextDecoder;var zi={};De(zi,{identity:()=>Qr});var Oh=cc,oc=128,Fh=127,Uh=~Fh,Kh=Math.pow(2,31);function cc(t,e,r){e=e||[],r=r||0;for(var n=r;t>=Kh;)e[r++]=t&255|oc,t/=128;for(;t&Uh;)e[r++]=t&255|oc,t>>>=7;return e[r]=t|0,cc.bytes=r-n+1,e}var qh=Vi,Vh=128,ac=127;function Vi(t,n){var r=0,n=n||0,s=0,i=n,o,a=t.length;do{if(i>=a)throw Vi.bytes=0,new RangeError("Could not decode varint");o=t[i++],r+=s<28?(o&ac)<<s:(o&ac)*Math.pow(2,s),s+=7}while(o>=Vh);return Vi.bytes=i-n,r}var zh=Math.pow(2,7),Hh=Math.pow(2,14),Gh=Math.pow(2,21),Wh=Math.pow(2,28),jh=Math.pow(2,35),$h=Math.pow(2,42),Yh=Math.pow(2,49),Zh=Math.pow(2,56),Qh=Math.pow(2,63),Xh=function(t){return t<zh?1:t<Hh?2:t<Gh?3:t<Wh?4:t<jh?5:t<$h?6:t<Yh?7:t<Zh?8:t<Qh?9:10},Jh={encode:Oh,decode:qh,encodingLength:Xh},ep=Jh,Pn=ep;var Rn=(t,e=0)=>[Pn.decode(t,e),Pn.decode.bytes],jr=(t,e,r=0)=>(Pn.encode(t,e,r),e),$r=t=>Pn.encodingLength(t);var er=(t,e)=>{let r=e.byteLength,n=$r(t),s=n+$r(r),i=new Uint8Array(s+r);return jr(t,i,0),jr(r,i,n),i.set(e,s),new Yr(t,r,e,i)},Zr=t=>{let e=Ut(t),[r,n]=Rn(e),[s,i]=Rn(e.subarray(n)),o=e.subarray(n+i);if(o.byteLength!==s)throw new Error("Incorrect length");return new Yr(r,s,o,e)},uc=(t,e)=>{if(t===e)return!0;{let r=e;return t.code===r.code&&t.size===r.size&&r.bytes instanceof Uint8Array&&ec(t.bytes,r.bytes)}},Yr=class{constructor(e,r,n,s){this.code=e,this.size=r,this.digest=n,this.bytes=s}};var fc=0,tp="identity",lc=Ut,rp=t=>er(fc,lc(t)),Qr={code:fc,name:tp,encode:lc,digest:rp};var Wi={};De(Wi,{sha256:()=>Pe,sha512:()=>np});var Gi=({name:t,code:e,encode:r})=>new Hi(t,e,r),Hi=class{constructor(e,r,n){this.name=e,this.code=r,this.encode=n}digest(e){if(e instanceof Uint8Array){let r=this.encode(e);return r instanceof Uint8Array?er(this.code,r):r.then(n=>er(this.code,n))}else throw Error("Unknown type, must be binary type")}};var pc=t=>async e=>new Uint8Array(await crypto.subtle.digest(t,e)),Pe=Gi({name:"sha2-256",code:18,encode:pc("SHA-256")}),np=Gi({name:"sha2-512",code:19,encode:pc("SHA-512")});var dc=(t,e)=>{let{bytes:r,version:n}=t;switch(n){case 0:return ip(r,ji(t),e||ke.encoder);default:return op(r,ji(t),e||Kt.encoder)}};var gc=new WeakMap,ji=t=>{let e=gc.get(t);if(e==null){let r=new Map;return gc.set(t,r),r}return e},tr=class t{constructor(e,r,n,s){this.code=r,this.version=e,this.multihash=n,this.bytes=s,this["/"]=s}get asCID(){return this}get byteOffset(){return this.bytes.byteOffset}get byteLength(){return this.bytes.byteLength}toV0(){switch(this.version){case 0:return this;case 1:{let{code:e,multihash:r}=this;if(e!==Dn)throw new Error("Cannot convert a non dag-pb CID to CIDv0");if(r.code!==ap)throw new Error("Cannot convert non sha2-256 multihash CID to CIDv0");return t.createV0(r)}default:throw Error(`Can not convert CID version ${this.version} to version 0. This is a bug please report`)}}toV1(){switch(this.version){case 0:{let{code:e,digest:r}=this.multihash,n=er(e,r);return t.createV1(this.code,n)}case 1:return this;default:throw Error(`Can not convert CID version ${this.version} to version 1. This is a bug please report`)}}equals(e){return t.equals(this,e)}static equals(e,r){let n=r;return n&&e.code===n.code&&e.version===n.version&&uc(e.multihash,n.multihash)}toString(e){return dc(this,e)}toJSON(){return{"/":dc(this)}}link(){return this}get[Symbol.toStringTag](){return"CID"}[Symbol.for("nodejs.util.inspect.custom")](){return`CID(${this.toString()})`}static asCID(e){if(e==null)return null;let r=e;if(r instanceof t)return r;if(r["/"]!=null&&r["/"]===r.bytes||r.asCID===r){let{version:n,code:s,multihash:i,bytes:o}=r;return new t(n,s,i,o||yc(n,s,i.bytes))}else if(r[cp]===!0){let{version:n,multihash:s,code:i}=r,o=Zr(s);return t.create(n,i,o)}else return null}static create(e,r,n){if(typeof r!="number")throw new Error("String codecs are no longer supported");if(!(n.bytes instanceof Uint8Array))throw new Error("Invalid digest");switch(e){case 0:{if(r!==Dn)throw new Error(`Version 0 CID must use dag-pb (code: ${Dn}) block encoding`);return new t(e,r,n,n.bytes)}case 1:{let s=yc(e,r,n.bytes);return new t(e,r,n,s)}default:throw new Error("Invalid version")}}static createV0(e){return t.create(0,Dn,e)}static createV1(e,r){return t.create(1,e,r)}static decode(e){let[r,n]=t.decodeFirst(e);if(n.length)throw new Error("Incorrect length");return r}static decodeFirst(e){let r=t.inspectBytes(e),n=r.size-r.multihashSize,s=Ut(e.subarray(n,n+r.multihashSize));if(s.byteLength!==r.multihashSize)throw new Error("Incorrect length");let i=s.subarray(r.multihashSize-r.digestSize),o=new Yr(r.multihashCode,r.digestSize,i,s);return[r.version===0?t.createV0(o):t.createV1(r.codec,o),e.subarray(r.size)]}static inspectBytes(e){let r=0,n=()=>{let[l,h]=Rn(e.subarray(r));return r+=h,l},s=n(),i=Dn;if(s===18?(s=0,r=0):i=n(),s!==0&&s!==1)throw new RangeError(`Invalid CID version ${s}`);let o=r,a=n(),f=n(),u=r+f,c=u-o;return{version:s,codec:i,multihashCode:a,digestSize:f,multihashSize:c,size:u}}static parse(e,r){let[n,s]=sp(e,r),i=t.decode(s);if(i.version===0&&e[0]!=="Q")throw Error("Version 0 CID string must not include multibase prefix");return ji(i).set(n,e),i}},sp=(t,e)=>{switch(t[0]){case"Q":{let r=e||ke;return[ke.prefix,r.decode(`${ke.prefix}${t}`)]}case ke.prefix:{let r=e||ke;return[ke.prefix,r.decode(t)]}case Kt.prefix:{let r=e||Kt;return[Kt.prefix,r.decode(t)]}default:{if(e==null)throw Error("To parse non base32 or base58btc encoded CID multibase decoder must be provided");return[t[0],e.decode(t)]}}},ip=(t,e,r)=>{let{prefix:n}=r;if(n!==ke.prefix)throw Error(`Cannot string encode V0 in ${r.name} encoding`);let s=e.get(n);if(s==null){let i=r.encode(t).slice(1);return e.set(n,i),i}else return s},op=(t,e,r)=>{let{prefix:n}=r,s=e.get(n);if(s==null){let i=r.encode(t);return e.set(n,i),i}else return s},Dn=112,ap=18,yc=(t,e,r)=>{let n=$r(t),s=n+$r(e),i=new Uint8Array(s+r.byteLength);return jr(t,i,0),jr(e,i,n),i.set(r,s),i},cp=Symbol.for("@ipld/js-cid/CID");var rr={...qi,...Li,...Ki,...ki,...Mi,...Oi,...Fi,...Di,...Ui,...Ni},G2={...Wi,...zi};function qe(t,e){if(t===e)return!0;if(t.byteLength!==e.byteLength)return!1;for(let r=0;r<t.byteLength;r++)if(t[r]!==e[r])return!1;return!0}var up=Symbol.for("nodejs.util.inspect.custom"),mc=Object.values(rr).map(t=>t.decoder).reduce((t,e)=>t.or(e),rr.identity.decoder),bc=114,xc=36,vc=37,kn=class{type;multihash;privateKey;publicKey;string;constructor(e){this.type=e.type,this.multihash=e.multihash,this.privateKey=e.privateKey,Object.defineProperty(this,"string",{enumerable:!1,writable:!0})}get[Symbol.toStringTag](){return`PeerId(${this.toString()})`}[Qa]=!0;toString(){return this.string==null&&(this.string=ke.encode(this.multihash.bytes).slice(1)),this.string}toCID(){return tr.createV1(bc,this.multihash)}toBytes(){return this.multihash.bytes}toJSON(){return this.toString()}equals(e){if(e instanceof Uint8Array)return qe(this.multihash.bytes,e);if(typeof e=="string")return _r(e).equals(this);if(e?.multihash?.bytes!=null)return qe(this.multihash.bytes,e.multihash.bytes);throw new Error("not valid Id")}[up](){return`PeerId(${this.toString()})`}},Mn=class extends kn{type="RSA";publicKey;constructor(e){super({...e,type:"RSA"}),this.publicKey=e.publicKey}},Ln=class extends kn{type="Ed25519";publicKey;constructor(e){super({...e,type:"Ed25519"}),this.publicKey=e.multihash.digest}},Nn=class extends kn{type="secp256k1";publicKey;constructor(e){super({...e,type:"secp256k1"}),this.publicKey=e.multihash.digest}};function _r(t,e){if(e=e??mc,t.charAt(0)==="1"||t.charAt(0)==="Q"){let r=Zr(ke.decode(`z${t}`));return t.startsWith("12D")?new Ln({multihash:r}):t.startsWith("16U")?new Nn({multihash:r}):new Mn({multihash:r})}return Xr(mc.decode(t))}function Xr(t){try{let e=Zr(t);if(e.code===Qr.code){if(e.digest.length===xc)return new Ln({multihash:e});if(e.digest.length===vc)return new Nn({multihash:e})}if(e.code===Pe.code)return new Mn({multihash:e})}catch{return fp(tr.decode(t))}throw new Error("Supplied PeerID CID is invalid")}function fp(t){if(t==null||t.multihash==null||t.version==null||t.version===1&&t.code!==bc)throw new Error("Supplied PeerID CID is invalid");let e=t.multihash;if(e.code===Pe.code)return new Mn({multihash:t.multihash});if(e.code===Qr.code){if(e.digest.length===xc)return new Ln({multihash:t.multihash});if(e.digest.length===vc)return new Nn({multihash:t.multihash})}throw new Error("Supplied PeerID CID is invalid")}function ps(){let t={};return t.promise=new Promise((e,r)=>{t.resolve=e,t.reject=r}),t}var ds=class{buffer;mask;top;btm;next;constructor(e){if(!(e>0)||e-1&e)throw new Error("Max size for a FixedFIFO should be a power of two");this.buffer=new Array(e),this.mask=e-1,this.top=0,this.btm=0,this.next=null}push(e){return this.buffer[this.top]!==void 0?!1:(this.buffer[this.top]=e,this.top=this.top+1&this.mask,!0)}shift(){let e=this.buffer[this.btm];if(e!==void 0)return this.buffer[this.btm]=void 0,this.btm=this.btm+1&this.mask,e}isEmpty(){return this.buffer[this.btm]===void 0}},Jr=class{size;hwm;head;tail;constructor(e={}){this.hwm=e.splitLimit??16,this.head=new ds(this.hwm),this.tail=this.head,this.size=0}calculateSize(e){return e?.byteLength!=null?e.byteLength:1}push(e){if(e?.value!=null&&(this.size+=this.calculateSize(e.value)),!this.head.push(e)){let r=this.head;this.head=r.next=new ds(2*this.head.buffer.length),this.head.push(e)}}shift(){let e=this.tail.shift();if(e===void 0&&this.tail.next!=null){let r=this.tail.next;this.tail.next=null,this.tail=r,e=this.tail.shift()}return e?.value!=null&&(this.size-=this.calculateSize(e.value)),e}isEmpty(){return this.head.isEmpty()}};var $i=class extends Error{type;code;constructor(e,r){super(e??"The operation was aborted"),this.type="aborted",this.code=r??"ABORT_ERR"}};function qt(t={}){return lp(r=>{let n=r.shift();if(n==null)return{done:!0};if(n.error!=null)throw n.error;return{done:n.done===!0,value:n.value}},t)}function lp(t,e){e=e??{};let r=e.onEnd,n=new Jr,s,i,o,a=ps(),f=async()=>{try{return n.isEmpty()?o?{done:!0}:await new Promise((y,m)=>{i=E=>{i=null,n.push(E);try{y(t(n))}catch(v){m(v)}return s}}):t(n)}finally{n.isEmpty()&&queueMicrotask(()=>{a.resolve(),a=ps()})}},u=y=>i!=null?i(y):(n.push(y),s),c=y=>(n=new Jr,i!=null?i({error:y}):(n.push({error:y}),s)),l=y=>{if(o)return s;if(e?.objectMode!==!0&&y?.byteLength==null)throw new Error("objectMode was not true but tried to push non-Uint8Array value");return u({done:!1,value:y})},h=y=>o?s:(o=!0,y!=null?c(y):u({done:!0})),g=()=>(n=new Jr,h(),{done:!0}),p=y=>(h(y),{done:!0});if(s={[Symbol.asyncIterator](){return this},next:f,return:g,throw:p,push:l,end:h,get readableLength(){return n.size},onEmpty:async y=>{let m=y?.signal;if(m?.throwIfAborted(),n.isEmpty())return;let E,v;m!=null&&(E=new Promise((C,b)=>{v=()=>{b(new $i)},m.addEventListener("abort",v)}));try{await Promise.race([a.promise,E])}finally{v!=null&&m!=null&&m?.removeEventListener("abort",v)}}},r==null)return s;let d=s;return s={[Symbol.asyncIterator](){return this},next(){return d.next()},throw(y){return d.throw(y),r!=null&&(r(y),r=void 0),{done:!0}},return(){return d.return(),r!=null&&(r(),r=void 0),{done:!0}},push:l,end(y){return d.end(y),r!=null&&(r(y),r=void 0),s},get readableLength(){return d.readableLength}},s}function hp(t){return t[Symbol.asyncIterator]!=null}function pp(...t){let e=[];for(let r of t)hp(r)||e.push(r);return e.length===t.length?function*(){for(let r of e)yield*r}():async function*(){let r=qt({objectMode:!0});Promise.resolve().then(async()=>{try{await Promise.all(t.map(async n=>{for await(let s of n)r.push(s)})),r.end()}catch(n){r.end(n)}}),yield*r}()}var wc=pp;function en(t,...e){if(t==null)throw new Error("Empty pipeline");if(Yi(t)){let n=t;t=()=>n.source}else if(Ec(t)||Sc(t)){let n=t;t=()=>n}let r=[t,...e];if(r.length>1&&Yi(r[r.length-1])&&(r[r.length-1]=r[r.length-1].sink),r.length>2)for(let n=1;n<r.length-1;n++)Yi(r[n])&&(r[n]=gp(r[n]));return dp(...r)}var dp=(...t)=>{let e;for(;t.length>0;)e=t.shift()(e);return e},Sc=t=>t?.[Symbol.asyncIterator]!=null,Ec=t=>t?.[Symbol.iterator]!=null,Yi=t=>t==null?!1:t.sink!=null&&t.source!=null,gp=t=>e=>{let r=t.sink(e);if(r?.then!=null){let n=qt({objectMode:!0});r.then(()=>{n.end()},o=>{n.end(o)});let s,i=t.source;if(Sc(i))s=async function*(){yield*i,n.end()};else if(Ec(i))s=function*(){yield*i,n.end()};else throw new Error("Unknown duplex source type - must be Iterable or AsyncIterable");return wc(n,s())}return t.source};var Zi="/floodsub/1.0.0",Qi="/meshsub/1.0.0",gs="/meshsub/1.1.0";var _c="ERR_TOPIC_VALIDATOR_REJECT",Ic="ERR_TOPIC_VALIDATOR_IGNORE";var Su=Se(lo(),1),Eu={maxSubscriptions:1/0,maxMessages:1/0,maxIhaveMessageIDs:1/0,maxIwantMessageIDs:1/0,maxControlMessages:1/0,maxPeerInfos:1/0};function _u(t,e){e={...e};let r=Su.default.Reader.create(t),n=t.length,s=n===void 0?r.len:r.pos+n,i={};for(;r.pos<s;){let o=r.uint32();switch(o>>>3){case 1:i.subscriptions!=null&&i.subscriptions.length>0||(i.subscriptions=[]),i.subscriptions.length<e.maxSubscriptions?i.subscriptions.push(Cp(r,r.uint32())):r.skipType(o&7);break;case 2:i.messages!=null&&i.messages.length>0||(i.messages=[]),i.messages.length<e.maxMessages?i.messages.push(Bp(r,r.uint32())):r.skipType(o&7);break;case 3:i.control=Ap(r,r.uint32(),e);break;default:r.skipType(o&7);break}}return i}function Cp(t,e){let r=e===void 0?t.len:t.pos+e,n={};for(;t.pos<r;){let s=t.uint32();switch(s>>>3){case 1:n.subscribe=t.bool();break;case 2:n.topic=t.string();break;default:t.skipType(s&7);break}}return n}function Bp(t,e){let r=e===void 0?t.len:t.pos+e,n={};for(;t.pos<r;){let s=t.uint32();switch(s>>>3){case 1:n.from=t.bytes();break;case 2:n.data=t.bytes();break;case 3:n.seqno=t.bytes();break;case 4:n.topic=t.string();break;case 5:n.signature=t.bytes();break;case 6:n.key=t.bytes();break;default:t.skipType(s&7);break}}if(!n.topic)throw Error("missing required 'topic'");return n}function Ap(t,e,r){let n=e===void 0?t.len:t.pos+e,s={};for(;t.pos<n;){let i=t.uint32();switch(i>>>3){case 1:s.ihave!=null&&s.ihave.length>0||(s.ihave=[]),s.ihave.length<r.maxControlMessages?s.ihave.push(Tp(t,t.uint32(),r)):t.skipType(i&7);break;case 2:s.iwant!=null&&s.iwant.length>0||(s.iwant=[]),s.iwant.length<r.maxControlMessages?s.iwant.push(Pp(t,t.uint32(),r)):t.skipType(i&7);break;case 3:s.graft!=null&&s.graft.length>0||(s.graft=[]),s.graft.length<r.maxControlMessages?s.graft.push(Rp(t,t.uint32())):t.skipType(i&7);break;case 4:s.prune!=null&&s.prune.length>0||(s.prune=[]),s.prune.length<r.maxControlMessages?s.prune.push(Dp(t,t.uint32(),r)):t.skipType(i&7);break;default:t.skipType(i&7);break}}return s}function Tp(t,e,r){let n=e===void 0?t.len:t.pos+e,s={};for(;t.pos<n;){let i=t.uint32();switch(i>>>3){case 1:s.topicID=t.string();break;case 2:s.messageIDs!=null&&s.messageIDs.length>0||(s.messageIDs=[]),r.maxIhaveMessageIDs-- >0?s.messageIDs.push(t.bytes()):t.skipType(i&7);break;default:t.skipType(i&7);break}}return s}function Pp(t,e,r){let n=e===void 0?t.len:t.pos+e,s={};for(;t.pos<n;){let i=t.uint32();switch(i>>>3){case 1:s.messageIDs!=null&&s.messageIDs.length>0||(s.messageIDs=[]),r.maxIwantMessageIDs-- >0?s.messageIDs.push(t.bytes()):t.skipType(i&7);break;default:t.skipType(i&7);break}}return s}function Rp(t,e){let r=e===void 0?t.len:t.pos+e,n={};for(;t.pos<r;){let s=t.uint32();switch(s>>>3){case 1:n.topicID=t.string();break;default:t.skipType(s&7);break}}return n}function Dp(t,e,r){let n=e===void 0?t.len:t.pos+e,s={};for(;t.pos<n;){let i=t.uint32();switch(i>>>3){case 1:s.topicID=t.string();break;case 2:s.peers!=null&&s.peers.length>0||(s.peers=[]),r.maxPeerInfos-- >0?s.peers.push(kp(t,t.uint32())):t.skipType(i&7);break;case 3:s.backoff=t.uint64();break;default:t.skipType(i&7);break}}return s}function kp(t,e){let r=e===void 0?t.len:t.pos+e,n={};for(;t.pos<r;){let s=t.uint32();switch(s>>>3){case 1:n.peerID=t.bytes();break;case 2:n.signedPeerRecord=t.bytes();break;default:t.skipType(s&7);break}}return n}var Bu=Se(Cu(),1),{RPC:qn}=Bu.default;var vs=class{gossip;msgs=new Map;msgIdToStrFn;history=[];notValidatedCount=0;constructor(e,r,n){this.gossip=e,this.msgIdToStrFn=n;for(let s=0;s<r;s++)this.history[s]=[]}get size(){return this.msgs.size}put(e,r,n=!1){let{msgIdStr:s}=e;return this.msgs.has(s)?!1:(this.msgs.set(s,{message:r,validated:n,originatingPeers:new Set,iwantCounts:new Map}),this.history[0].push({...e,topic:r.topic}),n||this.notValidatedCount++,!0)}observeDuplicate(e,r){let n=this.msgs.get(e);n!=null&&!n.validated&&n.originatingPeers.add(r)}get(e){return this.msgs.get(this.msgIdToStrFn(e))?.message}getWithIWantCount(e,r){let n=this.msgs.get(e);if(n==null)return null;let s=(n.iwantCounts.get(r)??0)+1;return n.iwantCounts.set(r,s),{msg:n.message,count:s}}getGossipIDs(e){let r=new Map;for(let n=0;n<this.gossip;n++)this.history[n].forEach(s=>{if((this.msgs.get(s.msgIdStr)?.validated??!1)&&e.has(s.topic)){let o=r.get(s.topic);o==null&&(o=[],r.set(s.topic,o)),o.push(s.msgId)}});return r}validate(e){let r=this.msgs.get(e);if(r==null)return null;r.validated||this.notValidatedCount--;let{message:n,originatingPeers:s}=r;return r.validated=!0,r.originatingPeers=new Set,{message:n,originatingPeers:s}}shift(){this.history[this.history.length-1].forEach(r=>{let n=this.msgs.get(r.msgIdStr);n!=null&&(this.msgs.delete(r.msgIdStr),n.validated||this.notValidatedCount--)}),this.history.pop(),this.history.unshift([])}remove(e){let r=this.msgs.get(e);return r==null?null:(this.msgs.delete(e),r)}};var Au;(function(t){t.StrictSign="StrictSign",t.StrictNoSign="StrictNoSign"})(Au||(Au={}));var or;(function(t){t[t.Signing=0]="Signing",t[t.Anonymous=1]="Anonymous"})(or||(or={}));var Ye;(function(t){t.Error="error",t.Ignore="ignore",t.Reject="reject",t.Blacklisted="blacklisted"})(Ye||(Ye={}));var ze;(function(t){t.InvalidSignature="invalid_signature",t.InvalidSeqno="invalid_seqno",t.InvalidPeerId="invalid_peerid",t.SignaturePresent="signature_present",t.SeqnoPresent="seqno_present",t.FromPresent="from_present",t.TransformFailed="transform_failed"})(ze||(ze={}));var He;(function(t){t.duplicate="duplicate",t.invalid="invalid",t.valid="valid"})(He||(He={}));function ho(t){switch(t){case $e.Ignore:return Ye.Ignore;case $e.Reject:return Ye.Reject;default:throw new Error("Unreachable")}}var Tu;(function(t){t.forward="forward",t.publish="publish"})(Tu||(Tu={}));var Ze;(function(t){t.Fanout="fanout",t.Random="random",t.Subscribed="subscribed",t.Outbound="outbound",t.NotEnough="not_enough",t.Opportunistic="opportunistic"})(Ze||(Ze={}));var bt;(function(t){t.Dc="disconnected",t.BadScore="bad_score",t.Prune="prune",t.Excess="excess"})(bt||(bt={}));var nn;(function(t){t.GraftBackoff="graft_backoff",t.BrokenPromise="broken_promise",t.MessageDeficit="message_deficit",t.IPColocation="IP_colocation"})(nn||(nn={}));var sn;(function(t){t.LowScore="low_score",t.MaxIhave="max_ihave",t.MaxIasked="max_iasked"})(sn||(sn={}));var rn;(function(t){t.graylist="graylist",t.publish="publish",t.gossip="gossip",t.mesh="mesh"})(rn||(rn={}));function Pu(t,e,r){return{protocolsEnabled:t.gauge({name:"gossipsub_protocol",help:"Status of enabled protocols",labelNames:["protocol"]}),topicSubscriptionStatus:t.gauge({name:"gossipsub_topic_subscription_status",help:"Status of our subscription to this topic",labelNames:["topicStr"]}),topicPeersCount:t.gauge({name:"gossipsub_topic_peer_count",help:"Number of peers subscribed to each topic",labelNames:["topicStr"]}),meshPeerCounts:t.gauge({name:"gossipsub_mesh_peer_count",help:"Number of peers in our mesh",labelNames:["topicStr"]}),meshPeerInclusionEventsFanout:t.gauge({name:"gossipsub_mesh_peer_inclusion_events_fanout_total",help:"Number of times we include peers in a topic mesh for fanout reasons",labelNames:["topic"]}),meshPeerInclusionEventsRandom:t.gauge({name:"gossipsub_mesh_peer_inclusion_events_random_total",help:"Number of times we include peers in a topic mesh for random reasons",labelNames:["topic"]}),meshPeerInclusionEventsSubscribed:t.gauge({name:"gossipsub_mesh_peer_inclusion_events_subscribed_total",help:"Number of times we include peers in a topic mesh for subscribed reasons",labelNames:["topic"]}),meshPeerInclusionEventsOutbound:t.gauge({name:"gossipsub_mesh_peer_inclusion_events_outbound_total",help:"Number of times we include peers in a topic mesh for outbound reasons",labelNames:["topic"]}),meshPeerInclusionEventsNotEnough:t.gauge({name:"gossipsub_mesh_peer_inclusion_events_not_enough_total",help:"Number of times we include peers in a topic mesh for not_enough reasons",labelNames:["topic"]}),meshPeerInclusionEventsOpportunistic:t.gauge({name:"gossipsub_mesh_peer_inclusion_events_opportunistic_total",help:"Number of times we include peers in a topic mesh for opportunistic reasons",labelNames:["topic"]}),meshPeerInclusionEventsUnknown:t.gauge({name:"gossipsub_mesh_peer_inclusion_events_unknown_total",help:"Number of times we include peers in a topic mesh for unknown reasons",labelNames:["topic"]}),meshPeerChurnEventsDisconnected:t.gauge({name:"gossipsub_peer_churn_events_disconnected_total",help:"Number of times we remove peers in a topic mesh for disconnected reasons",labelNames:["topic"]}),meshPeerChurnEventsBadScore:t.gauge({name:"gossipsub_peer_churn_events_bad_score_total",help:"Number of times we remove peers in a topic mesh for bad_score reasons",labelNames:["topic"]}),meshPeerChurnEventsPrune:t.gauge({name:"gossipsub_peer_churn_events_prune_total",help:"Number of times we remove peers in a topic mesh for prune reasons",labelNames:["topic"]}),meshPeerChurnEventsExcess:t.gauge({name:"gossipsub_peer_churn_events_excess_total",help:"Number of times we remove peers in a topic mesh for excess reasons",labelNames:["topic"]}),meshPeerChurnEventsUnknown:t.gauge({name:"gossipsub_peer_churn_events_unknown_total",help:"Number of times we remove peers in a topic mesh for unknown reasons",labelNames:["topic"]}),peersPerProtocol:t.gauge({name:"gossipsub_peers_per_protocol_count",help:"Peers connected for each topic",labelNames:["protocol"]}),heartbeatDuration:t.histogram({name:"gossipsub_heartbeat_duration_seconds",help:"The time it takes to complete one iteration of the heartbeat",buckets:[.01,.1,1]}),heartbeatSkipped:t.gauge({name:"gossipsub_heartbeat_skipped",help:"Heartbeat run took longer than heartbeat interval so next is skipped"}),acceptedMessagesTotal:t.gauge({name:"gossipsub_accepted_messages_total",help:"Total accepted messages for each topic",labelNames:["topic"]}),ignoredMessagesTotal:t.gauge({name:"gossipsub_ignored_messages_total",help:"Total ignored messages for each topic",labelNames:["topic"]}),rejectedMessagesTotal:t.gauge({name:"gossipsub_rejected_messages_total",help:"Total rejected messages for each topic",labelNames:["topic"]}),unknownValidationResultsTotal:t.gauge({name:"gossipsub_unknown_validation_results_total",help:"Total unknown validation results for each topic",labelNames:["topic"]}),asyncValidationMcacheHit:t.gauge({name:"gossipsub_async_validation_mcache_hit_total",help:"Async validation result reported by the user layer",labelNames:["hit"]}),asyncValidationDelayFromFirstSeenSec:t.histogram({name:"gossipsub_async_validation_delay_from_first_seen",help:"Async validation report delay from first seen in second",labelNames:["topic"],buckets:[.01,.03,.1,.3,1,3,10]}),asyncValidationUnknownFirstSeen:t.gauge({name:"gossipsub_async_validation_unknown_first_seen_count_total",help:"Async validation report unknown first seen value for message"}),peerReadStreamError:t.gauge({name:"gossipsub_peer_read_stream_err_count_total",help:"Peer read stream error"}),rpcRecvBytes:t.gauge({name:"gossipsub_rpc_recv_bytes_total",help:"RPC recv"}),rpcRecvCount:t.gauge({name:"gossipsub_rpc_recv_count_total",help:"RPC recv"}),rpcRecvSubscription:t.gauge({name:"gossipsub_rpc_recv_subscription_total",help:"RPC recv"}),rpcRecvMessage:t.gauge({name:"gossipsub_rpc_recv_message_total",help:"RPC recv"}),rpcRecvControl:t.gauge({name:"gossipsub_rpc_recv_control_total",help:"RPC recv"}),rpcRecvIHave:t.gauge({name:"gossipsub_rpc_recv_ihave_total",help:"RPC recv"}),rpcRecvIWant:t.gauge({name:"gossipsub_rpc_recv_iwant_total",help:"RPC recv"}),rpcRecvGraft:t.gauge({name:"gossipsub_rpc_recv_graft_total",help:"RPC recv"}),rpcRecvPrune:t.gauge({name:"gossipsub_rpc_recv_prune_total",help:"RPC recv"}),rpcDataError:t.gauge({name:"gossipsub_rpc_data_err_count_total",help:"RPC data error"}),rpcRecvError:t.gauge({name:"gossipsub_rpc_recv_err_count_total",help:"RPC recv error"}),rpcRecvNotAccepted:t.gauge({name:"gossipsub_rpc_rcv_not_accepted_total",help:"Total count of RPC dropped because acceptFrom() == false"}),rpcSentBytes:t.gauge({name:"gossipsub_rpc_sent_bytes_total",help:"RPC sent"}),rpcSentCount:t.gauge({name:"gossipsub_rpc_sent_count_total",help:"RPC sent"}),rpcSentSubscription:t.gauge({name:"gossipsub_rpc_sent_subscription_total",help:"RPC sent"}),rpcSentMessage:t.gauge({name:"gossipsub_rpc_sent_message_total",help:"RPC sent"}),rpcSentControl:t.gauge({name:"gossipsub_rpc_sent_control_total",help:"RPC sent"}),rpcSentIHave:t.gauge({name:"gossipsub_rpc_sent_ihave_total",help:"RPC sent"}),rpcSentIWant:t.gauge({name:"gossipsub_rpc_sent_iwant_total",help:"RPC sent"}),rpcSentGraft:t.gauge({name:"gossipsub_rpc_sent_graft_total",help:"RPC sent"}),rpcSentPrune:t.gauge({name:"gossipsub_rpc_sent_prune_total",help:"RPC sent"}),msgPublishCount:t.gauge({name:"gossipsub_msg_publish_count_total",help:"Total count of msg published by topic",labelNames:["topic"]}),msgPublishPeersByTopic:t.gauge({name:"gossipsub_msg_publish_peers_total",help:"Total count of peers that we publish a msg to",labelNames:["topic"]}),directPeersPublishedTotal:t.gauge({name:"gossipsub_direct_peers_published_total",help:"Total direct peers that we publish a msg to",labelNames:["topic"]}),floodsubPeersPublishedTotal:t.gauge({name:"gossipsub_floodsub_peers_published_total",help:"Total floodsub peers that we publish a msg to",labelNames:["topic"]}),meshPeersPublishedTotal:t.gauge({name:"gossipsub_mesh_peers_published_total",help:"Total mesh peers that we publish a msg to",labelNames:["topic"]}),fanoutPeersPublishedTotal:t.gauge({name:"gossipsub_fanout_peers_published_total",help:"Total fanout peers that we publish a msg to",labelNames:["topic"]}),msgPublishBytes:t.gauge({name:"gossipsub_msg_publish_bytes_total",help:"Total count of msg publish data.length bytes",labelNames:["topic"]}),msgPublishTime:t.histogram({name:"gossipsub_msg_publish_seconds",help:"Total time in seconds to publish a message",buckets:[.001,.002,.005,.01,.1,.5,1],labelNames:["topic"]}),msgForwardCount:t.gauge({name:"gossipsub_msg_forward_count_total",help:"Total count of msg forwarded by topic",labelNames:["topic"]}),msgForwardPeers:t.gauge({name:"gossipsub_msg_forward_peers_total",help:"Total count of peers that we forward a msg to",labelNames:["topic"]}),msgReceivedPreValidation:t.gauge({name:"gossipsub_msg_received_prevalidation_total",help:"Total count of recv msgs before any validation",labelNames:["topic"]}),msgReceivedError:t.gauge({name:"gossipsub_msg_received_error_total",help:"Total count of recv msgs error",labelNames:["topic"]}),prevalidationInvalidTotal:t.gauge({name:"gossipsub_pre_validation_invalid_total",help:"Total count of invalid messages received",labelNames:["topic"]}),prevalidationValidTotal:t.gauge({name:"gossipsub_pre_validation_valid_total",help:"Total count of valid messages received",labelNames:["topic"]}),prevalidationDuplicateTotal:t.gauge({name:"gossipsub_pre_validation_duplicate_total",help:"Total count of duplicate messages received",labelNames:["topic"]}),prevalidationUnknownTotal:t.gauge({name:"gossipsub_pre_validation_unknown_status_total",help:"Total count of unknown_status messages received",labelNames:["topic"]}),msgReceivedInvalid:t.gauge({name:"gossipsub_msg_received_invalid_total",help:"Tracks specific reason of invalid",labelNames:["error"]}),msgReceivedInvalidByTopic:t.gauge({name:"gossipsub_msg_received_invalid_by_topic_total",help:"Tracks specific invalid message by topic",labelNames:["topic"]}),duplicateMsgDeliveryDelay:t.histogram({name:"gossisub_duplicate_msg_delivery_delay_seconds",help:"Time since the 1st duplicated message validated",labelNames:["topic"],buckets:[.25*r.maxMeshMessageDeliveriesWindowSec,.5*r.maxMeshMessageDeliveriesWindowSec,Number(r.maxMeshMessageDeliveriesWindowSec),2*r.maxMeshMessageDeliveriesWindowSec,4*r.maxMeshMessageDeliveriesWindowSec]}),duplicateMsgLateDelivery:t.gauge({name:"gossisub_duplicate_msg_late_delivery_total",help:"Total count of late duplicate message delivery by topic, which triggers P3 penalty",labelNames:["topic"]}),duplicateMsgIgnored:t.gauge({name:"gossisub_ignored_published_duplicate_msgs_total",help:"Total count of published duplicate message ignored by topic",labelNames:["topic"]}),scoreFnCalls:t.gauge({name:"gossipsub_score_fn_calls_total",help:"Total times score() is called"}),scoreFnRuns:t.gauge({name:"gossipsub_score_fn_runs_total",help:"Total times score() call actually computed computeScore(), no cache"}),scoreCachedDelta:t.histogram({name:"gossipsub_score_cache_delta",help:"Delta of score between cached values that expired",buckets:[10,100,1e3]}),peersByScoreThreshold:t.gauge({name:"gossipsub_peers_by_score_threshold_count",help:"Current count of peers by score threshold",labelNames:["threshold"]}),score:t.avgMinMax({name:"gossipsub_score",help:"Avg min max of gossip scores"}),scoreWeights:t.avgMinMax({name:"gossipsub_score_weights",help:"Separate score weights",labelNames:["topic","p"]}),scorePerMesh:t.avgMinMax({name:"gossipsub_score_per_mesh",help:"Histogram of the scores for each mesh topic",labelNames:["topic"]}),scoringPenalties:t.gauge({name:"gossipsub_scoring_penalties_total",help:"A counter of the kind of penalties being applied to peers",labelNames:["penalty"]}),behaviourPenalty:t.histogram({name:"gossipsub_peer_stat_behaviour_penalty",help:"Current peer stat behaviour_penalty at each scrape",buckets:[.25*r.behaviourPenaltyThreshold,.5*r.behaviourPenaltyThreshold,Number(r.behaviourPenaltyThreshold),2*r.behaviourPenaltyThreshold,4*r.behaviourPenaltyThreshold]}),ihaveRcvIgnored:t.gauge({name:"gossipsub_ihave_rcv_ignored_total",help:"Total received IHAVE messages that we ignore for some reason",labelNames:["reason"]}),ihaveRcvMsgids:t.gauge({name:"gossipsub_ihave_rcv_msgids_total",help:"Total received IHAVE messages by topic",labelNames:["topic"]}),ihaveRcvNotSeenMsgids:t.gauge({name:"gossipsub_ihave_rcv_not_seen_msgids_total",help:"Total messages per topic we do not have, not actual requests",labelNames:["topic"]}),iwantRcvMsgids:t.gauge({name:"gossipsub_iwant_rcv_msgids_total",help:"Total received IWANT messages by topic",labelNames:["topic"]}),iwantRcvDonthaveMsgids:t.gauge({name:"gossipsub_iwant_rcv_dont_have_msgids_total",help:"Total requested messageIDs that we do not have"}),iwantPromiseStarted:t.gauge({name:"gossipsub_iwant_promise_sent_total",help:"Total count of started IWANT promises"}),iwantPromiseResolved:t.gauge({name:"gossipsub_iwant_promise_resolved_total",help:"Total count of resolved IWANT promises"}),iwantPromiseResolvedFromDuplicate:t.gauge({name:"gossipsub_iwant_promise_resolved_from_duplicate_total",help:"Total count of resolved IWANT promises from duplicate messages"}),iwantPromiseResolvedPeers:t.gauge({name:"gossipsub_iwant_promise_resolved_peers",help:"Total count of peers we have asked IWANT promises that are resolved"}),iwantPromiseBroken:t.gauge({name:"gossipsub_iwant_promise_broken",help:"Total count of broken IWANT promises"}),iwantMessagePruned:t.gauge({name:"gossipsub_iwant_message_pruned",help:"Total count of pruned IWANT messages"}),iwantPromiseDeliveryTime:t.histogram({name:"gossipsub_iwant_promise_delivery_seconds",help:"Histogram of delivery time of resolved IWANT promises",buckets:[.5*r.gossipPromiseExpireSec,Number(r.gossipPromiseExpireSec),2*r.gossipPromiseExpireSec,4*r.gossipPromiseExpireSec]}),iwantPromiseUntracked:t.gauge({name:"gossip_iwant_promise_untracked",help:"Total count of untracked IWANT promise"}),connectedPeersBackoffSec:t.histogram({name:"gossipsub_connected_peers_backoff_seconds",help:"Backoff time in seconds",buckets:[1,2,4,10,20,60,120]}),cacheSize:t.gauge({name:"gossipsub_cache_size",help:"Unbounded cache sizes",labelNames:["cache"]}),mcacheSize:t.gauge({name:"gossipsub_mcache_size",help:"Current mcache msg count"}),mcacheNotValidatedCount:t.gauge({name:"gossipsub_mcache_not_validated_count",help:"Current mcache msg count not validated"}),fastMsgIdCacheCollision:t.gauge({name:"gossipsub_fastmsgid_cache_collision_total",help:"Total count of key collisions on fastmsgid cache put"}),newConnectionCount:t.gauge({name:"gossipsub_new_connection_total",help:"Total new connection by status",labelNames:["status"]}),topicStrToLabel:e,toTopic(n){return this.topicStrToLabel.get(n)??n},onJoin(n){this.topicSubscriptionStatus.set({topicStr:n},1),this.meshPeerCounts.set({topicStr:n},0)},onLeave(n){this.topicSubscriptionStatus.set({topicStr:n},0),this.meshPeerCounts.set({topicStr:n},0)},onAddToMesh(n,s,i){let o=this.toTopic(n);switch(s){case Ze.Fanout:this.meshPeerInclusionEventsFanout.inc({topic:o},i);break;case Ze.Random:this.meshPeerInclusionEventsRandom.inc({topic:o},i);break;case Ze.Subscribed:this.meshPeerInclusionEventsSubscribed.inc({topic:o},i);break;case Ze.Outbound:this.meshPeerInclusionEventsOutbound.inc({topic:o},i);break;case Ze.NotEnough:this.meshPeerInclusionEventsNotEnough.inc({topic:o},i);break;case Ze.Opportunistic:this.meshPeerInclusionEventsOpportunistic.inc({topic:o},i);break;default:this.meshPeerInclusionEventsUnknown.inc({topic:o},i);break}},onRemoveFromMesh(n,s,i){let o=this.toTopic(n);switch(s){case bt.Dc:this.meshPeerChurnEventsDisconnected.inc({topic:o},i);break;case bt.BadScore:this.meshPeerChurnEventsBadScore.inc({topic:o},i);break;case bt.Prune:this.meshPeerChurnEventsPrune.inc({topic:o},i);break;case bt.Excess:this.meshPeerChurnEventsExcess.inc({topic:o},i);break;default:this.meshPeerChurnEventsUnknown.inc({topic:o},i);break}},onReportValidation(n,s,i){if(this.asyncValidationMcacheHit.inc({hit:n!=null?"hit":"miss"}),n!=null){let o=this.toTopic(n.message.topic);switch(s){case $e.Accept:this.acceptedMessagesTotal.inc({topic:o});break;case $e.Ignore:this.ignoredMessagesTotal.inc({topic:o});break;case $e.Reject:this.rejectedMessagesTotal.inc({topic:o});break;default:this.unknownValidationResultsTotal.inc({topic:o});break}}i!=null?this.asyncValidationDelayFromFirstSeenSec.observe((Date.now()-i)/1e3):this.asyncValidationUnknownFirstSeen.inc()},onScorePenalty(n){this.scoringPenalties.inc({penalty:n},1)},onIhaveRcv(n,s,i){let o=this.toTopic(n);this.ihaveRcvMsgids.inc({topic:o},s),this.ihaveRcvNotSeenMsgids.inc({topic:o},i)},onIwantRcv(n,s){for(let[i,o]of n){let a=this.toTopic(i);this.iwantRcvMsgids.inc({topic:a},o)}this.iwantRcvDonthaveMsgids.inc(s)},onForwardMsg(n,s){let i=this.toTopic(n);this.msgForwardCount.inc({topic:i},1),this.msgForwardPeers.inc({topic:i},s)},onPublishMsg(n,s,i,o,a){let f=this.toTopic(n);this.msgPublishCount.inc({topic:f},1),this.msgPublishBytes.inc({topic:f},i*o),this.msgPublishPeersByTopic.inc({topic:f},i),this.directPeersPublishedTotal.inc({topic:f},s.direct),this.floodsubPeersPublishedTotal.inc({topic:f},s.floodsub),this.meshPeersPublishedTotal.inc({topic:f},s.mesh),this.fanoutPeersPublishedTotal.inc({topic:f},s.fanout),this.msgPublishTime.observe({topic:f},a/1e3)},onMsgRecvPreValidation(n){let s=this.toTopic(n);this.msgReceivedPreValidation.inc({topic:s},1)},onMsgRecvError(n){let s=this.toTopic(n);this.msgReceivedError.inc({topic:s},1)},onPrevalidationResult(n,s){let i=this.toTopic(n);switch(s){case He.duplicate:this.prevalidationDuplicateTotal.inc({topic:i});break;case He.invalid:this.prevalidationInvalidTotal.inc({topic:i});break;case He.valid:this.prevalidationValidTotal.inc({topic:i});break;default:this.prevalidationUnknownTotal.inc({topic:i});break}},onMsgRecvInvalid(n,s){let i=this.toTopic(n),o=s.reason===Ye.Error?s.error:s.reason;this.msgReceivedInvalid.inc({error:o},1),this.msgReceivedInvalidByTopic.inc({topic:i},1)},onDuplicateMsgDelivery(n,s,i){if(this.duplicateMsgDeliveryDelay.observe(s/1e3),i){let o=this.toTopic(n);this.duplicateMsgLateDelivery.inc({topic:o},1)}},onPublishDuplicateMsg(n){let s=this.toTopic(n);this.duplicateMsgIgnored.inc({topic:s},1)},onPeerReadStreamError(){this.peerReadStreamError.inc(1)},onRpcRecvError(){this.rpcRecvError.inc(1)},onRpcDataError(){this.rpcDataError.inc(1)},onRpcRecv(n,s){this.rpcRecvBytes.inc(s),this.rpcRecvCount.inc(1),n.subscriptions!=null&&this.rpcRecvSubscription.inc(n.subscriptions.length),n.messages!=null&&this.rpcRecvMessage.inc(n.messages.length),n.control!=null&&(this.rpcRecvControl.inc(1),n.control.ihave!=null&&this.rpcRecvIHave.inc(n.control.ihave.length),n.control.iwant!=null&&this.rpcRecvIWant.inc(n.control.iwant.length),n.control.graft!=null&&this.rpcRecvGraft.inc(n.control.graft.length),n.control.prune!=null&&this.rpcRecvPrune.inc(n.control.prune.length))},onRpcSent(n,s){if(this.rpcSentBytes.inc(s),this.rpcSentCount.inc(1),n.subscriptions!=null&&this.rpcSentSubscription.inc(n.subscriptions.length),n.messages!=null&&this.rpcSentMessage.inc(n.messages.length),n.control!=null){let i=n.control.ihave?.length??0,o=n.control.iwant?.length??0,a=n.control.graft?.length??0,f=n.control.prune?.length??0;i>0&&this.rpcSentIHave.inc(i),o>0&&this.rpcSentIWant.inc(o),a>0&&this.rpcSentGraft.inc(a),f>0&&this.rpcSentPrune.inc(f),(i>0||o>0||a>0||f>0)&&this.rpcSentControl.inc(1)}},registerScores(n,s){let i=0,o=0,a=0,f=0;for(let u of n)u>=s.graylistThreshold&&i++,u>=s.publishThreshold&&o++,u>=s.gossipThreshold&&a++,u>=0&&f++;this.peersByScoreThreshold.set({threshold:rn.graylist},i),this.peersByScoreThreshold.set({threshold:rn.publish},o),this.peersByScoreThreshold.set({threshold:rn.gossip},a),this.peersByScoreThreshold.set({threshold:rn.mesh},f),this.score.set(n)},registerScoreWeights(n){for(let[s,i]of n.byTopic)this.scoreWeights.set({topic:s,p:"p1"},i.p1w),this.scoreWeights.set({topic:s,p:"p2"},i.p2w),this.scoreWeights.set({topic:s,p:"p3"},i.p3w),this.scoreWeights.set({topic:s,p:"p3b"},i.p3bw),this.scoreWeights.set({topic:s,p:"p4"},i.p4w);this.scoreWeights.set({p:"p5"},n.p5w),this.scoreWeights.set({p:"p6"},n.p6w),this.scoreWeights.set({p:"p7"},n.p7w)},registerScorePerMesh(n,s){let i=new Map;n.forEach((o,a)=>{let f=this.topicStrToLabel.get(a)??"unknown",u=i.get(f);u==null&&(u=new Set,i.set(f,u)),o.forEach(c=>u?.add(c))});for(let[o,a]of i){let f=[];a.forEach(u=>{f.push(s.get(u)??0)}),this.scorePerMesh.set({topic:o},f)}}}}var fe="ERR_INVALID_PEER_SCORE_PARAMS";var Mp={topics:{},topicScoreCap:10,appSpecificScore:()=>0,appSpecificWeight:10,IPColocationFactorWeight:-5,IPColocationFactorThreshold:10,IPColocationFactorWhitelist:new Set,behaviourPenaltyWeight:-10,behaviourPenaltyThreshold:0,behaviourPenaltyDecay:.2,decayInterval:1e3,decayToZero:.1,retainScore:3600*1e3},Lp={topicWeight:.5,timeInMeshWeight:1,timeInMeshQuantum:1,timeInMeshCap:3600,firstMessageDeliveriesWeight:1,firstMessageDeliveriesDecay:.5,firstMessageDeliveriesCap:2e3,meshMessageDeliveriesWeight:-1,meshMessageDeliveriesDecay:.5,meshMessageDeliveriesCap:100,meshMessageDeliveriesThreshold:20,meshMessageDeliveriesWindow:10,meshMessageDeliveriesActivation:5e3,meshFailurePenaltyWeight:-1,meshFailurePenaltyDecay:.5,invalidMessageDeliveriesWeight:-1,invalidMessageDeliveriesDecay:.3};function Ru(t={}){return{...Mp,...t,topics:t.topics!=null?Object.entries(t.topics).reduce((e,[r,n])=>(e[r]=Np(n),e),{}):{}}}function Np(t={}){return{...Lp,...t}}function Du(t){for(let[e,r]of Object.entries(t.topics))try{Op(r)}catch(n){throw new U(`invalid score parameters for topic ${e}: ${n.message}`,fe)}if(t.topicScoreCap<0)throw new U("invalid topic score cap; must be positive (or 0 for no cap)",fe);if(t.appSpecificScore===null||t.appSpecificScore===void 0)throw new U("missing application specific score function",fe);if(t.IPColocationFactorWeight>0)throw new U("invalid IPColocationFactorWeight; must be negative (or 0 to disable)",fe);if(t.IPColocationFactorWeight!==0&&t.IPColocationFactorThreshold<1)throw new U("invalid IPColocationFactorThreshold; must be at least 1",fe);if(t.behaviourPenaltyWeight>0)throw new U("invalid BehaviourPenaltyWeight; must be negative (or 0 to disable)",fe);if(t.behaviourPenaltyWeight!==0&&(t.behaviourPenaltyDecay<=0||t.behaviourPenaltyDecay>=1))throw new U("invalid BehaviourPenaltyDecay; must be between 0 and 1",fe);if(t.decayInterval<1e3)throw new U("invalid DecayInterval; must be at least 1s",fe);if(t.decayToZero<=0||t.decayToZero>=1)throw new U("invalid DecayToZero; must be between 0 and 1",fe)}function Op(t){if(t.topicWeight<0)throw new U("invalid topic weight; must be >= 0",fe);if(t.timeInMeshQuantum===0)throw new U("invalid TimeInMeshQuantum; must be non zero",fe);if(t.timeInMeshWeight<0)throw new U("invalid TimeInMeshWeight; must be positive (or 0 to disable)",fe);if(t.timeInMeshWeight!==0&&t.timeInMeshQuantum<=0)throw new U("invalid TimeInMeshQuantum; must be positive",fe);if(t.timeInMeshWeight!==0&&t.timeInMeshCap<=0)throw new U("invalid TimeInMeshCap; must be positive",fe);if(t.firstMessageDeliveriesWeight<0)throw new U("invallid FirstMessageDeliveriesWeight; must be positive (or 0 to disable)",fe);if(t.firstMessageDeliveriesWeight!==0&&(t.firstMessageDeliveriesDecay<=0||t.firstMessageDeliveriesDecay>=1))throw new U("invalid FirstMessageDeliveriesDecay; must be between 0 and 1",fe);if(t.firstMessageDeliveriesWeight!==0&&t.firstMessageDeliveriesCap<=0)throw new U("invalid FirstMessageDeliveriesCap; must be positive",fe);if(t.meshMessageDeliveriesWeight>0)throw new U("invalid MeshMessageDeliveriesWeight; must be negative (or 0 to disable)",fe);if(t.meshMessageDeliveriesWeight!==0&&(t.meshMessageDeliveriesDecay<=0||t.meshMessageDeliveriesDecay>=1))throw new U("invalid MeshMessageDeliveriesDecay; must be between 0 and 1",fe);if(t.meshMessageDeliveriesWeight!==0&&t.meshMessageDeliveriesCap<=0)throw new U("invalid MeshMessageDeliveriesCap; must be positive",fe);if(t.meshMessageDeliveriesWeight!==0&&t.meshMessageDeliveriesThreshold<=0)throw new U("invalid MeshMessageDeliveriesThreshold; must be positive",fe);if(t.meshMessageDeliveriesWindow<0)throw new U("invalid MeshMessageDeliveriesWindow; must be non-negative",fe);if(t.meshMessageDeliveriesWeight!==0&&t.meshMessageDeliveriesActivation<1e3)throw new U("invalid MeshMessageDeliveriesActivation; must be at least 1s",fe);if(t.meshFailurePenaltyWeight>0)throw new U("invalid MeshFailurePenaltyWeight; must be negative (or 0 to disable)",fe);if(t.meshFailurePenaltyWeight!==0&&(t.meshFailurePenaltyDecay<=0||t.meshFailurePenaltyDecay>=1))throw new U("invalid MeshFailurePenaltyDecay; must be between 0 and 1",fe);if(t.invalidMessageDeliveriesWeight>0)throw new U("invalid InvalidMessageDeliveriesWeight; must be negative (or 0 to disable)",fe);if(t.invalidMessageDeliveriesDecay<=0||t.invalidMessageDeliveriesDecay>=1)throw new U("invalid InvalidMessageDeliveriesDecay; must be between 0 and 1",fe)}var Fp={gossipThreshold:-10,publishThreshold:-50,graylistThreshold:-80,acceptPXThreshold:10,opportunisticGraftThreshold:20};function ku(t={}){return{...Fp,...t}}var ot=Se(Fu(),1);ot.default.formatters.b=t=>t==null?"undefined":ke.baseEncode(t);ot.default.formatters.t=t=>t==null?"undefined":Kt.baseEncode(t);ot.default.formatters.m=t=>t==null?"undefined":Wr.baseEncode(t);ot.default.formatters.p=t=>t==null?"undefined":t.toString();ot.default.formatters.c=t=>t==null?"undefined":t.toString();ot.default.formatters.k=t=>t==null?"undefined":t.toString();ot.default.formatters.a=t=>t==null?"undefined":t.toString();function Qp(t){let e=()=>{};return e.enabled=!1,e.color="",e.diff=0,e.log=()=>{},e.namespace=t,e.destroy=()=>!0,e.extend=()=>e,e}function Uu(t){let e=Qp(`${t}:trace`);return ot.default.enabled(`${t}:trace`)&&ot.default.names.map(r=>r.toString()).find(r=>r.includes(":trace"))!=null&&(e=(0,ot.default)(`${t}:trace`)),Object.assign((0,ot.default)(t),{error:(0,ot.default)(`${t}:error`),trace:e})}function _s(t,e,r=()=>!0){let n=new Set;if(e<=0)return n;for(let s of t){if(n.size>=e)break;r(s)&&(n.add(s),t.delete(s))}return n}function Ku(t,e){return _s(t,e,()=>!0)}var Es=class extends Map{getDefault;constructor(e){super(),this.getDefault=e}getOrDefault(e){let r=super.get(e);return r===void 0&&(r=this.getDefault(),this.set(e,r)),r}};function qu(t,e,r,n){let s=0;Object.entries(e.topics).forEach(([o,a])=>{let f=r.topics[o];if(f===void 0)return;let u=0;if(a.inMesh){let g=a.meshTime/f.timeInMeshQuantum;g>f.timeInMeshCap&&(g=f.timeInMeshCap),u+=g*f.timeInMeshWeight}let c=a.firstMessageDeliveries;if(c>f.firstMessageDeliveriesCap&&(c=f.firstMessageDeliveriesCap),u+=c*f.firstMessageDeliveriesWeight,a.meshMessageDeliveriesActive&&a.meshMessageDeliveries<f.meshMessageDeliveriesThreshold){let g=f.meshMessageDeliveriesThreshold-a.meshMessageDeliveries,p=g*g;u+=p*f.meshMessageDeliveriesWeight}let l=a.meshFailurePenalty;u+=l*f.meshFailurePenaltyWeight;let h=a.invalidMessageDeliveries*a.invalidMessageDeliveries;u+=h*f.invalidMessageDeliveriesWeight,s+=u*f.topicWeight}),r.topicScoreCap>0&&s>r.topicScoreCap&&(s=r.topicScoreCap);let i=r.appSpecificScore(t);if(s+=i*r.appSpecificWeight,e.knownIPs.forEach(o=>{if(r.IPColocationFactorWhitelist.has(o))return;let a=n.get(o),f=a!=null?a.size:0;if(f>r.IPColocationFactorThreshold){let u=f-r.IPColocationFactorThreshold,c=u*u;s+=c*r.IPColocationFactorWeight}}),e.behaviourPenalty>r.behaviourPenaltyThreshold){let o=e.behaviourPenalty-r.behaviourPenaltyThreshold,a=o*o;s+=a*r.behaviourPenaltyWeight}return s}var Hu=Se(zu(),1);var Qe;(function(t){t[t.unknown=0]="unknown",t[t.valid=1]="valid",t[t.invalid=2]="invalid",t[t.ignored=3]="ignored"})(Qe||(Qe={}));var Is=class{records;queue;constructor(){this.records=new Map,this.queue=new Hu.default}getRecord(e){return this.records.get(e)}ensureRecord(e){let r=this.records.get(e);if(r!=null)return r;r={status:Qe.unknown,firstSeenTsMs:Date.now(),validated:0,peers:new Set},this.records.set(e,r);let n={msgId:e,expire:Date.now()+12e4};return this.queue.push(n),r}gc(){let e=Date.now(),r=this.queue.peekFront();for(;r!=null&&r.expire<e;)this.records.delete(r.msgId),this.queue.shift(),r=this.queue.peekFront()}clear(){this.records.clear(),this.queue.clear()}};var un=Uu("libp2p:gossipsub:score"),Cs=class{params;metrics;peerStats=new Map;peerIPs=new Es(()=>new Set);scoreCache=new Map;deliveryRecords=new Is;_backgroundInterval;scoreCacheValidityMs;computeScore;constructor(e,r,n){this.params=e,this.metrics=r,Du(e),this.scoreCacheValidityMs=n.scoreCacheValidityMs,this.computeScore=n.computeScore??qu}get size(){return this.peerStats.size}start(){if(this._backgroundInterval!=null){un("Peer score already running");return}this._backgroundInterval=setInterval(()=>{this.background()},this.params.decayInterval),un("started")}stop(){if(this._backgroundInterval==null){un("Peer score already stopped");return}clearInterval(this._backgroundInterval),delete this._backgroundInterval,this.peerIPs.clear(),this.peerStats.clear(),this.deliveryRecords.clear(),un("stopped")}background(){this.refreshScores(),this.deliveryRecords.gc()}dumpPeerScoreStats(){return Object.fromEntries(Array.from(this.peerStats.entries()).map(([e,r])=>[e,r]))}messageFirstSeenTimestampMs(e){let r=this.deliveryRecords.getRecord(e);return r!=null?r.firstSeenTsMs:null}refreshScores(){let e=Date.now(),r=this.params.decayToZero;this.peerStats.forEach((n,s)=>{if(!n.connected){e>n.expire&&(this.removeIPsForPeer(s,n.knownIPs),this.peerStats.delete(s),this.scoreCache.delete(s));return}Object.entries(n.topics).forEach(([i,o])=>{let a=this.params.topics[i];a!==void 0&&(o.firstMessageDeliveries*=a.firstMessageDeliveriesDecay,o.firstMessageDeliveries<r&&(o.firstMessageDeliveries=0),o.meshMessageDeliveries*=a.meshMessageDeliveriesDecay,o.meshMessageDeliveries<r&&(o.meshMessageDeliveries=0),o.meshFailurePenalty*=a.meshFailurePenaltyDecay,o.meshFailurePenalty<r&&(o.meshFailurePenalty=0),o.invalidMessageDeliveries*=a.invalidMessageDeliveriesDecay,o.invalidMessageDeliveries<r&&(o.invalidMessageDeliveries=0),o.inMesh&&(o.meshTime=e-o.graftTime,o.meshTime>a.meshMessageDeliveriesActivation&&(o.meshMessageDeliveriesActive=!0)))}),n.behaviourPenalty*=this.params.behaviourPenaltyDecay,n.behaviourPenalty<r&&(n.behaviourPenalty=0)})}score(e){this.metrics?.scoreFnCalls.inc();let r=this.peerStats.get(e);if(r==null)return 0;let n=Date.now(),s=this.scoreCache.get(e);if(s!=null&&s.cacheUntil>n)return s.score;this.metrics?.scoreFnRuns.inc();let i=this.computeScore(e,r,this.params,this.peerIPs),o=n+this.scoreCacheValidityMs;return s!=null?(this.metrics?.scoreCachedDelta.observe(Math.abs(i-s.score)),s.score=i,s.cacheUntil=o):this.scoreCache.set(e,{score:i,cacheUntil:o}),i}addPenalty(e,r,n){let s=this.peerStats.get(e);s!=null&&(s.behaviourPenalty+=r,this.metrics?.onScorePenalty(n))}addPeer(e){let r={connected:!0,expire:0,topics:{},knownIPs:new Set,behaviourPenalty:0};this.peerStats.set(e,r)}addIP(e,r){let n=this.peerStats.get(e);n?.knownIPs.add(r),this.peerIPs.getOrDefault(r).add(e)}removeIP(e,r){let n=this.peerStats.get(e);n?.knownIPs.delete(r);let s=this.peerIPs.get(r);s!=null&&(s.delete(e),s.size===0&&this.peerIPs.delete(r))}removePeer(e){let r=this.peerStats.get(e);if(r!=null){if(this.score(e)>0){this.removeIPsForPeer(e,r.knownIPs),this.peerStats.delete(e);return}Object.entries(r.topics).forEach(([n,s])=>{s.firstMessageDeliveries=0;let i=this.params.topics[n].meshMessageDeliveriesThreshold;if(s.inMesh&&s.meshMessageDeliveriesActive&&s.meshMessageDeliveries<i){let o=i-s.meshMessageDeliveries;s.meshFailurePenalty+=o*o}s.inMesh=!1,s.meshMessageDeliveriesActive=!1}),r.connected=!1,r.expire=Date.now()+this.params.retainScore}}graft(e,r){let n=this.peerStats.get(e);if(n!=null){let s=this.getPtopicStats(n,r);s!=null&&(s.inMesh=!0,s.graftTime=Date.now(),s.meshTime=0,s.meshMessageDeliveriesActive=!1)}}prune(e,r){let n=this.peerStats.get(e);if(n!=null){let s=this.getPtopicStats(n,r);if(s!=null){let i=this.params.topics[r].meshMessageDeliveriesThreshold;if(s.meshMessageDeliveriesActive&&s.meshMessageDeliveries<i){let o=i-s.meshMessageDeliveries;s.meshFailurePenalty+=o*o}s.meshMessageDeliveriesActive=!1,s.inMesh=!1}}}validateMessage(e){this.deliveryRecords.ensureRecord(e)}deliverMessage(e,r,n){this.markFirstMessageDelivery(e,n);let s=this.deliveryRecords.ensureRecord(r),i=Date.now();if(s.status!==Qe.unknown){un("unexpected delivery: message from %s was first seen %s ago and has delivery status %s",e,i-s.firstSeenTsMs,Qe[s.status]);return}s.status=Qe.valid,s.validated=i,s.peers.forEach(o=>{o!==e.toString()&&this.markDuplicateMessageDelivery(o,n)})}rejectInvalidMessage(e,r){this.markInvalidMessageDelivery(e,r)}rejectMessage(e,r,n,s){switch(s){case Ye.Error:this.markInvalidMessageDelivery(e,n);return;case Ye.Blacklisted:return}let i=this.deliveryRecords.ensureRecord(r);if(i.status!==Qe.unknown){un("unexpected rejection: message from %s was first seen %s ago and has delivery status %d",e,Date.now()-i.firstSeenTsMs,Qe[i.status]);return}if(s===Ye.Ignore){i.status=Qe.ignored,i.peers.clear();return}i.status=Qe.invalid,this.markInvalidMessageDelivery(e,n),i.peers.forEach(o=>{this.markInvalidMessageDelivery(o,n)}),i.peers.clear()}duplicateMessage(e,r,n){let s=this.deliveryRecords.ensureRecord(r);if(!s.peers.has(e))switch(s.status){case Qe.unknown:s.peers.add(e);break;case Qe.valid:s.peers.add(e),this.markDuplicateMessageDelivery(e,n,s.validated);break;case Qe.invalid:this.markInvalidMessageDelivery(e,n);break;case Qe.ignored:break}}markInvalidMessageDelivery(e,r){let n=this.peerStats.get(e);if(n!=null){let s=this.getPtopicStats(n,r);s!=null&&(s.invalidMessageDeliveries+=1)}}markFirstMessageDelivery(e,r){let n=this.peerStats.get(e);if(n!=null){let s=this.getPtopicStats(n,r);if(s!=null){let i=this.params.topics[r].firstMessageDeliveriesCap;s.firstMessageDeliveries=Math.min(i,s.firstMessageDeliveries+1),s.inMesh&&(i=this.params.topics[r].meshMessageDeliveriesCap,s.meshMessageDeliveries=Math.min(i,s.meshMessageDeliveries+1))}}}markDuplicateMessageDelivery(e,r,n){let s=this.peerStats.get(e);if(s!=null){let i=n!==void 0?Date.now():0,o=this.getPtopicStats(s,r);if(o!=null&&o.inMesh){let a=this.params.topics[r];if(n!==void 0){let u=i-n,c=u>a.meshMessageDeliveriesWindow;if(this.metrics?.onDuplicateMsgDelivery(r,u,c),c)return}let f=a.meshMessageDeliveriesCap;o.meshMessageDeliveries=Math.min(f,o.meshMessageDeliveries+1)}}}removeIPsForPeer(e,r){for(let n of r){let s=this.peerIPs.get(n);s!=null&&(s.delete(e),s.size===0&&this.peerIPs.delete(n))}}getPtopicStats(e,r){let n=e.topics[r];return n!==void 0?n:this.params.topics[r]!==void 0?(n={inMesh:!1,graftTime:0,meshTime:0,firstMessageDeliveries:0,meshMessageDeliveries:0,meshMessageDeliveriesActive:!1,meshFailurePenalty:0,invalidMessageDeliveries:0},e.topics[r]=n,n):null}};function Jp(t,e,r,n,s){let i=0,o=new Map;if(Object.entries(e.topics).forEach(([h,g])=>{let p=s.get(h)??"unknown",d=r.topics[h];if(d===void 0)return;let y=o.get(p);y==null&&(y={p1w:0,p2w:0,p3w:0,p3bw:0,p4w:0},o.set(p,y));let m=0,E=0,v=0,C=0,b=0;if(g.inMesh){let F=Math.max(g.meshTime/d.timeInMeshQuantum,d.timeInMeshCap);m+=F*d.timeInMeshWeight}let w=g.firstMessageDeliveries;if(w>d.firstMessageDeliveriesCap&&(w=d.firstMessageDeliveriesCap),E+=w*d.firstMessageDeliveriesWeight,g.meshMessageDeliveriesActive&&g.meshMessageDeliveries<d.meshMessageDeliveriesThreshold){let F=d.meshMessageDeliveriesThreshold-g.meshMessageDeliveries,K=F*F;v+=K*d.meshMessageDeliveriesWeight}let I=g.meshFailurePenalty;C+=I*d.meshFailurePenaltyWeight;let T=g.invalidMessageDeliveries*g.invalidMessageDeliveries;b+=T*d.invalidMessageDeliveriesWeight,i+=(m+E+v+C+b)*d.topicWeight,y.p1w+=m,y.p2w+=E,y.p3w+=v,y.p3bw+=C,y.p4w+=b}),r.topicScoreCap>0&&i>r.topicScoreCap){i=r.topicScoreCap;let h=r.topicScoreCap/i;for(let g of o.values())g.p1w*=h,g.p2w*=h,g.p3w*=h,g.p3bw*=h,g.p4w*=h}let a=0,f=0,u=0,c=r.appSpecificScore(t);a+=c*r.appSpecificWeight,e.knownIPs.forEach(h=>{if(r.IPColocationFactorWhitelist.has(h))return;let g=n.get(h),p=g!=null?g.size:0;if(p>r.IPColocationFactorThreshold){let d=p-r.IPColocationFactorThreshold,y=d*d;f+=y*r.IPColocationFactorWeight}});let l=e.behaviourPenalty*e.behaviourPenalty;return u+=l*r.behaviourPenaltyWeight,i+=a+f+u,{byTopic:o,p5w:a,p6w:f,p7w:u,score:i}}function Gu(t,e,r,n,s){let i={byTopic:new Map,p5w:[],p6w:[],p7w:[],score:[]};for(let o of t){let a=e.get(o);if(a!=null){let f=Jp(o,a,r,n,s);for(let[u,c]of f.byTopic){let l=i.byTopic.get(u);l==null&&(l={p1w:[],p2w:[],p3w:[],p3bw:[],p4w:[]},i.byTopic.set(u,l)),l.p1w.push(c.p1w),l.p2w.push(c.p2w),l.p3w.push(c.p3w),l.p3bw.push(c.p3bw),l.p4w.push(c.p4w)}i.p5w.push(f.p5w),i.p6w.push(f.p6w),i.p7w.push(f.p7w),i.score.push(f.score)}else i.p5w.push(0),i.p6w.push(0),i.p7w.push(0),i.score.push(0)}return i}var Vn=class extends Error{constructor(e,r){super(e??"The operation was aborted"),this.type="aborted",this.code=r??"ABORT_ERR"}};function Wu(t){if(t!=null){if(typeof t[Symbol.iterator]=="function")return t[Symbol.iterator]();if(typeof t[Symbol.asyncIterator]=="function")return t[Symbol.asyncIterator]();if(typeof t.next=="function")return t}throw new Error("argument is not an iterator or iterable")}function po(t,e,r){let n=r??{},s=Wu(t);async function*i(){let o,a=()=>{o?.()};for(e.addEventListener("abort",a);;){let f;try{if(e.aborted){let{abortMessage:c,abortCode:l}=n;throw new Vn(c,l)}let u=new Promise((c,l)=>{o=()=>{let{abortMessage:h,abortCode:g}=n;l(new Vn(h,g))}});f=await Promise.race([u,s.next()]),o=null}catch(u){e.removeEventListener("abort",a);let c=u.type==="aborted"&&e.aborted;if(c&&n.onAbort!=null&&n.onAbort(t),typeof s.return=="function")try{let l=s.return();l instanceof Promise&&l.catch(h=>{n.onReturnError!=null&&n.onReturnError(h)})}catch(l){n.onReturnError!=null&&n.onReturnError(l)}if(c&&n.returnOnAbort===!0)return;throw u}if(f.done===!0)break;yield f.value}e.removeEventListener("abort",a)}return i()}function Ar(t){return globalThis.Buffer!=null?new Uint8Array(t.buffer,t.byteOffset,t.byteLength):t}function Vt(t=0){return globalThis.Buffer?.alloc!=null?Ar(globalThis.Buffer.alloc(t)):new Uint8Array(t)}function Ge(t=0){return globalThis.Buffer?.allocUnsafe!=null?Ar(globalThis.Buffer.allocUnsafe(t)):new Uint8Array(t)}var ed=Math.pow(2,7),td=Math.pow(2,14),rd=Math.pow(2,21),go=Math.pow(2,28),yo=Math.pow(2,35),mo=Math.pow(2,42),bo=Math.pow(2,49),ie=128,We=127;function xt(t){if(t<ed)return 1;if(t<td)return 2;if(t<rd)return 3;if(t<go)return 4;if(t<yo)return 5;if(t<mo)return 6;if(t<bo)return 7;if(Number.MAX_SAFE_INTEGER!=null&&t>Number.MAX_SAFE_INTEGER)throw new RangeError("Could not encode varint");return 8}function nd(t,e,r=0){switch(xt(t)){case 8:e[r++]=t&255|ie,t/=128;case 7:e[r++]=t&255|ie,t/=128;case 6:e[r++]=t&255|ie,t/=128;case 5:e[r++]=t&255|ie,t/=128;case 4:e[r++]=t&255|ie,t>>>=7;case 3:e[r++]=t&255|ie,t>>>=7;case 2:e[r++]=t&255|ie,t>>>=7;case 1:{e[r++]=t&255,t>>>=7;break}default:throw new Error("unreachable")}return e}function sd(t,e,r=0){switch(xt(t)){case 8:e.set(r++,t&255|ie),t/=128;case 7:e.set(r++,t&255|ie),t/=128;case 6:e.set(r++,t&255|ie),t/=128;case 5:e.set(r++,t&255|ie),t/=128;case 4:e.set(r++,t&255|ie),t>>>=7;case 3:e.set(r++,t&255|ie),t>>>=7;case 2:e.set(r++,t&255|ie),t>>>=7;case 1:{e.set(r++,t&255),t>>>=7;break}default:throw new Error("unreachable")}return e}function id(t,e){let r=t[e],n=0;if(n+=r&We,r<ie||(r=t[e+1],n+=(r&We)<<7,r<ie)||(r=t[e+2],n+=(r&We)<<14,r<ie)||(r=t[e+3],n+=(r&We)<<21,r<ie)||(r=t[e+4],n+=(r&We)*go,r<ie)||(r=t[e+5],n+=(r&We)*yo,r<ie)||(r=t[e+6],n+=(r&We)*mo,r<ie)||(r=t[e+7],n+=(r&We)*bo,r<ie))return n;throw new RangeError("Could not decode varint")}function od(t,e){let r=t.get(e),n=0;if(n+=r&We,r<ie||(r=t.get(e+1),n+=(r&We)<<7,r<ie)||(r=t.get(e+2),n+=(r&We)<<14,r<ie)||(r=t.get(e+3),n+=(r&We)<<21,r<ie)||(r=t.get(e+4),n+=(r&We)*go,r<ie)||(r=t.get(e+5),n+=(r&We)*yo,r<ie)||(r=t.get(e+6),n+=(r&We)*mo,r<ie)||(r=t.get(e+7),n+=(r&We)*bo,r<ie))return n;throw new RangeError("Could not decode varint")}function xo(t,e,r=0){return e==null&&(e=Ge(xt(t))),e instanceof Uint8Array?nd(t,e,r):sd(t,e,r)}function fn(t,e=0){return t instanceof Uint8Array?id(t,e):od(t,e)}function tt(t,e){e==null&&(e=t.reduce((s,i)=>s+i.length,0));let r=Ge(e),n=0;for(let s of t)r.set(s,n),n+=s.length;return Ar(r)}var $u=Symbol.for("@achingbrain/uint8arraylist");function ju(t,e){if(e==null||e<0)throw new RangeError("index is out of bounds");let r=0;for(let n of t){let s=r+n.byteLength;if(e<s)return{buf:n,index:e-r};r=s}throw new RangeError("index is out of bounds")}function Bs(t){return!!t?.[$u]}var ln=class t{constructor(...e){Object.defineProperty(this,$u,{value:!0}),this.bufs=[],this.length=0,e.length>0&&this.appendAll(e)}*[Symbol.iterator](){yield*this.bufs}get byteLength(){return this.length}append(...e){this.appendAll(e)}appendAll(e){let r=0;for(let n of e)if(n instanceof Uint8Array)r+=n.byteLength,this.bufs.push(n);else if(Bs(n))r+=n.byteLength,this.bufs.push(...n.bufs);else throw new Error("Could not append value, must be an Uint8Array or a Uint8ArrayList");this.length+=r}prepend(...e){this.prependAll(e)}prependAll(e){let r=0;for(let n of e.reverse())if(n instanceof Uint8Array)r+=n.byteLength,this.bufs.unshift(n);else if(Bs(n))r+=n.byteLength,this.bufs.unshift(...n.bufs);else throw new Error("Could not prepend value, must be an Uint8Array or a Uint8ArrayList");this.length+=r}get(e){let r=ju(this.bufs,e);return r.buf[r.index]}set(e,r){let n=ju(this.bufs,e);n.buf[n.index]=r}write(e,r=0){if(e instanceof Uint8Array)for(let n=0;n<e.length;n++)this.set(r+n,e[n]);else if(Bs(e))for(let n=0;n<e.length;n++)this.set(r+n,e.get(n));else throw new Error("Could not write value, must be an Uint8Array or a Uint8ArrayList")}consume(e){if(e=Math.trunc(e),!(Number.isNaN(e)||e<=0)){if(e===this.byteLength){this.bufs=[],this.length=0;return}for(;this.bufs.length>0;)if(e>=this.bufs[0].byteLength)e-=this.bufs[0].byteLength,this.length-=this.bufs[0].byteLength,this.bufs.shift();else{this.bufs[0]=this.bufs[0].subarray(e),this.length-=e;break}}}slice(e,r){let{bufs:n,length:s}=this._subList(e,r);return tt(n,s)}subarray(e,r){let{bufs:n,length:s}=this._subList(e,r);return n.length===1?n[0]:tt(n,s)}sublist(e,r){let{bufs:n,length:s}=this._subList(e,r),i=new t;return i.length=s,i.bufs=n,i}_subList(e,r){if(e=e??0,r=r??this.length,e<0&&(e=this.length+e),r<0&&(r=this.length+r),e<0||r>this.length)throw new RangeError("index is out of bounds");if(e===r)return{bufs:[],length:0};if(e===0&&r===this.length)return{bufs:[...this.bufs],length:this.length};let n=[],s=0;for(let i=0;i<this.bufs.length;i++){let o=this.bufs[i],a=s,f=a+o.byteLength;if(s=f,e>=f)continue;let u=e>=a&&e<f,c=r>a&&r<=f;if(u&&c){if(e===a&&r===f){n.push(o);break}let l=e-a;n.push(o.subarray(l,l+(r-e)));break}if(u){if(e===0){n.push(o);continue}n.push(o.subarray(e-a));continue}if(c){if(r===f){n.push(o);break}n.push(o.subarray(0,r-a));break}n.push(o)}return{bufs:n,length:r-e}}indexOf(e,r=0){if(!Bs(e)&&!(e instanceof Uint8Array))throw new TypeError('The "value" argument must be a Uint8ArrayList or Uint8Array');let n=e instanceof Uint8Array?e:e.subarray();if(r=Number(r??0),isNaN(r)&&(r=0),r<0&&(r=this.length+r),r<0&&(r=0),e.length===0)return r>this.length?this.length:r;let s=n.byteLength;if(s===0)throw new TypeError("search must be at least 1 byte long");let i=256,o=new Int32Array(i);for(let l=0;l<i;l++)o[l]=-1;for(let l=0;l<s;l++)o[n[l]]=l;let a=o,f=this.byteLength-n.byteLength,u=n.byteLength-1,c;for(let l=r;l<=f;l+=c){c=0;for(let h=u;h>=0;h--){let g=this.get(l+h);if(n[h]!==g){c=Math.max(1,h-a[g]);break}}if(c===0)return l}return-1}getInt8(e){let r=this.subarray(e,e+1);return new DataView(r.buffer,r.byteOffset,r.byteLength).getInt8(0)}setInt8(e,r){let n=Ge(1);new DataView(n.buffer,n.byteOffset,n.byteLength).setInt8(0,r),this.write(n,e)}getInt16(e,r){let n=this.subarray(e,e+2);return new DataView(n.buffer,n.byteOffset,n.byteLength).getInt16(0,r)}setInt16(e,r,n){let s=Vt(2);new DataView(s.buffer,s.byteOffset,s.byteLength).setInt16(0,r,n),this.write(s,e)}getInt32(e,r){let n=this.subarray(e,e+4);return new DataView(n.buffer,n.byteOffset,n.byteLength).getInt32(0,r)}setInt32(e,r,n){let s=Vt(4);new DataView(s.buffer,s.byteOffset,s.byteLength).setInt32(0,r,n),this.write(s,e)}getBigInt64(e,r){let n=this.subarray(e,e+8);return new DataView(n.buffer,n.byteOffset,n.byteLength).getBigInt64(0,r)}setBigInt64(e,r,n){let s=Vt(8);new DataView(s.buffer,s.byteOffset,s.byteLength).setBigInt64(0,r,n),this.write(s,e)}getUint8(e){let r=this.subarray(e,e+1);return new DataView(r.buffer,r.byteOffset,r.byteLength).getUint8(0)}setUint8(e,r){let n=Ge(1);new DataView(n.buffer,n.byteOffset,n.byteLength).setUint8(0,r),this.write(n,e)}getUint16(e,r){let n=this.subarray(e,e+2);return new DataView(n.buffer,n.byteOffset,n.byteLength).getUint16(0,r)}setUint16(e,r,n){let s=Vt(2);new DataView(s.buffer,s.byteOffset,s.byteLength).setUint16(0,r,n),this.write(s,e)}getUint32(e,r){let n=this.subarray(e,e+4);return new DataView(n.buffer,n.byteOffset,n.byteLength).getUint32(0,r)}setUint32(e,r,n){let s=Vt(4);new DataView(s.buffer,s.byteOffset,s.byteLength).setUint32(0,r,n),this.write(s,e)}getBigUint64(e,r){let n=this.subarray(e,e+8);return new DataView(n.buffer,n.byteOffset,n.byteLength).getBigUint64(0,r)}setBigUint64(e,r,n){let s=Vt(8);new DataView(s.buffer,s.byteOffset,s.byteLength).setBigUint64(0,r,n),this.write(s,e)}getFloat32(e,r){let n=this.subarray(e,e+4);return new DataView(n.buffer,n.byteOffset,n.byteLength).getFloat32(0,r)}setFloat32(e,r,n){let s=Vt(4);new DataView(s.buffer,s.byteOffset,s.byteLength).setFloat32(0,r,n),this.write(s,e)}getFloat64(e,r){let n=this.subarray(e,e+8);return new DataView(n.buffer,n.byteOffset,n.byteLength).getFloat64(0,r)}setFloat64(e,r,n){let s=Vt(8);new DataView(s.buffer,s.byteOffset,s.byteLength).setFloat64(0,r,n),this.write(s,e)}equals(e){if(e==null||!(e instanceof t)||e.bufs.length!==this.bufs.length)return!1;for(let r=0;r<this.bufs.length;r++)if(!qe(this.bufs[r],e.bufs[r]))return!1;return!0}static fromUint8Arrays(e,r){let n=new t;return n.bufs=e,r==null&&(r=e.reduce((s,i)=>s+i.byteLength,0)),n.length=r,n}};function As(t){return t[Symbol.asyncIterator]!=null}var Ts=t=>{let e=xt(t),r=Ge(e);return xo(t,r),Ts.bytes=e,r};Ts.bytes=0;function Ps(t,e){e=e??{};let r=e.lengthEncoder??Ts;function*n(s){let i=r(s.byteLength);i instanceof Uint8Array?yield i:yield*i,s instanceof Uint8Array?yield s:yield*s}return As(t)?async function*(){for await(let s of t)yield*n(s)}():function*(){for(let s of t)yield*n(s)}()}Ps.single=(t,e)=>{e=e??{};let r=e.lengthEncoder??Ts;return new ln(r(t.byteLength),t)};var hn=Se(Qu(),1);var cd=8,ud=1024*1024*4,Tr;(function(t){t[t.LENGTH=0]="LENGTH",t[t.DATA=1]="DATA"})(Tr||(Tr={}));var wo=t=>{let e=fn(t);return wo.bytes=xt(e),e};wo.bytes=0;function zn(t,e){let r=new ln,n=Tr.LENGTH,s=-1,i=e?.lengthDecoder??wo,o=e?.maxLengthLength??cd,a=e?.maxDataLength??ud;function*f(){for(;r.byteLength>0;){if(n===Tr.LENGTH)try{if(s=i(r),s<0)throw(0,hn.default)(new Error("invalid message length"),"ERR_INVALID_MSG_LENGTH");if(s>a)throw(0,hn.default)(new Error("message length too long"),"ERR_MSG_DATA_TOO_LONG");let u=i.bytes;r.consume(u),e?.onLength!=null&&e.onLength(s),n=Tr.DATA}catch(u){if(u instanceof RangeError){if(r.byteLength>o)throw(0,hn.default)(new Error("message length length too long"),"ERR_MSG_LENGTH_TOO_LONG");break}throw u}if(n===Tr.DATA){if(r.byteLength<s)break;let u=r.sublist(0,s);r.consume(s),e?.onData!=null&&e.onData(u),yield u,n=Tr.LENGTH}}}return As(t)?async function*(){for await(let u of t)r.append(u),yield*f();if(r.byteLength>0)throw(0,hn.default)(new Error("unexpected end of input"),"ERR_UNEXPECTED_EOF")}():function*(){for(let u of t)r.append(u),yield*f();if(r.byteLength>0)throw(0,hn.default)(new Error("unexpected end of input"),"ERR_UNEXPECTED_EOF")}()}zn.fromReader=(t,e)=>{let r=1,n=async function*(){for(;;)try{let{done:i,value:o}=await t.next(r);if(i===!0)return;o!=null&&(yield o)}catch(i){if(i.code==="ERR_UNDER_READ")return{done:!0,value:null};throw i}finally{r=1}}();return zn(n,{...e??{},onLength:i=>{r=i}})};var Rs=class{rawStream;pushable;closeController;maxBufferSize;constructor(e,r,n){this.rawStream=e,this.pushable=qt({objectMode:!1}),this.closeController=new AbortController,this.maxBufferSize=n.maxBufferSize??1/0,en(po(this.pushable,this.closeController.signal,{returnOnAbort:!0}),s=>Ps(s),this.rawStream).catch(r)}get protocol(){return this.rawStream.protocol}push(e){if(this.pushable.readableLength>this.maxBufferSize)throw Error(`OutboundStream buffer full, size > ${this.maxBufferSize}`);this.pushable.push(e)}async close(){this.closeController.abort(),await this.pushable.return(),await this.rawStream.close()}},Ds=class{source;rawStream;closeController;constructor(e,r={}){this.rawStream=e,this.closeController=new AbortController,this.source=po(en(this.rawStream,n=>zn(n,r)),this.closeController.signal,{returnOnAbort:!0})}async close(){this.closeController.abort(),await this.rawStream.close()}};var ks=class{gossipsubIWantFollowupMs;msgIdToStrFn;metrics;promises=new Map;requestMsByMsg=new Map;requestMsByMsgExpire;constructor(e,r,n){this.gossipsubIWantFollowupMs=e,this.msgIdToStrFn=r,this.metrics=n,this.requestMsByMsgExpire=10*e}get size(){return this.promises.size}get requestMsByMsgSize(){return this.requestMsByMsg.size}addPromise(e,r){let n=Math.floor(Math.random()*r.length),s=r[n],i=this.msgIdToStrFn(s),o=this.promises.get(i);o==null&&(o=new Map,this.promises.set(i,o));let a=Date.now();o.has(e)||(o.set(e,a+this.gossipsubIWantFollowupMs),this.metrics!=null&&(this.metrics.iwantPromiseStarted.inc(1),this.requestMsByMsg.has(i)||this.requestMsByMsg.set(i,a)))}getBrokenPromises(){let e=Date.now(),r=new Map,n=0;return this.promises.forEach((s,i)=>{s.forEach((o,a)=>{o<e&&(r.set(a,(r.get(a)??0)+1),s.delete(a),n++)}),s.size===0&&this.promises.delete(i)}),this.metrics?.iwantPromiseBroken.inc(n),r}deliverMessage(e,r=!1){this.trackMessage(e);let n=this.promises.get(e);n!=null&&(this.promises.delete(e),this.metrics!=null&&(this.metrics.iwantPromiseResolved.inc(1),r&&this.metrics.iwantPromiseResolvedFromDuplicate.inc(1),this.metrics.iwantPromiseResolvedPeers.inc(n.size)))}rejectMessage(e,r){switch(this.trackMessage(e),r){case Ye.Error:return;default:break}this.promises.delete(e)}clear(){this.promises.clear()}prune(){let e=Date.now()-this.requestMsByMsgExpire,r=0;for(let[n,s]of this.requestMsByMsg.entries())if(s<e)this.requestMsByMsg.delete(n),r++;else break;this.metrics?.iwantMessagePruned.inc(r)}trackMessage(e){if(this.metrics!=null){let r=this.requestMsByMsg.get(e);r!==void 0&&(this.metrics.iwantPromiseDeliveryTime.observe((Date.now()-r)/1e3),this.requestMsByMsg.delete(e))}}};var yw=Se(Fs(),1),bd=Se(ce(),1);function df(t,e,r,n){return{name:t,prefix:e,encoder:{name:t,prefix:e,encode:r},decoder:{decode:n}}}var pf=df("utf8","u",t=>"u"+new TextDecoder("utf8").decode(t),t=>new TextEncoder().encode(t.substring(1))),ko=df("ascii","a",t=>{let e="a";for(let r=0;r<t.length;r++)e+=String.fromCharCode(t[r]);return e},t=>{t=t.substring(1);let e=Ge(t.length);for(let r=0;r<t.length;r++)e[r]=t.charCodeAt(r);return e}),md={utf8:pf,"utf-8":pf,hex:rr.base16,latin1:ko,ascii:ko,binary:ko,...rr},Us=md;function Be(t,e="utf8"){let r=Us[e];if(r==null)throw new Error(`Unsupported encoding "${e}"`);return(e==="utf8"||e==="utf-8")&&globalThis.Buffer!=null&&globalThis.Buffer.from!=null?Ar(globalThis.Buffer.from(t,"utf-8")):r.decoder.decode(`${r.prefix}${t}`)}function he(t,e="utf8"){let r=Us[e];if(r==null)throw new Error(`Unsupported encoding "${e}"`);return(e==="utf8"||e==="utf-8")&&globalThis.Buffer!=null&&globalThis.Buffer.from!=null?globalThis.Buffer.from(t.buffer,t.byteOffset,t.byteLength).toString("utf8"):r.encoder.encode(t).substring(1)}var rt={get(t=globalThis){let e=t.crypto;if(e==null||e.subtle==null)throw Object.assign(new Error("Missing Web Crypto API. The most likely cause of this error is that this page is being accessed from an insecure context (i.e. not HTTPS). For more information and possible resolutions see https://github.com/libp2p/js-libp2p/blob/main/packages/crypto/README.md#web-crypto-api"),{code:"ERR_MISSING_WEB_CRYPTO"});return e}};var X4=Se(jn(),1),J4=Se(yl(),1);var B1=Se(ce(),1);var Sa={};De(Sa,{Ed25519PrivateKey:()=>Kr,Ed25519PublicKey:()=>rs,generateKeyPair:()=>Xm,generateKeyPairFromSeed:()=>Ql,unmarshalEd25519PrivateKey:()=>Zm,unmarshalEd25519PublicKey:()=>Qm});var jw=Se(Ce(),1),$w=Se(Zs(),1),ml=Se(ce(),1);function St(t,e){let r=Uint8Array.from(t.abs().toByteArray());if(r=r[0]===0?r.subarray(1):r,e!=null){if(r.length>e)throw new Error("byte array longer than desired length");r=tt([new Uint8Array(e-r.length),r])}return he(r,"base64url")}function at(t){let e=bl(t);return new ml.default.jsbn.BigInteger(he(e,"base16"),16)}function bl(t,e){let r=Be(t,"base64urlpad");if(e!=null){if(r.length>e)throw new Error("byte array longer than desired length");r=tt([new Uint8Array(e-r.length),r])}return r}function pt(t){return t==null?!1:typeof t.then=="function"&&typeof t.catch=="function"&&typeof t.finally=="function"}function xl(t){if(!Number.isSafeInteger(t)||t<0)throw new Error(`Wrong positive integer: ${t}`)}function Go(t,...e){if(!(t instanceof Uint8Array))throw new Error("Expected Uint8Array");if(e.length>0&&!e.includes(t.length))throw new Error(`Expected Uint8Array of length ${e}, not of length=${t.length}`)}function vl(t){if(typeof t!="function"||typeof t.create!="function")throw new Error("Hash should be wrapped by utils.wrapConstructor");xl(t.outputLen),xl(t.blockLen)}function mn(t,e=!0){if(t.destroyed)throw new Error("Hash instance has been destroyed");if(e&&t.finished)throw new Error("Hash#digest() has already been called")}function wl(t,e){Go(t);let r=e.outputLen;if(t.length<r)throw new Error(`digestInto() expects output buffer of length at least ${r}`)}var ei=typeof globalThis=="object"&&"crypto"in globalThis?globalThis.crypto:void 0;var Sl=t=>t instanceof Uint8Array;var ti=t=>new DataView(t.buffer,t.byteOffset,t.byteLength),Et=(t,e)=>t<<32-e|t>>>e,Fy=new Uint8Array(new Uint32Array([287454020]).buffer)[0]===68;if(!Fy)throw new Error("Non little-endian hardware is not supported");function Wo(t){if(typeof t!="string")throw new Error(`utf8ToBytes expected string, got ${typeof t}`);return new Uint8Array(new TextEncoder().encode(t))}function Zn(t){if(typeof t=="string"&&(t=Wo(t)),!Sl(t))throw new Error(`expected Uint8Array, got ${typeof t}`);return t}function ri(...t){let e=new Uint8Array(t.reduce((n,s)=>n+s.length,0)),r=0;return t.forEach(n=>{if(!Sl(n))throw new Error("Uint8Array expected");e.set(n,r),r+=n.length}),e}var bn=class{clone(){return this._cloneInto()}},rS={}.toString;function ni(t){let e=n=>t().update(Zn(n)).digest(),r=t();return e.outputLen=r.outputLen,e.blockLen=r.blockLen,e.create=()=>t(),e}function xn(t=32){if(ei&&typeof ei.getRandomValues=="function")return ei.getRandomValues(new Uint8Array(t));throw new Error("crypto.getRandomValues must be defined")}function Uy(t,e,r,n){if(typeof t.setBigUint64=="function")return t.setBigUint64(e,r,n);let s=BigInt(32),i=BigInt(4294967295),o=Number(r>>s&i),a=Number(r&i),f=n?4:0,u=n?0:4;t.setUint32(e+f,o,n),t.setUint32(e+u,a,n)}var vn=class extends bn{constructor(e,r,n,s){super(),this.blockLen=e,this.outputLen=r,this.padOffset=n,this.isLE=s,this.finished=!1,this.length=0,this.pos=0,this.destroyed=!1,this.buffer=new Uint8Array(e),this.view=ti(this.buffer)}update(e){mn(this);let{view:r,buffer:n,blockLen:s}=this;e=Zn(e);let i=e.length;for(let o=0;o<i;){let a=Math.min(s-this.pos,i-o);if(a===s){let f=ti(e);for(;s<=i-o;o+=s)this.process(f,o);continue}n.set(e.subarray(o,o+a),this.pos),this.pos+=a,o+=a,this.pos===s&&(this.process(r,0),this.pos=0)}return this.length+=e.length,this.roundClean(),this}digestInto(e){mn(this),wl(e,this),this.finished=!0;let{buffer:r,view:n,blockLen:s,isLE:i}=this,{pos:o}=this;r[o++]=128,this.buffer.subarray(o).fill(0),this.padOffset>s-o&&(this.process(n,0),o=0);for(let l=o;l<s;l++)r[l]=0;Uy(n,s-8,BigInt(this.length*8),i),this.process(n,0);let a=ti(e),f=this.outputLen;if(f%4)throw new Error("_sha2: outputLen should be aligned to 32bit");let u=f/4,c=this.get();if(u>c.length)throw new Error("_sha2: outputLen bigger than state");for(let l=0;l<u;l++)a.setUint32(4*l,c[l],i)}digest(){let{buffer:e,outputLen:r}=this;this.digestInto(e);let n=e.slice(0,r);return this.destroy(),n}_cloneInto(e){e||(e=new this.constructor),e.set(...this.get());let{blockLen:r,buffer:n,length:s,finished:i,destroyed:o,pos:a}=this;return e.length=s,e.pos=a,e.finished=i,e.destroyed=o,s%r&&e.buffer.set(n),e}};var si=BigInt(4294967295),jo=BigInt(32);function El(t,e=!1){return e?{h:Number(t&si),l:Number(t>>jo&si)}:{h:Number(t>>jo&si)|0,l:Number(t&si)|0}}function Ky(t,e=!1){let r=new Uint32Array(t.length),n=new Uint32Array(t.length);for(let s=0;s<t.length;s++){let{h:i,l:o}=El(t[s],e);[r[s],n[s]]=[i,o]}return[r,n]}var qy=(t,e)=>BigInt(t>>>0)<<jo|BigInt(e>>>0),Vy=(t,e,r)=>t>>>r,zy=(t,e,r)=>t<<32-r|e>>>r,Hy=(t,e,r)=>t>>>r|e<<32-r,Gy=(t,e,r)=>t<<32-r|e>>>r,Wy=(t,e,r)=>t<<64-r|e>>>r-32,jy=(t,e,r)=>t>>>r-32|e<<64-r,$y=(t,e)=>e,Yy=(t,e)=>t,Zy=(t,e,r)=>t<<r|e>>>32-r,Qy=(t,e,r)=>e<<r|t>>>32-r,Xy=(t,e,r)=>e<<r-32|t>>>64-r,Jy=(t,e,r)=>t<<r-32|e>>>64-r;function em(t,e,r,n){let s=(e>>>0)+(n>>>0);return{h:t+r+(s/2**32|0)|0,l:s|0}}var tm=(t,e,r)=>(t>>>0)+(e>>>0)+(r>>>0),rm=(t,e,r,n)=>e+r+n+(t/2**32|0)|0,nm=(t,e,r,n)=>(t>>>0)+(e>>>0)+(r>>>0)+(n>>>0),sm=(t,e,r,n,s)=>e+r+n+s+(t/2**32|0)|0,im=(t,e,r,n,s)=>(t>>>0)+(e>>>0)+(r>>>0)+(n>>>0)+(s>>>0),om=(t,e,r,n,s,i)=>e+r+n+s+i+(t/2**32|0)|0;var am={fromBig:El,split:Ky,toBig:qy,shrSH:Vy,shrSL:zy,rotrSH:Hy,rotrSL:Gy,rotrBH:Wy,rotrBL:jy,rotr32H:$y,rotr32L:Yy,rotlSH:Zy,rotlSL:Qy,rotlBH:Xy,rotlBL:Jy,add:em,add3L:tm,add3H:rm,add4L:nm,add4H:sm,add5H:om,add5L:im},Y=am;var[cm,um]=(()=>Y.split(["0x428a2f98d728ae22","0x7137449123ef65cd","0xb5c0fbcfec4d3b2f","0xe9b5dba58189dbbc","0x3956c25bf348b538","0x59f111f1b605d019","0x923f82a4af194f9b","0xab1c5ed5da6d8118","0xd807aa98a3030242","0x12835b0145706fbe","0x243185be4ee4b28c","0x550c7dc3d5ffb4e2","0x72be5d74f27b896f","0x80deb1fe3b1696b1","0x9bdc06a725c71235","0xc19bf174cf692694","0xe49b69c19ef14ad2","0xefbe4786384f25e3","0x0fc19dc68b8cd5b5","0x240ca1cc77ac9c65","0x2de92c6f592b0275","0x4a7484aa6ea6e483","0x5cb0a9dcbd41fbd4","0x76f988da831153b5","0x983e5152ee66dfab","0xa831c66d2db43210","0xb00327c898fb213f","0xbf597fc7beef0ee4","0xc6e00bf33da88fc2","0xd5a79147930aa725","0x06ca6351e003826f","0x142929670a0e6e70","0x27b70a8546d22ffc","0x2e1b21385c26c926","0x4d2c6dfc5ac42aed","0x53380d139d95b3df","0x650a73548baf63de","0x766a0abb3c77b2a8","0x81c2c92e47edaee6","0x92722c851482353b","0xa2bfe8a14cf10364","0xa81a664bbc423001","0xc24b8b70d0f89791","0xc76c51a30654be30","0xd192e819d6ef5218","0xd69906245565a910","0xf40e35855771202a","0x106aa07032bbd1b8","0x19a4c116b8d2d0c8","0x1e376c085141ab53","0x2748774cdf8eeb99","0x34b0bcb5e19b48a8","0x391c0cb3c5c95a63","0x4ed8aa4ae3418acb","0x5b9cca4f7763e373","0x682e6ff3d6b2b8a3","0x748f82ee5defb2fc","0x78a5636f43172f60","0x84c87814a1f0ab72","0x8cc702081a6439ec","0x90befffa23631e28","0xa4506cebde82bde9","0xbef9a3f7b2c67915","0xc67178f2e372532b","0xca273eceea26619c","0xd186b8c721c0c207","0xeada7dd6cde0eb1e","0xf57d4f7fee6ed178","0x06f067aa72176fba","0x0a637dc5a2c898a6","0x113f9804bef90dae","0x1b710b35131c471b","0x28db77f523047d84","0x32caab7b40c72493","0x3c9ebe0a15c9bebc","0x431d67c49c100d4c","0x4cc5d4becb3e42b6","0x597f299cfc657e2a","0x5fcb6fab3ad6faec","0x6c44198c4a475817"].map(t=>BigInt(t))))(),lr=new Uint32Array(80),hr=new Uint32Array(80),$o=class extends vn{constructor(){super(128,64,16,!1),this.Ah=1779033703,this.Al=-205731576,this.Bh=-1150833019,this.Bl=-2067093701,this.Ch=1013904242,this.Cl=-23791573,this.Dh=-1521486534,this.Dl=1595750129,this.Eh=1359893119,this.El=-1377402159,this.Fh=-1694144372,this.Fl=725511199,this.Gh=528734635,this.Gl=-79577749,this.Hh=1541459225,this.Hl=327033209}get(){let{Ah:e,Al:r,Bh:n,Bl:s,Ch:i,Cl:o,Dh:a,Dl:f,Eh:u,El:c,Fh:l,Fl:h,Gh:g,Gl:p,Hh:d,Hl:y}=this;return[e,r,n,s,i,o,a,f,u,c,l,h,g,p,d,y]}set(e,r,n,s,i,o,a,f,u,c,l,h,g,p,d,y){this.Ah=e|0,this.Al=r|0,this.Bh=n|0,this.Bl=s|0,this.Ch=i|0,this.Cl=o|0,this.Dh=a|0,this.Dl=f|0,this.Eh=u|0,this.El=c|0,this.Fh=l|0,this.Fl=h|0,this.Gh=g|0,this.Gl=p|0,this.Hh=d|0,this.Hl=y|0}process(e,r){for(let v=0;v<16;v++,r+=4)lr[v]=e.getUint32(r),hr[v]=e.getUint32(r+=4);for(let v=16;v<80;v++){let C=lr[v-15]|0,b=hr[v-15]|0,w=Y.rotrSH(C,b,1)^Y.rotrSH(C,b,8)^Y.shrSH(C,b,7),I=Y.rotrSL(C,b,1)^Y.rotrSL(C,b,8)^Y.shrSL(C,b,7),T=lr[v-2]|0,F=hr[v-2]|0,K=Y.rotrSH(T,F,19)^Y.rotrBH(T,F,61)^Y.shrSH(T,F,6),q=Y.rotrSL(T,F,19)^Y.rotrBL(T,F,61)^Y.shrSL(T,F,6),X=Y.add4L(I,q,hr[v-7],hr[v-16]),ue=Y.add4H(X,w,K,lr[v-7],lr[v-16]);lr[v]=ue|0,hr[v]=X|0}let{Ah:n,Al:s,Bh:i,Bl:o,Ch:a,Cl:f,Dh:u,Dl:c,Eh:l,El:h,Fh:g,Fl:p,Gh:d,Gl:y,Hh:m,Hl:E}=this;for(let v=0;v<80;v++){let C=Y.rotrSH(l,h,14)^Y.rotrSH(l,h,18)^Y.rotrBH(l,h,41),b=Y.rotrSL(l,h,14)^Y.rotrSL(l,h,18)^Y.rotrBL(l,h,41),w=l&g^~l&d,I=h&p^~h&y,T=Y.add5L(E,b,I,um[v],hr[v]),F=Y.add5H(T,m,C,w,cm[v],lr[v]),K=T|0,q=Y.rotrSH(n,s,28)^Y.rotrBH(n,s,34)^Y.rotrBH(n,s,39),X=Y.rotrSL(n,s,28)^Y.rotrBL(n,s,34)^Y.rotrBL(n,s,39),ue=n&i^n&a^i&a,Fe=s&o^s&f^o&f;m=d|0,E=y|0,d=g|0,y=p|0,g=l|0,p=h|0,{h:l,l:h}=Y.add(u|0,c|0,F|0,K|0),u=a|0,c=f|0,a=i|0,f=o|0,i=n|0,o=s|0;let P=Y.add3L(K,X,Fe);n=Y.add3H(P,F,q,ue),s=P|0}({h:n,l:s}=Y.add(this.Ah|0,this.Al|0,n|0,s|0)),{h:i,l:o}=Y.add(this.Bh|0,this.Bl|0,i|0,o|0),{h:a,l:f}=Y.add(this.Ch|0,this.Cl|0,a|0,f|0),{h:u,l:c}=Y.add(this.Dh|0,this.Dl|0,u|0,c|0),{h:l,l:h}=Y.add(this.Eh|0,this.El|0,l|0,h|0),{h:g,l:p}=Y.add(this.Fh|0,this.Fl|0,g|0,p|0),{h:d,l:y}=Y.add(this.Gh|0,this.Gl|0,d|0,y|0),{h:m,l:E}=Y.add(this.Hh|0,this.Hl|0,m|0,E|0),this.set(n,s,i,o,a,f,u,c,l,h,g,p,d,y,m,E)}roundClean(){lr.fill(0),hr.fill(0)}destroy(){this.buffer.fill(0),this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0)}};var Yo=ni(()=>new $o);var ai={};De(ai,{bitGet:()=>ym,bitLen:()=>gm,bitMask:()=>Qn,bitSet:()=>mm,bytesToHex:()=>Wt,bytesToNumberBE:()=>jt,bytesToNumberLE:()=>pr,concatBytes:()=>$t,createHmacDrbg:()=>Xo,ensureBytes:()=>_e,equalBytes:()=>pm,hexToBytes:()=>Lr,hexToNumber:()=>Qo,numberToBytesBE:()=>dr,numberToBytesLE:()=>Nr,numberToHexUnpadded:()=>Cl,numberToVarBytesBE:()=>hm,utf8ToBytes:()=>dm,validateObject:()=>Mt});var Il=BigInt(0),ii=BigInt(1),fm=BigInt(2),oi=t=>t instanceof Uint8Array,lm=Array.from({length:256},(t,e)=>e.toString(16).padStart(2,"0"));function Wt(t){if(!oi(t))throw new Error("Uint8Array expected");let e="";for(let r=0;r<t.length;r++)e+=lm[t[r]];return e}function Cl(t){let e=t.toString(16);return e.length&1?`0${e}`:e}function Qo(t){if(typeof t!="string")throw new Error("hex string expected, got "+typeof t);return BigInt(t===""?"0":`0x${t}`)}function Lr(t){if(typeof t!="string")throw new Error("hex string expected, got "+typeof t);let e=t.length;if(e%2)throw new Error("padded hex string expected, got unpadded hex of length "+e);let r=new Uint8Array(e/2);for(let n=0;n<r.length;n++){let s=n*2,i=t.slice(s,s+2),o=Number.parseInt(i,16);if(Number.isNaN(o)||o<0)throw new Error("Invalid byte sequence");r[n]=o}return r}function jt(t){return Qo(Wt(t))}function pr(t){if(!oi(t))throw new Error("Uint8Array expected");return Qo(Wt(Uint8Array.from(t).reverse()))}function dr(t,e){return Lr(t.toString(16).padStart(e*2,"0"))}function Nr(t,e){return dr(t,e).reverse()}function hm(t){return Lr(Cl(t))}function _e(t,e,r){let n;if(typeof e=="string")try{n=Lr(e)}catch(i){throw new Error(`${t} must be valid hex string, got "${e}". Cause: ${i}`)}else if(oi(e))n=Uint8Array.from(e);else throw new Error(`${t} must be hex string or Uint8Array`);let s=n.length;if(typeof r=="number"&&s!==r)throw new Error(`${t} expected ${r} bytes, got ${s}`);return n}function $t(...t){let e=new Uint8Array(t.reduce((n,s)=>n+s.length,0)),r=0;return t.forEach(n=>{if(!oi(n))throw new Error("Uint8Array expected");e.set(n,r),r+=n.length}),e}function pm(t,e){if(t.length!==e.length)return!1;for(let r=0;r<t.length;r++)if(t[r]!==e[r])return!1;return!0}function dm(t){if(typeof t!="string")throw new Error(`utf8ToBytes expected string, got ${typeof t}`);return new Uint8Array(new TextEncoder().encode(t))}function gm(t){let e;for(e=0;t>Il;t>>=ii,e+=1);return e}function ym(t,e){return t>>BigInt(e)&ii}var mm=(t,e,r)=>t|(r?ii:Il)<<BigInt(e),Qn=t=>(fm<<BigInt(t-1))-ii,Zo=t=>new Uint8Array(t),_l=t=>Uint8Array.from(t);function Xo(t,e,r){if(typeof t!="number"||t<2)throw new Error("hashLen must be a number");if(typeof e!="number"||e<2)throw new Error("qByteLen must be a number");if(typeof r!="function")throw new Error("hmacFn must be a function");let n=Zo(t),s=Zo(t),i=0,o=()=>{n.fill(1),s.fill(0),i=0},a=(...l)=>r(s,n,...l),f=(l=Zo())=>{s=a(_l([0]),l),n=a(),l.length!==0&&(s=a(_l([1]),l),n=a())},u=()=>{if(i++>=1e3)throw new Error("drbg: tried 1000 values");let l=0,h=[];for(;l<e;){n=a();let g=n.slice();h.push(g),l+=n.length}return $t(...h)};return(l,h)=>{o(),f(l);let g;for(;!(g=h(u()));)f();return o(),g}}var bm={bigint:t=>typeof t=="bigint",function:t=>typeof t=="function",boolean:t=>typeof t=="boolean",string:t=>typeof t=="string",stringOrUint8Array:t=>typeof t=="string"||t instanceof Uint8Array,isSafeInteger:t=>Number.isSafeInteger(t),array:t=>Array.isArray(t),field:(t,e)=>e.Fp.isValid(t),hash:t=>typeof t=="function"&&Number.isSafeInteger(t.outputLen)};function Mt(t,e,r={}){let n=(s,i,o)=>{let a=bm[i];if(typeof a!="function")throw new Error(`Invalid validator "${i}", expected function`);let f=t[s];if(!(o&&f===void 0)&&!a(f,t))throw new Error(`Invalid param ${String(s)}=${f} (${typeof f}), expected ${i}`)};for(let[s,i]of Object.entries(e))n(s,i,!1);for(let[s,i]of Object.entries(r))n(s,i,!0);return t}var Re=BigInt(0),me=BigInt(1),Or=BigInt(2),xm=BigInt(3),Jo=BigInt(4),Bl=BigInt(5),Al=BigInt(8),vm=BigInt(9),wm=BigInt(16);function le(t,e){let r=t%e;return r>=Re?r:e+r}function Sm(t,e,r){if(r<=Re||e<Re)throw new Error("Expected power/modulo > 0");if(r===me)return Re;let n=me;for(;e>Re;)e&me&&(n=n*t%r),t=t*t%r,e>>=me;return n}function be(t,e,r){let n=t;for(;e-- >Re;)n*=n,n%=r;return n}function ci(t,e){if(t===Re||e<=Re)throw new Error(`invert: expected positive integers, got n=${t} mod=${e}`);let r=le(t,e),n=e,s=Re,i=me,o=me,a=Re;for(;r!==Re;){let u=n/r,c=n%r,l=s-o*u,h=i-a*u;n=r,r=c,s=o,i=a,o=l,a=h}if(n!==me)throw new Error("invert: does not exist");return le(s,e)}function Em(t){let e=(t-me)/Or,r,n,s;for(r=t-me,n=0;r%Or===Re;r/=Or,n++);for(s=Or;s<t&&Sm(s,e,t)!==t-me;s++);if(n===1){let o=(t+me)/Jo;return function(f,u){let c=f.pow(u,o);if(!f.eql(f.sqr(c),u))throw new Error("Cannot find square root");return c}}let i=(r+me)/Or;return function(a,f){if(a.pow(f,e)===a.neg(a.ONE))throw new Error("Cannot find square root");let u=n,c=a.pow(a.mul(a.ONE,s),r),l=a.pow(f,i),h=a.pow(f,r);for(;!a.eql(h,a.ONE);){if(a.eql(h,a.ZERO))return a.ZERO;let g=1;for(let d=a.sqr(h);g<u&&!a.eql(d,a.ONE);g++)d=a.sqr(d);let p=a.pow(c,me<<BigInt(u-g-1));c=a.sqr(p),l=a.mul(l,p),h=a.mul(h,c),u=g}return l}}function _m(t){if(t%Jo===xm){let e=(t+me)/Jo;return function(n,s){let i=n.pow(s,e);if(!n.eql(n.sqr(i),s))throw new Error("Cannot find square root");return i}}if(t%Al===Bl){let e=(t-Bl)/Al;return function(n,s){let i=n.mul(s,Or),o=n.pow(i,e),a=n.mul(s,o),f=n.mul(n.mul(a,Or),o),u=n.mul(a,n.sub(f,n.ONE));if(!n.eql(n.sqr(u),s))throw new Error("Cannot find square root");return u}}return t%wm,Em(t)}var Tl=(t,e)=>(le(t,e)&me)===me,Im=["create","isValid","is0","neg","inv","sqrt","sqr","eql","add","sub","mul","pow","div","addN","subN","mulN","sqrN"];function ea(t){let e={ORDER:"bigint",MASK:"bigint",BYTES:"isSafeInteger",BITS:"isSafeInteger"},r=Im.reduce((n,s)=>(n[s]="function",n),e);return Mt(t,r)}function Cm(t,e,r){if(r<Re)throw new Error("Expected power > 0");if(r===Re)return t.ONE;if(r===me)return e;let n=t.ONE,s=e;for(;r>Re;)r&me&&(n=t.mul(n,s)),s=t.sqr(s),r>>=me;return n}function Bm(t,e){let r=new Array(e.length),n=e.reduce((i,o,a)=>t.is0(o)?i:(r[a]=i,t.mul(i,o)),t.ONE),s=t.inv(n);return e.reduceRight((i,o,a)=>t.is0(o)?i:(r[a]=t.mul(i,r[a]),t.mul(i,o)),s),r}function ta(t,e){let r=e!==void 0?e:t.toString(2).length,n=Math.ceil(r/8);return{nBitLength:r,nByteLength:n}}function ui(t,e,r=!1,n={}){if(t<=Re)throw new Error(`Expected Field ORDER > 0, got ${t}`);let{nBitLength:s,nByteLength:i}=ta(t,e);if(i>2048)throw new Error("Field lengths over 2048 bytes are not supported");let o=_m(t),a=Object.freeze({ORDER:t,BITS:s,BYTES:i,MASK:Qn(s),ZERO:Re,ONE:me,create:f=>le(f,t),isValid:f=>{if(typeof f!="bigint")throw new Error(`Invalid field element: expected bigint, got ${typeof f}`);return Re<=f&&f<t},is0:f=>f===Re,isOdd:f=>(f&me)===me,neg:f=>le(-f,t),eql:(f,u)=>f===u,sqr:f=>le(f*f,t),add:(f,u)=>le(f+u,t),sub:(f,u)=>le(f-u,t),mul:(f,u)=>le(f*u,t),pow:(f,u)=>Cm(a,f,u),div:(f,u)=>le(f*ci(u,t),t),sqrN:f=>f*f,addN:(f,u)=>f+u,subN:(f,u)=>f-u,mulN:(f,u)=>f*u,inv:f=>ci(f,t),sqrt:n.sqrt||(f=>o(a,f)),invertBatch:f=>Bm(a,f),cmov:(f,u,c)=>c?u:f,toBytes:f=>r?Nr(f,i):dr(f,i),fromBytes:f=>{if(f.length!==i)throw new Error(`Fp.fromBytes: expected ${i}, got ${f.length}`);return r?pr(f):jt(f)}});return Object.freeze(a)}function Pl(t,e){if(!t.isOdd)throw new Error("Field doesn't have isOdd");let r=t.sqrt(e);return t.isOdd(r)?t.neg(r):r}function Rl(t){if(typeof t!="bigint")throw new Error("field order must be bigint");let e=t.toString(2).length;return Math.ceil(e/8)}function ra(t){let e=Rl(t);return e+Math.ceil(e/2)}function Dl(t,e,r=!1){let n=t.length,s=Rl(e),i=ra(e);if(n<16||n<i||n>1024)throw new Error(`expected ${i}-1024 bytes of input, got ${n}`);let o=r?jt(t):pr(t),a=le(o,e-me)+me;return r?Nr(a,s):dr(a,s)}var Tm=BigInt(0),na=BigInt(1);function fi(t,e){let r=(s,i)=>{let o=i.negate();return s?o:i},n=s=>{let i=Math.ceil(e/s)+1,o=2**(s-1);return{windows:i,windowSize:o}};return{constTimeNegate:r,unsafeLadder(s,i){let o=t.ZERO,a=s;for(;i>Tm;)i&na&&(o=o.add(a)),a=a.double(),i>>=na;return o},precomputeWindow(s,i){let{windows:o,windowSize:a}=n(i),f=[],u=s,c=u;for(let l=0;l<o;l++){c=u,f.push(c);for(let h=1;h<a;h++)c=c.add(u),f.push(c);u=c.double()}return f},wNAF(s,i,o){let{windows:a,windowSize:f}=n(s),u=t.ZERO,c=t.BASE,l=BigInt(2**s-1),h=2**s,g=BigInt(s);for(let p=0;p<a;p++){let d=p*f,y=Number(o&l);o>>=g,y>f&&(y-=h,o+=na);let m=d,E=d+Math.abs(y)-1,v=p%2!==0,C=y<0;y===0?c=c.add(r(v,i[m])):u=u.add(r(C,i[E]))}return{p:u,f:c}},wNAFCached(s,i,o,a){let f=s._WINDOW_SIZE||1,u=i.get(s);return u||(u=this.precomputeWindow(s,f),f!==1&&i.set(s,a(u))),this.wNAF(f,u,o)}}}function Xn(t){return ea(t.Fp),Mt(t,{n:"bigint",h:"bigint",Gx:"field",Gy:"field"},{nBitLength:"isSafeInteger",nByteLength:"isSafeInteger"}),Object.freeze({...ta(t.n,t.nBitLength),...t,p:t.Fp.ORDER})}var _t=BigInt(0),ct=BigInt(1),li=BigInt(2),Pm=BigInt(8),Rm={zip215:!0};function Dm(t){let e=Xn(t);return Mt(t,{hash:"function",a:"bigint",d:"bigint",randomBytes:"function"},{adjustScalarBytes:"function",domain:"function",uvRatio:"function",mapToCurve:"function"}),Object.freeze({...e})}function hi(t){let e=Dm(t),{Fp:r,n,prehash:s,hash:i,randomBytes:o,nByteLength:a,h:f}=e,u=li<<BigInt(a*8)-ct,c=r.create,l=e.uvRatio||((k,B)=>{try{return{isValid:!0,value:r.sqrt(k*r.inv(B))}}catch{return{isValid:!1,value:_t}}}),h=e.adjustScalarBytes||(k=>k),g=e.domain||((k,B,O)=>{if(B.length||O)throw new Error("Contexts/pre-hash are not supported");return k}),p=k=>typeof k=="bigint"&&_t<k,d=(k,B)=>p(k)&&p(B)&&k<B,y=k=>k===_t||d(k,u);function m(k,B){if(d(k,B))return k;throw new Error(`Expected valid scalar < ${B}, got ${typeof k} ${k}`)}function E(k){return k===_t?k:m(k,n)}let v=new Map;function C(k){if(!(k instanceof b))throw new Error("ExtendedPoint expected")}class b{constructor(B,O,V,W){if(this.ex=B,this.ey=O,this.ez=V,this.et=W,!y(B))throw new Error("x required");if(!y(O))throw new Error("y required");if(!y(V))throw new Error("z required");if(!y(W))throw new Error("t required")}get x(){return this.toAffine().x}get y(){return this.toAffine().y}static fromAffine(B){if(B instanceof b)throw new Error("extended point not allowed");let{x:O,y:V}=B||{};if(!y(O)||!y(V))throw new Error("invalid affine point");return new b(O,V,ct,c(O*V))}static normalizeZ(B){let O=r.invertBatch(B.map(V=>V.ez));return B.map((V,W)=>V.toAffine(O[W])).map(b.fromAffine)}_setWindowSize(B){this._WINDOW_SIZE=B,v.delete(this)}assertValidity(){let{a:B,d:O}=e;if(this.is0())throw new Error("bad point: ZERO");let{ex:V,ey:W,ez:Z,et:J}=this,ae=c(V*V),ee=c(W*W),se=c(Z*Z),Ae=c(se*se),we=c(ae*B),Ue=c(se*c(we+ee)),Ke=c(Ae+c(O*c(ae*ee)));if(Ue!==Ke)throw new Error("bad point: equation left != right (1)");let Te=c(V*W),Ve=c(Z*J);if(Te!==Ve)throw new Error("bad point: equation left != right (2)")}equals(B){C(B);let{ex:O,ey:V,ez:W}=this,{ex:Z,ey:J,ez:ae}=B,ee=c(O*ae),se=c(Z*W),Ae=c(V*ae),we=c(J*W);return ee===se&&Ae===we}is0(){return this.equals(b.ZERO)}negate(){return new b(c(-this.ex),this.ey,this.ez,c(-this.et))}double(){let{a:B}=e,{ex:O,ey:V,ez:W}=this,Z=c(O*O),J=c(V*V),ae=c(li*c(W*W)),ee=c(B*Z),se=O+V,Ae=c(c(se*se)-Z-J),we=ee+J,Ue=we-ae,Ke=ee-J,Te=c(Ae*Ue),Ve=c(we*Ke),Ft=c(Ae*Ke),vr=c(Ue*we);return new b(Te,Ve,vr,Ft)}add(B){C(B);let{a:O,d:V}=e,{ex:W,ey:Z,ez:J,et:ae}=this,{ex:ee,ey:se,ez:Ae,et:we}=B;if(O===BigInt(-1)){let Va=c((Z-W)*(se+ee)),za=c((Z+W)*(se-ee)),Ci=c(za-Va);if(Ci===_t)return this.double();let Ha=c(J*li*we),Ga=c(ae*li*Ae),Wa=Ga+Ha,ja=za+Va,$a=Ga-Ha,Y0=c(Wa*Ci),Z0=c(ja*$a),Q0=c(Wa*$a),X0=c(Ci*ja);return new b(Y0,Z0,X0,Q0)}let Ue=c(W*ee),Ke=c(Z*se),Te=c(ae*V*we),Ve=c(J*Ae),Ft=c((W+Z)*(ee+se)-Ue-Ke),vr=Ve-Te,Tn=Ve+Te,qa=c(Ke-O*Ue),G0=c(Ft*vr),W0=c(Tn*qa),j0=c(Ft*qa),$0=c(vr*Tn);return new b(G0,W0,$0,j0)}subtract(B){return this.add(B.negate())}wNAF(B){return T.wNAFCached(this,v,B,b.normalizeZ)}multiply(B){let{p:O,f:V}=this.wNAF(m(B,n));return b.normalizeZ([O,V])[0]}multiplyUnsafe(B){let O=E(B);return O===_t?I:this.equals(I)||O===ct?this:this.equals(w)?this.wNAF(O).p:T.unsafeLadder(this,O)}isSmallOrder(){return this.multiplyUnsafe(f).is0()}isTorsionFree(){return T.unsafeLadder(this,n).is0()}toAffine(B){let{ex:O,ey:V,ez:W}=this,Z=this.is0();B==null&&(B=Z?Pm:r.inv(W));let J=c(O*B),ae=c(V*B),ee=c(W*B);if(Z)return{x:_t,y:ct};if(ee!==ct)throw new Error("invZ was invalid");return{x:J,y:ae}}clearCofactor(){let{h:B}=e;return B===ct?this:this.multiplyUnsafe(B)}static fromHex(B,O=!1){let{d:V,a:W}=e,Z=r.BYTES;B=_e("pointHex",B,Z);let J=B.slice(),ae=B[Z-1];J[Z-1]=ae&-129;let ee=pr(J);ee===_t||(O?m(ee,u):m(ee,r.ORDER));let se=c(ee*ee),Ae=c(se-ct),we=c(V*se-W),{isValid:Ue,value:Ke}=l(Ae,we);if(!Ue)throw new Error("Point.fromHex: invalid y coordinate");let Te=(Ke&ct)===ct,Ve=(ae&128)!==0;if(!O&&Ke===_t&&Ve)throw new Error("Point.fromHex: x=0 and x_0=1");return Ve!==Te&&(Ke=c(-Ke)),b.fromAffine({x:Ke,y:ee})}static fromPrivateKey(B){return q(B).point}toRawBytes(){let{x:B,y:O}=this.toAffine(),V=Nr(O,r.BYTES);return V[V.length-1]|=B&ct?128:0,V}toHex(){return Wt(this.toRawBytes())}}b.BASE=new b(e.Gx,e.Gy,ct,c(e.Gx*e.Gy)),b.ZERO=new b(_t,ct,ct,_t);let{BASE:w,ZERO:I}=b,T=fi(b,a*8);function F(k){return le(k,n)}function K(k){return F(pr(k))}function q(k){let B=a;k=_e("private key",k,B);let O=_e("hashed private key",i(k),2*B),V=h(O.slice(0,B)),W=O.slice(B,2*B),Z=K(V),J=w.multiply(Z),ae=J.toRawBytes();return{head:V,prefix:W,scalar:Z,point:J,pointBytes:ae}}function X(k){return q(k).pointBytes}function ue(k=new Uint8Array,...B){let O=$t(...B);return K(i(g(O,_e("context",k),!!s)))}function Fe(k,B,O={}){k=_e("message",k),s&&(k=s(k));let{prefix:V,scalar:W,pointBytes:Z}=q(B),J=ue(O.context,V,k),ae=w.multiply(J).toRawBytes(),ee=ue(O.context,ae,Z,k),se=F(J+ee*W);E(se);let Ae=$t(ae,Nr(se,r.BYTES));return _e("result",Ae,a*2)}let P=Rm;function M(k,B,O,V=P){let{context:W,zip215:Z}=V,J=r.BYTES;k=_e("signature",k,2*J),B=_e("message",B),s&&(B=s(B));let ae=pr(k.slice(J,2*J)),ee,se,Ae;try{ee=b.fromHex(O,Z),se=b.fromHex(k.slice(0,J),Z),Ae=w.multiplyUnsafe(ae)}catch{return!1}if(!Z&&ee.isSmallOrder())return!1;let we=ue(W,se.toRawBytes(),ee.toRawBytes(),B);return se.add(ee.multiplyUnsafe(we)).subtract(Ae).clearCofactor().equals(b.ZERO)}return w._setWindowSize(8),{CURVE:e,getPublicKey:X,sign:Fe,verify:M,ExtendedPoint:b,utils:{getExtendedPublicKey:q,randomPrivateKey:()=>o(r.BYTES),precompute(k=8,B=b.BASE){return B._setWindowSize(k),B.multiply(BigInt(3)),B}}}}var ia=BigInt("57896044618658097711785492504343953926634992332820282019728792003956564819949"),kl=BigInt("19681161376707505956807079304988542015446066515923890162744021073123829784752"),_S=BigInt(0),km=BigInt(1),sa=BigInt(2),Mm=BigInt(5),Ml=BigInt(10),Lm=BigInt(20),Nm=BigInt(40),Ll=BigInt(80);function Om(t){let e=ia,n=t*t%e*t%e,s=be(n,sa,e)*n%e,i=be(s,km,e)*t%e,o=be(i,Mm,e)*i%e,a=be(o,Ml,e)*o%e,f=be(a,Lm,e)*a%e,u=be(f,Nm,e)*f%e,c=be(u,Ll,e)*u%e,l=be(c,Ll,e)*u%e,h=be(l,Ml,e)*o%e;return{pow_p_5_8:be(h,sa,e)*t%e,b2:n}}function Fm(t){return t[0]&=248,t[31]&=127,t[31]|=64,t}function Um(t,e){let r=ia,n=le(e*e*e,r),s=le(n*n*e,r),i=Om(t*s).pow_p_5_8,o=le(t*n*i,r),a=le(e*o*o,r),f=o,u=le(o*kl,r),c=a===t,l=a===le(-t,r),h=a===le(-t*kl,r);return c&&(o=f),(l||h)&&(o=u),Tl(o,r)&&(o=le(-o,r)),{isValid:c||l,value:o}}var Yt=ui(ia,void 0,!0),oa={a:BigInt(-1),d:BigInt("37095705934669439343138083508754565189542113879843219016388785533085940283555"),Fp:Yt,n:BigInt("7237005577332262213973186563042994240857116359379907606001950938285454250989"),h:BigInt(8),Gx:BigInt("15112221349535400772501151409588531511454012693041857206046113283949847762202"),Gy:BigInt("46316835694926478169428394003475163141307993866256225615783033603165251855960"),hash:Yo,randomBytes:xn,adjustScalarBytes:Fm,uvRatio:Um},wn=hi(oa);function Nl(t,e,r){if(e.length>255)throw new Error("Context is too big");return ri(Wo("SigEd25519 no Ed25519 collisions"),new Uint8Array([r?1:0,e.length]),e,t)}var IS=hi({...oa,domain:Nl}),CS=hi({...oa,domain:Nl,prehash:Yo});var Km=(Yt.ORDER+BigInt(3))/BigInt(8),BS=Yt.pow(sa,Km),AS=Yt.sqrt(Yt.neg(Yt.ONE)),TS=(Yt.ORDER-BigInt(5))/BigInt(8),PS=BigInt(486662);var RS=Pl(Yt,Yt.neg(BigInt(486664)));var DS=BigInt("25063068953384623474111414158702152701244531502492656460079210482610430750235"),kS=BigInt("54469307008909316920995813868745141605393597292927456921205312896311721017578"),MS=BigInt("1159843021668779879193775521855586647937357759715417654439879720876111806838"),LS=BigInt("40440834346308536858101042469323190826248399146238708352240133220865137265952");var NS=BigInt("0x7fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff");var Sn=32,Zt=64,pi=32;function Ol(){let t=wn.utils.randomPrivateKey(),e=wn.getPublicKey(t);return{privateKey:ql(t,e),publicKey:e}}function Fl(t){if(t.length!==pi)throw new TypeError('"seed" must be 32 bytes in length.');if(!(t instanceof Uint8Array))throw new TypeError('"seed" must be a node.js Buffer, or Uint8Array.');let e=t,r=wn.getPublicKey(e);return{privateKey:ql(e,r),publicKey:r}}function Ul(t,e){let r=t.subarray(0,pi);return wn.sign(e instanceof Uint8Array?e:e.subarray(),r)}function Kl(t,e,r){return wn.verify(e,r instanceof Uint8Array?r:r.subarray(),t)}function ql(t,e){let r=new Uint8Array(Zt);for(let n=0;n<pi;n++)r[n]=t[n],r[pi+n]=e[n];return r}var aa={alg:"A128GCM",ext:!0,k:"scm9jmO_4BJAgdwWGVulLg",key_ops:["encrypt","decrypt"],kty:"oct"};function ca(t){let e=t?.algorithm??"AES-GCM",r=t?.keyLength??16,n=t?.nonceLength??12,s=t?.digest??"SHA-256",i=t?.saltLength??16,o=t?.iterations??32767,a=rt.get();r*=8;async function f(l,h){let g=a.getRandomValues(new Uint8Array(i)),p=a.getRandomValues(new Uint8Array(n)),d={name:e,iv:p};typeof h=="string"&&(h=Be(h));let y;if(h.length===0){y=await a.subtle.importKey("jwk",aa,{name:"AES-GCM"},!0,["encrypt"]);try{let E={name:"PBKDF2",salt:g,iterations:o,hash:{name:s}},v=await a.subtle.importKey("raw",h,{name:"PBKDF2"},!1,["deriveKey"]);y=await a.subtle.deriveKey(E,v,{name:e,length:r},!0,["encrypt"])}catch{y=await a.subtle.importKey("jwk",aa,{name:"AES-GCM"},!0,["encrypt"])}}else{let E={name:"PBKDF2",salt:g,iterations:o,hash:{name:s}},v=await a.subtle.importKey("raw",h,{name:"PBKDF2"},!1,["deriveKey"]);y=await a.subtle.deriveKey(E,v,{name:e,length:r},!0,["encrypt"])}let m=await a.subtle.encrypt(d,y,l);return tt([g,d.iv,new Uint8Array(m)])}async function u(l,h){let g=l.subarray(0,i),p=l.subarray(i,i+n),d=l.subarray(i+n),y={name:e,iv:p};typeof h=="string"&&(h=Be(h));let m;if(h.length===0)try{let v={name:"PBKDF2",salt:g,iterations:o,hash:{name:s}},C=await a.subtle.importKey("raw",h,{name:"PBKDF2"},!1,["deriveKey"]);m=await a.subtle.deriveKey(v,C,{name:e,length:r},!0,["decrypt"])}catch{m=await a.subtle.importKey("jwk",aa,{name:"AES-GCM"},!0,["decrypt"])}else{let v={name:"PBKDF2",salt:g,iterations:o,hash:{name:s}},C=await a.subtle.importKey("raw",h,{name:"PBKDF2"},!1,["deriveKey"]);m=await a.subtle.deriveKey(v,C,{name:e,length:r},!0,["decrypt"])}let E=await a.subtle.decrypt(y,m,d);return new Uint8Array(E)}return{encrypt:f,decrypt:u}}async function En(t,e){let n=await ca().encrypt(t,e);return Wr.encode(n)}var ua=new Float32Array([-0]),gr=new Uint8Array(ua.buffer);function zl(t,e,r){ua[0]=t,e[r]=gr[0],e[r+1]=gr[1],e[r+2]=gr[2],e[r+3]=gr[3]}function Hl(t,e){return gr[0]=t[e],gr[1]=t[e+1],gr[2]=t[e+2],gr[3]=t[e+3],ua[0]}var fa=new Float64Array([-0]),je=new Uint8Array(fa.buffer);function Gl(t,e,r){fa[0]=t,e[r]=je[0],e[r+1]=je[1],e[r+2]=je[2],e[r+3]=je[3],e[r+4]=je[4],e[r+5]=je[5],e[r+6]=je[6],e[r+7]=je[7]}function Wl(t,e){return je[0]=t[e],je[1]=t[e+1],je[2]=t[e+2],je[3]=t[e+3],je[4]=t[e+4],je[5]=t[e+5],je[6]=t[e+6],je[7]=t[e+7],fa[0]}var Vm=BigInt(Number.MAX_SAFE_INTEGER),zm=BigInt(Number.MIN_SAFE_INTEGER),st=class t{lo;hi;constructor(e,r){this.lo=e|0,this.hi=r|0}toNumber(e=!1){if(!e&&this.hi>>>31>0){let r=~this.lo+1>>>0,n=~this.hi>>>0;return r===0&&(n=n+1>>>0),-(r+n*4294967296)}return this.lo+this.hi*4294967296}toBigInt(e=!1){if(e)return BigInt(this.lo>>>0)+(BigInt(this.hi>>>0)<<32n);if(this.hi>>>31){let r=~this.lo+1>>>0,n=~this.hi>>>0;return r===0&&(n=n+1>>>0),-(BigInt(r)+(BigInt(n)<<32n))}return BigInt(this.lo>>>0)+(BigInt(this.hi>>>0)<<32n)}toString(e=!1){return this.toBigInt(e).toString()}zzEncode(){let e=this.hi>>31;return this.hi=((this.hi<<1|this.lo>>>31)^e)>>>0,this.lo=(this.lo<<1^e)>>>0,this}zzDecode(){let e=-(this.lo&1);return this.lo=((this.lo>>>1|this.hi<<31)^e)>>>0,this.hi=(this.hi>>>1^e)>>>0,this}length(){let e=this.lo,r=(this.lo>>>28|this.hi<<4)>>>0,n=this.hi>>>24;return n===0?r===0?e<16384?e<128?1:2:e<2097152?3:4:r<16384?r<128?5:6:r<2097152?7:8:n<128?9:10}static fromBigInt(e){if(e===0n)return Fr;if(e<Vm&&e>zm)return this.fromNumber(Number(e));let r=e<0n;r&&(e=-e);let n=e>>32n,s=e-(n<<32n);return r&&(n=~n|0n,s=~s|0n,++s>jl&&(s=0n,++n>jl&&(n=0n))),new t(Number(s),Number(n))}static fromNumber(e){if(e===0)return Fr;let r=e<0;r&&(e=-e);let n=e>>>0,s=(e-n)/4294967296>>>0;return r&&(s=~s>>>0,n=~n>>>0,++n>4294967295&&(n=0,++s>4294967295&&(s=0))),new t(n,s)}static from(e){return typeof e=="number"?t.fromNumber(e):typeof e=="bigint"?t.fromBigInt(e):typeof e=="string"?t.fromBigInt(BigInt(e)):e.low!=null||e.high!=null?new t(e.low>>>0,e.high>>>0):Fr}},Fr=new st(0,0);Fr.toBigInt=function(){return 0n};Fr.zzEncode=Fr.zzDecode=function(){return this};Fr.length=function(){return 1};var jl=4294967296n;function $l(t){let e=0,r=0;for(let n=0;n<t.length;++n)r=t.charCodeAt(n),r<128?e+=1:r<2048?e+=2:(r&64512)===55296&&(t.charCodeAt(n+1)&64512)===56320?(++n,e+=4):e+=3;return e}function Yl(t,e,r){if(r-e<1)return"";let s,i=[],o=0,a;for(;e<r;)a=t[e++],a<128?i[o++]=a:a>191&&a<224?i[o++]=(a&31)<<6|t[e++]&63:a>239&&a<365?(a=((a&7)<<18|(t[e++]&63)<<12|(t[e++]&63)<<6|t[e++]&63)-65536,i[o++]=55296+(a>>10),i[o++]=56320+(a&1023)):i[o++]=(a&15)<<12|(t[e++]&63)<<6|t[e++]&63,o>8191&&((s??(s=[])).push(String.fromCharCode.apply(String,i)),o=0);return s!=null?(o>0&&s.push(String.fromCharCode.apply(String,i.slice(0,o))),s.join("")):String.fromCharCode.apply(String,i.slice(0,o))}function la(t,e,r){let n=r,s,i;for(let o=0;o<t.length;++o)s=t.charCodeAt(o),s<128?e[r++]=s:s<2048?(e[r++]=s>>6|192,e[r++]=s&63|128):(s&64512)===55296&&((i=t.charCodeAt(o+1))&64512)===56320?(s=65536+((s&1023)<<10)+(i&1023),++o,e[r++]=s>>18|240,e[r++]=s>>12&63|128,e[r++]=s>>6&63|128,e[r++]=s&63|128):(e[r++]=s>>12|224,e[r++]=s>>6&63|128,e[r++]=s&63|128);return r-n}function It(t,e){return RangeError(`index out of range: ${t.pos} + ${e??1} > ${t.len}`)}function di(t,e){return(t[e-4]|t[e-3]<<8|t[e-2]<<16|t[e-1]<<24)>>>0}var ha=class{buf;pos;len;_slice=Uint8Array.prototype.subarray;constructor(e){this.buf=e,this.pos=0,this.len=e.length}uint32(){let e=4294967295;if(e=(this.buf[this.pos]&127)>>>0,this.buf[this.pos++]<128||(e=(e|(this.buf[this.pos]&127)<<7)>>>0,this.buf[this.pos++]<128)||(e=(e|(this.buf[this.pos]&127)<<14)>>>0,this.buf[this.pos++]<128)||(e=(e|(this.buf[this.pos]&127)<<21)>>>0,this.buf[this.pos++]<128)||(e=(e|(this.buf[this.pos]&15)<<28)>>>0,this.buf[this.pos++]<128))return e;if((this.pos+=5)>this.len)throw this.pos=this.len,It(this,10);return e}int32(){return this.uint32()|0}sint32(){let e=this.uint32();return e>>>1^-(e&1)|0}bool(){return this.uint32()!==0}fixed32(){if(this.pos+4>this.len)throw It(this,4);return di(this.buf,this.pos+=4)}sfixed32(){if(this.pos+4>this.len)throw It(this,4);return di(this.buf,this.pos+=4)|0}float(){if(this.pos+4>this.len)throw It(this,4);let e=Hl(this.buf,this.pos);return this.pos+=4,e}double(){if(this.pos+8>this.len)throw It(this,4);let e=Wl(this.buf,this.pos);return this.pos+=8,e}bytes(){let e=this.uint32(),r=this.pos,n=this.pos+e;if(n>this.len)throw It(this,e);return this.pos+=e,r===n?new Uint8Array(0):this.buf.subarray(r,n)}string(){let e=this.bytes();return Yl(e,0,e.length)}skip(e){if(typeof e=="number"){if(this.pos+e>this.len)throw It(this,e);this.pos+=e}else do if(this.pos>=this.len)throw It(this);while(this.buf[this.pos++]&128);return this}skipType(e){switch(e){case 0:this.skip();break;case 1:this.skip(8);break;case 2:this.skip(this.uint32());break;case 3:for(;(e=this.uint32()&7)!==4;)this.skipType(e);break;case 5:this.skip(4);break;default:throw Error(`invalid wire type ${e} at offset ${this.pos}`)}return this}readLongVarint(){let e=new st(0,0),r=0;if(this.len-this.pos>4){for(;r<4;++r)if(e.lo=(e.lo|(this.buf[this.pos]&127)<<r*7)>>>0,this.buf[this.pos++]<128)return e;if(e.lo=(e.lo|(this.buf[this.pos]&127)<<28)>>>0,e.hi=(e.hi|(this.buf[this.pos]&127)>>4)>>>0,this.buf[this.pos++]<128)return e;r=0}else{for(;r<3;++r){if(this.pos>=this.len)throw It(this);if(e.lo=(e.lo|(this.buf[this.pos]&127)<<r*7)>>>0,this.buf[this.pos++]<128)return e}return e.lo=(e.lo|(this.buf[this.pos++]&127)<<r*7)>>>0,e}if(this.len-this.pos>4){for(;r<5;++r)if(e.hi=(e.hi|(this.buf[this.pos]&127)<<r*7+3)>>>0,this.buf[this.pos++]<128)return e}else for(;r<5;++r){if(this.pos>=this.len)throw It(this);if(e.hi=(e.hi|(this.buf[this.pos]&127)<<r*7+3)>>>0,this.buf[this.pos++]<128)return e}throw Error("invalid varint encoding")}readFixed64(){if(this.pos+8>this.len)throw It(this,8);let e=di(this.buf,this.pos+=4),r=di(this.buf,this.pos+=4);return new st(e,r)}int64(){return this.readLongVarint().toBigInt()}int64Number(){return this.readLongVarint().toNumber()}int64String(){return this.readLongVarint().toString()}uint64(){return this.readLongVarint().toBigInt(!0)}uint64Number(){return this.readLongVarint().toNumber(!0)}uint64String(){return this.readLongVarint().toString(!0)}sint64(){return this.readLongVarint().zzDecode().toBigInt()}sint64Number(){return this.readLongVarint().zzDecode().toNumber()}sint64String(){return this.readLongVarint().zzDecode().toString()}fixed64(){return this.readFixed64().toBigInt()}fixed64Number(){return this.readFixed64().toNumber()}fixed64String(){return this.readFixed64().toString()}sfixed64(){return this.readFixed64().toBigInt()}sfixed64Number(){return this.readFixed64().toNumber()}sfixed64String(){return this.readFixed64().toString()}};function pa(t){return new ha(t instanceof Uint8Array?t:t.subarray())}function gi(t,e){let r=pa(t);return e.decode(r)}function da(t){let e=t??8192,r=e>>>1,n,s=e;return function(o){if(o<1||o>r)return Ge(o);s+o>e&&(n=Ge(e),s=0);let a=n.subarray(s,s+=o);return s&7&&(s=(s|7)+1),a}}var Ur=class{fn;len;next;val;constructor(e,r,n){this.fn=e,this.len=r,this.next=void 0,this.val=n}};function ga(){}var ma=class{head;tail;len;next;constructor(e){this.head=e.head,this.tail=e.tail,this.len=e.len,this.next=e.states}},Hm=da();function Gm(t){return globalThis.Buffer!=null?Ge(t):Hm(t)}var ts=class{len;head;tail;states;constructor(){this.len=0,this.head=new Ur(ga,0,0),this.tail=this.head,this.states=null}_push(e,r,n){return this.tail=this.tail.next=new Ur(e,r,n),this.len+=r,this}uint32(e){return this.len+=(this.tail=this.tail.next=new ba((e=e>>>0)<128?1:e<16384?2:e<2097152?3:e<268435456?4:5,e)).len,this}int32(e){return e<0?this._push(Jn,10,st.fromNumber(e)):this.uint32(e)}sint32(e){return this.uint32((e<<1^e>>31)>>>0)}uint64(e){let r=st.fromBigInt(e);return this._push(Jn,r.length(),r)}uint64Number(e){let r=st.fromNumber(e);return this._push(Jn,r.length(),r)}uint64String(e){return this.uint64(BigInt(e))}int64(e){return this.uint64(e)}int64Number(e){return this.uint64Number(e)}int64String(e){return this.uint64String(e)}sint64(e){let r=st.fromBigInt(e).zzEncode();return this._push(Jn,r.length(),r)}sint64Number(e){let r=st.fromNumber(e).zzEncode();return this._push(Jn,r.length(),r)}sint64String(e){return this.sint64(BigInt(e))}bool(e){return this._push(ya,1,e?1:0)}fixed32(e){return this._push(es,4,e>>>0)}sfixed32(e){return this.fixed32(e)}fixed64(e){let r=st.fromBigInt(e);return this._push(es,4,r.lo)._push(es,4,r.hi)}fixed64Number(e){let r=st.fromNumber(e);return this._push(es,4,r.lo)._push(es,4,r.hi)}fixed64String(e){return this.fixed64(BigInt(e))}sfixed64(e){return this.fixed64(e)}sfixed64Number(e){return this.fixed64Number(e)}sfixed64String(e){return this.fixed64String(e)}float(e){return this._push(zl,4,e)}double(e){return this._push(Gl,8,e)}bytes(e){let r=e.length>>>0;return r===0?this._push(ya,1,0):this.uint32(r)._push(jm,r,e)}string(e){let r=$l(e);return r!==0?this.uint32(r)._push(la,r,e):this._push(ya,1,0)}fork(){return this.states=new ma(this),this.head=this.tail=new Ur(ga,0,0),this.len=0,this}reset(){return this.states!=null?(this.head=this.states.head,this.tail=this.states.tail,this.len=this.states.len,this.states=this.states.next):(this.head=this.tail=new Ur(ga,0,0),this.len=0),this}ldelim(){let e=this.head,r=this.tail,n=this.len;return this.reset().uint32(n),n!==0&&(this.tail.next=e.next,this.tail=r,this.len+=n),this}finish(){let e=this.head.next,r=Gm(this.len),n=0;for(;e!=null;)e.fn(e.val,r,n),n+=e.len,e=e.next;return r}};function ya(t,e,r){e[r]=t&255}function Wm(t,e,r){for(;t>127;)e[r++]=t&127|128,t>>>=7;e[r]=t}var ba=class extends Ur{next;constructor(e,r){super(Wm,e,r),this.next=void 0}};function Jn(t,e,r){for(;t.hi!==0;)e[r++]=t.lo&127|128,t.lo=(t.lo>>>7|t.hi<<25)>>>0,t.hi>>>=7;for(;t.lo>127;)e[r++]=t.lo&127|128,t.lo=t.lo>>>7;e[r++]=t.lo}function es(t,e,r){e[r]=t&255,e[r+1]=t>>>8&255,e[r+2]=t>>>16&255,e[r+3]=t>>>24}function jm(t,e,r){e.set(t,r)}globalThis.Buffer!=null&&(ts.prototype.bytes=function(t){let e=t.length>>>0;return this.uint32(e),e>0&&this._push($m,e,t),this},ts.prototype.string=function(t){let e=globalThis.Buffer.byteLength(t);return this.uint32(e),e>0&&this._push(Ym,e,t),this});function $m(t,e,r){e.set(t,r)}function Ym(t,e,r){t.length<40?la(t,e,r):e.utf8Write!=null?e.utf8Write(t,r):e.set(Be(t),r)}function xa(){return new ts}function yi(t,e){let r=xa();return e.encode(t,r,{lengthDelimited:!1}),r.finish()}var _n;(function(t){t[t.VARINT=0]="VARINT",t[t.BIT64=1]="BIT64",t[t.LENGTH_DELIMITED=2]="LENGTH_DELIMITED",t[t.START_GROUP=3]="START_GROUP",t[t.END_GROUP=4]="END_GROUP",t[t.BIT32=5]="BIT32"})(_n||(_n={}));function mi(t,e,r,n){return{name:t,type:e,encode:r,decode:n}}function va(t){function e(s){if(t[s.toString()]==null)throw new Error("Invalid enum value");return t[s]}let r=function(i,o){let a=e(i);o.int32(a)},n=function(i){let o=i.int32();return e(o)};return mi("enum",_n.VARINT,r,n)}function bi(t,e){return mi("message",_n.LENGTH_DELIMITED,t,e)}var xe;(function(t){t.RSA="RSA",t.Ed25519="Ed25519",t.Secp256k1="Secp256k1"})(xe||(xe={}));var wa;(function(t){t[t.RSA=0]="RSA",t[t.Ed25519=1]="Ed25519",t[t.Secp256k1=2]="Secp256k1"})(wa||(wa={}));(function(t){t.codec=()=>va(wa)})(xe||(xe={}));var Lt;(function(t){let e;t.codec=()=>(e==null&&(e=bi((r,n,s={})=>{s.lengthDelimited!==!1&&n.fork(),r.Type!=null&&(n.uint32(8),xe.codec().encode(r.Type,n)),r.Data!=null&&(n.uint32(18),n.bytes(r.Data)),s.lengthDelimited!==!1&&n.ldelim()},(r,n)=>{let s={},i=n==null?r.len:r.pos+n;for(;r.pos<i;){let o=r.uint32();switch(o>>>3){case 1:s.Type=xe.codec().decode(r);break;case 2:s.Data=r.bytes();break;default:r.skipType(o&7);break}}return s})),e),t.encode=r=>yi(r,t.codec()),t.decode=r=>gi(r,t.codec())})(Lt||(Lt={}));var Nt;(function(t){let e;t.codec=()=>(e==null&&(e=bi((r,n,s={})=>{s.lengthDelimited!==!1&&n.fork(),r.Type!=null&&(n.uint32(8),xe.codec().encode(r.Type,n)),r.Data!=null&&(n.uint32(18),n.bytes(r.Data)),s.lengthDelimited!==!1&&n.ldelim()},(r,n)=>{let s={},i=n==null?r.len:r.pos+n;for(;r.pos<i;){let o=r.uint32();switch(o>>>3){case 1:s.Type=xe.codec().decode(r);break;case 2:s.Data=r.bytes();break;default:r.skipType(o&7);break}}return s})),e),t.encode=r=>yi(r,t.codec()),t.decode=r=>gi(r,t.codec())})(Nt||(Nt={}));var rs=class{_key;constructor(e){this._key=In(e,Sn)}verify(e,r){return Kl(this._key,r,e)}marshal(){return this._key}get bytes(){return Lt.encode({Type:xe.Ed25519,Data:this.marshal()}).subarray()}equals(e){return qe(this.bytes,e.bytes)}hash(){let e=Pe.digest(this.bytes);return pt(e)?e.then(({bytes:r})=>r):e.bytes}},Kr=class{_key;_publicKey;constructor(e,r){this._key=In(e,Zt),this._publicKey=In(r,Sn)}sign(e){return Ul(this._key,e)}get public(){return new rs(this._publicKey)}marshal(){return this._key}get bytes(){return Nt.encode({Type:xe.Ed25519,Data:this.marshal()}).subarray()}equals(e){return qe(this.bytes,e.bytes)}async hash(){let e=Pe.digest(this.bytes),r;return pt(e)?{bytes:r}=await e:r=e.bytes,r}async id(){let e=Qr.digest(this.public.bytes);return ke.encode(e.bytes).substring(1)}async export(e,r="libp2p-key"){if(r==="libp2p-key")return En(this.bytes,e);throw new U(`export format '${r}' is not supported`,"ERR_INVALID_EXPORT_FORMAT")}};function Zm(t){if(t.length>Zt){t=In(t,Zt+Sn);let n=t.subarray(0,Zt),s=t.subarray(Zt,t.length);return new Kr(n,s)}t=In(t,Zt);let e=t.subarray(0,Zt),r=t.subarray(Sn);return new Kr(e,r)}function Qm(t){return t=In(t,Sn),new rs(t)}async function Xm(){let{privateKey:t,publicKey:e}=Ol();return new Kr(t,e)}async function Ql(t){let{privateKey:e,publicKey:r}=Fl(t);return new Kr(e,r)}function In(t,e){if(t=Uint8Array.from(t??[]),t.length!==e)throw new U(`Key must be a Uint8Array of length ${e}, got ${t.length}`,"ERR_INVALID_KEY_TYPE");return t}var Jm={"P-256":256,"P-384":384,"P-521":521},e1=Object.keys(Jm),kE=e1.join(" / ");var Ba={};De(Ba,{MAX_KEY_SIZE:()=>os,RsaPrivateKey:()=>Cn,RsaPublicKey:()=>is,fromJwk:()=>f1,generateKeyPair:()=>l1,unmarshalRsaPrivateKey:()=>c1,unmarshalRsaPublicKey:()=>u1});var ss=Se(ce(),1);var p4=Se(r0(),1);function yr(t){if(isNaN(t)||t<=0)throw new U("random bytes length must be a Number bigger than 0","ERR_INVALID_LENGTH");return xn(t)}var YE=Se(Js(),1),Ia=Se(ce(),1);function n0(t,e){return e.map(r=>at(t[r]))}function s0(t){return Ia.default.pki.setRsaPrivateKey(...n0(t,["n","e","d","p","q","dp","dq","qi"]))}function i0(t){return Ia.default.pki.setRsaPublicKey(...n0(t,["n","e"]))}var Vr={};De(Vr,{jwkToPkcs1:()=>n1,jwkToPkix:()=>i1,pkcs1ToJwk:()=>r1,pkixToJwk:()=>s1});var XE=Se(jn(),1),JE=Se(Js(),1);var Qt=Se(ce(),1);function r1(t){let e=Qt.default.asn1.fromDer(he(t,"ascii")),r=Qt.default.pki.privateKeyFromAsn1(e);return{kty:"RSA",n:St(r.n),e:St(r.e),d:St(r.d),p:St(r.p),q:St(r.q),dp:St(r.dP),dq:St(r.dQ),qi:St(r.qInv),alg:"RS256"}}function n1(t){if(t.n==null||t.e==null||t.d==null||t.p==null||t.q==null||t.dp==null||t.dq==null||t.qi==null)throw new U("JWK was missing components","ERR_INVALID_PARAMETERS");let e=Qt.default.pki.privateKeyToAsn1({n:at(t.n),e:at(t.e),d:at(t.d),p:at(t.p),q:at(t.q),dP:at(t.dp),dQ:at(t.dq),qInv:at(t.qi)});return Be(Qt.default.asn1.toDer(e).getBytes(),"ascii")}function s1(t){let e=Qt.default.asn1.fromDer(he(t,"ascii")),r=Qt.default.pki.publicKeyFromAsn1(e);return{kty:"RSA",n:St(r.n),e:St(r.e)}}function i1(t){if(t.n==null||t.e==null)throw new U("JWK was missing components","ERR_INVALID_PARAMETERS");let e=Qt.default.pki.publicKeyToAsn1({n:at(t.n),e:at(t.e)});return Be(Qt.default.asn1.toDer(e).getBytes(),"ascii")}async function o0(t){let e=await rt.get().subtle.generateKey({name:"RSASSA-PKCS1-v1_5",modulusLength:t,publicExponent:new Uint8Array([1,0,1]),hash:{name:"SHA-256"}},!0,["sign","verify"]),r=await u0(e);return{privateKey:r[0],publicKey:r[1]}}async function Ca(t){let r=[await rt.get().subtle.importKey("jwk",t,{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-256"}},!0,["sign"]),await o1(t)],n=await u0({privateKey:r[0],publicKey:r[1]});return{privateKey:n[0],publicKey:n[1]}}async function a0(t,e){let r=await rt.get().subtle.importKey("jwk",t,{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-256"}},!1,["sign"]),n=await rt.get().subtle.sign({name:"RSASSA-PKCS1-v1_5"},r,e instanceof Uint8Array?e:e.subarray());return new Uint8Array(n,0,n.byteLength)}async function c0(t,e,r){let n=await rt.get().subtle.importKey("jwk",t,{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-256"}},!1,["verify"]);return rt.get().subtle.verify({name:"RSASSA-PKCS1-v1_5"},n,e,r instanceof Uint8Array?r:r.subarray())}async function u0(t){if(t.privateKey==null||t.publicKey==null)throw new U("Private and public key are required","ERR_INVALID_PARAMETERS");return Promise.all([rt.get().subtle.exportKey("jwk",t.privateKey),rt.get().subtle.exportKey("jwk",t.publicKey)])}async function o1(t){return rt.get().subtle.importKey("jwk",{kty:t.kty,n:t.n,e:t.e},{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-256"}},!0,["verify"])}function f0(t,e,r,n){let s=e?i0(t):s0(t),i=he(r instanceof Uint8Array?r:r.subarray(),"ascii"),o=n(i,s);return Be(o,"ascii")}function l0(t,e){return f0(t,!0,e,(r,n)=>n.encrypt(r))}function h0(t,e){return f0(t,!1,e,(r,n)=>n.decrypt(r))}function vi(t){if(t.kty!=="RSA")throw new U("invalid key type","ERR_INVALID_KEY_TYPE");if(t.n==null)throw new U("invalid key modulus","ERR_INVALID_KEY_MODULUS");return Be(t.n,"base64url").length*8}var os=8192,is=class{_key;constructor(e){this._key=e}verify(e,r){return c0(this._key,r,e)}marshal(){return Vr.jwkToPkix(this._key)}get bytes(){return Lt.encode({Type:xe.RSA,Data:this.marshal()}).subarray()}encrypt(e){return l0(this._key,e)}equals(e){return qe(this.bytes,e.bytes)}hash(){let e=Pe.digest(this.bytes);return pt(e)?e.then(({bytes:r})=>r):e.bytes}},Cn=class{_key;_publicKey;constructor(e,r){this._key=e,this._publicKey=r}genSecret(){return yr(16)}sign(e){return a0(this._key,e)}get public(){if(this._publicKey==null)throw new U("public key not provided","ERR_PUBKEY_NOT_PROVIDED");return new is(this._publicKey)}decrypt(e){return h0(this._key,e)}marshal(){return Vr.jwkToPkcs1(this._key)}get bytes(){return Nt.encode({Type:xe.RSA,Data:this.marshal()}).subarray()}equals(e){return qe(this.bytes,e.bytes)}hash(){let e=Pe.digest(this.bytes);return pt(e)?e.then(({bytes:r})=>r):e.bytes}async id(){let e=await this.public.hash();return he(e,"base58btc")}async export(e,r="pkcs-8"){if(r==="pkcs-8"){let n=new ss.default.util.ByteBuffer(this.marshal()),s=ss.default.asn1.fromDer(n),i=ss.default.pki.privateKeyFromAsn1(s),o={algorithm:"aes256",count:1e4,saltSize:128/8,prfAlgorithm:"sha512"};return ss.default.pki.encryptRsaPrivateKey(i,e,o)}else{if(r==="libp2p-key")return En(this.bytes,e);throw new U(`export format '${r}' is not supported`,"ERR_INVALID_EXPORT_FORMAT")}}};async function c1(t){let e=Vr.pkcs1ToJwk(t);if(vi(e)>os)throw new U("key size is too large","ERR_KEY_SIZE_TOO_LARGE");let r=await Ca(e);return new Cn(r.privateKey,r.publicKey)}function u1(t){let e=Vr.pkixToJwk(t);if(vi(e)>os)throw new U("key size is too large","ERR_KEY_SIZE_TOO_LARGE");return new is(e)}async function f1(t){if(vi(t)>os)throw new U("key size is too large","ERR_KEY_SIZE_TOO_LARGE");let e=await Ca(t);return new Cn(e.privateKey,e.publicKey)}async function l1(t){if(t>os)throw new U("key size is too large","ERR_KEY_SIZE_TOO_LARGE");let e=await o0(t);return new Cn(e.privateKey,e.publicKey)}var ka={};De(ka,{Secp256k1PrivateKey:()=>cs,Secp256k1PublicKey:()=>as,generateKeyPair:()=>C1,unmarshalSecp256k1PrivateKey:()=>_1,unmarshalSecp256k1PublicKey:()=>I1});var h1=(t,e,r)=>t&e^~t&r,p1=(t,e,r)=>t&e^t&r^e&r,d1=new Uint32Array([1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298]),mr=new Uint32Array([1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225]),br=new Uint32Array(64),Aa=class extends vn{constructor(){super(64,32,8,!1),this.A=mr[0]|0,this.B=mr[1]|0,this.C=mr[2]|0,this.D=mr[3]|0,this.E=mr[4]|0,this.F=mr[5]|0,this.G=mr[6]|0,this.H=mr[7]|0}get(){let{A:e,B:r,C:n,D:s,E:i,F:o,G:a,H:f}=this;return[e,r,n,s,i,o,a,f]}set(e,r,n,s,i,o,a,f){this.A=e|0,this.B=r|0,this.C=n|0,this.D=s|0,this.E=i|0,this.F=o|0,this.G=a|0,this.H=f|0}process(e,r){for(let l=0;l<16;l++,r+=4)br[l]=e.getUint32(r,!1);for(let l=16;l<64;l++){let h=br[l-15],g=br[l-2],p=Et(h,7)^Et(h,18)^h>>>3,d=Et(g,17)^Et(g,19)^g>>>10;br[l]=d+br[l-7]+p+br[l-16]|0}let{A:n,B:s,C:i,D:o,E:a,F:f,G:u,H:c}=this;for(let l=0;l<64;l++){let h=Et(a,6)^Et(a,11)^Et(a,25),g=c+h+h1(a,f,u)+d1[l]+br[l]|0,d=(Et(n,2)^Et(n,13)^Et(n,22))+p1(n,s,i)|0;c=u,u=f,f=a,a=o+g|0,o=i,i=s,s=n,n=g+d|0}n=n+this.A|0,s=s+this.B|0,i=i+this.C|0,o=o+this.D|0,a=a+this.E|0,f=f+this.F|0,u=u+this.G|0,c=c+this.H|0,this.set(n,s,i,o,a,f,u,c)}roundClean(){br.fill(0)}destroy(){this.set(0,0,0,0,0,0,0,0),this.buffer.fill(0)}};var p0=ni(()=>new Aa);function g1(t){let e=Xn(t);Mt(e,{a:"field",b:"field"},{allowedPrivateKeyLengths:"array",wrapPrivateKey:"boolean",isTorsionFree:"function",clearCofactor:"function",allowInfinityPoint:"boolean",fromBytes:"function",toBytes:"function"});let{endo:r,Fp:n,a:s}=e;if(r){if(!n.eql(s,n.ZERO))throw new Error("Endomorphism can only be defined for Koblitz curves that have a=0");if(typeof r!="object"||typeof r.beta!="bigint"||typeof r.splitScalar!="function")throw new Error("Expected endomorphism with beta: bigint and splitScalar: function")}return Object.freeze({...e})}var{bytesToNumberBE:y1,hexToBytes:m1}=ai,zr={Err:class extends Error{constructor(e=""){super(e)}},_parseInt(t){let{Err:e}=zr;if(t.length<2||t[0]!==2)throw new e("Invalid signature integer tag");let r=t[1],n=t.subarray(2,r+2);if(!r||n.length!==r)throw new e("Invalid signature integer: wrong length");if(n[0]&128)throw new e("Invalid signature integer: negative");if(n[0]===0&&!(n[1]&128))throw new e("Invalid signature integer: unnecessary leading zero");return{d:y1(n),l:t.subarray(r+2)}},toSig(t){let{Err:e}=zr,r=typeof t=="string"?m1(t):t;if(!(r instanceof Uint8Array))throw new Error("ui8a expected");let n=r.length;if(n<2||r[0]!=48)throw new e("Invalid signature tag");if(r[1]!==n-2)throw new e("Invalid signature: incorrect length");let{d:s,l:i}=zr._parseInt(r.subarray(2)),{d:o,l:a}=zr._parseInt(i);if(a.length)throw new e("Invalid signature: left bytes after parsing");return{r:s,s:o}},hexFromSig(t){let e=u=>Number.parseInt(u[0],16)&8?"00"+u:u,r=u=>{let c=u.toString(16);return c.length&1?`0${c}`:c},n=e(r(t.s)),s=e(r(t.r)),i=n.length/2,o=s.length/2,a=r(i),f=r(o);return`30${r(o+i+4)}02${f}${s}02${a}${n}`}},Xt=BigInt(0),dt=BigInt(1),E4=BigInt(2),d0=BigInt(3),_4=BigInt(4);function b1(t){let e=g1(t),{Fp:r}=e,n=e.toBytes||((p,d,y)=>{let m=d.toAffine();return $t(Uint8Array.from([4]),r.toBytes(m.x),r.toBytes(m.y))}),s=e.fromBytes||(p=>{let d=p.subarray(1),y=r.fromBytes(d.subarray(0,r.BYTES)),m=r.fromBytes(d.subarray(r.BYTES,2*r.BYTES));return{x:y,y:m}});function i(p){let{a:d,b:y}=e,m=r.sqr(p),E=r.mul(m,p);return r.add(r.add(E,r.mul(p,d)),y)}if(!r.eql(r.sqr(e.Gy),i(e.Gx)))throw new Error("bad generator point: equation left != right");function o(p){return typeof p=="bigint"&&Xt<p&&p<e.n}function a(p){if(!o(p))throw new Error("Expected valid bigint: 0 < bigint < curve.n")}function f(p){let{allowedPrivateKeyLengths:d,nByteLength:y,wrapPrivateKey:m,n:E}=e;if(d&&typeof p!="bigint"){if(p instanceof Uint8Array&&(p=Wt(p)),typeof p!="string"||!d.includes(p.length))throw new Error("Invalid key");p=p.padStart(y*2,"0")}let v;try{v=typeof p=="bigint"?p:jt(_e("private key",p,y))}catch{throw new Error(`private key must be ${y} bytes, hex or bigint, not ${typeof p}`)}return m&&(v=le(v,E)),a(v),v}let u=new Map;function c(p){if(!(p instanceof l))throw new Error("ProjectivePoint expected")}class l{constructor(d,y,m){if(this.px=d,this.py=y,this.pz=m,d==null||!r.isValid(d))throw new Error("x required");if(y==null||!r.isValid(y))throw new Error("y required");if(m==null||!r.isValid(m))throw new Error("z required")}static fromAffine(d){let{x:y,y:m}=d||{};if(!d||!r.isValid(y)||!r.isValid(m))throw new Error("invalid affine point");if(d instanceof l)throw new Error("projective point not allowed");let E=v=>r.eql(v,r.ZERO);return E(y)&&E(m)?l.ZERO:new l(y,m,r.ONE)}get x(){return this.toAffine().x}get y(){return this.toAffine().y}static normalizeZ(d){let y=r.invertBatch(d.map(m=>m.pz));return d.map((m,E)=>m.toAffine(y[E])).map(l.fromAffine)}static fromHex(d){let y=l.fromAffine(s(_e("pointHex",d)));return y.assertValidity(),y}static fromPrivateKey(d){return l.BASE.multiply(f(d))}_setWindowSize(d){this._WINDOW_SIZE=d,u.delete(this)}assertValidity(){if(this.is0()){if(e.allowInfinityPoint&&!r.is0(this.py))return;throw new Error("bad point: ZERO")}let{x:d,y}=this.toAffine();if(!r.isValid(d)||!r.isValid(y))throw new Error("bad point: x or y not FE");let m=r.sqr(y),E=i(d);if(!r.eql(m,E))throw new Error("bad point: equation left != right");if(!this.isTorsionFree())throw new Error("bad point: not in prime-order subgroup")}hasEvenY(){let{y:d}=this.toAffine();if(r.isOdd)return!r.isOdd(d);throw new Error("Field doesn't support isOdd")}equals(d){c(d);let{px:y,py:m,pz:E}=this,{px:v,py:C,pz:b}=d,w=r.eql(r.mul(y,b),r.mul(v,E)),I=r.eql(r.mul(m,b),r.mul(C,E));return w&&I}negate(){return new l(this.px,r.neg(this.py),this.pz)}double(){let{a:d,b:y}=e,m=r.mul(y,d0),{px:E,py:v,pz:C}=this,b=r.ZERO,w=r.ZERO,I=r.ZERO,T=r.mul(E,E),F=r.mul(v,v),K=r.mul(C,C),q=r.mul(E,v);return q=r.add(q,q),I=r.mul(E,C),I=r.add(I,I),b=r.mul(d,I),w=r.mul(m,K),w=r.add(b,w),b=r.sub(F,w),w=r.add(F,w),w=r.mul(b,w),b=r.mul(q,b),I=r.mul(m,I),K=r.mul(d,K),q=r.sub(T,K),q=r.mul(d,q),q=r.add(q,I),I=r.add(T,T),T=r.add(I,T),T=r.add(T,K),T=r.mul(T,q),w=r.add(w,T),K=r.mul(v,C),K=r.add(K,K),T=r.mul(K,q),b=r.sub(b,T),I=r.mul(K,F),I=r.add(I,I),I=r.add(I,I),new l(b,w,I)}add(d){c(d);let{px:y,py:m,pz:E}=this,{px:v,py:C,pz:b}=d,w=r.ZERO,I=r.ZERO,T=r.ZERO,F=e.a,K=r.mul(e.b,d0),q=r.mul(y,v),X=r.mul(m,C),ue=r.mul(E,b),Fe=r.add(y,m),P=r.add(v,C);Fe=r.mul(Fe,P),P=r.add(q,X),Fe=r.sub(Fe,P),P=r.add(y,E);let M=r.add(v,b);return P=r.mul(P,M),M=r.add(q,ue),P=r.sub(P,M),M=r.add(m,E),w=r.add(C,b),M=r.mul(M,w),w=r.add(X,ue),M=r.sub(M,w),T=r.mul(F,P),w=r.mul(K,ue),T=r.add(w,T),w=r.sub(X,T),T=r.add(X,T),I=r.mul(w,T),X=r.add(q,q),X=r.add(X,q),ue=r.mul(F,ue),P=r.mul(K,P),X=r.add(X,ue),ue=r.sub(q,ue),ue=r.mul(F,ue),P=r.add(P,ue),q=r.mul(X,P),I=r.add(I,q),q=r.mul(M,P),w=r.mul(Fe,w),w=r.sub(w,q),q=r.mul(Fe,X),T=r.mul(M,T),T=r.add(T,q),new l(w,I,T)}subtract(d){return this.add(d.negate())}is0(){return this.equals(l.ZERO)}wNAF(d){return g.wNAFCached(this,u,d,y=>{let m=r.invertBatch(y.map(E=>E.pz));return y.map((E,v)=>E.toAffine(m[v])).map(l.fromAffine)})}multiplyUnsafe(d){let y=l.ZERO;if(d===Xt)return y;if(a(d),d===dt)return this;let{endo:m}=e;if(!m)return g.unsafeLadder(this,d);let{k1neg:E,k1:v,k2neg:C,k2:b}=m.splitScalar(d),w=y,I=y,T=this;for(;v>Xt||b>Xt;)v&dt&&(w=w.add(T)),b&dt&&(I=I.add(T)),T=T.double(),v>>=dt,b>>=dt;return E&&(w=w.negate()),C&&(I=I.negate()),I=new l(r.mul(I.px,m.beta),I.py,I.pz),w.add(I)}multiply(d){a(d);let y=d,m,E,{endo:v}=e;if(v){let{k1neg:C,k1:b,k2neg:w,k2:I}=v.splitScalar(y),{p:T,f:F}=this.wNAF(b),{p:K,f:q}=this.wNAF(I);T=g.constTimeNegate(C,T),K=g.constTimeNegate(w,K),K=new l(r.mul(K.px,v.beta),K.py,K.pz),m=T.add(K),E=F.add(q)}else{let{p:C,f:b}=this.wNAF(y);m=C,E=b}return l.normalizeZ([m,E])[0]}multiplyAndAddUnsafe(d,y,m){let E=l.BASE,v=(b,w)=>w===Xt||w===dt||!b.equals(E)?b.multiplyUnsafe(w):b.multiply(w),C=v(this,y).add(v(d,m));return C.is0()?void 0:C}toAffine(d){let{px:y,py:m,pz:E}=this,v=this.is0();d==null&&(d=v?r.ONE:r.inv(E));let C=r.mul(y,d),b=r.mul(m,d),w=r.mul(E,d);if(v)return{x:r.ZERO,y:r.ZERO};if(!r.eql(w,r.ONE))throw new Error("invZ was invalid");return{x:C,y:b}}isTorsionFree(){let{h:d,isTorsionFree:y}=e;if(d===dt)return!0;if(y)return y(l,this);throw new Error("isTorsionFree() has not been declared for the elliptic curve")}clearCofactor(){let{h:d,clearCofactor:y}=e;return d===dt?this:y?y(l,this):this.multiplyUnsafe(e.h)}toRawBytes(d=!0){return this.assertValidity(),n(l,this,d)}toHex(d=!0){return Wt(this.toRawBytes(d))}}l.BASE=new l(e.Gx,e.Gy,r.ONE),l.ZERO=new l(r.ZERO,r.ONE,r.ZERO);let h=e.nBitLength,g=fi(l,e.endo?Math.ceil(h/2):h);return{CURVE:e,ProjectivePoint:l,normPrivateKeyToScalar:f,weierstrassEquation:i,isWithinCurveOrder:o}}function x1(t){let e=Xn(t);return Mt(e,{hash:"hash",hmac:"function",randomBytes:"function"},{bits2int:"function",bits2int_modN:"function",lowS:"boolean"}),Object.freeze({lowS:!0,...e})}function g0(t){let e=x1(t),{Fp:r,n}=e,s=r.BYTES+1,i=2*r.BYTES+1;function o(P){return Xt<P&&P<r.ORDER}function a(P){return le(P,n)}function f(P){return ci(P,n)}let{ProjectivePoint:u,normPrivateKeyToScalar:c,weierstrassEquation:l,isWithinCurveOrder:h}=b1({...e,toBytes(P,M,D){let k=M.toAffine(),B=r.toBytes(k.x),O=$t;return D?O(Uint8Array.from([M.hasEvenY()?2:3]),B):O(Uint8Array.from([4]),B,r.toBytes(k.y))},fromBytes(P){let M=P.length,D=P[0],k=P.subarray(1);if(M===s&&(D===2||D===3)){let B=jt(k);if(!o(B))throw new Error("Point is not on curve");let O=l(B),V=r.sqrt(O),W=(V&dt)===dt;return(D&1)===1!==W&&(V=r.neg(V)),{x:B,y:V}}else if(M===i&&D===4){let B=r.fromBytes(k.subarray(0,r.BYTES)),O=r.fromBytes(k.subarray(r.BYTES,2*r.BYTES));return{x:B,y:O}}else throw new Error(`Point of length ${M} was invalid. Expected ${s} compressed bytes or ${i} uncompressed bytes`)}}),g=P=>Wt(dr(P,e.nByteLength));function p(P){let M=n>>dt;return P>M}function d(P){return p(P)?a(-P):P}let y=(P,M,D)=>jt(P.slice(M,D));class m{constructor(M,D,k){this.r=M,this.s=D,this.recovery=k,this.assertValidity()}static fromCompact(M){let D=e.nByteLength;return M=_e("compactSignature",M,D*2),new m(y(M,0,D),y(M,D,2*D))}static fromDER(M){let{r:D,s:k}=zr.toSig(_e("DER",M));return new m(D,k)}assertValidity(){if(!h(this.r))throw new Error("r must be 0 < r < CURVE.n");if(!h(this.s))throw new Error("s must be 0 < s < CURVE.n")}addRecoveryBit(M){return new m(this.r,this.s,M)}recoverPublicKey(M){let{r:D,s:k,recovery:B}=this,O=I(_e("msgHash",M));if(B==null||![0,1,2,3].includes(B))throw new Error("recovery id invalid");let V=B===2||B===3?D+e.n:D;if(V>=r.ORDER)throw new Error("recovery id 2 or 3 invalid");let W=B&1?"03":"02",Z=u.fromHex(W+g(V)),J=f(V),ae=a(-O*J),ee=a(k*J),se=u.BASE.multiplyAndAddUnsafe(Z,ae,ee);if(!se)throw new Error("point at infinify");return se.assertValidity(),se}hasHighS(){return p(this.s)}normalizeS(){return this.hasHighS()?new m(this.r,a(-this.s),this.recovery):this}toDERRawBytes(){return Lr(this.toDERHex())}toDERHex(){return zr.hexFromSig({r:this.r,s:this.s})}toCompactRawBytes(){return Lr(this.toCompactHex())}toCompactHex(){return g(this.r)+g(this.s)}}let E={isValidPrivateKey(P){try{return c(P),!0}catch{return!1}},normPrivateKeyToScalar:c,randomPrivateKey:()=>{let P=ra(e.n);return Dl(e.randomBytes(P),e.n)},precompute(P=8,M=u.BASE){return M._setWindowSize(P),M.multiply(BigInt(3)),M}};function v(P,M=!0){return u.fromPrivateKey(P).toRawBytes(M)}function C(P){let M=P instanceof Uint8Array,D=typeof P=="string",k=(M||D)&&P.length;return M?k===s||k===i:D?k===2*s||k===2*i:P instanceof u}function b(P,M,D=!0){if(C(P))throw new Error("first arg must be private key");if(!C(M))throw new Error("second arg must be public key");return u.fromHex(M).multiply(c(P)).toRawBytes(D)}let w=e.bits2int||function(P){let M=jt(P),D=P.length*8-e.nBitLength;return D>0?M>>BigInt(D):M},I=e.bits2int_modN||function(P){return a(w(P))},T=Qn(e.nBitLength);function F(P){if(typeof P!="bigint")throw new Error("bigint expected");if(!(Xt<=P&&P<T))throw new Error(`bigint expected < 2^${e.nBitLength}`);return dr(P,e.nByteLength)}function K(P,M,D=q){if(["recovered","canonical"].some(we=>we in D))throw new Error("sign() legacy options not supported");let{hash:k,randomBytes:B}=e,{lowS:O,prehash:V,extraEntropy:W}=D;O==null&&(O=!0),P=_e("msgHash",P),V&&(P=_e("prehashed msgHash",k(P)));let Z=I(P),J=c(M),ae=[F(J),F(Z)];if(W!=null){let we=W===!0?B(r.BYTES):W;ae.push(_e("extraEntropy",we))}let ee=$t(...ae),se=Z;function Ae(we){let Ue=w(we);if(!h(Ue))return;let Ke=f(Ue),Te=u.BASE.multiply(Ue).toAffine(),Ve=a(Te.x);if(Ve===Xt)return;let Ft=a(Ke*a(se+Ve*J));if(Ft===Xt)return;let vr=(Te.x===Ve?0:2)|Number(Te.y&dt),Tn=Ft;return O&&p(Ft)&&(Tn=d(Ft),vr^=1),new m(Ve,Tn,vr)}return{seed:ee,k2sig:Ae}}let q={lowS:e.lowS,prehash:!1},X={lowS:e.lowS,prehash:!1};function ue(P,M,D=q){let{seed:k,k2sig:B}=K(P,M,D),O=e;return Xo(O.hash.outputLen,O.nByteLength,O.hmac)(k,B)}u.BASE._setWindowSize(8);function Fe(P,M,D,k=X){let B=P;if(M=_e("msgHash",M),D=_e("publicKey",D),"strict"in k)throw new Error("options.strict was renamed to lowS");let{lowS:O,prehash:V}=k,W,Z;try{if(typeof B=="string"||B instanceof Uint8Array)try{W=m.fromDER(B)}catch(Te){if(!(Te instanceof zr.Err))throw Te;W=m.fromCompact(B)}else if(typeof B=="object"&&typeof B.r=="bigint"&&typeof B.s=="bigint"){let{r:Te,s:Ve}=B;W=new m(Te,Ve)}else throw new Error("PARSE");Z=u.fromHex(D)}catch(Te){if(Te.message==="PARSE")throw new Error("signature must be Signature instance, Uint8Array or hex string");return!1}if(O&&W.hasHighS())return!1;V&&(M=e.hash(M));let{r:J,s:ae}=W,ee=I(M),se=f(ae),Ae=a(ee*se),we=a(J*se),Ue=u.BASE.multiplyAndAddUnsafe(Z,Ae,we)?.toAffine();return Ue?a(Ue.x)===J:!1}return{CURVE:e,getPublicKey:v,getSharedSecret:b,sign:ue,verify:Fe,ProjectivePoint:u,Signature:m,utils:E}}var wi=class extends bn{constructor(e,r){super(),this.finished=!1,this.destroyed=!1,vl(e);let n=Zn(r);if(this.iHash=e.create(),typeof this.iHash.update!="function")throw new Error("Expected instance of class which extends utils.Hash");this.blockLen=this.iHash.blockLen,this.outputLen=this.iHash.outputLen;let s=this.blockLen,i=new Uint8Array(s);i.set(n.length>s?e.create().update(n).digest():n);for(let o=0;o<i.length;o++)i[o]^=54;this.iHash.update(i),this.oHash=e.create();for(let o=0;o<i.length;o++)i[o]^=106;this.oHash.update(i),i.fill(0)}update(e){return mn(this),this.iHash.update(e),this}digestInto(e){mn(this),Go(e,this.outputLen),this.finished=!0,this.iHash.digestInto(e),this.oHash.update(e),this.oHash.digestInto(e),this.destroy()}digest(){let e=new Uint8Array(this.oHash.outputLen);return this.digestInto(e),e}_cloneInto(e){e||(e=Object.create(Object.getPrototypeOf(this),{}));let{oHash:r,iHash:n,finished:s,destroyed:i,blockLen:o,outputLen:a}=this;return e=e,e.finished=s,e.destroyed=i,e.blockLen=o,e.outputLen=a,e.oHash=r._cloneInto(e.oHash),e.iHash=n._cloneInto(e.iHash),e}destroy(){this.destroyed=!0,this.oHash.destroy(),this.iHash.destroy()}},Ta=(t,e,r)=>new wi(t,e).update(r).digest();Ta.create=(t,e)=>new wi(t,e);function v1(t){return{hash:t,hmac:(e,...r)=>Ta(t,e,ri(...r)),randomBytes:xn}}function y0(t,e){let r=n=>g0({...t,...v1(n)});return Object.freeze({...r(e),create:r})}var x0=BigInt("0xfffffffffffffffffffffffffffffffffffffffffffffffffffffffefffffc2f"),m0=BigInt("0xfffffffffffffffffffffffffffffffebaaedce6af48a03bbfd25e8cd0364141"),w1=BigInt(1),Pa=BigInt(2),b0=(t,e)=>(t+e/Pa)/e;function S1(t){let e=x0,r=BigInt(3),n=BigInt(6),s=BigInt(11),i=BigInt(22),o=BigInt(23),a=BigInt(44),f=BigInt(88),u=t*t*t%e,c=u*u*t%e,l=be(c,r,e)*c%e,h=be(l,r,e)*c%e,g=be(h,Pa,e)*u%e,p=be(g,s,e)*g%e,d=be(p,i,e)*p%e,y=be(d,a,e)*d%e,m=be(y,f,e)*y%e,E=be(m,a,e)*d%e,v=be(E,r,e)*c%e,C=be(v,o,e)*p%e,b=be(C,n,e)*u%e,w=be(b,Pa,e);if(!Ra.eql(Ra.sqr(w),t))throw new Error("Cannot find square root");return w}var Ra=ui(x0,void 0,void 0,{sqrt:S1}),Ct=y0({a:BigInt(0),b:BigInt(7),Fp:Ra,n:m0,Gx:BigInt("55066263022277343669578718895168534326250603453777594175500187360389116729240"),Gy:BigInt("32670510020758816978083085130507043184471273380659243275938904335757337482424"),h:BigInt(1),lowS:!0,endo:{beta:BigInt("0x7ae96a2b657c07106e64479eac3434e99cf0497512f58995c1396c28719501ee"),splitScalar:t=>{let e=m0,r=BigInt("0x3086d221a7d46bcde86c90e49284eb15"),n=-w1*BigInt("0xe4437ed6010e88286f547fa90abfe4c3"),s=BigInt("0x114ca50f7a8e2f3f657c1108d9d44cfd8"),i=r,o=BigInt("0x100000000000000000000000000000000"),a=b0(i*t,e),f=b0(-n*t,e),u=le(t-a*r-f*s,e),c=le(-a*n-f*i,e),l=u>o,h=c>o;if(l&&(u=e-u),h&&(c=e-c),u>o||c>o)throw new Error("splitScalar: Endomorphism failed, k="+t);return{k1neg:l,k1:u,k2neg:h,k2:c}}}},p0),N4=BigInt(0);var O4=Ct.ProjectivePoint;function v0(){return Ct.utils.randomPrivateKey()}function w0(t,e){let r=Pe.digest(e instanceof Uint8Array?e:e.subarray());if(pt(r))return r.then(({digest:n})=>Ct.sign(n,t).toDERRawBytes()).catch(n=>{throw new U(String(n),"ERR_INVALID_INPUT")});try{return Ct.sign(r.digest,t).toDERRawBytes()}catch(n){throw new U(String(n),"ERR_INVALID_INPUT")}}function S0(t,e,r){let n=Pe.digest(r instanceof Uint8Array?r:r.subarray());if(pt(n))return n.then(({digest:s})=>Ct.verify(e,s,t)).catch(s=>{throw new U(String(s),"ERR_INVALID_INPUT")});try{return Ct.verify(e,n.digest,t)}catch(s){throw new U(String(s),"ERR_INVALID_INPUT")}}function E0(t){return Ct.ProjectivePoint.fromHex(t).toRawBytes(!0)}function _0(t){try{Ct.getPublicKey(t,!0)}catch(e){throw new U(String(e),"ERR_INVALID_PRIVATE_KEY")}}function Da(t){try{Ct.ProjectivePoint.fromHex(t)}catch(e){throw new U(String(e),"ERR_INVALID_PUBLIC_KEY")}}function I0(t){try{return Ct.getPublicKey(t,!0)}catch(e){throw new U(String(e),"ERR_INVALID_PRIVATE_KEY")}}var as=class{_key;constructor(e){Da(e),this._key=e}verify(e,r){return S0(this._key,r,e)}marshal(){return E0(this._key)}get bytes(){return Lt.encode({Type:xe.Secp256k1,Data:this.marshal()}).subarray()}equals(e){return qe(this.bytes,e.bytes)}async hash(){let e=Pe.digest(this.bytes),r;return pt(e)?{bytes:r}=await e:r=e.bytes,r}},cs=class{_key;_publicKey;constructor(e,r){this._key=e,this._publicKey=r??I0(e),_0(this._key),Da(this._publicKey)}sign(e){return w0(this._key,e)}get public(){return new as(this._publicKey)}marshal(){return this._key}get bytes(){return Nt.encode({Type:xe.Secp256k1,Data:this.marshal()}).subarray()}equals(e){return qe(this.bytes,e.bytes)}hash(){let e=Pe.digest(this.bytes);return pt(e)?e.then(({bytes:r})=>r):e.bytes}async id(){let e=await this.public.hash();return he(e,"base58btc")}async export(e,r="libp2p-key"){if(r==="libp2p-key")return En(this.bytes,e);throw new U(`export format '${r}' is not supported`,"ERR_INVALID_EXPORT_FORMAT")}};function _1(t){return new cs(t)}function I1(t){return new as(t)}async function C1(){let t=v0();return new cs(t)}var xr={rsa:Ba,ed25519:Sa,secp256k1:ka};function Ma(t){let e=Object.keys(xr).join(" / ");return new U(`invalid or unsupported key type ${t}. Must be ${e}`,"ERR_UNSUPPORTED_KEY_TYPE")}function A1(t){if(t=t.toLowerCase(),t==="rsa"||t==="ed25519"||t==="secp256k1")return xr[t];throw Ma(t)}function La(t){let e=Lt.decode(t),r=e.Data??new Uint8Array;switch(e.Type){case xe.RSA:return xr.rsa.unmarshalRsaPublicKey(r);case xe.Ed25519:return xr.ed25519.unmarshalEd25519PublicKey(r);case xe.Secp256k1:return xr.secp256k1.unmarshalSecp256k1PublicKey(r);default:throw Ma(e.Type??"unknown")}}function C0(t,e){return e=(e??"rsa").toLowerCase(),A1(e),t.bytes}async function B0(t){let e=Nt.decode(t),r=e.Data??new Uint8Array;switch(e.Type){case xe.RSA:return xr.rsa.unmarshalRsaPrivateKey(r);case xe.Ed25519:return xr.ed25519.unmarshalEd25519PrivateKey(r);case xe.Secp256k1:return xr.secp256k1.unmarshalSecp256k1PrivateKey(r);default:throw Ma(e.Type??"RSA")}}var P1=Se(Lo(),1),R1=Se(Ce(),1);var A0=Be("libp2p-pubsub:");async function T0(t,e,r,n){switch(t.type){case or.Signing:{let s={from:t.author.toBytes(),data:n,seqno:yr(8),topic:e,signature:void 0,key:void 0},i=tt([A0,qn.Message.encode(s).finish()]);s.signature=await t.privateKey.sign(i),s.key=t.key;let o={type:"signed",from:t.author,data:r,sequenceNumber:BigInt(`0x${he(s.seqno,"base16")}`),topic:e,signature:s.signature,key:s.key};return{raw:s,msg:o}}case or.Anonymous:return{raw:{from:void 0,data:n,seqno:void 0,topic:e,signature:void 0,key:void 0},msg:{type:"unsigned",data:r,topic:e}};default:throw new Error("Unreachable")}}async function P0(t,e){switch(t){case Hr:return e.signature!=null?{valid:!1,error:ze.SignaturePresent}:e.seqno!=null?{valid:!1,error:ze.SeqnoPresent}:e.key!=null?{valid:!1,error:ze.FromPresent}:{valid:!0,message:{type:"unsigned",topic:e.topic,data:e.data??new Uint8Array(0)}};case wr:{if(e.seqno==null)return{valid:!1,error:ze.InvalidSeqno};if(e.seqno.length!==8)return{valid:!1,error:ze.InvalidSeqno};if(e.signature==null)return{valid:!1,error:ze.InvalidSignature};if(e.from==null)return{valid:!1,error:ze.InvalidPeerId};let r;try{r=Xr(e.from)}catch{return{valid:!1,error:ze.InvalidPeerId}}let n;if(e.key!=null){if(n=La(e.key),r.publicKey!==void 0&&!qe(n.bytes,r.publicKey))return{valid:!1,error:ze.InvalidPeerId}}else{if(r.publicKey==null)return{valid:!1,error:ze.InvalidPeerId};n=La(r.publicKey)}let s={from:e.from,data:e.data,seqno:e.seqno,topic:e.topic,signature:void 0,key:void 0},i=tt([A0,qn.Message.encode(s).finish()]);return await n.verify(i,e.signature)?{valid:!0,message:{type:"signed",from:r,data:e.data??new Uint8Array(0),sequenceNumber:BigInt(`0x${he(e.seqno,"base16")}`),topic:e.topic,signature:e.signature,key:e.key??C0(n)}}:{valid:!1,error:ze.InvalidSignature}}default:throw new Error("Unreachable")}}function Ot(t){if(t.length<=1)return t;let e=()=>Math.floor(Math.random()*Math.floor(t.length));for(let r=0;r<t.length;r++){let n=e(),s=t[r];t[r]=t[n],t[n]=s}return t}function R0(t){return he(t,"base64")}async function Na(t,e){switch(t){case wr:{if(e==null)throw Error("Must provide PeerId");if(e.privateKey==null)throw Error("Cannot sign message, no private key present");if(e.publicKey==null)throw Error("Cannot sign message, no public key present");let r=await B0(e.privateKey);return{type:or.Signing,author:e,key:e.publicKey,privateKey:r}}case Hr:return{type:or.Anonymous};default:throw new Error(`Unknown signature policy "${t}"`)}}var D0=(t,e)=>{let r=Be(e.toString(16).padStart(16,"0"),"base16"),n=new Uint8Array(t.length+r.length);return n.set(t,0),n.set(r,t.length),n};function k0(t){if(t.type!=="signed")throw new Error("expected signed message type");if(t.sequenceNumber==null)throw Error("missing seqno field");return D0(t.from.toBytes(),t.sequenceNumber)}async function M0(t){return Pe.encode(t.data)}var Si=class{index=0;input="";new(e){return this.index=0,this.input=e,this}readAtomically(e){let r=this.index,n=e();return n===void 0&&(this.index=r),n}parseWith(e){let r=e();if(this.index===this.input.length)return r}peekChar(){if(!(this.index>=this.input.length))return this.input[this.index]}readChar(){if(!(this.index>=this.input.length))return this.input[this.index++]}readGivenChar(e){return this.readAtomically(()=>{let r=this.readChar();if(r===e)return r})}readSeparator(e,r,n){return this.readAtomically(()=>{if(!(r>0&&this.readGivenChar(e)===void 0))return n()})}readNumber(e,r,n,s){return this.readAtomically(()=>{let i=0,o=0,a=this.peekChar();if(a===void 0)return;let f=a==="0",u=2**(8*s)-1;for(;;){let c=this.readAtomically(()=>{let l=this.readChar();if(l===void 0)return;let h=Number.parseInt(l,e);if(!Number.isNaN(h))return h});if(c===void 0)break;if(i*=e,i+=c,i>u||(o+=1,r!==void 0&&o>r))return}if(o!==0)return!n&&f&&o>1?void 0:i})}readIPv4Addr(){return this.readAtomically(()=>{let e=new Uint8Array(4);for(let r=0;r<e.length;r++){let n=this.readSeparator(".",r,()=>this.readNumber(10,3,!1,1));if(n===void 0)return;e[r]=n}return e})}readIPv6Addr(){let e=r=>{for(let n=0;n<r.length/2;n++){let s=n*2;if(n<r.length-3){let o=this.readSeparator(":",n,()=>this.readIPv4Addr());if(o!==void 0)return r[s]=o[0],r[s+1]=o[1],r[s+2]=o[2],r[s+3]=o[3],[s+4,!0]}let i=this.readSeparator(":",n,()=>this.readNumber(16,4,!0,2));if(i===void 0)return[s,!1];r[s]=i>>8,r[s+1]=i&255}return[r.length,!1]};return this.readAtomically(()=>{let r=new Uint8Array(16),[n,s]=e(r);if(n===16)return r;if(s||this.readGivenChar(":")===void 0||this.readGivenChar(":")===void 0)return;let i=new Uint8Array(14),o=16-(n+2),[a]=e(i.subarray(0,o));return r.set(i.subarray(0,a),16-a),r})}readIPAddr(){return this.readIPv4Addr()??this.readIPv6Addr()}};var D1=45;var L0=new Si;function Ei(t){if(t.includes("%")&&(t=t.split("%")[0]),!(t.length>D1))return L0.new(t).parseWith(()=>L0.readIPAddr())}var r3=parseInt("0xFFFF",16),n3=new Uint8Array([0,0,0,0,0,0,0,0,0,0,255,255]);function Oa(t){return!!Ei(t)}var F0=function(t,e=0,r){e=~~e,r=r??t.length-e;let n=new DataView(t.buffer);if(r===4){let s=[];for(let i=0;i<r;i++)s.push(t[e+i]);return s.join(".")}if(r===16){let s=[];for(let i=0;i<r;i+=2)s.push(n.getUint16(e+i).toString(16));return s.join(":").replace(/(^|:)0(:0)*:0(:|$)/,"$1::$3").replace(/:{3,4}/,"::")}return""};var Fa={},Ua={},K1=[[4,32,"ip4"],[6,16,"tcp"],[33,16,"dccp"],[41,128,"ip6"],[42,-1,"ip6zone"],[43,8,"ipcidr"],[53,-1,"dns",!0],[54,-1,"dns4",!0],[55,-1,"dns6",!0],[56,-1,"dnsaddr",!0],[132,16,"sctp"],[273,16,"udp"],[275,0,"p2p-webrtc-star"],[276,0,"p2p-webrtc-direct"],[277,0,"p2p-stardust"],[280,0,"webrtc-direct"],[281,0,"webrtc"],[290,0,"p2p-circuit"],[301,0,"udt"],[302,0,"utp"],[400,-1,"unix",!1,!0],[421,-1,"ipfs"],[421,-1,"p2p"],[443,0,"https"],[444,96,"onion"],[445,296,"onion3"],[446,-1,"garlic64"],[448,0,"tls"],[449,-1,"sni"],[460,0,"quic"],[461,0,"quic-v1"],[465,0,"webtransport"],[466,-1,"certhash"],[477,0,"ws"],[478,0,"wss"],[479,0,"p2p-websocket-star"],[480,0,"http"],[777,-1,"memory"]];K1.forEach(t=>{let e=q1(...t);Ua[e.code]=e,Fa[e.name]=e});function q1(t,e,r,n,s){return{code:t,size:e,name:r,resolvable:!!n,path:!!s}}function us(t){if(typeof t=="number"){if(Ua[t]!=null)return Ua[t];throw new Error(`no protocol with code: ${t}`)}else if(typeof t=="string"){if(Fa[t]!=null)return Fa[t];throw new Error(`no protocol with name: ${t}`)}throw new Error(`invalid protocol id type: ${typeof t}`)}var z3=us("ip4"),H3=us("ip6"),G3=us("ipcidr");function q0(t,e){switch(us(t).code){case 4:case 41:return V1(e);case 42:return U0(e);case 6:case 273:case 33:case 132:return V0(e).toString();case 53:case 54:case 55:case 56:case 400:case 449:case 777:return U0(e);case 421:return H1(e);case 444:return K0(e);case 445:return K0(e);case 466:return z1(e);default:return he(e,"base16")}}var Ka=Object.values(rr).map(t=>t.decoder),W3=function(){let t=Ka[0].or(Ka[1]);return Ka.slice(2).forEach(e=>t=t.or(e)),t}();function V1(t){let e=F0(t,0,t.length);if(e==null)throw new Error("ipBuff is required");if(!Oa(e))throw new Error("invalid ip address");return e}function V0(t){return new DataView(t.buffer).getUint16(t.byteOffset)}function U0(t){let e=fn(t);if(t=t.slice(xt(e)),t.length!==e)throw new Error("inconsistent lengths");return he(t)}function z1(t){let e=fn(t),r=t.slice(xt(e));if(r.length!==e)throw new Error("inconsistent lengths");return"u"+he(r,"base64url")}function H1(t){let e=fn(t),r=t.slice(xt(e));if(r.length!==e)throw new Error("inconsistent lengths");return he(r,"base58btc")}function K0(t){let e=t.slice(0,t.length-2),r=t.slice(t.length-2),n=he(e,"base32"),s=V0(r);return`${n}:${s}`}var _i;(function(t){t[t.ip4=4]="ip4",t[t.ip6=41]="ip6"})(_i||(_i={}));function z0(t){for(let e of t.tuples())switch(e[0]){case _i.ip4:case _i.ip6:return q0(e[0],e[1]);default:break}return null}var Bn=class{entries=new Map;validityMs;constructor(e){this.validityMs=e.validityMs}get size(){return this.entries.size}put(e,r){return this.entries.has(e)?!0:(this.entries.set(e,{value:r,validUntilMs:Date.now()+this.validityMs}),!1)}prune(){let e=Date.now();for(let[r,n]of this.entries.entries())if(n.validUntilMs<e)this.entries.delete(r);else break}has(e){return this.entries.has(e)}get(e){let r=this.entries.get(e);return r!=null&&r.validUntilMs>=Date.now()?r.value:void 0}clear(){this.entries.clear()}};var vb=gs,ut;(function(t){t[t.started=0]="started",t[t.stopped=1]="stopped"})(ut||(ut={}));var Ii=class extends ls{globalSignaturePolicy;multicodecs=[gs,Qi];publishConfig;dataTransform;peers=new Set;streamsInbound=new Map;streamsOutbound=new Map;outboundInflightQueue=qt({objectMode:!0});direct=new Set;floodsubPeers=new Set;seenCache;acceptFromWhitelist=new Map;topics=new Map;subscriptions=new Set;mesh=new Map;fanout=new Map;fanoutLastpub=new Map;gossip=new Map;control=new Map;peerhave=new Map;iasked=new Map;backoff=new Map;outbound=new Map;msgIdFn;fastMsgIdFn;msgIdToStrFn;fastMsgIdCache;publishedMessageIds;mcache;score;topicValidators=new Map;log;heartbeatTicks=0;gossipTracer;components;directPeerInitial=null;static multicodec=gs;opts;decodeRpcLimits;metrics;status={code:ut.stopped};maxInboundStreams;maxOutboundStreams;allowedTopics;heartbeatTimer=null;constructor(e,r={}){super();let n={fallbackToFloodsub:!0,floodPublish:!0,doPX:!1,directPeers:[],D:6,Dlo:4,Dhi:12,Dscore:4,Dout:2,Dlazy:6,heartbeatInterval:1e3,fanoutTTL:6e4,mcacheLength:5,mcacheGossip:3,seenTTL:12e4,gossipsubIWantFollowupMs:3e3,prunePeers:16,pruneBackoff:6e4,unsubcribeBackoff:1e4,graftFloodThreshold:1e4,opportunisticGraftPeers:2,opportunisticGraftTicks:60,directConnectTicks:300,...r,scoreParams:Ru(r.scoreParams),scoreThresholds:ku(r.scoreThresholds)};if(this.components=e,this.decodeRpcLimits=n.decodeRpcLimits??Eu,this.globalSignaturePolicy=n.globalSignaturePolicy??wr,n.fallbackToFloodsub&&this.multicodecs.push(Zi),this.log=e.logger.forComponent(n.debugName??"libp2p:gossipsub"),this.opts=n,this.direct=new Set(n.directPeers.map(s=>s.id.toString())),this.seenCache=new Bn({validityMs:n.seenTTL}),this.publishedMessageIds=new Bn({validityMs:n.seenTTL}),r.msgIdFn!=null)this.msgIdFn=r.msgIdFn;else switch(this.globalSignaturePolicy){case wr:this.msgIdFn=k0;break;case Hr:this.msgIdFn=M0;break;default:throw new Error(`Invalid globalSignaturePolicy: ${this.globalSignaturePolicy}`)}if(r.fastMsgIdFn!=null&&(this.fastMsgIdFn=r.fastMsgIdFn,this.fastMsgIdCache=new Bn({validityMs:n.seenTTL})),this.msgIdToStrFn=r.msgIdToStrFn??R0,this.mcache=r.messageCache??new vs(n.mcacheGossip,n.mcacheLength,this.msgIdToStrFn),r.dataTransform!=null&&(this.dataTransform=r.dataTransform),r.metricsRegister!=null){if(r.metricsTopicStrToLabel==null)throw Error("Must set metricsTopicStrToLabel with metrics");let s=Math.max(...Object.values(n.scoreParams.topics).map(o=>o.meshMessageDeliveriesWindow),1e3),i=Pu(r.metricsRegister,r.metricsTopicStrToLabel,{gossipPromiseExpireSec:this.opts.gossipsubIWantFollowupMs/1e3,behaviourPenaltyThreshold:n.scoreParams.behaviourPenaltyThreshold,maxMeshMessageDeliveriesWindowSec:s/1e3});i.mcacheSize.addCollect(()=>{this.onScrapeMetrics(i)});for(let o of this.multicodecs)i.protocolsEnabled.set({protocol:o},1);this.metrics=i}else this.metrics=null;this.gossipTracer=new ks(this.opts.gossipsubIWantFollowupMs,this.msgIdToStrFn,this.metrics),this.score=new Cs(this.opts.scoreParams,this.metrics,{scoreCacheValidityMs:n.heartbeatInterval}),this.maxInboundStreams=r.maxInboundStreams,this.maxOutboundStreams=r.maxOutboundStreams,this.allowedTopics=n.allowedTopics!=null?new Set(n.allowedTopics):null}getPeers(){return[...this.peers.keys()].map(e=>_r(e))}isStarted(){return this.status.code===ut.started}async start(){if(this.isStarted())return;this.log("starting"),this.publishConfig=await Na(this.globalSignaturePolicy,this.components.peerId),this.outboundInflightQueue=qt({objectMode:!0}),en(this.outboundInflightQueue,async i=>{for await(let{peerId:o,connection:a}of i)await this.createOutboundStream(o,a)}).catch(i=>{this.log.error("outbound inflight queue error",i)}),await Promise.all(this.opts.directPeers.map(async i=>{await this.components.peerStore.merge(i.id,{multiaddrs:i.addrs})}));let e=this.components.registrar;await Promise.all(this.multicodecs.map(async i=>e.handle(i,this.onIncomingStream.bind(this),{maxInboundStreams:this.maxInboundStreams,maxOutboundStreams:this.maxOutboundStreams})));let r={onConnect:this.onPeerConnected.bind(this),onDisconnect:this.onPeerDisconnected.bind(this)},n=await Promise.all(this.multicodecs.map(async i=>e.register(i,r))),s=setTimeout(this.runHeartbeat,100);this.status={code:ut.started,registrarTopologyIds:n,heartbeatTimeout:s,hearbeatStartMs:Date.now()+100},this.score.start(),this.directPeerInitial=setTimeout(()=>{Promise.resolve().then(async()=>{await Promise.all(Array.from(this.direct).map(async i=>this.connect(i)))}).catch(i=>{this.log(i)})},1e3),this.log("started")}async stop(){if(this.log("stopping"),this.status.code!==ut.started)return;let{registrarTopologyIds:e}=this.status;this.status={code:ut.stopped};let r=this.components.registrar;await Promise.all(this.multicodecs.map(async s=>r.unhandle(s))),e.forEach(s=>{r.unregister(s)}),this.outboundInflightQueue.end();let n=[];for(let s of this.streamsOutbound.values())n.push(s.close());this.streamsOutbound.clear();for(let s of this.streamsInbound.values())n.push(s.close());this.streamsInbound.clear(),await Promise.all(n),this.peers.clear(),this.subscriptions.clear(),this.heartbeatTimer!=null&&(this.heartbeatTimer.cancel(),this.heartbeatTimer=null),this.score.stop(),this.mesh.clear(),this.fanout.clear(),this.fanoutLastpub.clear(),this.gossip.clear(),this.control.clear(),this.peerhave.clear(),this.iasked.clear(),this.backoff.clear(),this.outbound.clear(),this.gossipTracer.clear(),this.seenCache.clear(),this.fastMsgIdCache!=null&&this.fastMsgIdCache.clear(),this.directPeerInitial!=null&&clearTimeout(this.directPeerInitial),this.log("stopped")}dumpPeerScoreStats(){return this.score.dumpPeerScoreStats()}onIncomingStream({stream:e,connection:r}){if(!this.isStarted())return;let n=r.remotePeer;this.addPeer(n,r.direction,r.remoteAddr),this.createInboundStream(n,e),this.outboundInflightQueue.push({peerId:n,connection:r})}onPeerConnected(e,r){this.metrics?.newConnectionCount.inc({status:r.status}),!(!this.isStarted()||r.status!=="open")&&(this.addPeer(e,r.direction,r.remoteAddr),this.outboundInflightQueue.push({peerId:e,connection:r}))}onPeerDisconnected(e){this.log("connection ended %p",e),this.removePeer(e)}async createOutboundStream(e,r){if(!this.isStarted())return;let n=e.toString();if(this.peers.has(n)&&!this.streamsOutbound.has(n))try{let s=new Rs(await r.newStream(this.multicodecs),o=>{this.log.error("outbound pipe error",o)},{maxBufferSize:this.opts.maxOutboundBufferSize});this.log("create outbound stream %p",e),this.streamsOutbound.set(n,s);let i=s.protocol;i===Zi&&this.floodsubPeers.add(n),this.metrics?.peersPerProtocol.inc({protocol:i},1),this.subscriptions.size>0&&(this.log("send subscriptions to",n),this.sendSubscriptions(n,Array.from(this.subscriptions),!0))}catch(s){this.log.error("createOutboundStream error",s)}}createInboundStream(e,r){if(!this.isStarted())return;let n=e.toString();if(!this.peers.has(n))return;let s=this.streamsInbound.get(n);s!==void 0&&(this.log("replacing existing inbound steam %s",n),s.close().catch(o=>{this.log.error(o)})),this.log("create inbound stream %s",n);let i=new Ds(r,{maxDataLength:this.opts.maxInboundDataLength});this.streamsInbound.set(n,i),this.pipePeerReadStream(e,i.source).catch(o=>{this.log(o)})}addPeer(e,r,n){let s=e.toString();if(!this.peers.has(s)){this.log("new peer %p",e),this.peers.add(s),this.score.addPeer(s);let i=z0(n);i!==null?this.score.addIP(s,i):this.log("Added peer has no IP in current address %s %s",s,n.toString()),this.outbound.has(s)||this.outbound.set(s,r==="outbound")}}removePeer(e){let r=e.toString();if(!this.peers.has(r))return;this.log("delete peer %p",e),this.peers.delete(r);let n=this.streamsOutbound.get(r),s=this.streamsInbound.get(r);n!=null&&this.metrics?.peersPerProtocol.inc({protocol:n.protocol},-1),n?.close().catch(i=>{this.log.error(i)}),s?.close().catch(i=>{this.log.error(i)}),this.streamsOutbound.delete(r),this.streamsInbound.delete(r);for(let i of this.topics.values())i.delete(r);for(let[i,o]of this.mesh)o.delete(r)&&this.metrics?.onRemoveFromMesh(i,bt.Dc,1);for(let i of this.fanout.values())i.delete(r);this.floodsubPeers.delete(r),this.gossip.delete(r),this.control.delete(r),this.outbound.delete(r),this.score.removePeer(r),this.acceptFromWhitelist.delete(r)}get started(){return this.status.code===ut.started}getMeshPeers(e){let r=this.mesh.get(e);return r!=null?Array.from(r):[]}getSubscribers(e){let r=this.topics.get(e);return(r!=null?Array.from(r):[]).map(n=>_r(n))}getTopics(){return Array.from(this.subscriptions)}async pipePeerReadStream(e,r){try{await en(r,async n=>{for await(let s of n)try{let i=s.subarray(),o=_u(i,this.decodeRpcLimits);if(this.metrics?.onRpcRecv(o,i.length),this.opts.awaitRpcHandler)try{await this.handleReceivedRpc(e,o)}catch(a){this.metrics?.onRpcRecvError(),this.log(a)}else this.handleReceivedRpc(e,o).catch(a=>{this.metrics?.onRpcRecvError(),this.log(a)})}catch(i){this.metrics?.onRpcDataError(),this.log(i)}})}catch(n){this.metrics?.onPeerReadStreamError(),this.handlePeerReadStreamError(n,e)}}handlePeerReadStreamError(e,r){this.log.error(e),this.onPeerDisconnected(r)}async handleReceivedRpc(e,r){if(!this.acceptFrom(e.toString())){this.log("received message from unacceptable peer %p",e),this.metrics?.rpcRecvNotAccepted.inc();return}let n=r.subscriptions!=null?r.subscriptions.length:0,s=r.messages!=null?r.messages.length:0,i=0,o=0,a=0,f=0;if(r.control!=null&&(r.control.ihave!=null&&(i=r.control.ihave.length),r.control.iwant!=null&&(o=r.control.iwant.length),r.control.graft!=null&&(a=r.control.graft.length),r.control.prune!=null&&(f=r.control.prune.length)),this.log(`rpc.from ${e.toString()} subscriptions ${n} messages ${s} ihave ${i} iwant ${o} graft ${a} prune ${f}`),r.subscriptions!=null&&r.subscriptions.length>0){let u=[];r.subscriptions.forEach(c=>{let l=c.topic,h=c.subscribe===!0;if(l!=null){if(this.allowedTopics!=null&&!this.allowedTopics.has(l))return;this.handleReceivedSubscription(e,l,h),u.push({topic:l,subscribe:h})}}),this.safeDispatchEvent("subscription-change",{detail:{peerId:e,subscriptions:u}})}if(r.messages!=null)for(let u of r.messages){if(this.allowedTopics!=null&&!this.allowedTopics.has(u.topic))continue;let c=this.handleReceivedMessage(e,u).catch(l=>{this.metrics?.onMsgRecvError(u.topic),this.log(l)});this.opts.awaitRpcMessageHandler&&await c}r.control!=null&&await this.handleControlMessage(e.toString(),r.control)}handleReceivedSubscription(e,r,n){this.log("subscription update from %p topic %s",e,r);let s=this.topics.get(r);s==null&&(s=new Set,this.topics.set(r,s)),n?s.add(e.toString()):s.delete(e.toString())}async handleReceivedMessage(e,r){this.metrics?.onMsgRecvPreValidation(r.topic);let n=await this.validateReceivedMessage(e,r);this.metrics?.onPrevalidationResult(r.topic,n.code);let s=n.code;switch(s){case He.duplicate:this.score.duplicateMessage(e.toString(),n.msgIdStr,r.topic),this.gossipTracer.deliverMessage(n.msgIdStr,!0),this.mcache.observeDuplicate(n.msgIdStr,e.toString());return;case He.invalid:if(n.msgIdStr!=null){let i=n.msgIdStr;this.score.rejectMessage(e.toString(),i,r.topic,n.reason),this.gossipTracer.rejectMessage(i,n.reason)}else this.score.rejectInvalidMessage(e.toString(),r.topic);this.metrics?.onMsgRecvInvalid(r.topic,n);return;case He.valid:this.score.validateMessage(n.messageId.msgIdStr),this.gossipTracer.deliverMessage(n.messageId.msgIdStr),this.mcache.put(n.messageId,r,!this.opts.asyncValidation),this.subscriptions.has(r.topic)&&(!this.components.peerId.equals(e)||this.opts.emitSelf)&&(super.dispatchEvent(new Sr("gossipsub:message",{detail:{propagationSource:e,msgId:n.messageId.msgIdStr,msg:n.msg}})),super.dispatchEvent(new Sr("message",{detail:n.msg}))),this.opts.asyncValidation||this.forwardMessage(n.messageId.msgIdStr,r,e.toString());break;default:throw new Error(`Invalid validation result: ${s}`)}}async validateReceivedMessage(e,r){let n=this.fastMsgIdFn?.(r),s=n!==void 0?this.fastMsgIdCache?.get(n):void 0;if(s!=null)return{code:He.duplicate,msgIdStr:s};let i=await P0(this.globalSignaturePolicy,r);if(!i.valid)return{code:He.invalid,reason:Ye.Error,error:i.error};let o=i.message;try{this.dataTransform!=null&&(o.data=this.dataTransform.inboundTransform(r.topic,o.data))}catch(l){return this.log("Invalid message, transform failed",l),{code:He.invalid,reason:Ye.Error,error:ze.TransformFailed}}let a=await this.msgIdFn(o),f=this.msgIdToStrFn(a),u={msgId:a,msgIdStr:f};if(n!==void 0&&this.fastMsgIdCache!=null&&this.fastMsgIdCache.put(n,f)&&this.metrics?.fastMsgIdCacheCollision.inc(),this.seenCache.has(f))return{code:He.duplicate,msgIdStr:f};this.seenCache.put(f);let c=this.topicValidators.get(r.topic);if(c!=null){let l;try{l=await c(e,o)}catch(h){let g=h.code;g===Ic&&(l=$e.Ignore),g===_c?l=$e.Reject:l=$e.Ignore}if(l!==$e.Accept)return{code:He.invalid,reason:ho(l),msgIdStr:f}}return{code:He.valid,messageId:u,msg:o}}getScore(e){return this.score.score(e)}sendSubscriptions(e,r,n){this.sendRpc(e,{subscriptions:r.map(s=>({topic:s,subscribe:n}))})}async handleControlMessage(e,r){if(r===void 0)return;let n=r.ihave!=null?this.handleIHave(e,r.ihave):[],s=r.iwant!=null?this.handleIWant(e,r.iwant):[],i=r.graft!=null?await this.handleGraft(e,r.graft):[];if(r.prune!=null&&await this.handlePrune(e,r.prune),n.length===0&&s.length===0&&i.length===0)return;let o=this.sendRpc(e,{messages:s,control:{iwant:n,prune:i}}),a=n[0]?.messageIDs;a!=null&&(o?this.gossipTracer.addPromise(e,a):this.metrics?.iwantPromiseUntracked.inc(1))}acceptFrom(e){if(this.direct.has(e))return!0;let r=Date.now(),n=this.acceptFromWhitelist.get(e);if(n!=null&&n.messagesAccepted<128&&n.acceptUntil>=r)return n.messagesAccepted+=1,!0;let s=this.score.score(e);return s>=0?this.acceptFromWhitelist.set(e,{messagesAccepted:0,acceptUntil:r+1e3}):this.acceptFromWhitelist.delete(e),s>=this.opts.scoreThresholds.graylistThreshold}handleIHave(e,r){if(r.length===0)return[];let n=this.score.score(e);if(n<this.opts.scoreThresholds.gossipThreshold)return this.log("IHAVE: ignoring peer %s with score below threshold [ score = %d ]",e,n),this.metrics?.ihaveRcvIgnored.inc({reason:sn.LowScore}),[];let s=(this.peerhave.get(e)??0)+1;if(this.peerhave.set(e,s),s>10)return this.log("IHAVE: peer %s has advertised too many times (%d) within this heartbeat interval; ignoring",e,s),this.metrics?.ihaveRcvIgnored.inc({reason:sn.MaxIhave}),[];let i=this.iasked.get(e)??0;if(i>=5e3)return this.log("IHAVE: peer %s has already advertised too many messages (%d); ignoring",e,i),this.metrics?.ihaveRcvIgnored.inc({reason:sn.MaxIasked}),[];let o=new Map;if(r.forEach(({topicID:u,messageIDs:c})=>{if(u==null||c==null||!this.mesh.has(u))return;let l=0;c.forEach(h=>{let g=this.msgIdToStrFn(h);this.seenCache.has(g)||(o.set(g,h),l++)}),this.metrics?.onIhaveRcv(u,c.length,l)}),o.size===0)return[];let a=o.size;a+i>5e3&&(a=5e3-i),this.log("IHAVE: Asking for %d out of %d messages from %s",a,o.size,e);let f=Array.from(o.values());return Ot(f),f=f.slice(0,a),this.iasked.set(e,i+a),[{messageIDs:f}]}handleIWant(e,r){if(r.length===0)return[];let n=this.score.score(e);if(n<this.opts.scoreThresholds.gossipThreshold)return this.log("IWANT: ignoring peer %s with score below threshold [score = %d]",e,n),[];let s=new Map,i=new Map,o=0;return r.forEach(({messageIDs:a})=>{a?.forEach(f=>{let u=this.msgIdToStrFn(f),c=this.mcache.getWithIWantCount(u,e);if(c==null){o++;return}if(i.set(c.msg.topic,1+(i.get(c.msg.topic)??0)),c.count>3){this.log("IWANT: Peer %s has asked for message %s too many times: ignoring request",e,f);return}s.set(u,c.msg)})}),this.metrics?.onIwantRcv(i,o),s.size===0?(this.log("IWANT: Could not provide any wanted messages to %s",e),[]):(this.log("IWANT: Sending %d messages to %s",s.size,e),Array.from(s.values()))}async handleGraft(e,r){let n=[],s=this.score.score(e),i=Date.now(),o=this.opts.doPX;if(r.forEach(({topicID:f})=>{if(f==null)return;let u=this.mesh.get(f);if(u==null){o=!1;return}if(u.has(e))return;if(this.direct.has(e)){this.log("GRAFT: ignoring request from direct peer %s",e),n.push(f),o=!1;return}let c=this.backoff.get(f)?.get(e);if(typeof c=="number"&&i<c){this.log("GRAFT: ignoring backed off peer %s",e),this.score.addPenalty(e,1,nn.GraftBackoff),o=!1;let l=c+this.opts.graftFloodThreshold-this.opts.pruneBackoff;i<l&&this.score.addPenalty(e,1,nn.GraftBackoff),this.addBackoff(e,f),n.push(f);return}if(s<0){this.log("GRAFT: ignoring peer %s with negative score: score=%d, topic=%s",e,s,f),n.push(f),o=!1,this.addBackoff(e,f);return}if(u.size>=this.opts.Dhi&&!(this.outbound.get(e)??!1)){n.push(f),this.addBackoff(e,f);return}this.log("GRAFT: Add mesh link from %s in %s",e,f),this.score.graft(e,f),u.add(e),this.metrics?.onAddToMesh(f,Ze.Subscribed,1)}),n.length===0)return[];let a=!1;return Promise.all(n.map(async f=>this.makePrune(e,f,o,a)))}async handlePrune(e,r){let n=this.score.score(e);for(let{topicID:s,backoff:i,peers:o}of r){if(s==null)continue;let a=this.mesh.get(s);if(a==null)return;if(this.log("PRUNE: Remove mesh link to %s in %s",e,s),this.score.prune(e,s),a.has(e)&&(a.delete(e),this.metrics?.onRemoveFromMesh(s,bt.Prune,1)),typeof i=="number"&&i>0?this.doAddBackoff(e,s,i*1e3):this.addBackoff(e,s),o!=null&&o.length>0){if(n<this.opts.scoreThresholds.acceptPXThreshold){this.log("PRUNE: ignoring PX from peer %s with insufficient score [score = %d, topic = %s]",e,n,s);continue}await this.pxConnect(o)}}}addBackoff(e,r){this.doAddBackoff(e,r,this.opts.pruneBackoff)}doAddBackoff(e,r,n){let s=this.backoff.get(r);s==null&&(s=new Map,this.backoff.set(r,s));let i=Date.now()+n;(s.get(e)??0)<i&&s.set(e,i)}applyIwantPenalties(){this.gossipTracer.getBrokenPromises().forEach((e,r)=>{this.log("peer %s didn't follow up in %d IWANT requests; adding penalty",r,e),this.score.addPenalty(r,e,nn.BrokenPromise)})}clearBackoff(){if(this.heartbeatTicks%15!==0)return;let e=Date.now();this.backoff.forEach((r,n)=>{r.forEach((s,i)=>{s+1*this.opts.heartbeatInterval<e&&r.delete(i)}),r.size===0&&this.backoff.delete(n)})}async directConnect(){let e=[];this.direct.forEach(r=>{this.streamsOutbound.has(r)||e.push(r)}),await Promise.all(e.map(async r=>this.connect(r)))}async pxConnect(e){e.length>this.opts.prunePeers&&(Ot(e),e=e.slice(0,this.opts.prunePeers));let r=[];await Promise.all(e.map(async n=>{if(n.peerID==null)return;let s=Xr(n.peerID),i=s.toString();if(!this.peers.has(i)){if(n.signedPeerRecord==null){r.push(i);return}try{if(!await this.components.peerStore.consumePeerRecord(n.signedPeerRecord,s)){this.log("bogus peer record obtained through px: could not add peer record to address book");return}r.push(i)}catch{this.log("bogus peer record obtained through px: invalid signature or not a peer record")}}})),r.length!==0&&await Promise.all(r.map(async n=>this.connect(n)))}async connect(e){this.log("Initiating connection with %s",e);let r=_r(e),n=await this.components.connectionManager.openConnection(r);for(let s of this.multicodecs)for(let i of this.components.registrar.getTopologies(s))i.onConnect?.(r,n)}subscribe(e){if(this.status.code!==ut.started)throw new Error("Pubsub has not started");if(!this.subscriptions.has(e)){this.subscriptions.add(e);for(let r of this.peers.keys())this.sendSubscriptions(r,[e],!0)}this.join(e)}unsubscribe(e){if(this.status.code!==ut.started)throw new Error("Pubsub is not started");let r=this.subscriptions.delete(e);if(this.log("unsubscribe from %s - am subscribed %s",e,r),r)for(let n of this.peers.keys())this.sendSubscriptions(n,[e],!1);this.leave(e)}join(e){if(this.status.code!==ut.started)throw new Error("Gossipsub has not started");if(this.mesh.has(e))return;this.log("JOIN %s",e),this.metrics?.onJoin(e);let r=new Set,n=this.backoff.get(e),s=this.fanout.get(e);if(s!=null&&(this.fanout.delete(e),this.fanoutLastpub.delete(e),s.forEach(i=>{!this.direct.has(i)&&this.score.score(i)>=0&&(n==null||!n.has(i))&&r.add(i)}),this.metrics?.onAddToMesh(e,Ze.Fanout,r.size)),r.size<this.opts.D){let i=r.size;this.getRandomGossipPeers(e,this.opts.D,a=>!r.has(a)&&!this.direct.has(a)&&this.score.score(a)>=0&&(n==null||!n.has(a))).forEach(a=>{r.add(a)}),this.metrics?.onAddToMesh(e,Ze.Random,r.size-i)}this.mesh.set(e,r),r.forEach(i=>{this.log("JOIN: Add mesh link to %s in %s",i,e),this.sendGraft(i,e)})}leave(e){if(this.status.code!==ut.started)throw new Error("Gossipsub has not started");this.log("LEAVE %s",e),this.metrics?.onLeave(e);let r=this.mesh.get(e);r!=null&&(Promise.all(Array.from(r).map(async n=>{this.log("LEAVE: Remove mesh link to %s in %s",n,e),await this.sendPrune(n,e)})).catch(n=>{this.log("Error sending prunes to mesh peers",n)}),this.mesh.delete(e))}selectPeersToForward(e,r,n){let s=new Set,i=this.topics.get(e);i!=null&&(this.direct.forEach(a=>{i.has(a)&&r!==a&&!(n?.has(a)??!1)&&s.add(a)}),this.floodsubPeers.forEach(a=>{i.has(a)&&r!==a&&!(n?.has(a)??!1)&&this.score.score(a)>=this.opts.scoreThresholds.publishThreshold&&s.add(a)}));let o=this.mesh.get(e);return o!=null&&o.size>0&&o.forEach(a=>{r!==a&&!(n?.has(a)??!1)&&s.add(a)}),s}selectPeersToPublish(e){let r=new Set,n={direct:0,floodsub:0,mesh:0,fanout:0},s=this.topics.get(e);if(s!=null)if(this.opts.floodPublish)s.forEach(i=>{this.direct.has(i)?(r.add(i),n.direct++):this.score.score(i)>=this.opts.scoreThresholds.publishThreshold&&(r.add(i),n.floodsub++)});else{this.direct.forEach(o=>{s.has(o)&&(r.add(o),n.direct++)}),this.floodsubPeers.forEach(o=>{s.has(o)&&this.score.score(o)>=this.opts.scoreThresholds.publishThreshold&&(r.add(o),n.floodsub++)});let i=this.mesh.get(e);if(i!=null&&i.size>0)i.forEach(o=>{r.add(o),n.mesh++});else{let o=this.fanout.get(e);if(o!=null&&o.size>0)o.forEach(a=>{r.add(a),n.fanout++});else{let a=this.getRandomGossipPeers(e,this.opts.D,f=>this.score.score(f)>=this.opts.scoreThresholds.publishThreshold);a.size>0&&(this.fanout.set(e,a),a.forEach(f=>{r.add(f),n.fanout++}))}this.fanoutLastpub.set(e,Date.now())}}return{tosend:r,tosendCount:n}}forwardMessage(e,r,n,s){n!=null&&this.score.deliverMessage(n,e,r.topic);let i=this.selectPeersToForward(r.topic,n,s);i.forEach(o=>{this.sendRpc(o,{messages:[r]})}),this.metrics?.onForwardMsg(r.topic,i.size)}async publish(e,r,n){let s=Date.now(),i=this.dataTransform!=null?this.dataTransform.outboundTransform(e,r):r;if(this.publishConfig==null)throw Error("PublishError.Uninitialized");let{raw:o,msg:a}=await T0(this.publishConfig,e,r,i),f=await this.msgIdFn(a),u=this.msgIdToStrFn(f),c=n?.ignoreDuplicatePublishError??this.opts.ignoreDuplicatePublishError;if(this.seenCache.has(u)){if(c)return this.metrics?.onPublishDuplicateMsg(e),{recipients:[]};throw Error("PublishError.Duplicate")}let{tosend:l,tosendCount:h}=this.selectPeersToPublish(e),g=this.opts.emitSelf&&this.subscriptions.has(e),p=n?.allowPublishToZeroPeers??this.opts.allowPublishToZeroPeers;if(l.size===0&&!p&&!g)throw Error("PublishError.InsufficientPeers");this.seenCache.put(u),this.mcache.put({msgId:f,msgIdStr:u},o,!0),this.publishedMessageIds.put(u);for(let y of l)this.sendRpc(y,{messages:[o]})||l.delete(y);let d=Date.now()-s;return this.metrics?.onPublishMsg(e,h,l.size,o.data!=null?o.data.length:0,d),g&&(l.add(this.components.peerId.toString()),super.dispatchEvent(new Sr("gossipsub:message",{detail:{propagationSource:this.components.peerId,msgId:u,msg:a}})),super.dispatchEvent(new Sr("message",{detail:a}))),{recipients:Array.from(l.values()).map(y=>_r(y))}}reportMessageValidationResult(e,r,n){let s;if(n===$e.Accept){if(s=this.mcache.validate(e),s!=null){let{message:o,originatingPeers:a}=s;this.score.deliverMessage(r,e,o.topic),this.forwardMessage(e,s.message,r,a)}}else if(s=this.mcache.remove(e),s!=null){let o=ho(n),{message:a,originatingPeers:f}=s;this.score.rejectMessage(r,e,a.topic,o);for(let u of f)this.score.rejectMessage(u,e,a.topic,o)}let i=this.score.messageFirstSeenTimestampMs(e);this.metrics?.onReportValidation(s,n,i)}sendGraft(e,r){let n=[{topicID:r}];this.sendRpc(e,{control:{graft:n}})}async sendPrune(e,r){let s=[await this.makePrune(e,r,this.opts.doPX,!0)];this.sendRpc(e,{control:{prune:s}})}sendRpc(e,r){let n=this.streamsOutbound.get(e);if(n==null)return this.log(`Cannot send RPC to ${e} as there is no open stream to it available`),!1;let s=this.control.get(e);s!=null&&(this.piggybackControl(e,r,s),this.control.delete(e));let i=this.gossip.get(e);i!=null&&(this.piggybackGossip(e,r,i),this.gossip.delete(e));let o=qn.encode(r).finish();try{n.push(o)}catch(a){return this.log.error(`Cannot send rpc to ${e}`,a),s!=null&&this.control.set(e,s),i!=null&&this.gossip.set(e,i),!1}return this.metrics?.onRpcSent(r,o.length),!0}piggybackControl(e,r,n){if(n.graft!=null){r.control==null&&(r.control={}),r.control.graft==null&&(r.control.graft=[]);for(let s of n.graft)s.topicID!=null&&(this.mesh.get(s.topicID)?.has(e)??!1)&&r.control.graft.push(s)}if(n.prune!=null){r.control==null&&(r.control={}),r.control.prune==null&&(r.control.prune=[]);for(let s of n.prune)s.topicID!=null&&!(this.mesh.get(s.topicID)?.has(e)??!1)&&r.control.prune.push(s)}}piggybackGossip(e,r,n){r.control==null&&(r.control={}),r.control.ihave=n}async sendGraftPrune(e,r,n){let s=this.opts.doPX,i=!1;for(let[o,a]of e){let f=a.map(l=>({topicID:l})),u=[],c=r.get(o);c!=null&&(u=await Promise.all(c.map(async l=>this.makePrune(o,l,s&&!(n.get(o)??!1),i))),r.delete(o)),this.sendRpc(o,{control:{graft:f,prune:u}})}for(let[o,a]of r){let f=await Promise.all(a.map(async u=>this.makePrune(o,u,s&&!(n.get(o)??!1),i)));this.sendRpc(o,{control:{prune:f}})}}emitGossip(e){let r=this.mcache.getGossipIDs(new Set(e.keys()));for(let[n,s]of e)this.doEmitGossip(n,s,r.get(n)??[])}doEmitGossip(e,r,n){if(n.length===0||(Ot(n),n.length>5e3&&this.log("too many messages for gossip; will truncate IHAVE list (%d messages)",n.length),r.size===0))return;let s=this.opts.Dlazy,i=.25*r.size,o=r;i>s&&(s=i),s>o.size?s=o.size:o=Ot(Array.from(o)).slice(0,s),o.forEach(a=>{let f=n;n.length>5e3&&(f=Ot(f.slice()).slice(0,5e3)),this.pushGossip(a,{topicID:e,messageIDs:f})})}flush(){for(let[e,r]of this.gossip.entries())this.gossip.delete(e),this.sendRpc(e,{control:{ihave:r}});for(let[e,r]of this.control.entries())this.control.delete(e),this.sendRpc(e,{control:{graft:r.graft,prune:r.prune}})}pushGossip(e,r){this.log("Add gossip to %s",e);let n=this.gossip.get(e)??[];this.gossip.set(e,n.concat(r))}async makePrune(e,r,n,s){if(this.score.prune(e,r),this.streamsOutbound.get(e)?.protocol===Qi)return{topicID:r,peers:[]};let i=s?this.opts.unsubcribeBackoff:this.opts.pruneBackoff,o=i/1e3;if(this.doAddBackoff(e,r,i),!n)return{topicID:r,peers:[],backoff:o};let a=this.getRandomGossipPeers(r,this.opts.prunePeers,u=>u!==e&&this.score.score(u)>=0),f=await Promise.all(Array.from(a).map(async u=>{let c=_r(u),l;try{l=await this.components.peerStore.get(c)}catch(h){if(h.code!=="ERR_NOT_FOUND")throw h}return{peerID:c.toBytes(),signedPeerRecord:l?.peerRecordEnvelope}}));return{topicID:r,peers:f,backoff:o}}runHeartbeat=()=>{let e=this.metrics?.heartbeatDuration.startTimer();this.heartbeat().catch(r=>{this.log("Error running heartbeat",r)}).finally(()=>{if(e?.(),this.status.code===ut.started){clearTimeout(this.status.heartbeatTimeout);let r=this.opts.heartbeatInterval-(Date.now()-this.status.hearbeatStartMs)%this.opts.heartbeatInterval;r<this.opts.heartbeatInterval*.25&&(r+=this.opts.heartbeatInterval,this.metrics?.heartbeatSkipped.inc()),this.status.heartbeatTimeout=setTimeout(this.runHeartbeat,r)}})};async heartbeat(){let{D:e,Dlo:r,Dhi:n,Dscore:s,Dout:i,fanoutTTL:o}=this.opts;this.heartbeatTicks++;let a=new Map,f=p=>{let d=a.get(p);return d===void 0&&(d=this.score.score(p),a.set(p,d)),d},u=new Map,c=new Map,l=new Map;this.clearBackoff(),this.peerhave.clear(),this.metrics?.cacheSize.set({cache:"iasked"},this.iasked.size),this.iasked.clear(),this.applyIwantPenalties(),this.heartbeatTicks%this.opts.directConnectTicks===0&&await this.directConnect(),this.fastMsgIdCache?.prune(),this.seenCache.prune(),this.gossipTracer.prune(),this.publishedMessageIds.prune();let h=new Map;this.mesh.forEach((p,d)=>{let y=this.topics.get(d),m=new Set,E=new Set;if(h.set(d,E),y!=null){let b=Ot(Array.from(y)),w=this.backoff.get(d);for(let I of b){let T=this.streamsOutbound.get(I);if(T!=null&&this.multicodecs.includes(T.protocol)&&!p.has(I)&&!this.direct.has(I)){let F=f(I);(w==null||!w.has(I))&&F>=0&&m.add(I),F>=this.opts.scoreThresholds.gossipThreshold&&E.add(I)}}}let v=(b,w)=>{this.log("HEARTBEAT: Remove mesh link to %s in %s",b,d),this.addBackoff(b,d),p.delete(b),f(b)>=this.opts.scoreThresholds.gossipThreshold&&E.add(b),this.metrics?.onRemoveFromMesh(d,w,1);let I=c.get(b);I==null?c.set(b,[d]):I.push(d)},C=(b,w)=>{this.log("HEARTBEAT: Add mesh link to %s in %s",b,d),this.score.graft(b,d),p.add(b),E.delete(b),this.metrics?.onAddToMesh(d,w,1);let I=u.get(b);I==null?u.set(b,[d]):I.push(d)};if(p.forEach(b=>{let w=f(b);w<0&&(this.log("HEARTBEAT: Prune peer %s with negative score: score=%d, topic=%s",b,w,d),v(b,bt.BadScore),l.set(b,!0))}),p.size<r){let b=e-p.size;Ku(m,b).forEach(I=>{C(I,Ze.NotEnough)})}if(p.size>n){let b=Array.from(p);b.sort((I,T)=>f(T)-f(I)),b=b.slice(0,s).concat(Ot(b.slice(s)));let w=0;if(b.slice(0,e).forEach(I=>{(this.outbound.get(I)??!1)&&w++}),w<i){let I=F=>{let K=b[F];for(let q=F;q>0;q--)b[q]=b[q-1];b[0]=K};if(w>0){let F=w;for(let K=1;K<e&&F>0;K++)(this.outbound.get(b[K])??!1)&&(I(K),F--)}let T=e-w;for(let F=e;F<b.length&&T>0;F++)(this.outbound.get(b[F])??!1)&&(I(F),T--)}b.slice(e).forEach(I=>{v(I,bt.Excess)})}if(p.size>=r){let b=0;if(p.forEach(w=>{(this.outbound.get(w)??!1)&&b++}),b<i){let w=i-b;_s(m,w,T=>this.outbound.get(T)===!0).forEach(T=>{C(T,Ze.Outbound)})}}if(this.heartbeatTicks%this.opts.opportunisticGraftTicks===0&&p.size>1){let b=Array.from(p).sort((T,F)=>f(T)-f(F)),w=Math.floor(p.size/2),I=f(b[w]);if(I<this.opts.scoreThresholds.opportunisticGraftThreshold){let T=this.opts.opportunisticGraftPeers,F=_s(m,T,K=>f(K)>I);for(let K of F)this.log("HEARTBEAT: Opportunistically graft peer %s on topic %s",K,d),C(K,Ze.Opportunistic)}}});let g=Date.now();this.fanoutLastpub.forEach((p,d)=>{p+o<g&&(this.fanout.delete(d),this.fanoutLastpub.delete(d))}),this.fanout.forEach((p,d)=>{let y=this.topics.get(d);p.forEach(C=>{(!(y?.has(C)??!1)||f(C)<this.opts.scoreThresholds.publishThreshold)&&p.delete(C)});let m=this.topics.get(d),E=[],v=new Set;if(h.set(d,v),m!=null){let C=Ot(Array.from(m));for(let b of C){let w=this.streamsOutbound.get(b);if(w!=null&&this.multicodecs.includes(w.protocol)&&!p.has(b)&&!this.direct.has(b)){let I=f(b);I>=this.opts.scoreThresholds.publishThreshold&&E.push(b),I>=this.opts.scoreThresholds.gossipThreshold&&v.add(b)}}}if(p.size<e){let C=e-p.size;E.slice(0,C).forEach(b=>{p.add(b),v?.delete(b)})}}),this.emitGossip(h),await this.sendGraftPrune(u,c,l),this.flush(),this.mcache.shift(),this.dispatchEvent(new Sr("gossipsub:heartbeat"))}getRandomGossipPeers(e,r,n=()=>!0){let s=this.topics.get(e);if(s==null)return new Set;let i=[];return s.forEach(o=>{let a=this.streamsOutbound.get(o);a!=null&&this.multicodecs.includes(a.protocol)&&n(o)&&i.push(o)}),i=Ot(i),r>0&&i.length>r&&(i=i.slice(0,r)),new Set(i)}onScrapeMetrics(e){e.mcacheSize.set(this.mcache.size),e.mcacheNotValidatedCount.set(this.mcache.notValidatedCount),e.cacheSize.set({cache:"direct"},this.direct.size),e.cacheSize.set({cache:"seenCache"},this.seenCache.size),e.cacheSize.set({cache:"fastMsgIdCache"},this.fastMsgIdCache?.size??0),e.cacheSize.set({cache:"publishedMessageIds"},this.publishedMessageIds.size),e.cacheSize.set({cache:"mcache"},this.mcache.size),e.cacheSize.set({cache:"score"},this.score.size),e.cacheSize.set({cache:"gossipTracer.promises"},this.gossipTracer.size),e.cacheSize.set({cache:"gossipTracer.requests"},this.gossipTracer.requestMsByMsgSize),e.cacheSize.set({cache:"topics"},this.topics.size),e.cacheSize.set({cache:"subscriptions"},this.subscriptions.size),e.cacheSize.set({cache:"mesh"},this.mesh.size),e.cacheSize.set({cache:"fanout"},this.fanout.size),e.cacheSize.set({cache:"peers"},this.peers.size),e.cacheSize.set({cache:"streamsOutbound"},this.streamsOutbound.size),e.cacheSize.set({cache:"streamsInbound"},this.streamsInbound.size),e.cacheSize.set({cache:"acceptFromWhitelist"},this.acceptFromWhitelist.size),e.cacheSize.set({cache:"gossip"},this.gossip.size),e.cacheSize.set({cache:"control"},this.control.size),e.cacheSize.set({cache:"peerhave"},this.peerhave.size),e.cacheSize.set({cache:"outbound"},this.outbound.size);let r=0,n=Date.now();e.connectedPeersBackoffSec.reset();for(let a of this.backoff.values()){r+=a.size;for(let[f,u]of a.entries())this.peers.has(f)&&e.connectedPeersBackoffSec.observe(Math.max(0,u-n)/1e3)}e.cacheSize.set({cache:"backoff"},r);for(let[a,f]of this.topics)e.topicPeersCount.set({topicStr:a},f.size);for(let[a,f]of this.mesh)e.meshPeerCounts.set({topicStr:a},f.size);let s=[],i=new Map;e.behaviourPenalty.reset();for(let a of this.peers.keys()){let f=this.score.score(a);s.push(f),i.set(a,f),e.behaviourPenalty.observe(this.score.peerStats.get(a)?.behaviourPenalty??0)}e.registerScores(s,this.opts.scoreThresholds),e.registerScorePerMesh(this.mesh,i);let o=Gu(this.peers.keys(),this.score.peerStats,this.score.params,this.score.peerIPs,e.topicStrToLabel);e.registerScoreWeights(o)}};function wb(t={}){return e=>new Ii(e,t)}return sh(Sb);})();
/*! Bundled license information:

@noble/hashes/esm/utils.js:
  (*! noble-hashes - MIT License (c) 2022 Paul Miller (paulmillr.com) *)

@noble/curves/esm/abstract/utils.js:
  (*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) *)

@noble/curves/esm/abstract/modular.js:
  (*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) *)

@noble/curves/esm/abstract/curve.js:
  (*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) *)

@noble/curves/esm/abstract/edwards.js:
  (*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) *)

@noble/curves/esm/ed25519.js:
  (*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) *)

@noble/curves/esm/abstract/weierstrass.js:
  (*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) *)

@noble/curves/esm/_shortw_utils.js:
  (*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) *)

@noble/curves/esm/secp256k1.js:
  (*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) *)
*/
return ChainsafeLibp2PGossipsub}));
